<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Helloï¼Welcom to Tumy-Timeï¼</title>
  
  
  <link href="http://tumytime.github.io/atom.xml" rel="self"/>
  
  <link href="http://tumytime.github.io/"/>
  <updated>2024-06-16T03:45:54.974Z</updated>
  <id>http://tumytime.github.io/</id>
  
  <author>
    <name>tumytime</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>videocaptureçš„bug</title>
    <link href="http://tumytime.github.io/2024/06/16/videocapture%E7%9A%84bug/"/>
    <id>http://tumytime.github.io/2024/06/16/videocapture%E7%9A%84bug/</id>
    <published>2024-06-16T03:45:42.000Z</published>
    <updated>2024-06-16T03:45:54.974Z</updated>
    
    <content type="html"><![CDATA[<pre><code>&lt;html lang=&quot;zh-CN&quot;&gt;&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;/&gt;  &lt;body class=&quot;nodata &quot; style=&quot;&quot;&gt;         &lt;main style=&quot;width:100%&quot;&gt;      &lt;div class=&quot;blog-content-box&quot;&gt;         &lt;div class=&quot;article-title-box&quot;&gt;            &lt;h1 class=&quot;title-article&quot; id=&quot;articleContentId&quot;&gt;opencvè¯»å–æ‘„åƒå¤´ä¸æ˜¯å®æ—¶çš„å¤„ç†æ–¹æ³•&lt;/h1&gt;        &lt;/div&gt;&lt;div id=&quot;article_content&quot; class=&quot;article_content clearfix&quot;&gt;    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/kdoc_html_views-1a98987dfd.css&quot;&gt;    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/ck_htmledit_views-044f2cf1dc.css&quot;&gt;                     &lt;div id=&quot;content_views&quot; class=&quot;markdown_views prism-atom-one-dark&quot;&gt;                &lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; style=&quot;display: none;&quot;&gt;                    &lt;path stroke-linecap=&quot;round&quot; d=&quot;M5,0 0,2.5 5,5z&quot; id=&quot;raphael-marker-block&quot; style=&quot;-webkit-tap-highlight-color: rgba(0, 0, 0, 0);&quot;&gt;&lt;/path&gt;                &lt;/svg&gt;                &lt;pre data-index=&quot;0&quot; class=&quot;set-code-show prettyprint&quot;&gt;&lt;code class=&quot;prism language-python has-numbering&quot; onclick=&quot;mdcp.copyCode(event)&quot; style=&quot;position: unset;&quot;&gt;cap &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; cv2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;VideoCapture&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;</code></pre><p>cap<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span></p><div class="hljs-button {2}" data-title="å¤åˆ¶"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li></ul></pre> <h2><a name="t0"></a><a id="___5"></a>è¯»å–çš„ä¸æ˜¯å®æ—¶çš„ç”»é¢ ï¼Œå­˜åœ¨å»¶è¿Ÿ æ€ä¹ˆå¤„ç†</h2> <blockquote>  <p>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯<a href="https://so.csdn.net/so/search?q=OpenCV%E5%BA%93&amp;spm=1001.2101.3001.7020" target="_blank" class="hl hl-1" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.7020&quot;,&quot;dest&quot;:&quot;https://so.csdn.net/so/search?q=OpenCV%E5%BA%93&amp;spm=1001.2101.3001.7020&quot;,&quot;extra&quot;:&quot;{\&quot;searchword\&quot;:\&quot;OpenCVåº“\&quot;}&quot;}" data-tit="OpenCVåº“" data-pretit="opencvåº“">OpenCVåº“</a>ï¼Œä½ å¯ä»¥é€šè¿‡å°†ç¼“å†²åŒºå¤§å°è®¾ç½®ä¸ºæ›´å°çš„å€¼æ¥å‡å°å»¶è¿Ÿã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œç¼“å†²åŒºå¤§å°æ˜¯16ï¼Œä½†å¯ä»¥é€šè¿‡åœ¨cv2.VideoCapture()ä¸­ä¼ é€’å‚æ•°æ¥æ›´æ”¹ã€‚ä¾‹å¦‚ï¼š</p> </blockquote> <pre data-index="1" class="set-code-show prettyprint"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;">cap <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>cap<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>CAP_PROP_BUFFERSIZE<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><div class="hljs-button &#123;2&#125;" data-title="å¤åˆ¶"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li></ul></pre> <blockquote>  <p>è¿™å°†æŠŠç¼“å†²åŒºå¤§å°å‡å°åˆ°1ï¼Œä»è€Œå‡å°å»¶è¿Ÿã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ å°†ç¼“å†²åŒºå¤§å°è®¾ç½®å¾—å¤ªå°ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°ç”»é¢å¡é¡¿æˆ–ä¸¢å¸§çš„é—®é¢˜ã€‚</p> </blockquote> <p>å¦ä¸€ç§æ–¹å¼æ˜¯ä½¿ç”¨å¤šçº¿ç¨‹æˆ–å¼‚æ­¥å¤„ç†æ¥å®ç°æ›´å¿«çš„ç”»é¢æ›´æ–°ã€‚ä½ å¯ä»¥åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­è¯»å–æ‘„åƒå¤´çš„å¸§ï¼Œå¹¶å°†å®ƒä»¬ä¼ é€’åˆ°å¦ä¸€ä¸ªçº¿ç¨‹æˆ–è¿›ç¨‹ä¸­è¿›è¡Œå¤„ç†å’Œæ˜¾ç¤ºã€‚è¿™å°†ä½¿ä½ èƒ½å¤Ÿæ›´å¿«åœ°å¤„ç†å¸§å¹¶å‡å°‘å»¶è¿Ÿã€‚ä½†æ˜¯ï¼Œè¿™éœ€è¦æ›´å¤šçš„ç¼–ç¨‹å’Œè®¡ç®—èµ„æºï¼Œå¹¶å¯èƒ½ä¼šå¢åŠ ä»£ç çš„å¤æ‚æ€§ã€‚</p> <h2><a name="t1"></a><a id="OpenCV_19"></a>ä¸‹é¢æ˜¯ä¸€ä¸ªåŸºæœ¬çš„å¤šçº¿ç¨‹å¤„ç†OpenCVè§†é¢‘å¸§çš„ä¾‹å­ï¼š</h2> <pre data-index="2" class="prettyprint set-code-show"><code class="prism language-python has-numbering" onclick="mdcp.copyCode(event)" style="position: unset;"><span class="token keyword">import</span> cv2<span class="token keyword">import</span> threading<span class="token keyword">class</span> <span class="token class-name">VideoCapture</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> src<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        self<span class="token punctuation">.</span>cap <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span>src<span class="token punctuation">)</span>        self<span class="token punctuation">.</span>cap<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span>cv2<span class="token punctuation">.</span>CAP_PROP_BUFFERSIZE<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>grabbed<span class="token punctuation">,</span> self<span class="token punctuation">.</span>frame <span class="token operator">=</span> self<span class="token punctuation">.</span>cap<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>        self<span class="token punctuation">.</span>started <span class="token operator">=</span> <span class="token boolean">False</span>        self<span class="token punctuation">.</span>read_lock <span class="token operator">=</span> threading<span class="token punctuation">.</span>Lock<span class="token punctuation">(</span><span class="token punctuation">)</span><pre><code>&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;self&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; self&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;started&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;        &lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&#39;VideoCapture already started&#39;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;None&lt;/span&gt;    self&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;started &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;True&lt;/span&gt;    self&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;thread &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; threading&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Thread&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;target&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;self&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;update&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; args&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;    self&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;thread&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;start&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; self&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;self&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;    &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; self&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;started&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;        grabbed&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; frame &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; self&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;cap&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;read&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;        &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt; self&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;read_lock&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;            self&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;grabbed &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; grabbed            self&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;frame &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; frame&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;self&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;    &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt; self&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;read_lock&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;        grabbed &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; self&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;grabbed        frame &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; self&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;frame    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; grabbed&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; frame&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;stop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;self&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;    self&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;started &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;False&lt;/span&gt;    self&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;thread&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;join&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;__exit__&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;self&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; exc_type&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; exc_value&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; traceback&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;    self&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;cap&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;release&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;</code></pre><p><span class="token keyword">if</span> <strong>name</strong> <span class="token operator">&#x3D;&#x3D;</span> <span class="token string">â€˜<strong>main</strong>â€˜</span><span class="token punctuation">:</span><br>    cap <span class="token operator">&#x3D;</span> VideoCapture<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span><br>        grabbed<span class="token punctuation">,</span> frame <span class="token operator">&#x3D;</span> cap<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><br>        <span class="token keyword">if</span> <span class="token keyword">not</span> grabbed<span class="token punctuation">:</span><br>            <span class="token keyword">break</span><br>        cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">â€˜frameâ€™</span><span class="token punctuation">,</span> frame<span class="token punctuation">)</span><br>        <span class="token keyword">if</span> cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span> <span class="token operator">&#x3D;&#x3D;</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">â€˜qâ€™</span><span class="token punctuation">)</span><span class="token punctuation">:</span><br>            <span class="token keyword">break</span><br>    cap<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span><br>    cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span></p><div class="hljs-button {2}" data-title="å¤åˆ¶"></div></code><ul class="pre-numbering" style=""><li style="color: rgb(153, 153, 153);">1</li><li style="color: rgb(153, 153, 153);">2</li><li style="color: rgb(153, 153, 153);">3</li><li style="color: rgb(153, 153, 153);">4</li><li style="color: rgb(153, 153, 153);">5</li><li style="color: rgb(153, 153, 153);">6</li><li style="color: rgb(153, 153, 153);">7</li><li style="color: rgb(153, 153, 153);">8</li><li style="color: rgb(153, 153, 153);">9</li><li style="color: rgb(153, 153, 153);">10</li><li style="color: rgb(153, 153, 153);">11</li><li style="color: rgb(153, 153, 153);">12</li><li style="color: rgb(153, 153, 153);">13</li><li style="color: rgb(153, 153, 153);">14</li><li style="color: rgb(153, 153, 153);">15</li><li style="color: rgb(153, 153, 153);">16</li><li style="color: rgb(153, 153, 153);">17</li><li style="color: rgb(153, 153, 153);">18</li><li style="color: rgb(153, 153, 153);">19</li><li style="color: rgb(153, 153, 153);">20</li><li style="color: rgb(153, 153, 153);">21</li><li style="color: rgb(153, 153, 153);">22</li><li style="color: rgb(153, 153, 153);">23</li><li style="color: rgb(153, 153, 153);">24</li><li style="color: rgb(153, 153, 153);">25</li><li style="color: rgb(153, 153, 153);">26</li><li style="color: rgb(153, 153, 153);">27</li><li style="color: rgb(153, 153, 153);">28</li><li style="color: rgb(153, 153, 153);">29</li><li style="color: rgb(153, 153, 153);">30</li><li style="color: rgb(153, 153, 153);">31</li><li style="color: rgb(153, 153, 153);">32</li><li style="color: rgb(153, 153, 153);">33</li><li style="color: rgb(153, 153, 153);">34</li><li style="color: rgb(153, 153, 153);">35</li><li style="color: rgb(153, 153, 153);">36</li><li style="color: rgb(153, 153, 153);">37</li><li style="color: rgb(153, 153, 153);">38</li><li style="color: rgb(153, 153, 153);">39</li><li style="color: rgb(153, 153, 153);">40</li><li style="color: rgb(153, 153, 153);">41</li><li style="color: rgb(153, 153, 153);">42</li><li style="color: rgb(153, 153, 153);">43</li><li style="color: rgb(153, 153, 153);">44</li><li style="color: rgb(153, 153, 153);">45</li><li style="color: rgb(153, 153, 153);">46</li><li style="color: rgb(153, 153, 153);">47</li><li style="color: rgb(153, 153, 153);">48</li><li style="color: rgb(153, 153, 153);">49</li><li style="color: rgb(153, 153, 153);">50</li></ul></pre> <blockquote>  <p>è¿™ä¸ªä¾‹å­ä½¿ç”¨äº†ä¸€ä¸ª<a href="https://so.csdn.net/so/search?q=VideoCapture&amp;spm=1001.2101.3001.7020" target="_blank" class="hl hl-1" data-report-view="{&quot;spm&quot;:&quot;1001.2101.3001.7020&quot;,&quot;dest&quot;:&quot;https://so.csdn.net/so/search?q=VideoCapture&amp;spm=1001.2101.3001.7020&quot;,&quot;extra&quot;:&quot;{\&quot;searchword\&quot;:\&quot;VideoCapture\&quot;}&quot;}" data-report-click="{&quot;spm&quot;:&quot;1001.2101.3001.7020&quot;,&quot;dest&quot;:&quot;https://so.csdn.net/so/search?q=VideoCapture&amp;spm=1001.2101.3001.7020&quot;,&quot;extra&quot;:&quot;{\&quot;searchword\&quot;:\&quot;VideoCapture\&quot;}&quot;}" data-tit="VideoCapture" data-pretit="videocapture">VideoCapture</a>ç±»ï¼Œè¯¥ç±»åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­ä¸æ–­è¯»å–æ‘„åƒå¤´å¸§ï¼Œå¹¶å°†å®ƒä»¬ä¿å­˜åœ¨ä¸€ä¸ªå…±äº«çš„grabbedå’Œframeå˜é‡ä¸­ã€‚åœ¨ä¸»ç¨‹åºä¸­ï¼Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨start()æ–¹æ³•æ¥å¯åŠ¨çº¿ç¨‹ï¼Œç„¶åä¸æ–­è¯»å–å¸§å¹¶åœ¨çª—å£ä¸­æ˜¾ç¤ºå®ƒä»¬ï¼Œç›´åˆ°ç”¨æˆ·æŒ‰ä¸‹â€™qâ€™é”®é€€å‡ºã€‚æœ€åï¼Œæˆ‘ä»¬è°ƒç”¨stop()æ–¹æ³•æ¥åœæ­¢çº¿ç¨‹å¹¶é‡Šæ”¾èµ„æºã€‚</p> </blockquote> <p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªä¾‹å­ä»…ä»…æ˜¯ä¸€ä¸ªåŸºæœ¬çš„æ¡†æ¶ï¼Œä½ å¯èƒ½éœ€è¦å¯¹å…¶è¿›è¡Œä¿®æ”¹å’Œæ‰©å±•ä»¥é€‚åº”ä½ çš„å…·ä½“åº”ç”¨åœºæ™¯ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥æ·»åŠ ä¸€ä¸ªå¦ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†å¸§ï¼Œç„¶åæ˜¾ç¤ºå¤„ç†åçš„ç»“æœï¼Œä»¥æ­¤æ¥å‡å°‘å»¶è¿Ÿã€‚</p>                </div><div data-report-view="{&quot;mod&quot;:&quot;1585297308_001&quot;,&quot;spm&quot;:&quot;1001.2101.3001.6548&quot;,&quot;dest&quot;:&quot;https://blog.csdn.net/qq_26696715/article/details/129686980&quot;,&quot;extend1&quot;:&quot;pc&quot;,&quot;ab&quot;:&quot;new&quot;}"><div></div></div>                <link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/editerView/markdown_views-f23dff6052.css" rel="stylesheet">                <link href="https://csdnimg.cn/release/blogv2/dist/mdeditor/css/style-c216769e99.css" rel="stylesheet">        </div>            </div>             <pre><code>          &lt;/main&gt;        &lt;/body&gt;   &lt;/html&gt;        </code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;pre&gt;&lt;code&gt;&amp;lt;html lang=&amp;quot;zh-CN&amp;quot;&amp;gt;
&amp;lt;meta http-equiv=&amp;quot;Content-Type&amp;quot; content=&amp;quot;text/html; charset=utf-8&amp;quot;/&amp;gt</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>C++å¤šçº¿ç¨‹</title>
    <link href="http://tumytime.github.io/2024/06/03/C-%E5%A4%9A%E7%BA%BF%E7%A8%8B/"/>
    <id>http://tumytime.github.io/2024/06/03/C-%E5%A4%9A%E7%BA%BF%E7%A8%8B/</id>
    <published>2024-06-03T05:30:23.000Z</published>
    <updated>2024-06-14T11:54:39.061Z</updated>
    
    <content type="html"><![CDATA[<div class="note info"><p>ä¸Šæ¬¡æ›´æ–°blogè¿˜æ˜¯ç”Ÿæ—¥4.29ï¼Œè¿™ä¸€ä¸ªæœˆçœŸæ˜¯å¿™é¼ äº†ï¼Œç°åœ¨æœ‰äº†ä¸€ä¸ªæ–°ä»»åŠ¡-å¤šçº¿ç¨‹ï¼Œæä¸€ä¸‹(ä¸åŠ å¤šçº¿ç¨‹çš„è¯æˆ‘çš„è½¦è½¦ä¼šå˜æˆèœ—ç‰›ğŸŒçš„ã€‚ã€‚ã€‚ã€‚)</p></div><h2 id="ç®€å•ç¤ºä¾‹"><a href="#ç®€å•ç¤ºä¾‹" class="headerlink" title="ç®€å•ç¤ºä¾‹"></a>ç®€å•ç¤ºä¾‹</h2><h3 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h3><p>å½“æˆ‘ä»¬è°ˆè®ºå¤šçº¿ç¨‹æ—¶ï¼Œå¯ä»¥æƒ³è±¡æˆä¸€ä¸ªäººåŒæ—¶åœ¨åšå¤šä¸ªäº‹æƒ…ï¼Œå°±åƒä¸€ä¸ªäººæ—¢å¯ä»¥åŒæ—¶åƒé¥­åˆå¯ä»¥åŒæ—¶å†™ä½œä¸šä¸€æ ·ã€‚åœ¨C++ä¸­ï¼Œä½¿ç”¨å¤šçº¿ç¨‹å¯ä»¥è®©æˆ‘ä»¬çš„ç¨‹åºåŒæ—¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡ï¼Œæé«˜ç¨‹åºçš„æ•ˆç‡å’Œæ€§èƒ½ã€‚</p><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬ç”¨ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥ç†è§£å¤šçº¿ç¨‹ã€‚å‡è®¾ä½ æœ‰ä¸€ä¸ªå¨æˆ¿ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªå¨å¸ˆåœ¨ç…®é¢æ¡ï¼Œä¸€ä¸ªå¨å¸ˆåœ¨ç‚’èœï¼Œè¿˜æœ‰ä¸€ä¸ªæœåŠ¡å‘˜åœ¨ç«¯èœã€‚è¿™å°±ç›¸å½“äºä¸€ä¸ªæœ‰å¤šä¸ªçº¿ç¨‹çš„ç¨‹åºï¼Œæ¯ä¸ªçº¿ç¨‹è´Ÿè´£ä¸åŒçš„ä»»åŠ¡ã€‚</p><p>åœ¨C++ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>&lt;thread&gt;</code> å¤´æ–‡ä»¶æ¥åˆ›å»ºå’Œç®¡ç†çº¿ç¨‹ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œåœ¨è¿™ä¸ªå‡½æ•°ä¸­åŒ…å«æˆ‘ä»¬å¸Œæœ›çº¿ç¨‹æ‰§è¡Œçš„ä»»åŠ¡ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>std::thread</code> ç±»æ¥åˆ›å»ºçº¿ç¨‹å¹¶æŒ‡å®šè¦æ‰§è¡Œçš„å‡½æ•°ã€‚</p><p>è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œä½œä¸ºçº¿ç¨‹çš„å…¥å£</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">printMessage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Hello from thread!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œå¹¶æŒ‡å®šè¦æ‰§è¡Œçš„å‡½æ•°</span></span><br><span class="line">    <span class="function">std::thread <span class="title">t1</span><span class="params">(printMessage)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸»çº¿ç¨‹ç»§ç»­æ‰§è¡Œè‡ªå·±çš„ä»»åŠ¡</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Hello from main thread!&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç­‰å¾…çº¿ç¨‹ t1 æ‰§è¡Œå®Œæ¯•</span></span><br><span class="line">    t1.<span class="built_in">join</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªç®€å•çš„å‡½æ•° <code>printMessage</code>ï¼Œå¹¶åœ¨ä¸»å‡½æ•°ä¸­åˆ›å»ºäº†ä¸€ä¸ªæ–°çº¿ç¨‹ <code>t1</code>ï¼Œè®©å®ƒæ‰§è¡Œè¿™ä¸ªå‡½æ•°ã€‚åŒæ—¶ï¼Œä¸»å‡½æ•°ä¹Ÿä¼šç»§ç»­æ‰§è¡Œï¼Œè¾“å‡º â€œHello from main thread!â€ã€‚æœ€åæˆ‘ä»¬ä½¿ç”¨ <code>join()</code> å‡½æ•°ç­‰å¾…çº¿ç¨‹ <code>t1</code> çš„æ‰§è¡Œå®Œæˆã€‚</p><p>è¿™æ ·ï¼Œå°±å®ç°äº†ä¸€ä¸ªç®€å•çš„å¤šçº¿ç¨‹ç¨‹åºã€‚é€šè¿‡åˆç†åœ°ä½¿ç”¨å¤šçº¿ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥æ›´é«˜æ•ˆåœ°åˆ©ç”¨è®¡ç®—æœºçš„èµ„æºï¼ŒåŠ å¿«ç¨‹åºçš„è¿è¡Œé€Ÿåº¦ã€‚å½“ç„¶ï¼Œåœ¨å®é™…ç¼–ç¨‹ä¸­ï¼Œè¿˜éœ€è¦è€ƒè™‘çº¿ç¨‹ä¹‹é—´çš„åŒæ­¥ã€äº’æ–¥è®¿é—®ç­‰é—®é¢˜ï¼Œä»¥ä¿è¯ç¨‹åºçš„æ­£ç¡®æ€§å’Œç¨³å®šæ€§ã€‚</p><h3 id="std-thread-t1-printMessage-ä»£è¡¨ç€çº¿ç¨‹å¼€å§‹æ‰§è¡Œå—"><a href="#std-thread-t1-printMessage-ä»£è¡¨ç€çº¿ç¨‹å¼€å§‹æ‰§è¡Œå—" class="headerlink" title="std::thread t1(printMessage);ä»£è¡¨ç€çº¿ç¨‹å¼€å§‹æ‰§è¡Œå—"></a>std::thread t1(printMessage);ä»£è¡¨ç€çº¿ç¨‹å¼€å§‹æ‰§è¡Œå—</h3><p>æ˜¯çš„ï¼Œå½“ä½ åˆ›å»ºä¸€ä¸ª <code>std::thread</code> å¯¹è±¡å¹¶ä¼ å…¥è¦æ‰§è¡Œçš„å‡½æ•°ï¼Œçº¿ç¨‹å°±ä¼šå¼€å§‹æ‰§è¡Œè¿™ä¸ªå‡½æ•°ã€‚åœ¨ä½ çš„ä¾‹å­ä¸­ï¼Œ<code>std::thread t1(printMessage);</code>è¿™ä¸€è¡Œä»£ç å°±ä»£è¡¨ç€çº¿ç¨‹å¼€å§‹æ‰§è¡Œ <code>printMessage</code> å‡½æ•°ã€‚è¿™æ„å‘³ç€åœ¨è¿è¡Œæ—¶ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„çº¿ç¨‹æ¥æ‰§è¡Œ <code>printMessage</code> å‡½æ•°ä¸­çš„ä»£ç ï¼ŒåŒæ—¶ä¸»çº¿ç¨‹ä¼šç»§ç»­æ‰§è¡Œåé¢çš„ä»£ç ã€‚</p><p>ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œçº¿ç¨‹çš„å¯åŠ¨å¹¶ä¸æ˜¯ç«‹å³æ‰§è¡Œ <code>printMessage</code> å‡½æ•°ä¸­çš„ä»£ç ï¼Œè€Œæ˜¯åœ¨<code>std::thread</code> å¯¹è±¡è¢«åˆ›å»ºä¹‹åæ‰ä¼šæ‰§è¡Œã€‚å¦‚æœç«‹å³è°ƒç”¨ <code>join()</code> å‡½æ•°ï¼Œä¸»çº¿ç¨‹ä¼šç­‰å¾…æ–°çº¿ç¨‹æ‰§è¡Œå®Œæ¯•å†ç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚è¿™ç§æ–¹å¼ä¿è¯äº†çº¿ç¨‹çš„åŒæ­¥æ‰§è¡Œã€‚</p><p>å› æ­¤ï¼Œåœ¨ä¸Šé¢æä¾›çš„ç¤ºä¾‹ä»£ç ä¸­ï¼Œ<code>std::thread t1(printMessage);</code>è¿™ä¸€è¡Œä»£ç ä¼šä½¿å¾—æ–°çº¿ç¨‹å¼€å§‹æ‰§è¡Œ <code>printMessage</code> å‡½æ•°ï¼Œè€Œä¸»çº¿ç¨‹ä¼šç»§ç»­æ‰§è¡Œç´§éšå…¶åçš„ä»£ç ï¼Œç›´åˆ°é‡åˆ° <code>t1.join();</code>ã€‚</p><p>åœ¨C++ä¸­ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨std::threadæ¥åˆ›å»ºçº¿ç¨‹ï¼Œçº¿ç¨‹çš„å¯åŠ¨ç¡®å®ä¸ä¼šç«‹å³æ‰§è¡Œçº¿ç¨‹å‡½æ•°ä¸­çš„ä»£ç ã€‚å½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªstd::threadå¯¹è±¡ï¼ŒæŒ‡å®šè¦æ‰§è¡Œçš„çº¿ç¨‹å‡½æ•°ï¼Œå¹¶è°ƒç”¨è¯¥std::threadå¯¹è±¡çš„æ„é€ å‡½æ•°æ—¶ï¼Œçº¿ç¨‹å¯¹è±¡å°±ä¼šè¢«åˆ›å»ºï¼Œä½†çº¿ç¨‹å‡½æ•°çš„ä»£ç å¹¶ä¸ä¼šç«‹å³æ‰§è¡Œã€‚å®é™…ä¸Šçº¿ç¨‹çš„å®é™…æ‰§è¡Œæ—¶æœºå–å†³äºæ“ä½œç³»ç»Ÿçš„è°ƒåº¦å™¨ï¼Œåœ¨åˆé€‚çš„æ—¶æœºä¼šå¼€å§‹æ‰§è¡Œçº¿ç¨‹å‡½æ•°ã€‚</p><p>å¦‚æœåœ¨ä¸»çº¿ç¨‹ä¸­ç«‹å³è°ƒç”¨æ–°çº¿ç¨‹çš„join()å‡½æ•°ï¼Œä¸»çº¿ç¨‹å°†ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°æ–°çº¿ç¨‹çš„æ‰§è¡Œå®Œæˆã€‚è¿™ç§æ–¹å¼ç¡®ä¿äº†çº¿ç¨‹çš„åŒæ­¥æ‰§è¡Œï¼Œå³ä¸»çº¿ç¨‹ä¼šç­‰å¾…æ–°çº¿ç¨‹æ‰§è¡Œå®Œæ¯•åæ‰ä¼šç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸»çº¿ç¨‹å’Œæ–°çº¿ç¨‹æ˜¯åŒæ­¥æ‰§è¡Œçš„ï¼Œä¸»çº¿ç¨‹èµ·åˆ°äº†ç­‰å¾…å’Œåè°ƒçš„ä½œç”¨ã€‚</p><p>æ€»ç»“ï¼šé€šè¿‡è°ƒç”¨join()å‡½æ•°å®ç°çº¿ç¨‹åŒæ­¥æ‰§è¡Œçš„æµç¨‹æ˜¯è¿™æ ·çš„ï¼Œå…ˆåˆ›å»ºæ–°çš„çº¿ç¨‹å¯¹è±¡ï¼Œç„¶åè°ƒç”¨join()å‡½æ•°ä½¿å¾—ä¸»çº¿ç¨‹ç­‰å¾…æ–°çº¿ç¨‹çš„æ‰§è¡Œå®Œæˆï¼Œå¾…æ–°çº¿ç¨‹æ‰§è¡Œå®Œæ¯•åï¼Œä¸»çº¿ç¨‹æ‰ç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚è¿™ç§æ–¹å¼ä¿è¯äº†çº¿ç¨‹çš„åŒæ­¥æ‰§è¡Œï¼Œç‰¹åˆ«é€‚ç”¨äºéœ€è¦æ–°çº¿ç¨‹æ‰§è¡Œå®Œæ¯•åæ‰èƒ½ç»§ç»­ä¸»çº¿ç¨‹æ“ä½œçš„åœºæ™¯ã€‚</p><h2 id="è¿›é˜¶å®ä¾‹-äº’æ–¥é”"><a href="#è¿›é˜¶å®ä¾‹-äº’æ–¥é”" class="headerlink" title="è¿›é˜¶å®ä¾‹(äº’æ–¥é”)"></a>è¿›é˜¶å®ä¾‹(äº’æ–¥é”)</h2><p>è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªç¨å¾®å¤æ‚ä¸€ç‚¹çš„å¤šçº¿ç¨‹ä¾‹å­ï¼Œè€ƒè™‘ä¸€ä¸ªç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæœ‰ä¸€ä¸ªç”Ÿäº§è€…çº¿ç¨‹è´Ÿè´£ç”Ÿäº§æ•°æ®ï¼Œç„¶åå°†æ•°æ®å‘é€ç»™ä¸€ä¸ªç¼“å†²åŒºï¼ŒåŒæ—¶ä¸€ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹ä»ç¼“å†²åŒºä¸­å–å‡ºæ•°æ®è¿›è¡Œæ¶ˆè´¹ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;condition_variable&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span></span></span><br><span class="line"></span><br><span class="line">std::queue&lt;<span class="type">int</span>&gt; buffer;</span><br><span class="line">std::mutex mtx;</span><br><span class="line">std::condition_variable cv;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">producer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i) &#123;</span><br><span class="line">        std::this_thread::<span class="built_in">sleep_for</span>(std::chrono::<span class="built_in">milliseconds</span>(<span class="number">500</span>)); <span class="comment">// æ¨¡æ‹Ÿç”Ÿäº§æ•°æ®çš„è€—æ—¶æ“ä½œ</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="function">std::lock_guard&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(mtx)</span></span>;</span><br><span class="line">            buffer.<span class="built_in">push</span>(i);</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;Produced: &quot;</span> &lt;&lt; i &lt;&lt; std::endl;</span><br><span class="line">        &#125;</span><br><span class="line">        cv.<span class="built_in">notify_one</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">consumer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i) &#123;</span><br><span class="line">        <span class="function">std::unique_lock&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(mtx)</span></span>;</span><br><span class="line">        cv.<span class="built_in">wait</span>(lock, []&#123; <span class="keyword">return</span> !buffer.<span class="built_in">empty</span>(); &#125;);</span><br><span class="line">        <span class="type">int</span> data = buffer.<span class="built_in">front</span>();</span><br><span class="line">        buffer.<span class="built_in">pop</span>();</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Consumed: &quot;</span> &lt;&lt; data &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">std::thread <span class="title">producerThread</span><span class="params">(producer)</span></span>;</span><br><span class="line">    <span class="function">std::thread <span class="title">consumerThread</span><span class="params">(consumer)</span></span>;</span><br><span class="line"></span><br><span class="line">    producerThread.<span class="built_in">join</span>();</span><br><span class="line">    consumerThread.<span class="built_in">join</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªäº’æ–¥é”ï¼ˆstd::mutexï¼‰æ¥ä¿æŠ¤å…±äº«çš„æ•°æ®ç»“æ„ï¼ˆé˜Ÿåˆ—bufferï¼‰ï¼Œç”Ÿäº§è€…çº¿ç¨‹å¾€é˜Ÿåˆ—ä¸­å†™å…¥æ•°æ®ï¼Œæ¶ˆè´¹è€…çº¿ç¨‹ä»é˜Ÿåˆ—ä¸­è¯»å–æ•°æ®ã€‚é€šè¿‡æ¡ä»¶å˜é‡ï¼ˆstd::condition_variableï¼‰å®ç°äº†ç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…ä¹‹é—´çš„åŒæ­¥ã€‚</p><p>ç”Ÿäº§è€…ä¸æ–­åœ°åœ¨é˜Ÿåˆ—ä¸­æ’å…¥æ•°æ®ï¼Œæ¶ˆè´¹è€…åˆ™ç­‰å¾…é˜Ÿåˆ—ä¸­æœ‰æ•°æ®åè¿›è¡Œæ¶ˆè´¹ã€‚å½“é˜Ÿåˆ—ä¸­æœ‰æ•°æ®æ—¶ï¼Œæ¶ˆè´¹è€…çº¿ç¨‹è¢«å”¤é†’ï¼Œæ¶ˆè´¹æ•°æ®å¹¶è¾“å‡ºï¼Œç›´è‡³ç”Ÿäº§è€…ç”Ÿäº§å®Œæ‰€æœ‰æ•°æ®ã€‚æ•´ä¸ªè¿‡ç¨‹åˆ©ç”¨äº’æ–¥é”å’Œæ¡ä»¶å˜é‡å®ç°äº†çº¿ç¨‹ä¹‹é—´çš„åŒæ­¥æ“ä½œï¼Œç¡®ä¿äº†æ•°æ®çš„æ­£ç¡®ç”Ÿäº§å’Œæ¶ˆè´¹ã€‚</p><ol><li><p><strong>å‰ä¸‰è¡Œæ„æ€</strong></p><p> è¿™ä¸‰è¡Œä»£ç å£°æ˜äº†ä¸€ä¸ªæ•´å‹é˜Ÿåˆ— <code>buffer</code>ï¼Œä¸€ä¸ªäº’æ–¥é” <code>mtx</code> å’Œä¸€ä¸ªæ¡ä»¶å˜é‡ <code>cv</code>ã€‚ </p><ul><li><p><code>std::queue&lt;int&gt; buffer;</code>ï¼šè¿™è¡Œä»£ç å®šä¹‰äº†ä¸€ä¸ªSTLé˜Ÿåˆ—ï¼Œå…¶ä¸­å­˜å‚¨æ•´å‹æ•°æ®ã€‚åœ¨ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å‹ä¸­ï¼Œ<code>buffer</code>ç”¨äºå­˜å‚¨ç”Ÿäº§è€…ç”Ÿæˆçš„æ•°æ®ï¼Œåœ¨ç”Ÿäº§è€…çº¿ç¨‹å°†æ•°æ®å†™å…¥é˜Ÿåˆ—ï¼Œæ¶ˆè´¹è€…çº¿ç¨‹ä»é˜Ÿåˆ—ä¸­å–å‡ºæ•°æ®è¿›è¡Œæ¶ˆè´¹ã€‚</p></li><li><p><code>std::mutex mtx;</code>ï¼šè¿™è¡Œä»£ç å®šä¹‰äº†ä¸€ä¸ªäº’æ–¥é”ï¼Œç”¨äºåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­å¯¹å…±äº«æ•°æ®ç»“æ„è¿›è¡Œè®¿é—®æ§åˆ¶ã€‚åœ¨æ­¤ä¾‹ä¸­ï¼Œ<code>mtx</code> ç”¨äºä¿æŠ¤é˜Ÿåˆ— <code>buffer</code>ï¼Œç¡®ä¿åœ¨ä»»ä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®é˜Ÿåˆ—ã€‚</p></li><li><p><code>std::condition_variable cv;</code>ï¼šè¿™è¡Œä»£ç å®šä¹‰äº†ä¸€ä¸ªæ¡ä»¶å˜é‡ï¼Œç”¨äºçº¿ç¨‹é—´çš„åŒæ­¥ã€‚åœ¨æ­¤ä¾‹ä¸­ï¼Œ<code>cv</code> ç”¨äºé€šçŸ¥æ¶ˆè´¹è€…çº¿ç¨‹æœ‰æ–°çš„æ•°æ®å¯ç”¨äºæ¶ˆè´¹ã€‚æ¶ˆè´¹è€…çº¿ç¨‹ä¼šé€šè¿‡ <code>wait()</code> æ¥ç­‰å¾…ç”Ÿäº§è€…é€šçŸ¥ï¼Œä¸€æ—¦æœ‰æ•°æ®å¯ç”¨ï¼Œå®ƒä¼šè¢« <code>notify_one()</code> é€šçŸ¥å¯ä»¥ç»§ç»­æ‰§è¡Œã€‚</p></li></ul><p> è¿™äº›æœºåˆ¶å…±åŒæ„æˆäº†ä¸€ä¸ªç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ï¼Œç¡®ä¿åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ•°æ®çš„å®‰å…¨è®¿é—®å’ŒåŒæ­¥å¤„ç†ã€‚</p></li><li><p><strong>ä¸ºä»€ä¹ˆç¡®ä¿åœ¨ä»»ä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®é˜Ÿåˆ—</strong><br> åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œå¦‚æœä¸å¯¹å…±äº«æ•°æ®ç»“æ„ï¼ˆæ¯”å¦‚é˜Ÿåˆ—ï¼‰è¿›è¡Œä¿æŠ¤ï¼Œå°±å¯èƒ½å¯¼è‡´æ•°æ®ç«äº‰ï¼ˆData Raceï¼‰çš„é—®é¢˜ã€‚æ•°æ®ç«äº‰æŒ‡çš„æ˜¯å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®å…±äº«æ•°æ®ï¼Œå…¶ä¸­è‡³å°‘ä¸€ä¸ªçº¿ç¨‹å¯¹æ•°æ®è¿›è¡Œå†™æ“ä½œï¼Œè€Œå…¶ä»–çº¿ç¨‹è¿›è¡Œè¯»æˆ–å†™æ“ä½œï¼Œä»è€Œå¯¼è‡´æœªå®šä¹‰è¡Œä¸ºã€‚å¯¹äºé˜Ÿåˆ—è¿™æ ·çš„æ•°æ®ç»“æ„ï¼Œå¦‚æœæ²¡æœ‰äº’æ–¥è®¿é—®ï¼Œä¼šå¯¼è‡´ä»¥ä¸‹é—®é¢˜ï¼š</p><ul><li><p>ä¸ç¡®å®šæ€§ï¼šå¤šä¸ªçº¿ç¨‹åŒæ—¶å¯¹é˜Ÿåˆ—è¿›è¡Œæ“ä½œï¼Œå¯èƒ½é€ æˆé˜Ÿåˆ—ä¸­æ•°æ®çš„ä¹±åºæˆ–ä¸¢å¤±ï¼Œå¯¼è‡´ç¨‹åºé€»è¾‘é”™è¯¯ã€‚</p></li><li><p>æ•°æ®æŸåï¼šå½“ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨ä¿®æ”¹é˜Ÿåˆ—ä¸­çš„æ•°æ®æ—¶ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å¯èƒ½åŒæ—¶è¯»å–æˆ–ä¿®æ”¹è¿™äº›æ•°æ®ï¼Œé€ æˆæ„å¤–çš„æ•°æ®æŸåã€‚</p></li><li><p>æ­»é”ï¼šå¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶å°è¯•å¯¹é˜Ÿåˆ—è¿›è¡Œè¯»å†™æ“ä½œè€Œæ²¡æœ‰æ°å½“çš„åŒæ­¥æœºåˆ¶ï¼Œå¯èƒ½ä¼šå‡ºç°æ­»é”æƒ…å†µï¼Œä½¿å¾—ç¨‹åºæ— æ³•ç»§ç»­æ‰§è¡Œã€‚</p></li></ul><p> å› æ­¤ï¼Œé€šè¿‡ä½¿ç”¨äº’æ–¥é”ï¼ˆ<code>mutex</code>ï¼‰æ¥ä¿æŠ¤é˜Ÿåˆ—ï¼Œåœ¨ä»»ä¸€æ—¶åˆ»åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®é˜Ÿåˆ—ï¼Œå¯ä»¥ç¡®ä¿åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ•°æ®çš„å®‰å…¨è®¿é—®ï¼Œé¿å…æ•°æ®ç«äº‰å’Œå¯èƒ½å¯¼è‡´çš„é—®é¢˜ã€‚</p></li><li><p><strong>ä»€ä¹ˆæ˜¯æ­»é”</strong><br> æ­»é”ï¼ˆDeadlockï¼‰æ˜¯æŒ‡åœ¨å¹¶å‘ç³»ç»Ÿä¸­ï¼Œä¸¤ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹ï¼ˆçº¿ç¨‹ï¼‰å› äº‰å¤ºå…±äº«èµ„æºè€Œè¿›å…¥ä¸€ç§äº’ç›¸ç­‰å¾…çš„çŠ¶æ€ï¼Œå¯¼è‡´å®ƒä»¬éƒ½æ— æ³•ç»§ç»­æ‰§è¡Œä¸‹å»çš„æƒ…å†µã€‚åœ¨æ­»é”æƒ…å†µä¸‹ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½åœ¨ç­‰å¾…å…¶ä»–è¿›ç¨‹é‡Šæ”¾èµ„æºï¼Œè€ŒåŒæ—¶åˆä¸æ„¿æ„ä¸»åŠ¨é‡Šæ”¾è‡ªå·±å½“å‰å·²ç»å æœ‰çš„èµ„æºï¼Œä»è€Œå½¢æˆäº†ä¸€ç§åƒµå±€ã€‚æ­»é”æ˜¯å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­å¸¸è§çš„å¹¶å‘é—®é¢˜ï¼Œéœ€è¦é€šè¿‡åˆç†çš„è®¾è®¡å’Œå®ç°æ¥é¿å…å’Œè§£å†³æ­»é”é—®é¢˜ã€‚</p></li><li><p><strong>std::this_thread::sleep_for(std::chrono::milliseconds(500)); &#x2F;&#x2F; æ¨¡æ‹Ÿç”Ÿäº§æ•°æ®çš„è€—æ—¶æ“ä½œ</strong></p><p> è¿™è¡Œä»£ç æ˜¯ä½¿ç”¨C++æ ‡å‡†åº“æä¾›çš„çº¿ç¨‹åº“<code>&lt;thread&gt;</code>ä¸­çš„<code>std::this_thread::sleep_for</code>å‡½æ•°ï¼Œç”¨æ¥æ¨¡æ‹Ÿåœ¨ç”Ÿäº§æ•°æ®è¿‡ç¨‹ä¸­çš„è€—æ—¶æ“ä½œã€‚è®©æˆ‘ä»¬æ¥è¯¦ç»†è§£é‡Šä¸€ä¸‹è¿™è¡Œä»£ç çš„ä½œç”¨ï¼š</p><ul><li><p><code>std::this_thread::sleep_for</code>ï¼šè¿™æ˜¯C++æ ‡å‡†åº“ä¸­ç”¨äºçº¿ç¨‹æ“ä½œçš„é™æ€æˆå‘˜å‡½æ•°ï¼Œå…è®¸å½“å‰çº¿ç¨‹ä¼‘çœ ä¸€æ®µæ—¶é—´ã€‚å› ä¸ºæ˜¯<code>this_thread</code>æ‰€ä»¥æ˜¯å½“å‰çº¿ç¨‹ã€‚</p></li><li><p><code>std::chrono::milliseconds(500)</code>ï¼šè¿™é‡Œä½¿ç”¨<code>std::chrono::milliseconds</code>æ¥åˆ›å»ºä¸€ä¸ªè¡¨ç¤ºæ—¶é—´é—´éš”çš„å¯¹è±¡ï¼Œå‚æ•°ä¸º500ï¼Œè¡¨ç¤º500æ¯«ç§’ï¼ˆå³0.5ç§’ï¼‰çš„æ—¶é—´é—´éš”ã€‚<code>std::chrono</code>æ˜¯C++æ ‡å‡†åº“æä¾›çš„æ—¥æœŸå’Œæ—¶é—´åº“ï¼Œç”¨äºå¤„ç†æ—¶é—´ç›¸å…³çš„æ“ä½œã€‚</p></li><li><p><code>// æ¨¡æ‹Ÿç”Ÿäº§æ•°æ®çš„è€—æ—¶æ“ä½œ</code>ï¼šè¿™æ˜¯ä¸€è¡Œæ³¨é‡Šï¼Œè¯´æ˜äº†è¿™è¡Œä»£ç çš„ç›®çš„ï¼Œå³æ¨¡æ‹Ÿåœ¨ç”Ÿäº§æ•°æ®è¿‡ç¨‹ä¸­çš„è€—æ—¶æ“ä½œã€‚é€šå¸¸åœ¨ç”Ÿäº§æ•°æ®æˆ–å…¶ä»–éœ€è¦ç­‰å¾…çš„æ“ä½œä¸­ï¼Œä¸ºäº†æ¨¡æ‹ŸçœŸå®åœºæ™¯çš„å»¶è¿Ÿï¼Œä¼šä½¿ç”¨ç±»ä¼¼çš„ä¼‘çœ æ“ä½œæ¥å»¶è¿Ÿçº¿ç¨‹çš„æ‰§è¡Œã€‚</p></li></ul><p> å› æ­¤ï¼Œè¿™è¡Œä»£ç çš„ä½œç”¨æ˜¯è®©å½“å‰çº¿ç¨‹ä¼‘çœ 500æ¯«ç§’ï¼Œæ¨¡æ‹Ÿç”Ÿäº§æ•°æ®è¿‡ç¨‹ä¸­çš„è€—æ—¶æ“ä½œï¼Œä»¥ä¾¿æ›´å¥½åœ°æµ‹è¯•å’Œç†è§£ç¨‹åºçš„è¡Œä¸ºã€‚</p></li><li><p><strong>std::lock_guard &lt; std::mutex &gt; lock(mtx);</strong></p><p> <code>std::lock_guard&lt;std::mutex&gt; lock(mtx);</code>æ˜¯C++ä¸­ä½¿ç”¨RAIIæœºåˆ¶æ¥ç®¡ç†äº’æ–¥é”ï¼ˆ<code>std::mutex</code>ï¼‰çš„å…¸å‹è¯­æ³•æ ¼å¼ã€‚è¿™è¡Œä»£ç çš„ä½œç”¨æ˜¯åˆ›å»ºä¸€ä¸ª<code>lock_guard</code>å¯¹è±¡å¹¶ç”¨å…¶æ„é€ å‡½æ•°é”ä½ä¸€ä¸ª<code>std::mutex</code>å¯¹è±¡<code>mtx</code>ã€‚</p><p> å…·ä½“è§£é‡Šå¦‚ä¸‹ï¼š</p><ul><li><code>std::lock_guard</code>æ˜¯ä¸€ä¸ªæ¨¡æ¿ç±»ï¼Œç”¨äºç®¡ç†é”å¯¹è±¡ï¼ˆäº’æ–¥é”ï¼‰ã€‚å®ƒä¼šåœ¨æ„é€ æ—¶é”ä½ç»™å®šçš„äº’æ–¥é”ï¼Œåœ¨ææ„æ—¶è§£é”äº’æ–¥é”ï¼Œå®ç°äº†RAIIæœºåˆ¶ã€‚</li><li><code>&lt;std::mutex&gt;</code>æ˜¯æ¨¡æ¿å‚æ•°ï¼Œè¡¨ç¤º<code>std::lock_guard</code>å°†è¦ç®¡ç†çš„äº’æ–¥é”çš„ç±»å‹æ˜¯<code>std::mutex</code>ã€‚</li><li><code>lock</code>æ˜¯<code>std::lock_guard</code>å¯¹è±¡çš„åç§°ï¼Œå¯ä»¥æ ¹æ®éœ€è¦å‘½åã€‚</li><li><code>(mtx)</code>è¡¨ç¤ºç”¨<code>mtx</code>ï¼ˆä¸€ä¸ªåä¸º<code>mtx</code>çš„<code>std::mutex</code>å¯¹è±¡ï¼‰æ¥åˆå§‹åŒ–<code>lock_guard</code>å¯¹è±¡ï¼Œå³åœ¨æ„é€ <code>lock_guard</code>å¯¹è±¡æ—¶é”ä½<code>mtx</code>ã€‚</li></ul><p> <code>std::lock_guard</code>æ˜¯C++æ ‡å‡†åº“æä¾›çš„ä¸€ä¸ªRAIIï¼ˆèµ„æºè·å–å³åˆå§‹åŒ–ï¼‰é£æ ¼çš„äº’æ–¥é‡å°è£…ç±»ï¼Œé€šè¿‡å®ƒå¯ä»¥åœ¨ä¸€ä¸ªä½œç”¨åŸŸä¸­ä¿æŒäº’æ–¥é”çš„æŒæœ‰çŠ¶æ€ã€‚åœ¨è¿™æ®µä»£ç ä¸­ï¼Œ<code>std::lock_guard&lt;std::mutex&gt; lock(mtx);</code>çš„ä½œç”¨æ˜¯ä½¿ç”¨äº’æ–¥é‡<code>mtx</code>å¯¹ä¸´ç•ŒåŒºè¿›è¡ŒåŠ é”ï¼Œç¡®ä¿å¯¹å…±äº«æ•°æ®ç»“æ„<code>buffer</code>çš„è®¿é—®æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚è®©æˆ‘ä»¬æ¥è¯¦ç»†è§£é‡Šå…¶ä½œç”¨ï¼š</p><ul><li><p><strong>RAIIæœºåˆ¶</strong>ï¼šRAIIï¼ˆResource Acquisition Is Initializationï¼‰æ˜¯ä¸€ç§C++ç¼–ç¨‹èŒƒå¼ï¼Œå®ƒé€šè¿‡å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸæ¥ç®¡ç†èµ„æºçš„è·å–å’Œé‡Šæ”¾ï¼Œç¡®ä¿èµ„æºåœ¨å¯¹è±¡æ„é€ æ—¶è¢«æ­£ç¡®è·å–ï¼Œè€Œåœ¨å¯¹è±¡ææ„æ—¶è¢«è‡ªåŠ¨é‡Šæ”¾ã€‚è¿™ç§æœºåˆ¶çš„æ ¸å¿ƒæ€æƒ³æ˜¯åˆ©ç”¨å±€éƒ¨å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸæ§åˆ¶èµ„æºçš„è·å–å’Œé‡Šæ”¾ï¼Œä»è€Œç¡®ä¿èµ„æºçš„æ­£ç¡®ç®¡ç†ï¼Œæé«˜ä»£ç çš„å¯é æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p><p>  ä¸‹é¢æ˜¯RAIIæœºåˆ¶çš„å·¥ä½œåŸç†å’Œä¼˜åŠ¿ï¼š</p><ol><li><p><strong>èµ„æºè·å–å³åˆå§‹åŒ–</strong>ï¼šå½“ä¸€ä¸ªå¯¹è±¡è¢«åˆ›å»ºæ—¶ï¼ŒåŒæ—¶è·å–æ‰€éœ€çš„èµ„æºï¼Œä¾‹å¦‚å†…å­˜ã€æ–‡ä»¶å¥æŸ„ã€äº’æ–¥é”ç­‰ï¼Œè¿™æ ·èµ„æºçš„è·å–å’Œåˆå§‹åŒ–æ˜¯ç»Ÿä¸€çš„æ“ä½œã€‚</p></li><li><p><strong>èµ„æºçš„è‡ªåŠ¨é‡Šæ”¾</strong>ï¼šå½“å¯¹è±¡ç¦»å¼€å…¶ä½œç”¨åŸŸæ—¶ï¼ˆæ¯”å¦‚å‡½æ•°è¿”å›ã€ä½œç”¨åŸŸç»“æŸç­‰ï¼‰ï¼Œå…¶ææ„å‡½æ•°ä¼šè¢«è°ƒç”¨ï¼Œè´Ÿè´£é‡Šæ”¾å·²è·å–çš„èµ„æºï¼Œæ— è®ºæ˜¯æ­£å¸¸æ‰§è¡Œè¿˜æ˜¯å¼‚å¸¸å‘ç”Ÿï¼Œèµ„æºéƒ½ä¼šè¢«æ­£å¸¸é‡Šæ”¾ã€‚</p></li><li><p><strong>é¿å…èµ„æºæ³„æ¼å’Œç¡®ä¿èµ„æºç®¡ç†</strong>ï¼šé€šè¿‡RAIIæœºåˆ¶ï¼Œç¨‹åºå‘˜æ— éœ€æ‰‹åŠ¨ç®¡ç†èµ„æºçš„è·å–å’Œé‡Šæ”¾ï¼Œå‡å°‘äº†å› å¿˜è®°é‡Šæ”¾èµ„æºè€Œå¯¼è‡´çš„å†…å­˜æ³„æ¼æˆ–èµ„æºæ³„æ¼é—®é¢˜ã€‚</p></li><li><p><strong>å¼‚å¸¸å®‰å…¨æ€§</strong>ï¼šRAIIå¯ç¡®ä¿åœ¨å¼‚å¸¸å‘ç”Ÿæ—¶ï¼Œèµ„æºèƒ½å¤Ÿè¢«æ­£ç¡®é‡Šæ”¾ï¼Œé¿å…èµ„æºæ³„æ¼ï¼ŒåŒæ—¶ä¿è¯ç¨‹åºçš„å®‰å…¨æ€§ã€‚</p></li><li><p><strong>æé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯è¯»æ€§</strong>ï¼šRAIIä½¿èµ„æºç®¡ç†çš„é€»è¾‘æ›´åŠ æ¸…æ™°æ˜äº†ï¼Œä»£ç æ›´æ˜“äºç†è§£å’Œç»´æŠ¤ï¼ŒåŒæ—¶é™ä½äº†åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å‡ºç°çš„æ­»é”ç­‰é—®é¢˜ã€‚</p></li></ol><p>  åœ¨C++ä¸­ï¼Œæ ‡å‡†åº“ä¸­çš„æ™ºèƒ½æŒ‡é’ˆï¼ˆ<code>std::unique_ptr</code>ã€<code>std::shared_ptr</code>ç­‰ï¼‰å’Œé”ï¼ˆ<code>std::lock_guard</code>ã€<code>std::unique_lock</code>ç­‰ï¼‰éƒ½æ˜¯åŸºäºRAIIæœºåˆ¶è®¾è®¡çš„ã€‚é€šè¿‡åˆç†åˆ©ç”¨RAIIæœºåˆ¶ï¼Œå¯ä»¥æœ‰æ•ˆç®¡ç†èµ„æºï¼Œæé«˜ä»£ç çš„å¥å£®æ€§å’Œå¯é æ€§ã€‚</p></li><li><p><strong>åŠ é”</strong>ï¼šå½“<code>std::lock_guard</code>å¯¹è±¡<code>lock</code>è¢«åˆ›å»ºæ—¶ï¼Œå®ƒä¼šåœ¨æ„é€ å‡½æ•°ä¸­å¯¹äº’æ–¥é‡<code>mtx</code>è¿›è¡ŒåŠ é”æ“ä½œï¼Œå³é”ä½<code>mtx</code>ã€‚è¿™æ ·å°±ç¡®ä¿äº†åœ¨<code>lock_guard</code>å¯¹è±¡çš„ä½œç”¨åŸŸå†…ï¼ˆåœ¨è¿™ä¸ªæ‹¬å·å†…ï¼‰å¯¹<code>buffer</code>çš„è®¿é—®æ˜¯å—åˆ°ä¿æŠ¤çš„ï¼Œå…¶ä»–çº¿ç¨‹æ— æ³•åŒæ—¶ä¿®æ”¹<code>buffer</code>çš„å†…å®¹ï¼Œé¿å…äº†æ•°æ®ç«äº‰å’Œä¸ä¸€è‡´æ€§ã€‚<code>åœ¨è¿™ä¸ªæ‹¬å·å†…</code>æŒ‡çš„æ˜¯<code>std::lock_guard</code>å¯¹è±¡<code>lock</code>çš„ä½œç”¨åŸŸèŒƒå›´ï¼Œå³<code>lock</code>å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚åœ¨C++ä¸­ï¼Œä½œç”¨åŸŸç”¨èŠ±æ‹¬å·<code>&#123;&#125;</code>è¡¨ç¤ºï¼Œä¹Ÿå«åšä»£ç å—ã€‚å½“<code>std::lock_guard</code>å¯¹è±¡<code>lock</code>çš„ä½œç”¨åŸŸèŒƒå›´ç»“æŸï¼ˆå³è¶…å‡ºäº†èŠ±æ‹¬å·çš„èŒƒå›´ï¼‰ï¼Œè¯¥å¯¹è±¡çš„ææ„å‡½æ•°ä¼šè¢«è°ƒç”¨ï¼Œä»è€Œè‡ªåŠ¨é‡Šæ”¾é”ã€‚è¿™ç§æ–¹å¼ç¡®ä¿äº†åœ¨<code>lock</code>å¯¹è±¡çš„ä½œç”¨åŸŸå†…ï¼Œäº’æ–¥é”è¢«ä¿æŒï¼Œä»è€Œä¿æŠ¤äº†å…±äº«èµ„æºï¼ˆå¦‚<code>buffer</code>ï¼‰çš„è®¿é—®å¹¶é¿å…äº†æ•°æ®ç«äº‰å’Œä¸ä¸€è‡´æ€§çš„é—®é¢˜ã€‚</p></li></ul><p> å› æ­¤ï¼Œé€šè¿‡åœ¨èŠ±æ‹¬å·å†…åˆ›å»º<code>std::lock_guard</code>å¯¹è±¡å¹¶é”ä½äº’æ–¥é‡ï¼Œå¯ä»¥ç¡®ä¿åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè®¿é—®æˆ–ä¿®æ”¹è¢«ä¿æŠ¤çš„å…±äº«èµ„æºï¼Œä»è€Œæé«˜å¤šçº¿ç¨‹ç¨‹åºçš„å®‰å…¨æ€§ã€‚</p><ul><li><strong>è§£é”</strong>ï¼šå½“<code>lock_guard</code>å¯¹è±¡çš„ä½œç”¨åŸŸç»“æŸæ—¶ï¼Œä¼šè°ƒç”¨å…¶ææ„å‡½æ•°ï¼Œåœ¨ææ„å‡½æ•°ä¸­ä¼šè‡ªåŠ¨è§£é”äº’æ–¥é‡<code>mtx</code>ï¼Œå³é‡Šæ”¾<code>mtx</code>çš„é”ï¼Œä½¿å¾—å…¶ä»–çº¿ç¨‹å¯ä»¥è®¿é—®å…±äº«èµ„æºã€‚</li></ul><p> é€šè¿‡ä½¿ç”¨<code>std::lock_guard</code>å’Œäº’æ–¥é‡ï¼Œå¯ä»¥ç®€åŒ–äº†å¯¹ä¸´ç•ŒåŒºçš„åŠ é”å’Œè§£é”è¿‡ç¨‹ï¼Œå¹¶ä¸”å¯ä»¥é¿å…å› ä¸ºå¿˜è®°è§£é”å¯¼è‡´çš„æ­»é”æƒ…å†µã€‚è¿™æ ·çš„æ“ä½œä¿è¯äº†å¯¹ä¸´ç•ŒåŒºèµ„æºçš„è®¿é—®æ˜¯äº’æ–¥çš„ï¼Œç¡®ä¿äº†å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„æ•°æ®å®‰å…¨æ€§ã€‚</p></li><li><p><strong>cv.notify_one();</strong><br> åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ï¼Œ<code>cv.notify_one()</code> æ˜¯ç”¨æ¥é€šçŸ¥ç­‰å¾…åœ¨æ¡ä»¶å˜é‡ä¸Šçš„æŸä¸ªçº¿ç¨‹ç»§ç»­æ‰§è¡Œçš„å‡½æ•°ã€‚å½“æŸä¸ªçº¿ç¨‹è°ƒç”¨ <code>cv.wait()</code> æ–¹æ³•å¹¶åœ¨æ¡ä»¶å˜é‡ä¸Šç­‰å¾…æ—¶ï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥é€šè¿‡è°ƒç”¨ <code>cv.notify_one()</code> æˆ– <code>cv.notify_all()</code> æ¥é€šçŸ¥ç­‰å¾…çš„çº¿ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œã€‚</p><p> å…·ä½“æ¥è¯´ï¼Œ<code>cv.notify_one()</code> ä¼šå”¤é†’åœ¨æ¡ä»¶å˜é‡ä¸Šç­‰å¾…çš„ä¸€ä¸ªçº¿ç¨‹ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ï¼Œè®©å…¶å¯ä»¥ä»ç­‰å¾…çŠ¶æ€ä¸­é†’æ¥å¹¶ç»§ç»­æ‰§è¡Œã€‚å¦‚æœæ²¡æœ‰çº¿ç¨‹åœ¨æ¡ä»¶å˜é‡ä¸Šç­‰å¾…ï¼Œé‚£ä¹ˆè°ƒç”¨ <code>cv.notify_one()</code> ä¹Ÿä¸ä¼šæœ‰ä»»ä½•æ•ˆæœã€‚</p><p> åœ¨å¤šçº¿ç¨‹åä½œä¸­ï¼Œé€šå¸¸ä¼šç»“åˆæ¡ä»¶å˜é‡å’Œäº’æ–¥é‡æ¥å®ç°çº¿ç¨‹ä¹‹é—´çš„åŒæ­¥æ“ä½œã€‚å½“ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†å…±äº«æ•°æ®ï¼Œå¹¶å¸Œæœ›é€šçŸ¥å…¶ä»–çº¿ç¨‹æœ‰å…³æ­¤æ•°æ®çš„æ”¹å˜æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ¡ä»¶å˜é‡æ¥å®ç°çº¿ç¨‹ä¹‹é—´çš„åŒæ­¥é€šä¿¡ã€‚é€šå¸¸çš„æµç¨‹æ˜¯ï¼Œå…ˆè·å¾—äº’æ–¥é”ï¼Œç„¶åä¿®æ”¹å…±äº«æ•°æ®ï¼Œå†é€šçŸ¥ç­‰å¾…åœ¨æ¡ä»¶å˜é‡ä¸Šçš„çº¿ç¨‹ï¼Œæœ€åé‡Šæ”¾äº’æ–¥é”ã€‚</p><p> åœ¨è¿™æ®µç¤ºä¾‹ä»£ç ä¸­ï¼Œç”Ÿäº§è€…çº¿ç¨‹å’Œæ¶ˆè´¹è€…çº¿ç¨‹é€šè¿‡æ¡ä»¶å˜é‡ <code>cv</code> å’Œäº’æ–¥é‡ <code>mtx</code> å®ç°äº†çº¿ç¨‹ä¹‹é—´çš„åŒæ­¥é€šä¿¡ã€‚ç”Ÿäº§è€…çº¿ç¨‹é€šè¿‡ <code>notify_one()</code> æ–¹æ³•é€šçŸ¥æ¶ˆè´¹è€…çº¿ç¨‹ï¼Œå‘ŠçŸ¥å…¶æœ‰æ–°çš„æ•°æ®å¯ä»¥è¢«æ¶ˆè´¹ã€‚å…·ä½“æ¥è¯´ï¼Œ<code>cv.notify_one()</code> çš„ä½œç”¨æ˜¯ï¼š</p><ol><li>å½“ç”Ÿäº§è€…çº¿ç¨‹ç”Ÿäº§äº†ä¸€ä¸ªæ•°æ®åï¼ˆé€šè¿‡ <code>buffer.push(i)</code>ï¼‰ï¼Œå®ƒä¼šç«‹å³é€šçŸ¥ç­‰å¾…åœ¨æ¡ä»¶å˜é‡ <code>cv</code> ä¸Šçš„æ¶ˆè´¹è€…çº¿ç¨‹ã€‚</li><li>åœ¨æ¶ˆè´¹è€…çº¿ç¨‹ä¸­ï¼Œå½“å®ƒé€šè¿‡ <code>cv.wait(lock, [] &#123; return !buffer.empty(); &#125;);</code> è¿›å…¥ç­‰å¾…çŠ¶æ€æ—¶ï¼Œä¼šè‡ªåŠ¨é‡Šæ”¾ <code>mtx</code> äº’æ–¥é‡å¹¶ç­‰å¾…ï¼Œç›´åˆ°ç”Ÿäº§è€…çº¿ç¨‹è°ƒç”¨ <code>cv.notify_one()</code> æ¥å”¤é†’å®ƒã€‚</li><li>ä¸€æ—¦æ¶ˆè´¹è€…çº¿ç¨‹è¢«å”¤é†’ï¼Œå®ƒä¼šé‡æ–°è·å– <code>mtx</code> äº’æ–¥é‡å¹¶ç»§ç»­æ‰§è¡Œï¼Œä» <code>buffer</code> ä¸­å–å‡ºæ•°æ®æ¶ˆè´¹ã€‚</li><li>ç”Ÿäº§è€…çº¿ç¨‹æ¯ç”Ÿäº§ä¸€ä¸ªæ•°æ®ï¼Œå°±ä¼šå”¤é†’ä¸€ä¸ªç­‰å¾…çš„æ¶ˆè´¹è€…çº¿ç¨‹ã€‚å¦‚æœæœ‰å¤šä¸ªæ¶ˆè´¹è€…çº¿ç¨‹åœ¨ç­‰å¾…ï¼Œåªæœ‰ä¸€ä¸ªä¼šè¢«å”¤é†’ã€‚</li></ol><p> ç»¼ä¸Šæ‰€è¿°ï¼Œ<code>cv.notify_one()</code> çš„ä½œç”¨æ˜¯å”¤é†’ä¸€ä¸ªç­‰å¾…åœ¨æ¡ä»¶å˜é‡ä¸Šçš„çº¿ç¨‹ï¼Œç”¨æ¥æç¤ºè¯¥çº¿ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œï¼Œé€‚ç”¨äºåè°ƒå¤šçº¿ç¨‹ä¹‹é—´çš„æ“ä½œé¡ºåºå’Œæ•°æ®ä¼ é€’ã€‚</p></li><li><p><strong>ä¸ºä»€ä¹ˆä¸€ä¸ªç”¨std::lock_guardä¸€ä¸ªç”¨std::unique_lock</strong><br> åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œ<code>producer()</code> å‡½æ•°ä½¿ç”¨äº† <code>std::lock_guard</code> æ¥é”å®šäº’æ–¥é‡ï¼Œè€Œ <code>consumer()</code> å‡½æ•°åˆ™ä½¿ç”¨äº† <code>std::unique_lock</code>ã€‚è¿™ç§é€‰æ‹©å¹¶éç»å¯¹ï¼Œè€Œæ˜¯æ ¹æ®ä¸åŒçš„éœ€æ±‚å’Œæƒ…å¢ƒæ¥å†³å®šä½¿ç”¨å“ªç§é”å®šæ–¹å¼ã€‚</p><ol><li><strong><code>std::lock_guard</code> åœ¨ producer å‡½æ•°ä¸­çš„ä½¿ç”¨ï¼š</strong></li></ol><ul><li>åœ¨ <code>producer()</code> å‡½æ•°ä¸­ï¼Œç”Ÿäº§è€…ç”Ÿäº§æ•°æ®åˆ°ç¼“å†²åŒºï¼Œå¹¶åœ¨æ•°æ®ç”Ÿäº§å®Œæˆåç«‹å³é‡Šæ”¾äº’æ–¥é‡ã€‚ç”±äºåœ¨ç”Ÿäº§è€…ç”Ÿäº§å®Œæ•°æ®åå°±ä¼šé‡Šæ”¾äº’æ–¥é‡ï¼Œå› æ­¤ä½¿ç”¨ <code>std::lock_guard</code> è€Œä¸æ˜¯ <code>std::unique_lock</code> æ›´åŠ ç®€æ´å’Œåˆé€‚ã€‚<code>std::lock_guard</code> è‡ªåŠ¨é”å®šäº’æ–¥é‡ï¼Œå¹¶åœ¨ä½œç”¨åŸŸç»“æŸæ—¶è‡ªåŠ¨é‡Šæ”¾äº’æ–¥é‡ï¼Œéå¸¸é€‚åˆè¿™ç§ç®€å•çš„é”å®šå’Œé‡Šæ”¾æƒ…å†µã€‚</li></ul><ol start="2"><li><strong><code>std::unique_lock</code> åœ¨ consumer å‡½æ•°ä¸­çš„ä½¿ç”¨ï¼š</strong></li></ol><ul><li>åœ¨ <code>consumer()</code> å‡½æ•°ä¸­ï¼Œæ¶ˆè´¹è€…éœ€è¦ç­‰å¾…ç¼“å†²åŒºä¸­æœ‰æ•°æ®å¯æ¶ˆè´¹æ—¶æ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚ä¸ºäº†æ”¯æŒåœ¨ç­‰å¾…æœŸé—´æ‰‹åŠ¨è§£é”äº’æ–¥é‡å¹¶ç­‰å¾…æ¡ä»¶å˜é‡ï¼Œè¿™é‡Œä½¿ç”¨äº† <code>std::unique_lock</code>ã€‚<code>std::unique_lock</code> æä¾›äº†æ›´çµæ´»çš„åŠ é”å’Œè§£é”æ“ä½œï¼ŒåŒæ—¶æ”¯æŒæ¡ä»¶å˜é‡çš„ç­‰å¾…ã€‚åœ¨ç­‰å¾…ç¼“å†²åŒºæœ‰æ•°æ®å¯æ¶ˆè´¹æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>cv.wait(lock, [] &#123; return !buffer.empty(); &#125;);</code> æ¥ç­‰å¾…æ¡ä»¶å˜é‡æ»¡è¶³ã€‚</li></ul><p> ç»¼ä¸Šæ‰€è¿°ï¼Œé€‰æ‹©ä½¿ç”¨ <code>std::lock_guard</code> æˆ– <code>std::unique_lock</code> å–å†³äºå…·ä½“çš„åº”ç”¨åœºæ™¯å’Œéœ€æ±‚ã€‚åœ¨ç®€å•çš„è‡ªåŠ¨é”å®šå’Œé‡Šæ”¾äº’æ–¥é‡æƒ…å†µä¸‹ï¼Œå¯ä»¥ä½¿ç”¨ <code>std::lock_guard</code>ï¼›è€Œåœ¨éœ€è¦æ›´å¤šçµæ´»æ€§å’Œæ¡ä»¶å˜é‡æ”¯æŒçš„æƒ…å†µä¸‹ï¼Œå¯ä»¥é€‰æ‹©ä½¿ç”¨ <code>std::unique_lock</code>ã€‚åœ¨ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ä¸­ï¼Œç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å¯èƒ½æœ‰ä¸åŒçš„éœ€æ±‚ï¼Œå› æ­¤å¯ä»¥æ ¹æ®å…·ä½“æƒ…å†µé€‰æ‹©ä¸åŒçš„é”å®šæ–¹å¼ã€‚</p></li><li><p><strong>cv.wait(lock, [] { return !buffer.empty(); });</strong></p><p> <code>cv.wait(lock, [] &#123; return !buffer.empty(); &#125;);</code> è¿™è¡Œä»£ç æ˜¯åœ¨<code>consumer()</code>å‡½æ•°ä¸­ä½¿ç”¨æ¡ä»¶å˜é‡ç­‰å¾…çš„éƒ¨åˆ†ã€‚è®©æˆ‘ä»¬è¯¦ç»†è§£é‡Šè¿™æ®µä»£ç çš„ä½œç”¨å’Œå…·ä½“æ‰§è¡Œæµç¨‹ï¼š</p><ol><li><p><code>cv.wait(lock, condition)</code>ï¼šè¿™æ˜¯æ¡ä»¶å˜é‡ <code>cv</code> çš„ç­‰å¾…å‡½æ•°è°ƒç”¨ã€‚åœ¨è¿™é‡Œï¼Œ<code>lock</code> æ˜¯ä¸€ä¸ª <code>std::unique_lock&lt;std::mutex&gt;</code> å¯¹è±¡ï¼Œé€šè¿‡å°† <code>lock</code> ä¼ é€’ç»™ <code>cv.wait</code>ï¼Œä¼šåœ¨ç­‰å¾…æœŸé—´å°†äº’æ–¥é‡è§£é”ï¼Œä»¥ä¾¿å…¶ä»–çº¿ç¨‹å¯ä»¥åœ¨è¯¥äº’æ–¥é‡ä¸Šæ‰§è¡Œæ“ä½œã€‚<code>condition</code> æ˜¯ä¸€ä¸ª lambda å‡½æ•°ï¼Œç”¨äºæŒ‡å®šç­‰å¾…æ¡ä»¶ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>cv.wait</code>ä¼šåœ¨ç­‰å¾…æœŸé—´æ£€æŸ¥ lambda å‡½æ•°è¿”å›çš„å¸ƒå°”å€¼ï¼Œåªæœ‰åœ¨ lambda å‡½æ•°è¿”å› <code>true</code> æ—¶æ‰ä¼šç»§ç»­æ‰§è¡Œã€‚</p></li><li><p><code>[] &#123; return !buffer.empty(); &#125;</code>ï¼šè¿™æ˜¯ä¸€ä¸ª lambda å‡½æ•°ï¼Œå®ƒæ£€æŸ¥ <code>buffer</code> æ˜¯å¦ä¸ºç©ºã€‚æ¡ä»¶å˜é‡çš„ <code>wait</code> æ“ä½œä¾èµ–äºç”¨æˆ·æä¾›çš„æ¡ä»¶å‡½æ•°ã€‚åœ¨è¿™é‡Œï¼Œæ¡ä»¶å‡½æ•°æ£€æŸ¥ <code>buffer</code> æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºï¼Œåˆ™æ¡ä»¶ä¸ºå‡ï¼Œ <code>cv.wait</code> ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°æ¡ä»¶å˜ä¸ºçœŸã€‚ä¸€æ—¦æ¡ä»¶ä¸ºçœŸï¼Œ<code>cv.wait</code> å°†ç»§ç»­æ‰§è¡Œï¼Œå³äº’æ–¥é‡è¢«é‡æ–°é”å®šï¼Œå¹¶ä¸”çº¿ç¨‹ç»§ç»­æ‰§è¡Œä¸‹å»ã€‚</p></li><li><p>æ‰§è¡Œæµç¨‹ï¼š</p><ul><li>å½“æ¶ˆè´¹è€…çº¿ç¨‹å¼€å§‹æ‰§è¡Œ <code>consumer()</code> å‡½æ•°æ—¶ï¼Œé¦–å…ˆä¼šåˆ›å»ºä¸€ä¸ª <code>std::unique_lock&lt;std::mutex&gt;</code> å¯¹è±¡ <code>lock</code>ï¼Œè¯¥å¯¹è±¡åœ¨å®ä¾‹åŒ–æ—¶ä¼šé”å®šå…¶å…³è”çš„äº’æ–¥é‡ <code>mtx</code>ã€‚</li><li>æ¥ç€ï¼Œæ¶ˆè´¹è€…çº¿ç¨‹è°ƒç”¨ <code>cv.wait(lock, condition)</code>ï¼Œè¿™ä¼šå¯¼è‡´çº¿ç¨‹é‡Šæ”¾äº’æ–¥é‡çš„é”å¹¶ç­‰å¾…ï¼Œç›´åˆ°<code>condition</code>è¿”å› <code>true</code>ã€‚</li><li>åœ¨ç­‰å¾…è¿‡ç¨‹ä¸­ï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥è·å¾—äº’æ–¥é‡çš„é”å¹¶ä¿®æ”¹å…±äº«æ•°æ®ï¼Œä½†ç”±äºæ¡ä»¶æœªæ»¡è¶³ï¼Œæ¶ˆè´¹è€…çº¿ç¨‹ä¼šä¸€ç›´ä¿æŒç­‰å¾…çŠ¶æ€ã€‚</li><li>å½“ç”Ÿäº§è€…çº¿ç¨‹å‘ <code>buffer</code> ä¸­åŠ å…¥æ•°æ®å¹¶è°ƒç”¨ <code>cv.notify_one()</code> é€šçŸ¥æ—¶ï¼Œæ¡ä»¶ <code>!buffer.empty()</code> å˜ä¸ºçœŸï¼Œè¿™ä¼šå¯¼è‡´æ¡ä»¶å˜é‡é€šçŸ¥æ¶ˆè´¹è€…çº¿ç¨‹ç»§ç»­æ‰§è¡Œã€‚</li><li>æ¶ˆè´¹è€…çº¿ç¨‹è¢«å”¤é†’åï¼Œä¼šé‡æ–°è·å¾—äº’æ–¥é‡çš„é”ï¼Œè¿™æ—¶å¯ä»¥å®‰å…¨åœ°ä» <code>buffer</code> ä¸­å–å‡ºæ•°æ®è¿›è¡Œæ¶ˆè´¹ï¼Œç„¶åç»§ç»­æ‰§è¡Œåç»­çš„æ“ä½œã€‚</li></ul></li></ol><p> æ€»ä¹‹ï¼Œé€šè¿‡ä½¿ç”¨æ¡ä»¶å˜é‡å’Œ lambda å‡½æ•°ç­‰å¾…ç‰¹å®šæ¡ä»¶ï¼Œå¯ä»¥å®ç°çº¿ç¨‹é—´çš„åŒæ­¥å’Œåè°ƒï¼Œç¡®ä¿æ¶ˆè´¹è€…åœ¨æœ‰æ•°æ®å¯æ¶ˆè´¹æ—¶æ‰æ‰§è¡Œæ¶ˆè´¹æ“ä½œï¼Œä»è€Œæœ‰æ•ˆé¿å…äº†ç«æ€æ¡ä»¶å’Œæ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</p></li><li><p><strong>lambda è¡¨è¾¾å¼</strong><br> ç”¨äºå®šä¹‰å‡½æ•°å¯¹è±¡ï¼š</p><ol><li><p><code>[]</code>ï¼šlambda è¡¨è¾¾å¼çš„å¼€å¤´ä»¥ä¸€å¯¹æ–¹æ‹¬å·å¼€å§‹ã€‚åœ¨è¿™é‡Œï¼Œ<code>[]</code> è¡¨ç¤º lambda è¡¨è¾¾å¼ä¸æ•è·ä»»ä½•å¤–éƒ¨å˜é‡ã€‚è¿™æ„å‘³ç€ lambda è¡¨è¾¾å¼åªèƒ½è®¿é—®ä¼ é€’ç»™å®ƒçš„å‚æ•°ï¼Œè€Œä¸èƒ½è®¿é—®å¤–éƒ¨ä½œç”¨åŸŸçš„å˜é‡ã€‚</p></li><li><p><code>&#123;&#125;</code>ï¼šlambda è¡¨è¾¾å¼çš„ä¸»ä½“ä½¿ç”¨ä¸€å¯¹å¤§æ‹¬å·æ¥å®šä¹‰ï¼Œåœ¨å¤§æ‹¬å·å†…éƒ¨æ˜¯ lambda è¡¨è¾¾å¼çš„å…·ä½“å®ç°ã€‚</p></li></ol></li></ol><h2 id="äº’æ–¥é”"><a href="#äº’æ–¥é”" class="headerlink" title="äº’æ–¥é”"></a>äº’æ–¥é”</h2><p>åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ï¼Œä¸ºäº†é¿å…å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®å…±äº«èµ„æºè€Œå¼•èµ·çš„ç«äº‰æ¡ä»¶å’Œæ•°æ®ä¸ä¸€è‡´æ€§é—®é¢˜ï¼Œæˆ‘ä»¬ä½¿ç”¨äº’æ–¥é”ï¼ˆMutexï¼Œå…¨ç§°Mutual Exclusionï¼‰ã€‚äº’æ–¥é”æ˜¯ä¸€ç§åŒæ­¥åŸè¯­ï¼Œå®ƒå…è®¸çº¿ç¨‹åœ¨è¿›å…¥ä¸´ç•ŒåŒºï¼ˆå¯¹å…±äº«èµ„æºæ“ä½œçš„ä¸´ç•ŒåŒºåŸŸï¼‰å‰å…ˆè·å–é”ï¼Œæ‰§è¡Œå®Œåå†é‡Šæ”¾é”ï¼Œä»è€Œç¡®ä¿åœ¨åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½è¿›å…¥ä¸´ç•ŒåŒºè¿›è¡Œæ“ä½œã€‚</p><p>è¯¦ç»†è§£é‡Šäº’æ–¥é”åŒ…æ‹¬ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ol><li><p><strong>é”çš„çŠ¶æ€</strong>: äº’æ–¥é”æœ‰ä¸¤ç§çŠ¶æ€ï¼Œåˆ†åˆ«æ˜¯é”å®šï¼ˆlockedï¼‰å’Œè§£é”ï¼ˆunlockedï¼‰ã€‚çº¿ç¨‹åœ¨è¿›å…¥ä¸´ç•ŒåŒºä¹‹å‰éœ€è¦å…ˆè·å–é”ï¼ˆå³å°†é”å®šçŠ¶æ€è®¾å®šä¸ºlockedï¼‰ï¼Œæ‰§è¡Œå®Œåå†é‡Šæ”¾é”ï¼ˆå°†çŠ¶æ€è®¾å®šä¸ºunlockedï¼‰ã€‚</p></li><li><p><strong>äº’æ–¥æ€§</strong>: äº’æ–¥é”çš„ç‰¹æ€§ç¡®ä¿äº†åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè·å–é”ï¼Œå…¶ä»–çº¿ç¨‹éœ€è¦ç­‰å¾…å½“å‰æŒæœ‰é”çš„çº¿ç¨‹é‡Šæ”¾é”åæ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚è¿™æ ·å¯ä»¥é¿å…å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®å…±äº«èµ„æºå¯¼è‡´çš„æ•°æ®ç«äº‰å’Œä¸ä¸€è‡´æ€§é—®é¢˜ã€‚</p></li><li><p><strong>ä½¿ç”¨æ–¹æ³•</strong>: åœ¨å¤šçº¿ç¨‹ä»£ç ä¸­ä½¿ç”¨äº’æ–¥é”æ—¶ï¼Œä¸€èˆ¬ä¼šä½¿ç”¨<code>std::mutex</code>æˆ–ç±»ä¼¼çš„äº’æ–¥é”ç±»å‹ã€‚å…¸å‹çš„ç”¨æ³•æ˜¯åœ¨ä¸´ç•ŒåŒºå¼€å§‹ä¹‹å‰è°ƒç”¨<code>lock()</code>æ–¹æ³•è·å–é”ï¼Œåœ¨ä¸´ç•ŒåŒºç»“æŸåè°ƒç”¨<code>unlock()</code>æ–¹æ³•é‡Šæ”¾é”ã€‚</p></li><li><p><strong>æ­»é”</strong>: å¦‚æœåœ¨å¤šçº¿ç¨‹ä»£ç ä¸­ä½¿ç”¨äº’æ–¥é”ä¸å½“ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ­»é”ï¼ˆDeadlockï¼‰çš„é—®é¢˜ã€‚æ­»é”æŒ‡çš„æ˜¯å¤šä¸ªçº¿ç¨‹ç›¸äº’ç­‰å¾…å¯¹æ–¹é‡Šæ”¾èµ„æºè€Œæ— æ³•ç»§ç»­æ‰§è¡Œçš„æƒ…å†µï¼Œå› æ­¤åœ¨ä½¿ç”¨äº’æ–¥é”æ—¶è¦æ³¨æ„é¿å…é€ æˆæ­»é”ã€‚</p></li></ol><p>æ€»ä¹‹ï¼Œäº’æ–¥é”æ˜¯ä¸€ç§é‡è¦çš„åŒæ­¥å·¥å…·ï¼Œç”¨äºåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ§åˆ¶å¯¹å…±äº«èµ„æºçš„è®¿é—®ï¼Œç¡®ä¿çº¿ç¨‹å®‰å…¨æ€§å¹¶é¿å…ç«äº‰æ¡ä»¶å’Œæ•°æ®ä¸ä¸€è‡´æ€§é—®é¢˜çš„å‘ç”Ÿã€‚åœ¨æ­£ç¡®ä½¿ç”¨äº’æ–¥é”çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥æœ‰æ•ˆåœ°ä¿è¯å¤šçº¿ç¨‹ç¨‹åºçš„æ­£ç¡®æ€§å’Œç¨³å®šæ€§ã€‚</p><h3 id="ä¸´ç•ŒåŒºï¼ˆå¯¹å…±äº«èµ„æºæ“ä½œçš„ä¸´ç•ŒåŒºåŸŸï¼‰"><a href="#ä¸´ç•ŒåŒºï¼ˆå¯¹å…±äº«èµ„æºæ“ä½œçš„ä¸´ç•ŒåŒºåŸŸï¼‰" class="headerlink" title="ä¸´ç•ŒåŒºï¼ˆå¯¹å…±äº«èµ„æºæ“ä½œçš„ä¸´ç•ŒåŒºåŸŸï¼‰"></a>ä¸´ç•ŒåŒºï¼ˆå¯¹å…±äº«èµ„æºæ“ä½œçš„ä¸´ç•ŒåŒºåŸŸï¼‰</h3><p>ä¸´ç•ŒåŒºæ˜¯æŒ‡åœ¨å¤šçº¿ç¨‹ç¨‹åºä¸­ï¼Œå¤šä¸ªçº¿ç¨‹å…±äº«çš„æŸä¸€æ®µä»£ç æˆ–æ•°æ®åŒºåŸŸï¼Œè¿™é‡Œçš„ä»£ç æˆ–æ•°æ®å¯èƒ½ä¼šè¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®å’Œæ“ä½œã€‚åœ¨ä¸´ç•ŒåŒºä¸­ï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶å¯¹å…±äº«èµ„æºè¿›è¡Œè¯»å†™æ“ä½œï¼Œå°±ä¼šå‘ç”Ÿç«æ€æ¡ä»¶ï¼ˆRace Conditionï¼‰ï¼Œå¯¼è‡´ç¨‹åºå‡ºç°é”™è¯¯æˆ–äº§ç”Ÿä¸ç¡®å®šçš„ç»“æœã€‚</p><p>è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç”ŸåŠ¨çš„æ¯”å–»æ¥è§£é‡Šä¸´ç•ŒåŒºï¼š</p><p>å‡è®¾æœ‰ä¸€ä¸ªå°å’–å•¡å…åªæœ‰ä¸€ä¸ªå’–å•¡æœºå¯ä»¥åˆ¶ä½œå’–å•¡ã€‚å¤šä¸ªæœåŠ¡å‘˜ï¼ˆçº¿ç¨‹ï¼‰éœ€è¦åˆ¶ä½œå’–å•¡æ—¶ï¼Œä»–ä»¬éœ€è¦å…ˆæ£€æŸ¥å’–å•¡æœºæ˜¯å¦ç©ºé—²ã€‚å¦‚æœå’–å•¡æœºæ­£åœ¨è¢«ä½¿ç”¨ï¼Œé‚£ä¹ˆå…¶ä»–æœåŠ¡å‘˜å¿…é¡»ç­‰å¾…ç›´åˆ°å½“å‰åˆ¶ä½œå®Œæˆå¹¶é‡Šæ”¾å’–å•¡æœºã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ£€æŸ¥å’–å•¡æœºçŠ¶æ€ã€å ç”¨å’–å•¡æœºã€é‡Šæ”¾å’–å•¡æœºçš„è¿™ä¸€æ®µä»£ç å°±æ˜¯ä¸´ç•ŒåŒºã€‚åªèƒ½æœ‰ä¸€ä¸ªæœåŠ¡å‘˜è¿›å…¥ä¸´ç•ŒåŒºï¼Œå ç”¨å’–å•¡æœºï¼Œåˆ¶ä½œå’–å•¡ï¼Œé˜²æ­¢å‡ºç°å¤šä¸ªæœåŠ¡å‘˜åŒæ—¶æ“ä½œå¯¼è‡´çš„é”™è¯¯ã€‚</p><p>æ‰€ä»¥ï¼Œä¸´ç•ŒåŒºæ˜¯æŒ‡åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œéœ€è¦åŒæ­¥è®¿é—®å…±äº«èµ„æºçš„ä»£ç åŒºåŸŸæˆ–æ•°æ®åŒºåŸŸï¼Œä¸ºäº†é¿å…ç«æ€æ¡ä»¶ï¼Œéœ€è¦é€šè¿‡äº’æ–¥é”ç­‰åŒæ­¥æœºåˆ¶æ¥ç¡®ä¿åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè®¿é—®ä¸´ç•ŒåŒºï¼Œä¿è¯æ•°æ®çš„æ­£ç¡®æ€§å’Œä¸€è‡´æ€§ã€‚é€šè¿‡åˆç†ç®¡ç†ä¸´ç•ŒåŒºï¼Œå¯ä»¥æœ‰æ•ˆé¿å…å¤šçº¿ç¨‹ç¨‹åºä¸­çš„å„ç§æ½œåœ¨é—®é¢˜ï¼Œç¡®ä¿ç¨‹åºçš„æ­£ç¡®æ€§å’Œç¨³å®šæ€§ã€‚</p><h2 id="å¤æ‚ä¸€ç‚¹ç‚¹çš„ä¾‹å­"><a href="#å¤æ‚ä¸€ç‚¹ç‚¹çš„ä¾‹å­" class="headerlink" title="å¤æ‚ä¸€ç‚¹ç‚¹çš„ä¾‹å­"></a>å¤æ‚ä¸€ç‚¹ç‚¹çš„ä¾‹å­</h2><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªæ›´å¤æ‚çš„å¤šçº¿ç¨‹ç¤ºä¾‹ï¼Œå…¶ä¸­åŒ…å«ä¸¤ä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªæ˜¯ç”Ÿäº§è€…çº¿ç¨‹ï¼Œä¸€ä¸ªæ˜¯æ¶ˆè´¹è€…çº¿ç¨‹ï¼Œå®ƒä»¬ä¹‹é—´é€šè¿‡å…±äº«çš„ç¼“å†²åŒºè¿›è¡Œé€šä¿¡ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;condition_variable&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span></span></span><br><span class="line"></span><br><span class="line">std::mutex mtx;</span><br><span class="line">std::condition_variable produceCondition, consumeCondition;</span><br><span class="line">std::queue&lt;<span class="type">int</span>&gt; buffer;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> bufferSize = <span class="number">10</span>;</span><br><span class="line"><span class="type">bool</span> done = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">producer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; ++i) &#123;</span><br><span class="line">        <span class="function">std::unique_lock&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(mtx)</span></span>;</span><br><span class="line">        produceCondition.<span class="built_in">wait</span>(lock, [] &#123; <span class="keyword">return</span> buffer.<span class="built_in">size</span>() &lt; bufferSize; &#125;);</span><br><span class="line">        </span><br><span class="line">        buffer.<span class="built_in">push</span>(i);</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Produced: &quot;</span> &lt;&lt; i &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">        lock.<span class="built_in">unlock</span>();</span><br><span class="line">        consumeCondition.<span class="built_in">notify_one</span>();        </span><br><span class="line">    &#125;</span><br><span class="line">    done = <span class="literal">true</span>;</span><br><span class="line">    consumeCondition.<span class="built_in">notify_one</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">consumer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (!done) &#123;</span><br><span class="line">        <span class="function">std::unique_lock&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(mtx)</span></span>;</span><br><span class="line">        consumeCondition.<span class="built_in">wait</span>(lock, [] &#123; <span class="keyword">return</span> !buffer.<span class="built_in">empty</span>() || done; &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!buffer.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="type">int</span> val = buffer.<span class="built_in">front</span>();</span><br><span class="line">            buffer.<span class="built_in">pop</span>();</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;Consumed: &quot;</span> &lt;&lt; val &lt;&lt; std::endl;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        lock.<span class="built_in">unlock</span>();</span><br><span class="line">        produceCondition.<span class="built_in">notify_one</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">std::thread <span class="title">producerThread</span><span class="params">(producer)</span></span>;</span><br><span class="line">    <span class="function">std::thread <span class="title">consumerThread</span><span class="params">(consumer)</span></span>;</span><br><span class="line"></span><br><span class="line">    producerThread.<span class="built_in">join</span>();</span><br><span class="line">    consumerThread.<span class="built_in">join</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œç”Ÿäº§è€…çº¿ç¨‹è´Ÿè´£å‘ç¼“å†²åŒºä¸­æ”¾å…¥æ•°æ®ï¼Œè€Œæ¶ˆè´¹è€…çº¿ç¨‹åˆ™è´Ÿè´£ä»ç¼“å†²åŒºä¸­å–å‡ºæ•°æ®ã€‚ç”Ÿäº§è€…çº¿ç¨‹ä¼šä¸€ç›´ç”Ÿäº§æ•°æ®ç›´åˆ°ç”Ÿäº§å®Œ20ä¸ªæ•°æ®ä¸ºæ­¢ã€‚æ¶ˆè´¹è€…çº¿ç¨‹ä¼šåœ¨ç”Ÿäº§è€…çº¿ç¨‹ç”Ÿäº§æ•°æ®æ—¶ï¼Œä»ç¼“å†²åŒºä¸­æ¶ˆè´¹æ•°æ®ï¼Œå¹¶ä¸”å½“ç”Ÿäº§è€…çº¿ç¨‹ç»“æŸæ—¶ä¹Ÿä¼šç»“æŸã€‚</p><p>é€šè¿‡ä½¿ç”¨äº’æ–¥é”å’Œæ¡ä»¶å˜é‡æ¥å®ç°å¯¹ç¼“å†²åŒºçš„è®¿é—®æ§åˆ¶å’Œçº¿ç¨‹é€šä¿¡ã€‚ç”Ÿäº§è€…çº¿ç¨‹ä¼šæ ¹æ®ç¼“å†²åŒºçš„çŠ¶æ€æ¥å†³å®šæ˜¯å¦ç”Ÿäº§æ•°æ®ï¼Œè€Œæ¶ˆè´¹è€…çº¿ç¨‹ä¹Ÿä¼šæ ¹æ®ç¼“å†²åŒºçš„çŠ¶æ€æ¥å†³å®šæ˜¯å¦æ¶ˆè´¹æ•°æ®ã€‚åœ¨ä¸»å‡½æ•°ä¸­ï¼Œè°ƒç”¨äº† <code>join()</code> æ¥ç­‰å¾…ç”Ÿäº§è€…çº¿ç¨‹å’Œæ¶ˆè´¹è€…çº¿ç¨‹çš„ç»“æŸã€‚</p><p><strong>è¾“å‡º:</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">Produced: <span class="number">0</span></span><br><span class="line">Produced: <span class="number">1</span></span><br><span class="line">Produced: <span class="number">2</span></span><br><span class="line">Produced: <span class="number">3</span></span><br><span class="line">Produced: <span class="number">4</span></span><br><span class="line">Produced: <span class="number">5</span></span><br><span class="line">Produced: <span class="number">6</span></span><br><span class="line">Produced: <span class="number">7</span></span><br><span class="line">Produced: <span class="number">8</span></span><br><span class="line">Produced: <span class="number">9</span></span><br><span class="line">Consumed: <span class="number">0</span></span><br><span class="line">Consumed: <span class="number">1</span></span><br><span class="line">Consumed: <span class="number">2</span></span><br><span class="line">Consumed: <span class="number">3</span></span><br><span class="line">Consumed: <span class="number">4</span></span><br><span class="line">Consumed: <span class="number">5</span></span><br><span class="line">Consumed: <span class="number">6</span></span><br><span class="line">Consumed: <span class="number">7</span></span><br><span class="line">Consumed: <span class="number">8</span></span><br><span class="line">Consumed: <span class="number">9</span></span><br><span class="line">Produced: <span class="number">10</span></span><br><span class="line">Produced: <span class="number">11</span></span><br><span class="line">Produced: <span class="number">12</span></span><br><span class="line">Produced: <span class="number">13</span></span><br><span class="line">Produced: <span class="number">14</span></span><br><span class="line">Produced: <span class="number">15</span></span><br><span class="line">Produced: <span class="number">16</span></span><br><span class="line">Produced: <span class="number">17</span></span><br><span class="line">Produced: <span class="number">18</span></span><br><span class="line">Produced: <span class="number">19</span></span><br><span class="line">Consumed: <span class="number">10</span></span><br></pre></td></tr></table></figure><p><strong>å½“åŠ ä¸Šsleep_forå:</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;condition_variable&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span></span></span><br><span class="line"></span><br><span class="line">std::mutex mtx;</span><br><span class="line">std::condition_variable produceCondition, consumeCondition;</span><br><span class="line">std::queue&lt;<span class="type">int</span>&gt; buffer;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> bufferSize = <span class="number">10</span>;</span><br><span class="line"><span class="type">bool</span> done = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">producer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; ++i) &#123;</span><br><span class="line">        <span class="function">std::unique_lock&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(mtx)</span></span>;</span><br><span class="line">        produceCondition.<span class="built_in">wait</span>(lock, [] &#123; <span class="keyword">return</span> buffer.<span class="built_in">size</span>() &lt; bufferSize; &#125;);</span><br><span class="line"></span><br><span class="line">        buffer.<span class="built_in">push</span>(i);</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Produced: &quot;</span> &lt;&lt; i &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">        lock.<span class="built_in">unlock</span>();</span><br><span class="line">        consumeCondition.<span class="built_in">notify_one</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    done = <span class="literal">true</span>;</span><br><span class="line">    consumeCondition.<span class="built_in">notify_one</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">consumer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (!done) &#123;</span><br><span class="line">        <span class="function">std::unique_lock&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(mtx)</span></span>;</span><br><span class="line">        consumeCondition.<span class="built_in">wait</span>(lock, [] &#123; <span class="keyword">return</span> !buffer.<span class="built_in">empty</span>() || done; &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!buffer.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="type">int</span> val = buffer.<span class="built_in">front</span>();</span><br><span class="line">            buffer.<span class="built_in">pop</span>();</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;Consumed: &quot;</span> &lt;&lt; val &lt;&lt; std::endl;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        lock.<span class="built_in">unlock</span>();</span><br><span class="line">        produceCondition.<span class="built_in">notify_one</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">std::thread <span class="title">producerThread</span><span class="params">(producer)</span></span>;</span><br><span class="line">    <span class="function">std::thread <span class="title">consumerThread</span><span class="params">(consumer)</span></span>;</span><br><span class="line"></span><br><span class="line">    producerThread.<span class="built_in">join</span>();</span><br><span class="line">    consumerThread.<span class="built_in">join</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è¾“å‡º:</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">Produced: <span class="number">0</span></span><br><span class="line">Consumed: <span class="number">0</span></span><br><span class="line">Produced: <span class="number">1</span></span><br><span class="line">Consumed: <span class="number">1</span></span><br><span class="line">Produced: <span class="number">2</span></span><br><span class="line">Consumed: <span class="number">2</span></span><br><span class="line">Produced: <span class="number">3</span></span><br><span class="line">Consumed: <span class="number">3</span></span><br><span class="line">Produced: <span class="number">4</span></span><br><span class="line">Consumed: <span class="number">4</span></span><br><span class="line">Produced: <span class="number">5</span></span><br><span class="line">Consumed: <span class="number">5</span></span><br><span class="line">Produced: <span class="number">6</span></span><br><span class="line">Consumed: <span class="number">6</span></span><br><span class="line">Produced: <span class="number">7</span></span><br><span class="line">Consumed: <span class="number">7</span></span><br><span class="line">Produced: <span class="number">8</span></span><br><span class="line">Consumed: <span class="number">8</span></span><br><span class="line">Produced: <span class="number">9</span></span><br><span class="line">Consumed: <span class="number">9</span></span><br><span class="line">Produced: <span class="number">10</span></span><br><span class="line">Consumed: <span class="number">10</span></span><br><span class="line">Produced: <span class="number">11</span></span><br><span class="line">Consumed: <span class="number">11</span></span><br><span class="line">Produced: <span class="number">12</span></span><br><span class="line">Consumed: <span class="number">12</span></span><br><span class="line">Produced: <span class="number">13</span></span><br><span class="line">Consumed: <span class="number">13</span></span><br><span class="line">Produced: <span class="number">14</span></span><br><span class="line">Consumed: <span class="number">14</span></span><br><span class="line">Produced: <span class="number">15</span></span><br><span class="line">Consumed: <span class="number">15</span></span><br><span class="line">Produced: <span class="number">16</span></span><br><span class="line">Consumed: <span class="number">16</span></span><br><span class="line">Produced: <span class="number">17</span></span><br><span class="line">Consumed: <span class="number">17</span></span><br><span class="line">Produced: <span class="number">18</span></span><br><span class="line">Consumed: <span class="number">18</span></span><br><span class="line">Produced: <span class="number">19</span></span><br><span class="line">Consumed: <span class="number">19</span></span><br></pre></td></tr></table></figure><p>åœ¨ç”Ÿäº§è€…çº¿ç¨‹ä¸­ä½¿ç”¨<code>this_thread::sleep_for(std::chrono::milliseconds(500));</code>æ¥æ¨¡æ‹Ÿç”Ÿäº§æ•°æ®çš„è€—æ—¶æ“ä½œæ˜¯ä¸ºäº†æ¨¡æ‹Ÿå®é™…ç”Ÿäº§æ•°æ®å¯èƒ½å­˜åœ¨çš„è€—æ—¶æƒ…å†µï¼Œè€Œä¸æ˜¯ç«‹å³è¿ç»­ç”Ÿäº§æ•°æ®ã€‚è¿™ç§æ¨¡æ‹Ÿæœ‰å‡ ä¸ªå…³é”®çš„å½±å“ï¼š</p><ol><li><p><strong>æ¨¡æ‹Ÿå®é™…æƒ…å†µ</strong>ï¼šåœ¨å®é™…æƒ…å†µä¸‹ï¼Œç”Ÿäº§æ•°æ®å¯èƒ½æ¶‰åŠåˆ°ä¸€äº›ç¹é‡çš„è®¡ç®—æˆ–I&#x2F;Oæ“ä½œï¼Œè¿™å¯èƒ½å¯¼è‡´éœ€è¦ä¸€å®šçš„æ—¶é—´æ¥ç”Ÿæˆæ•°æ®ã€‚é€šè¿‡è¿™ç§æ¨¡æ‹Ÿï¼Œå¯ä»¥æ›´å¥½åœ°åæ˜ ç°å®æƒ…å†µä¸‹çš„ç”Ÿäº§æ•°æ®è¿‡ç¨‹ã€‚</p></li><li><p><strong>çº¿ç¨‹è°ƒåº¦</strong>ï¼šä½¿ç”¨<code>sleep_for</code>ä¼šä½¿å¾—å½“å‰çº¿ç¨‹åœ¨æŒ‡å®šçš„æ—¶é—´å†…æš‚åœæ‰§è¡Œï¼Œå…¶ä»–çº¿ç¨‹æœ‰æœºä¼šç»§ç»­æ‰§è¡Œã€‚è¿™æœ‰åŠ©äºæ¨¡æ‹Ÿå¹¶å‘ç¯å¢ƒä¸­ä¸åŒçº¿ç¨‹ä¹‹é—´çš„è°ƒåº¦å’Œç«äº‰ã€‚</p></li><li><p><strong>é¿å…èµ„æºäº‰å¤º</strong>ï¼šç”±äºç”Ÿäº§è€…çº¿ç¨‹åœ¨ç”Ÿäº§æ•°æ®æ—¶ä¼šæš‚åœä¸€æ®µæ—¶é—´ï¼Œæ¶ˆè´¹è€…çº¿ç¨‹æœ‰æœºä¼šè®¿é—®å’Œå¤„ç†å·²ç”Ÿäº§çš„æ•°æ®ï¼Œè€Œä¸ä¼šå› ä¸ºç”Ÿäº§é€Ÿåº¦è¿‡å¿«å¯¼è‡´é˜Ÿåˆ—æº¢å‡ºæˆ–æ•°æ®ä¸¢å¤±ã€‚</p></li></ol><p>å¦‚æœå»æ‰<code>this_thread::sleep_for(std::chrono::milliseconds(500));</code>éƒ¨åˆ†ï¼Œç”Ÿäº§è€…çº¿ç¨‹å°†ä¼šå˜å¾—éå¸¸å¿«é€Ÿï¼Œå¯èƒ½å¯¼è‡´ç”Ÿäº§çš„æ•°æ®è¿…é€Ÿå¡«æ»¡é˜Ÿåˆ—ï¼Œæ¶ˆè´¹è€…çº¿ç¨‹æ— æ³•åŠæ—¶æ¶ˆè´¹ï¼Œä»è€Œå¯¼è‡´é˜Ÿåˆ—æº¢å‡ºã€‚å› æ­¤ï¼Œè¿™æ®µä»£ç ä¸­çš„å»¶æ—¶æ“ä½œå¯¹äºæ­£ç¡®æ¨¡æ‹Ÿç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´çš„äº¤äº’è¿‡ç¨‹å’Œçº¿ç¨‹è°ƒåº¦æ˜¯éå¸¸é‡è¦çš„ã€‚</p><ol><li><p><strong>ä¸ºä»€ä¹ˆdone&#x3D;trueåé¢è¦åŠ consumeCondition.notify_one();</strong></p><p> åœ¨å…¸å‹çš„ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ä¸­ï¼Œ<code>done=true</code>é€šå¸¸è¡¨ç¤ºç”Ÿäº§è€…å·²ç»å®Œæˆäº†ç”Ÿäº§ä»»åŠ¡ï¼Œæ²¡æœ‰æ›´å¤šçš„æ•°æ®å¯ä¾›æ¶ˆè´¹è€…æ¶ˆè´¹ã€‚å½“<code>done</code>è¢«è®¾ç½®ä¸º<code>true</code>æ—¶ï¼Œæ¶ˆè´¹è€…çº¿ç¨‹éœ€è¦è¢«å”¤é†’å¹¶é€€å‡ºå¾ªç¯ï¼Œä»¥é¿å…ä¸å¿…è¦çš„ç­‰å¾…å’Œèµ„æºæµªè´¹ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œé€šå¸¸ä¼šä½¿ç”¨æ¡ä»¶å˜é‡ï¼ˆcondition variableï¼‰æ¥å®ç°çº¿ç¨‹çš„ç­‰å¾…å’Œå”¤é†’ã€‚</p><p> åœ¨è®¾ç½®<code>done=true</code>ä¹‹åï¼Œé€šè¿‡è°ƒç”¨<code>consumeCondition.notify_one()</code>æ¥å”¤é†’ç­‰å¾…åœ¨<code>consumeCondition</code>æ¡ä»¶å˜é‡ä¸Šçš„ä¸€ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹ã€‚è¿™æ ·åšå¯ä»¥ç¡®ä¿æ¶ˆè´¹è€…çº¿ç¨‹åœ¨<code>done=true</code>ä¹‹åèƒ½å¤Ÿç«‹å³è¢«å”¤é†’ï¼Œæ£€æŸ¥æ¡ä»¶å¹¶é€€å‡ºå¾ªç¯ã€‚æ²¡æœ‰è¿™ä¸€æ­¥çš„å”¤é†’æ“ä½œï¼Œæ¶ˆè´¹è€…çº¿ç¨‹å¯èƒ½ä¼šä¸€ç›´é˜»å¡åœ¨æ¡ä»¶å˜é‡ä¸Šï¼Œæ— æ³•åŠæ—¶é€€å‡ºå¾ªç¯ï¼Œå¯¼è‡´èµ„æºæµªè´¹æˆ–ç¨‹åºé€»è¾‘é”™è¯¯ã€‚</p><p> å› æ­¤ï¼Œé€šè¿‡åœ¨<code>done=true</code>ä¹‹åè°ƒç”¨<code>consumeCondition.notify_one()</code>æ¥å”¤é†’æ¶ˆè´¹è€…çº¿ç¨‹ï¼Œç¡®ä¿äº†ç”Ÿäº§è€…å®Œæˆç”Ÿäº§åæ¶ˆè´¹è€…èƒ½å¤ŸåŠæ—¶é€€å‡ºå¾ªç¯ï¼Œæœ‰æ•ˆåœ°ç®¡ç†çº¿ç¨‹çš„æ‰§è¡Œé¡ºåºå’Œèµ„æºçš„åˆ©ç”¨ã€‚</p></li><li><p><strong>condition_variableæ˜¯ä»€ä¹ˆ</strong></p><p> <code>std::condition_variable</code> æ˜¯ C++ æ ‡å‡†åº“ä¸­ç”¨æ¥å®ç°å¤šçº¿ç¨‹åŒæ­¥çš„ä¸€ç§æœºåˆ¶ã€‚å®ƒå…è®¸ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ç­‰å¾…ï¼Œç›´åˆ°æŸä¸ªæ¡ä»¶å¾—åˆ°æ»¡è¶³åå†ç»§ç»­æ‰§è¡Œã€‚åœ¨å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦ä¸€ç§æ–¹å¼æ¥è¿›è¡Œçº¿ç¨‹ä¹‹é—´çš„é€šä¿¡å’ŒåŒæ­¥ï¼Œ<code>std::condition_variable</code> å°±æ˜¯ä¸ºæ­¤è€Œè®¾è®¡çš„ã€‚</p><p> åœ¨ä½¿ç”¨ <code>std::condition_variable</code> æ—¶é€šå¸¸å’Œ <code>std::mutex</code> é…åˆä½¿ç”¨ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>ä½¿ç”¨ <code>std::mutex</code> æ¥ä¿æŠ¤éœ€è¦ç­‰å¾…çš„æ¡ä»¶å˜é‡å’Œå…±äº«èµ„æºã€‚</li><li>å½“æ¡ä»¶ä¸æ»¡è¶³æ—¶ï¼Œçº¿ç¨‹é€šè¿‡ <code>std::condition_variable</code> çš„ <code>wait()</code> æ–¹æ³•é‡Šæ”¾é”å¹¶è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ°å…¶ä»–çº¿ç¨‹é€šçŸ¥æ¡ä»¶æ»¡è¶³ã€‚</li><li>å½“å…¶ä»–çº¿ç¨‹æ»¡è¶³äº†æ¡ä»¶åï¼Œè°ƒç”¨ <code>std::condition_variable</code> çš„ <code>notify_one()</code> æˆ– <code>notify_all()</code> æ–¹æ³•æ¥å”¤é†’ç­‰å¾…çš„çº¿ç¨‹ã€‚</li></ol><p> é€šè¿‡ <code>std::condition_variable</code>ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°çº¿ç¨‹ä¹‹é—´çš„æœ‰æ•ˆåä½œå’ŒåŒæ­¥ï¼Œé¿å…äº†çº¿ç¨‹å¿™ç­‰å¾…ï¼Œæé«˜äº†ç¨‹åºçš„æ•ˆç‡å’Œæ€§èƒ½ã€‚</p></li></ol><h2 id="4ä¸ªçº¿ç¨‹æ¥å¹¶å‘è®¡ç®—éƒ¨åˆ†å’Œ"><a href="#4ä¸ªçº¿ç¨‹æ¥å¹¶å‘è®¡ç®—éƒ¨åˆ†å’Œ" class="headerlink" title="4ä¸ªçº¿ç¨‹æ¥å¹¶å‘è®¡ç®—éƒ¨åˆ†å’Œ"></a>4ä¸ªçº¿ç¨‹æ¥å¹¶å‘è®¡ç®—éƒ¨åˆ†å’Œ</h2>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;note info&quot;&gt;&lt;p&gt;ä¸Šæ¬¡æ›´æ–°blogè¿˜æ˜¯ç”Ÿæ—¥4.29ï¼Œè¿™ä¸€ä¸ªæœˆçœŸæ˜¯å¿™é¼ äº†ï¼Œç°åœ¨æœ‰äº†ä¸€ä¸ªæ–°ä»»åŠ¡-å¤šçº¿ç¨‹ï¼Œæä¸€ä¸‹(ä¸åŠ å¤šçº¿ç¨‹çš„è¯æˆ‘çš„è½¦è½¦ä¼šå˜æˆèœ—ç‰›ğŸŒçš„ã€‚ã€‚ã€‚ã€‚)&lt;/p&gt;&lt;/div&gt;


&lt;h2 id=&quot;ç®€å•ç¤ºä¾‹&quot;&gt;&lt;a href=&quot;#ç®€å•ç¤ºä¾‹&quot; cl</summary>
      
    
    
    
    <category term="æ™ºèƒ½è½¦" scheme="http://tumytime.github.io/categories/%E6%99%BA%E8%83%BD%E8%BD%A6/"/>
    
    
    <category term="C++" scheme="http://tumytime.github.io/tags/C/"/>
    
    <category term="æ™ºèƒ½è½¦ï¼Œå¤šçº¿ç¨‹" scheme="http://tumytime.github.io/tags/%E6%99%BA%E8%83%BD%E8%BD%A6%EF%BC%8C%E5%A4%9A%E7%BA%BF%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€äº›å›¾åƒå¤„ç†çš„å‡½æ•°</title>
    <link href="http://tumytime.github.io/2024/04/29/%E4%B8%80%E4%BA%9B%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86%E7%9A%84%E5%87%BD%E6%95%B0/"/>
    <id>http://tumytime.github.io/2024/04/29/%E4%B8%80%E4%BA%9B%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86%E7%9A%84%E5%87%BD%E6%95%B0/</id>
    <published>2024-04-29T11:47:24.000Z</published>
    <updated>2024-04-29T12:18:44.409Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä¸­å€¼æ»¤æ³¢"><a href="#ä¸­å€¼æ»¤æ³¢" class="headerlink" title="ä¸­å€¼æ»¤æ³¢"></a>ä¸­å€¼æ»¤æ³¢</h2><p><strong>å·ç§¯æ ¸å¤§å°ä¸º7ï¼š</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Mat <span class="title">medianFilter</span><span class="params">(Mat imgO)</span> </span>&#123;</span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªæ–°çš„Matå¯¹è±¡ç”¨äºå­˜å‚¨æ»¤æ³¢åçš„å›¾åƒ</span></span><br><span class="line">Mat img1 = Mat::<span class="built_in">zeros</span>(imgO.rows - <span class="number">6</span>, imgO.cols - <span class="number">6</span>, CV_8U);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¹è¾“å…¥å›¾åƒè¿›è¡Œä¸­å€¼æ»¤æ³¢</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> y = <span class="number">3</span>; y &lt; imgO.rows - <span class="number">3</span>; y++) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x = <span class="number">3</span>; x &lt; imgO.cols - <span class="number">3</span>; x++) &#123;</span><br><span class="line">vector&lt;uchar&gt; values;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">-3</span>; j &lt;= <span class="number">3</span>; j++) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">-3</span>; i &lt;= <span class="number">3</span>; i++) &#123;</span><br><span class="line">values.<span class="built_in">push_back</span>(imgO.<span class="built_in">at</span>&lt;uchar&gt;(y + j, x + i));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å¯¹valuesæ•°ç»„ä¸­çš„å€¼è¿›è¡Œæ’åº</span></span><br><span class="line"><span class="built_in">sort</span>(values.<span class="built_in">begin</span>(), values.<span class="built_in">end</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¡ç®—ä¸­å€¼å¹¶èµ‹å€¼ç»™è¾“å‡ºå›¾åƒ</span></span><br><span class="line">img1.<span class="built_in">at</span>&lt;uchar&gt;(y - <span class="number">3</span>, x - <span class="number">3</span>) = values[values.<span class="built_in">size</span>() / <span class="number">2</span>];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> img1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ•ˆæœ</strong></p><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src=",https://tumytime.github.io/picx-images-hosting/image.2yy5oeqtl5.webp" class="lazyload placeholder" data-srcset=",https://tumytime.github.io/picx-images-hosting/image.2yy5oeqtl5.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div><h2 id="sobelç®—å­è¾¹ç¼˜æ£€æµ‹"><a href="#sobelç®—å­è¾¹ç¼˜æ£€æµ‹" class="headerlink" title="sobelç®—å­è¾¹ç¼˜æ£€æµ‹"></a>sobelç®—å­è¾¹ç¼˜æ£€æµ‹</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Mat <span class="title">sobel3</span><span class="params">(Mat inputImg)</span> </span>&#123;</span><br><span class="line"><span class="type">int</span> gx, gy;</span><br><span class="line">Mat tempImg;</span><br><span class="line">inputImg.<span class="built_in">copyTo</span>(tempImg); <span class="comment">// ä¸ºäº†èƒ½å¤Ÿåœ¨è¾“å‡ºå›¾åƒä¸­è®¿é—®åŸå§‹è¾“å…¥å›¾åƒçš„åƒç´ å€¼</span></span><br><span class="line"></span><br><span class="line">Mat outputImg = Mat::<span class="built_in">zeros</span>(inputImg.<span class="built_in">size</span>(), inputImg.<span class="built_in">type</span>());</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> y = <span class="number">1</span>; y &lt; inputImg.rows - <span class="number">1</span>; y++) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> x = <span class="number">1</span>; x &lt; inputImg.cols - <span class="number">1</span>; x++) &#123;</span><br><span class="line">gx = (<span class="number">-1</span> * tempImg.<span class="built_in">at</span>&lt;uchar&gt;(y - <span class="number">1</span>, x - <span class="number">1</span>) + <span class="number">1</span> * tempImg.<span class="built_in">at</span>&lt;uchar&gt;(y - <span class="number">1</span>, x + <span class="number">1</span>) +</span><br><span class="line"><span class="number">-2</span> * tempImg.<span class="built_in">at</span>&lt;uchar&gt;(y, x - <span class="number">1</span>) + <span class="number">2</span> * tempImg.<span class="built_in">at</span>&lt;uchar&gt;(y, x + <span class="number">1</span>) +</span><br><span class="line"><span class="number">-1</span> * tempImg.<span class="built_in">at</span>&lt;uchar&gt;(y + <span class="number">1</span>, x - <span class="number">1</span>) + <span class="number">1</span> * tempImg.<span class="built_in">at</span>&lt;uchar&gt;(y + <span class="number">1</span>, x + <span class="number">1</span>)) / <span class="number">4</span>;</span><br><span class="line">gy = (<span class="number">1</span> * tempImg.<span class="built_in">at</span>&lt;uchar&gt;(y - <span class="number">1</span>, x - <span class="number">1</span>) + <span class="number">2</span> * tempImg.<span class="built_in">at</span>&lt;uchar&gt;(y - <span class="number">1</span>, x) + <span class="number">1</span> * tempImg.<span class="built_in">at</span>&lt;uchar&gt;(y - <span class="number">1</span>, x + <span class="number">1</span>) +</span><br><span class="line"><span class="number">-1</span> * tempImg.<span class="built_in">at</span>&lt;uchar&gt;(y + <span class="number">1</span>, x - <span class="number">1</span>) - <span class="number">2</span> * tempImg.<span class="built_in">at</span>&lt;uchar&gt;(y + <span class="number">1</span>, x) - <span class="number">1</span> * tempImg.<span class="built_in">at</span>&lt;uchar&gt;(y + <span class="number">1</span>, x + <span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">outputImg.<span class="built_in">at</span>&lt;uchar&gt;(y, x) = (<span class="built_in">abs</span>(gx) + <span class="built_in">abs</span>(gy)) / <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> outputImg.<span class="built_in">clone</span>(); <span class="comment">// è¿”å›outputImgçš„å‰¯æœ¬</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ•ˆæœ</strong></p><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src=",https://tumytime.github.io/picx-images-hosting/image.4jnwnvqbmt.webp" class="lazyload placeholder" data-srcset=",https://tumytime.github.io/picx-images-hosting/image.4jnwnvqbmt.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;ä¸­å€¼æ»¤æ³¢&quot;&gt;&lt;a href=&quot;#ä¸­å€¼æ»¤æ³¢&quot; class=&quot;headerlink&quot; title=&quot;ä¸­å€¼æ»¤æ³¢&quot;&gt;&lt;/a&gt;ä¸­å€¼æ»¤æ³¢&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;å·ç§¯æ ¸å¤§å°ä¸º7ï¼š&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight c++&quot;&gt;&lt;t</summary>
      
    
    
    
    <category term="æ™ºèƒ½è½¦" scheme="http://tumytime.github.io/categories/%E6%99%BA%E8%83%BD%E8%BD%A6/"/>
    
    
    <category term="æ™ºèƒ½è½¦" scheme="http://tumytime.github.io/tags/%E6%99%BA%E8%83%BD%E8%BD%A6/"/>
    
  </entry>
  
  <entry>
    <title>AuTopä»£ç æ•´ç†</title>
    <link href="http://tumytime.github.io/2024/04/28/AuTop%E4%BB%A3%E7%A0%81%E6%95%B4%E7%90%86/"/>
    <id>http://tumytime.github.io/2024/04/28/AuTop%E4%BB%A3%E7%A0%81%E6%95%B4%E7%90%86/</id>
    <published>2024-04-28T11:36:06.000Z</published>
    <updated>2024-05-03T17:37:19.012Z</updated>
    
    <content type="html"><![CDATA[<h2 id="åœ†ç¯circle"><a href="#åœ†ç¯circle" class="headerlink" title="åœ†ç¯circle"></a>åœ†ç¯circle</h2><details ><summary pointer> circle.c </summary>              <div class='content'>              <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;circle.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;motor.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;main.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">circle_type_e</span> <span class="title">circle_type</span> =</span> CIRCLE_NONE;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ–¹ä¾¿ä¸²å£æ”¶å‘</span></span><br><span class="line"><span class="type">const</span> <span class="type">char</span> *circle_type_name[CIRCLE_NUM] = &#123;</span><br><span class="line">        <span class="string">&quot;CIRCLE_NONE&quot;</span>,</span><br><span class="line">        <span class="string">&quot;CIRCLE_LEFT_BEGIN&quot;</span>, <span class="string">&quot;CIRCLE_RIGHT_BEGIN&quot;</span>,</span><br><span class="line">        <span class="string">&quot;CIRCLE_LEFT_RUNNING&quot;</span>, <span class="string">&quot;CIRCLE_RIGHT_RUNNING&quot;</span>,</span><br><span class="line">        <span class="string">&quot;CIRCLE_LEFT_IN&quot;</span>, <span class="string">&quot;CIRCLE_RIGHT_IN&quot;</span>,</span><br><span class="line">        <span class="string">&quot;CIRCLE_LEFT_OUT&quot;</span>, <span class="string">&quot;CIRCLE_RIGHT_OUT&quot;</span>,</span><br><span class="line">        <span class="string">&quot;CIRCLE_LEFT_END&quot;</span>, <span class="string">&quot;CIRCLE_RIGHT_END&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¼–ç å™¨ï¼Œç”¨äºé˜²æ­¢ä¸€äº›é‡å¤è§¦å‘ç­‰ã€‚</span></span><br><span class="line"><span class="type">int64_t</span> circle_encoder;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> none_left_line = <span class="number">0</span>, none_right_line = <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> have_left_line = <span class="number">0</span>, have_right_line = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">check_circle</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// éåœ†ç¯æ¨¡å¼ä¸‹ï¼Œå•è¾¹Lè§’ç‚¹, å•è¾¹é•¿ç›´é“</span></span><br><span class="line">    <span class="keyword">if</span> (circle_type == CIRCLE_NONE &amp;&amp; Lpt0_found &amp;&amp; !Lpt1_found &amp;&amp; is_straight1) &#123;</span><br><span class="line">        circle_type = CIRCLE_LEFT_BEGIN;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (circle_type == CIRCLE_NONE &amp;&amp; !Lpt0_found &amp;&amp; Lpt1_found &amp;&amp; is_straight0) &#123;</span><br><span class="line">        circle_type = CIRCLE_RIGHT_BEGIN;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">run_circle</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int64_t</span> current_encoder = get_total_encoder();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å·¦ç¯å¼€å§‹ï¼Œå¯»å¤–ç›´é“å³çº¿</span></span><br><span class="line">    <span class="keyword">if</span> (circle_type == CIRCLE_LEFT_BEGIN) &#123;</span><br><span class="line">        track_type = TRACK_RIGHT;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å…ˆä¸¢å·¦çº¿åæœ‰çº¿</span></span><br><span class="line">        <span class="keyword">if</span> (rpts0s_num &lt; <span class="number">0.2</span> / sample_dist) &#123; none_left_line++; &#125;</span><br><span class="line">        <span class="keyword">if</span> (rpts0s_num &gt; <span class="number">1.0</span> / sample_dist &amp;&amp; none_left_line &gt; <span class="number">2</span>) &#123;</span><br><span class="line">            have_left_line++;</span><br><span class="line">            <span class="keyword">if</span> (have_left_line &gt; <span class="number">1</span>) &#123;</span><br><span class="line">                circle_type = CIRCLE_LEFT_IN;</span><br><span class="line">                none_left_line = <span class="number">0</span>;</span><br><span class="line">                have_left_line = <span class="number">0</span>;</span><br><span class="line">                circle_encoder = current_encoder;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å…¥ç¯ï¼Œå¯»å†…åœ†å·¦çº¿</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (circle_type == CIRCLE_LEFT_IN) &#123;</span><br><span class="line">        track_type = TRACK_LEFT;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç¼–ç å™¨æ‰“è¡¨è¿‡1/4åœ†   åº”ä¿®æ­£ä¸ºå³çº¿ä¸ºè½¬å¼¯æ— æ‹ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (rpts0s_num &lt; <span class="number">0.1</span> / sample_dist ||</span><br><span class="line">            current_encoder - circle_encoder &gt;= ENCODER_PER_METER * (<span class="number">3.14</span> * <span class="number">1</span> / <span class="number">2</span>)) &#123; circle_type = CIRCLE_LEFT_RUNNING; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//æ­£å¸¸å·¡çº¿ï¼Œå¯»å¤–åœ†å³çº¿</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (circle_type == CIRCLE_LEFT_RUNNING) &#123;</span><br><span class="line">        track_type = TRACK_RIGHT;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (Lpt1_found) rpts1s_num = rptsc1_num = Lpt1_rpts1s_id;</span><br><span class="line">        <span class="comment">//å¤–ç¯æ‹ç‚¹(å³Lç‚¹)</span></span><br><span class="line">        <span class="keyword">if</span> (Lpt1_found &amp;&amp; Lpt1_rpts1s_id &lt; <span class="number">0.4</span> / sample_dist) &#123;</span><br><span class="line">            circle_type = CIRCLE_LEFT_OUT;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å‡ºç¯ï¼Œå¯»å†…åœ†</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (circle_type == CIRCLE_LEFT_OUT) &#123;</span><br><span class="line">        track_type = TRACK_LEFT;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å³çº¿ä¸ºé•¿ç›´é“</span></span><br><span class="line">        <span class="keyword">if</span> (is_straight1) &#123;</span><br><span class="line">            circle_type = CIRCLE_LEFT_END;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//èµ°è¿‡åœ†ç¯ï¼Œå¯»å³çº¿</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (circle_type == CIRCLE_LEFT_END) &#123;</span><br><span class="line">        track_type = TRACK_RIGHT;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å·¦çº¿å…ˆä¸¢åæœ‰</span></span><br><span class="line">        <span class="keyword">if</span> (rpts0s_num &lt; <span class="number">0.2</span> / sample_dist) &#123; none_left_line++; &#125;</span><br><span class="line">        <span class="keyword">if</span> (rpts0s_num &gt; <span class="number">1.0</span> / sample_dist &amp;&amp; none_left_line &gt; <span class="number">3</span>) &#123;</span><br><span class="line">            circle_type = CIRCLE_NONE;</span><br><span class="line">            none_left_line = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å³ç¯æ§åˆ¶ï¼Œå‰æœŸå¯»å·¦ç›´é“</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (circle_type == CIRCLE_RIGHT_BEGIN) &#123;</span><br><span class="line">        track_type = TRACK_LEFT;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å…ˆä¸¢å³çº¿åæœ‰çº¿</span></span><br><span class="line">        <span class="keyword">if</span> (rpts1s_num &lt; <span class="number">0.2</span> / sample_dist) &#123; none_right_line++; &#125;</span><br><span class="line">        <span class="keyword">if</span> (rpts1s_num &gt; <span class="number">1.0</span> / sample_dist &amp;&amp; none_right_line &gt; <span class="number">2</span>) &#123;</span><br><span class="line">            have_right_line++;</span><br><span class="line">            <span class="keyword">if</span> (have_right_line &gt; <span class="number">1</span>) &#123;</span><br><span class="line">                circle_type = CIRCLE_RIGHT_IN;</span><br><span class="line">                none_right_line = <span class="number">0</span>;</span><br><span class="line">                have_right_line = <span class="number">0</span>;</span><br><span class="line">                circle_encoder = current_encoder;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å…¥å³ç¯ï¼Œå¯»å³å†…åœ†ç¯</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (circle_type == CIRCLE_RIGHT_IN) &#123;</span><br><span class="line">        track_type = TRACK_RIGHT;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç¼–ç å™¨æ‰“è¡¨è¿‡1/4åœ†   åº”ä¿®æ­£ä¸ºå·¦çº¿ä¸ºè½¬å¼¯æ— æ‹ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (rpts1s_num &lt; <span class="number">0.1</span> / sample_dist ||</span><br><span class="line">            current_encoder - circle_encoder &gt;= ENCODER_PER_METER * (<span class="number">3.14</span> * <span class="number">1</span> / <span class="number">2</span>)) &#123; circle_type = CIRCLE_RIGHT_RUNNING; &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//æ­£å¸¸å·¡çº¿ï¼Œå¯»å¤–åœ†å·¦çº¿</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (circle_type == CIRCLE_RIGHT_RUNNING) &#123;</span><br><span class="line">        track_type = TRACK_LEFT;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¤–ç¯å­˜åœ¨æ‹ç‚¹,å¯å†åŠ æ‹ç‚¹è·ç¦»åˆ¤æ®(å·¦Lç‚¹)</span></span><br><span class="line">        <span class="keyword">if</span> (Lpt0_found) rpts0s_num = rptsc0_num = Lpt0_rpts0s_id;</span><br><span class="line">        <span class="keyword">if</span> (Lpt0_found &amp;&amp; Lpt0_rpts0s_id &lt; <span class="number">0.4</span> / sample_dist) &#123;</span><br><span class="line">            circle_type = CIRCLE_RIGHT_OUT;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å‡ºç¯ï¼Œå¯»å†…åœ†</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (circle_type == CIRCLE_RIGHT_OUT) &#123;</span><br><span class="line">        track_type = TRACK_RIGHT;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å·¦é•¿åº¦åŠ å€¾æ–œè§’åº¦  åº”ä¿®æ­£å·¦å³çº¿æ‰¾åˆ°ä¸”ä¸ºç›´çº¿</span></span><br><span class="line">        <span class="comment">//if((rpts1s_num &gt;100 &amp;&amp; !Lpt1_found))  &#123;have_right_line++;&#125;</span></span><br><span class="line">        <span class="keyword">if</span> (is_straight0) &#123;</span><br><span class="line">            circle_type = CIRCLE_RIGHT_END;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">        <span class="comment">//èµ°è¿‡åœ†ç¯ï¼Œå¯»å·¦çº¿</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (circle_type == CIRCLE_RIGHT_END) &#123;</span><br><span class="line">        track_type = TRACK_LEFT;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å·¦çº¿å…ˆä¸¢åæœ‰</span></span><br><span class="line">        <span class="keyword">if</span> (rpts1s_num &lt; <span class="number">0.2</span> / sample_dist) &#123; none_right_line++; &#125;</span><br><span class="line">        <span class="keyword">if</span> (rpts1s_num &gt; <span class="number">1.0</span> / sample_dist &amp;&amp; none_right_line &gt; <span class="number">2</span>) &#123;</span><br><span class="line">            circle_type = CIRCLE_NONE;</span><br><span class="line">            none_right_line = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»˜åˆ¶åœ†ç¯æ¨¡å¼ä¸‹çš„è°ƒè¯•å›¾åƒ</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">draw_circle</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>              </div>            </details><details ><summary pointer> circle.h </summary>              <div class='content'>              <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> CIRCLE_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CIRCLE_H</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">enum</span> <span class="title">circle_type_e</span> &#123;</span></span><br><span class="line">    CIRCLE_NONE = <span class="number">0</span>,                            <span class="comment">// éåœ†ç¯æ¨¡å¼</span></span><br><span class="line">    CIRCLE_LEFT_BEGIN, CIRCLE_RIGHT_BEGIN,      <span class="comment">// åœ†ç¯å¼€å§‹ï¼Œè¯†åˆ«åˆ°å•ä¾§Lè§’ç‚¹å¦ä¸€ä¾§é•¿ç›´é“ã€‚</span></span><br><span class="line">    CIRCLE_LEFT_IN, CIRCLE_RIGHT_IN,            <span class="comment">// åœ†ç¯è¿›å…¥ï¼Œå³èµ°åˆ°ä¸€ä¾§ç›´é“ï¼Œä¸€ä¾§åœ†ç¯çš„ä½ç½®ã€‚</span></span><br><span class="line">    CIRCLE_LEFT_RUNNING, CIRCLE_RIGHT_RUNNING,  <span class="comment">// åœ†ç¯å†…éƒ¨ã€‚</span></span><br><span class="line">    CIRCLE_LEFT_OUT, CIRCLE_RIGHT_OUT,          <span class="comment">// å‡†å¤‡å‡ºåœ†ç¯ï¼Œå³è¯†åˆ«åˆ°å‡ºç¯å¤„çš„Lè§’ç‚¹ã€‚</span></span><br><span class="line">    CIRCLE_LEFT_END, CIRCLE_RIGHT_END,          <span class="comment">// åœ†ç¯ç»“æŸï¼Œå³å†æ¬¡èµ°åˆ°å•ä¾§ç›´é“çš„ä½ç½®ã€‚</span></span><br><span class="line">    CIRCLE_NUM,                                 <span class="comment">//</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="type">const</span> <span class="type">char</span> *circle_type_name[CIRCLE_NUM];</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="class"><span class="keyword">enum</span> <span class="title">circle_type_e</span> <span class="title">circle_type</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">check_circle</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">run_circle</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">draw_circle</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// CIRCLE_H</span></span></span><br></pre></td></tr></table></figure>              </div>            </details><h3 id="éåœ†ç¯æ¨¡å¼ä¸‹åˆ¤æ–­åœ†ç¯"><a href="#éåœ†ç¯æ¨¡å¼ä¸‹åˆ¤æ–­åœ†ç¯" class="headerlink" title="éåœ†ç¯æ¨¡å¼ä¸‹åˆ¤æ–­åœ†ç¯"></a>éåœ†ç¯æ¨¡å¼ä¸‹åˆ¤æ–­åœ†ç¯</h3><p><strong>å•è¾¹Lè§’ç‚¹, å•è¾¹é•¿ç›´é“</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">check_circle</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// éåœ†ç¯æ¨¡å¼ä¸‹ï¼Œå•è¾¹Lè§’ç‚¹, å•è¾¹é•¿ç›´é“</span></span><br><span class="line">    <span class="keyword">if</span> (circle_type == CIRCLE_NONE &amp;&amp; Lpt0_found &amp;&amp; !Lpt1_found &amp;&amp; is_straight1) &#123;</span><br><span class="line">        circle_type = CIRCLE_LEFT_BEGIN;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (circle_type == CIRCLE_NONE &amp;&amp; !Lpt0_found &amp;&amp; Lpt1_found &amp;&amp; is_straight0) &#123;</span><br><span class="line">        circle_type = CIRCLE_RIGHT_BEGIN;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åœ†ç¯æ‰§è¡Œ"><a href="#åœ†ç¯æ‰§è¡Œ" class="headerlink" title="åœ†ç¯æ‰§è¡Œ"></a>åœ†ç¯æ‰§è¡Œ</h3><details ><summary pointer> run_circle() </summary>              <div class='content'>              <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">run_circle</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int64_t</span> current_encoder = get_total_encoder();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å·¦ç¯å¼€å§‹ï¼Œå¯»å¤–ç›´é“å³çº¿</span></span><br><span class="line">    <span class="keyword">if</span> (circle_type == CIRCLE_LEFT_BEGIN) &#123;</span><br><span class="line">        track_type = TRACK_RIGHT;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å…ˆä¸¢å·¦çº¿åæœ‰çº¿</span></span><br><span class="line">        <span class="keyword">if</span> (rpts0s_num &lt; <span class="number">0.2</span> / sample_dist) &#123; none_left_line++; &#125;</span><br><span class="line">        <span class="keyword">if</span> (rpts0s_num &gt; <span class="number">1.0</span> / sample_dist &amp;&amp; none_left_line &gt; <span class="number">2</span>) &#123;</span><br><span class="line">            have_left_line++;</span><br><span class="line">            <span class="keyword">if</span> (have_left_line &gt; <span class="number">1</span>) &#123;</span><br><span class="line">                circle_type = CIRCLE_LEFT_IN;</span><br><span class="line">                none_left_line = <span class="number">0</span>;</span><br><span class="line">                have_left_line = <span class="number">0</span>;</span><br><span class="line">                circle_encoder = current_encoder;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å…¥ç¯ï¼Œå¯»å†…åœ†å·¦çº¿</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (circle_type == CIRCLE_LEFT_IN) &#123;</span><br><span class="line">        track_type = TRACK_LEFT;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç¼–ç å™¨æ‰“è¡¨è¿‡1/4åœ†   åº”ä¿®æ­£ä¸ºå³çº¿ä¸ºè½¬å¼¯æ— æ‹ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (rpts0s_num &lt; <span class="number">0.1</span> / sample_dist ||</span><br><span class="line">            current_encoder - circle_encoder &gt;= ENCODER_PER_METER * (<span class="number">3.14</span> * <span class="number">1</span> / <span class="number">2</span>)) &#123; circle_type = CIRCLE_LEFT_RUNNING; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//æ­£å¸¸å·¡çº¿ï¼Œå¯»å¤–åœ†å³çº¿</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (circle_type == CIRCLE_LEFT_RUNNING) &#123;</span><br><span class="line">        track_type = TRACK_RIGHT;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (Lpt1_found) rpts1s_num = rptsc1_num = Lpt1_rpts1s_id;</span><br><span class="line">        <span class="comment">//å¤–ç¯æ‹ç‚¹(å³Lç‚¹)</span></span><br><span class="line">        <span class="keyword">if</span> (Lpt1_found &amp;&amp; Lpt1_rpts1s_id &lt; <span class="number">0.4</span> / sample_dist) &#123;</span><br><span class="line">            circle_type = CIRCLE_LEFT_OUT;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å‡ºç¯ï¼Œå¯»å†…åœ†</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (circle_type == CIRCLE_LEFT_OUT) &#123;</span><br><span class="line">        track_type = TRACK_LEFT;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å³çº¿ä¸ºé•¿ç›´é“</span></span><br><span class="line">        <span class="keyword">if</span> (is_straight1) &#123;</span><br><span class="line">            circle_type = CIRCLE_LEFT_END;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//èµ°è¿‡åœ†ç¯ï¼Œå¯»å³çº¿</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (circle_type == CIRCLE_LEFT_END) &#123;</span><br><span class="line">        track_type = TRACK_RIGHT;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å·¦çº¿å…ˆä¸¢åæœ‰</span></span><br><span class="line">        <span class="keyword">if</span> (rpts0s_num &lt; <span class="number">0.2</span> / sample_dist) &#123; none_left_line++; &#125;</span><br><span class="line">        <span class="keyword">if</span> (rpts0s_num &gt; <span class="number">1.0</span> / sample_dist &amp;&amp; none_left_line &gt; <span class="number">3</span>) &#123;</span><br><span class="line">            circle_type = CIRCLE_NONE;</span><br><span class="line">            none_left_line = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å³ç¯æ§åˆ¶ï¼Œå‰æœŸå¯»å·¦ç›´é“</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (circle_type == CIRCLE_RIGHT_BEGIN) &#123;</span><br><span class="line">        track_type = TRACK_LEFT;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å…ˆä¸¢å³çº¿åæœ‰çº¿</span></span><br><span class="line">        <span class="keyword">if</span> (rpts1s_num &lt; <span class="number">0.2</span> / sample_dist) &#123; none_right_line++; &#125;</span><br><span class="line">        <span class="keyword">if</span> (rpts1s_num &gt; <span class="number">1.0</span> / sample_dist &amp;&amp; none_right_line &gt; <span class="number">2</span>) &#123;</span><br><span class="line">            have_right_line++;</span><br><span class="line">            <span class="keyword">if</span> (have_right_line &gt; <span class="number">1</span>) &#123;</span><br><span class="line">                circle_type = CIRCLE_RIGHT_IN;</span><br><span class="line">                none_right_line = <span class="number">0</span>;</span><br><span class="line">                have_right_line = <span class="number">0</span>;</span><br><span class="line">                circle_encoder = current_encoder;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å…¥å³ç¯ï¼Œå¯»å³å†…åœ†ç¯</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (circle_type == CIRCLE_RIGHT_IN) &#123;</span><br><span class="line">        track_type = TRACK_RIGHT;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//ç¼–ç å™¨æ‰“è¡¨è¿‡1/4åœ†   åº”ä¿®æ­£ä¸ºå·¦çº¿ä¸ºè½¬å¼¯æ— æ‹ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (rpts1s_num &lt; <span class="number">0.1</span> / sample_dist ||</span><br><span class="line">            current_encoder - circle_encoder &gt;= ENCODER_PER_METER * (<span class="number">3.14</span> * <span class="number">1</span> / <span class="number">2</span>)) &#123; circle_type = CIRCLE_RIGHT_RUNNING; &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//æ­£å¸¸å·¡çº¿ï¼Œå¯»å¤–åœ†å·¦çº¿</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (circle_type == CIRCLE_RIGHT_RUNNING) &#123;</span><br><span class="line">        track_type = TRACK_LEFT;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å¤–ç¯å­˜åœ¨æ‹ç‚¹,å¯å†åŠ æ‹ç‚¹è·ç¦»åˆ¤æ®(å·¦Lç‚¹)</span></span><br><span class="line">        <span class="keyword">if</span> (Lpt0_found) rpts0s_num = rptsc0_num = Lpt0_rpts0s_id;</span><br><span class="line">        <span class="keyword">if</span> (Lpt0_found &amp;&amp; Lpt0_rpts0s_id &lt; <span class="number">0.4</span> / sample_dist) &#123;</span><br><span class="line">            circle_type = CIRCLE_RIGHT_OUT;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å‡ºç¯ï¼Œå¯»å†…åœ†</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (circle_type == CIRCLE_RIGHT_OUT) &#123;</span><br><span class="line">        track_type = TRACK_RIGHT;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å·¦é•¿åº¦åŠ å€¾æ–œè§’åº¦  åº”ä¿®æ­£å·¦å³çº¿æ‰¾åˆ°ä¸”ä¸ºç›´çº¿</span></span><br><span class="line">        <span class="comment">//if((rpts1s_num &gt;100 &amp;&amp; !Lpt1_found))  &#123;have_right_line++;&#125;</span></span><br><span class="line">        <span class="keyword">if</span> (is_straight0) &#123;</span><br><span class="line">            circle_type = CIRCLE_RIGHT_END;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">        <span class="comment">//èµ°è¿‡åœ†ç¯ï¼Œå¯»å·¦çº¿</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (circle_type == CIRCLE_RIGHT_END) &#123;</span><br><span class="line">        track_type = TRACK_LEFT;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å·¦çº¿å…ˆä¸¢åæœ‰</span></span><br><span class="line">        <span class="keyword">if</span> (rpts1s_num &lt; <span class="number">0.2</span> / sample_dist) &#123; none_right_line++; &#125;</span><br><span class="line">        <span class="keyword">if</span> (rpts1s_num &gt; <span class="number">1.0</span> / sample_dist &amp;&amp; none_right_line &gt; <span class="number">2</span>) &#123;</span><br><span class="line">            circle_type = CIRCLE_NONE;</span><br><span class="line">            none_right_line = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>              </div>            </details><details ><summary pointer> è¯¦ç»†è§£è¯» </summary>              <div class='content'>              <details open><summary pointer> get_total_encoder() </summary>          <div class='content'>          <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int64_t</span> <span class="title function_">get_total_encoder</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (<span class="type">int64_t</span>) ((motor_l.total_encoder + motor_r.total_encoder) / <span class="number">2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç å®šä¹‰äº†ä¸€ä¸ªå‡½æ•° <code>get_total_encoder()</code>ï¼Œç”¨äºè®¡ç®—å·¦å³ä¸¤ä¸ªç”µæœºçš„ç¼–ç å™¨æ€»å’Œå¹¶å–å¹³å‡å€¼ã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>è·å–å·¦ç”µæœºå’Œå³ç”µæœºçš„ç¼–ç å™¨å€¼ <code>motor_l.total_encoder</code> å’Œ <code>motor_r.total_encoder</code>ã€‚</li><li>å°†å·¦å³ä¸¤ä¸ªç”µæœºçš„ç¼–ç å™¨å€¼ç›¸åŠ å¾—åˆ°æ€»å’Œã€‚</li><li>å°†æ€»å’Œé™¤ä»¥2å–å¹³å‡å€¼ï¼Œç„¶åä»¥ <code>int64_t</code> ç±»å‹è¿”å›ç»“æœã€‚</li></ol>          </div>        </details>              </div>            </details><p>track_typeï¼šå•è¾¹å¾—ä¸­çº¿çš„è¾¹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç¼–ç å™¨æ‰“è¡¨è¿‡1/4åœ†   åº”ä¿®æ­£ä¸ºå³çº¿ä¸ºè½¬å¼¯æ— æ‹ç‚¹</span></span><br><span class="line">      </span><br><span class="line">      <span class="keyword">if</span> (rpts0s_num &lt; <span class="number">0.1</span> / sample_dist ||</span><br><span class="line">          current_encoder - circle_encoder &gt;= ENCODER_PER_METER * (<span class="number">3.14</span> * <span class="number">1</span> / <span class="number">2</span>)) &#123; circle_type = CIRCLE_LEFT_RUNNING; &#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç çš„é€»è¾‘ä¼¼ä¹ä¸ä¹‹å‰çš„ä»£ç ç›¸å…³ï¼Œç”¨äºæ£€æµ‹ç¼–ç å™¨åœ¨æ‰“è¡¨è¿‡1&#x2F;4åœ†æ—¶çš„çŠ¶æ€ï¼Œå¹¶è¿›è¡Œç›¸åº”çš„ä¿®æ­£ã€‚è®©æˆ‘æ¥è§£é‡Šä¸€ä¸‹è¿™æ®µä»£ç çš„ä½œç”¨ï¼š</p><ol><li>é¦–å…ˆåˆ¤æ–­æ¡ä»¶ <code>rpts0s_num &lt; 0.1 / sample_dist</code>ï¼Œå¦‚æœæ¡ä»¶æˆç«‹ï¼Œè¯´æ˜å°è½¦è¿˜æœªè¡Œé©¶åˆ°1&#x2F;4åœ†çš„ä½ç½®ï¼Œæˆ–è€…å³çº¿æœªè¢«æ£€æµ‹åˆ°ã€‚</li><li>æˆ–è€…åˆ¤æ–­æ¡ä»¶ <code>current_encoder - circle_encoder &gt;= ENCODER_PER_METER * (3.14 * 1 / 2)</code>ï¼Œè¿™ä¸ªæ¡ä»¶çœ‹èµ·æ¥æ˜¯åœ¨åˆ¤æ–­å½“å‰ç¼–ç å™¨å€¼ä¸å¼€å§‹æ‰“è¡¨æ—¶çš„ç¼–ç å™¨å€¼ä¹‹å·®æ˜¯å¦è¶…è¿‡äº†1&#x2F;4åœ†çš„å‘¨é•¿å¯¹åº”çš„ç¼–ç å™¨å€¼ã€‚</li><li>å¦‚æœä»¥ä¸Šä¸¤ä¸ªæ¡ä»¶æœ‰ä¸€ä¸ªæˆç«‹ï¼Œå°±ä¼šå°† <code>circle_type</code> è®¾ç½®ä¸º <code>CIRCLE_LEFT_RUNNING</code>ï¼Œè¡¨ç¤ºå°è½¦æ­£åœ¨å·¦ç¯è¡Œé©¶çš„é˜¶æ®µã€‚</li></ol><p>åœ¨æ£€æµ‹åˆ°å°è½¦è¡Œé©¶è¿‡1&#x2F;4åœ†æˆ–è€…å³çº¿ä¸ºè½¬å¼¯æ—¶å°† <code>circle_type</code> ä¿®æ”¹ä¸º <code>CIRCLE_LEFT_RUNNING</code>ï¼Œå¯èƒ½æ˜¯ä¸ºäº†æ ¡å‡†å°è½¦åœ¨å·¦ç¯èµ›é“ä¸Šè¡Œé©¶æ—¶çš„ç‰¹å®šçŠ¶æ€ã€‚è¿™æ®µä»£ç ä¸ä¹‹å‰çš„ä»£ç ä¸€èµ·ï¼Œä¼¼ä¹åœ¨å®ç°ä¸€ä¸ªå¤æ‚çš„çŠ¶æ€æœºæ¥æ§åˆ¶å°è½¦åœ¨å·¦ç¯èµ›é“ä¸Šçš„è¿åŠ¨ã€‚å¦‚æœæ‚¨æœ‰æ›´å¤šçš„é—®é¢˜æˆ–éœ€è¦è¿›ä¸€æ­¥è§£é‡Šï¼Œè¯·éšæ—¶å‘Šè¯‰æˆ‘ã€‚</p><hr><p>ä»€ä¹ˆæ˜¯ç¼–ç å™¨æ‰“è¡¨:<br>ç¼–ç å™¨æ‰“è¡¨ï¼ˆEncoder Look-Up Tableï¼‰é€šå¸¸æŒ‡çš„æ˜¯åœ¨ç¼–ç å™¨æ¨¡å—ä¸­ä½¿ç”¨æŸ¥æ‰¾è¡¨ï¼ˆLook-Up Tableï¼‰æ¥è¿›è¡Œç¼–ç çš„è¿‡ç¨‹ã€‚åœ¨ä¿¡å·å¤„ç†é¢†åŸŸæˆ–è€…é€šä¿¡ç³»ç»Ÿä¸­ï¼Œç¼–ç å™¨çš„ä½œç”¨æ˜¯å°†è¾“å…¥ä¿¡å·è½¬æ¢ä¸ºç‰¹å®šçš„ç¼–ç å½¢å¼ï¼Œä»¥ä¾¿ä¼ è¾“ã€å­˜å‚¨æˆ–å¤„ç†ã€‚è€Œç¼–ç å™¨æ‰“è¡¨çš„æ¦‚å¿µæ˜¯é€šè¿‡é¢„å…ˆæ„å»ºä¸€ä¸ªè¡¨æ ¼ï¼Œå°†è¾“å…¥ä¿¡å·æ˜ å°„åˆ°ç‰¹å®šçš„ç¼–ç å€¼ï¼Œä»è€Œå®ç°ç¼–ç çš„è¿‡ç¨‹ã€‚</p><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç¼–ç å™¨æ‰“è¡¨çš„ä¼˜åŠ¿åœ¨äºå¯ä»¥æé«˜ç¼–ç çš„é€Ÿåº¦å’Œæ•ˆç‡ã€‚é€šè¿‡æŸ¥æ‰¾è¡¨ï¼Œç¼–ç å™¨å¯ä»¥ä»¥å¸¸é‡æ—¶é—´å¤æ‚åº¦å¿«é€ŸæŸ¥æ‰¾åˆ°å¯¹åº”çš„ç¼–ç å€¼ï¼Œè€Œä¸å¿…æ¯æ¬¡éƒ½è¿›è¡Œå¤æ‚çš„è®¡ç®—æˆ–é€»è¾‘åˆ¤æ–­ã€‚è¿™æ ·å¯ä»¥åŠ å¿«ç¼–ç è¿‡ç¨‹ï¼Œç‰¹åˆ«æ˜¯åœ¨éœ€è¦é¢‘ç¹ç¼–ç å¤§é‡æ•°æ®æ—¶ï¼Œå¯ä»¥èŠ‚çœæ—¶é—´å’Œè®¡ç®—èµ„æºã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œç¼–ç å™¨æ‰“è¡¨æ˜¯ä¸€ç§æé«˜ç¼–ç æ•ˆç‡çš„æ–¹æ³•ï¼Œé€šè¿‡é¢„å…ˆå»ºç«‹ç¼–ç æ˜ å°„è¡¨ï¼Œå¯ä»¥åœ¨ç¼–ç è¿‡ç¨‹ä¸­å¿«é€Ÿå‡†ç¡®åœ°æ‰¾åˆ°å¯¹åº”çš„ç¼–ç å€¼ï¼Œæé«˜ç³»ç»Ÿæ€§èƒ½å’Œé€Ÿåº¦ã€‚</p><hr><h2 id="è¿·å®«å·¡çº¿éƒ¨åˆ†"><a href="#è¿·å®«å·¡çº¿éƒ¨åˆ†" class="headerlink" title="è¿·å®«å·¡çº¿éƒ¨åˆ†"></a>è¿·å®«å·¡çº¿éƒ¨åˆ†</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* å‰è¿›æ–¹å‘å®šä¹‰ï¼š</span></span><br><span class="line"><span class="comment"> *   0</span></span><br><span class="line"><span class="comment"> * 3   1</span></span><br><span class="line"><span class="comment"> *   2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="built_in">AT_DTCM_SECTION_ALIGN_INIT</span>(<span class="type">const</span> <span class="type">int</span> dir_front[<span class="number">4</span>][<span class="number">2</span>], <span class="number">8</span>) = &#123;&#123;<span class="number">0</span>,  <span class="number">-1</span>&#125;,</span><br><span class="line">                                                            &#123;<span class="number">1</span>,  <span class="number">0</span>&#125;,</span><br><span class="line">                                                            &#123;<span class="number">0</span>,  <span class="number">1</span>&#125;,</span><br><span class="line">                                                            &#123;<span class="number">-1</span>, <span class="number">0</span>&#125;&#125;;</span><br><span class="line"><span class="built_in">AT_DTCM_SECTION_ALIGN_INIT</span>(<span class="type">const</span> <span class="type">int</span> dir_frontleft[<span class="number">4</span>][<span class="number">2</span>], <span class="number">8</span>) = &#123;&#123;<span class="number">-1</span>, <span class="number">-1</span>&#125;,</span><br><span class="line">                                                                &#123;<span class="number">1</span>,  <span class="number">-1</span>&#125;,</span><br><span class="line">                                                                &#123;<span class="number">1</span>,  <span class="number">1</span>&#125;,</span><br><span class="line">                                                                &#123;<span class="number">-1</span>, <span class="number">1</span>&#125;&#125;;</span><br><span class="line"><span class="built_in">AT_DTCM_SECTION_ALIGN_INIT</span>(<span class="type">const</span> <span class="type">int</span> dir_frontright[<span class="number">4</span>][<span class="number">2</span>], <span class="number">8</span>) = &#123;&#123;<span class="number">1</span>,  <span class="number">-1</span>&#125;,</span><br><span class="line">                                                                 &#123;<span class="number">1</span>,  <span class="number">1</span>&#125;,</span><br><span class="line">                                                                 &#123;<span class="number">-1</span>, <span class="number">1</span>&#125;,</span><br><span class="line">                                                                 &#123;<span class="number">-1</span>, <span class="number">-1</span>&#125;&#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å·¦æ‰‹è¿·å®«å·¡çº¿</span></span><br><span class="line"><span class="built_in">AT_ITCM_SECTION_INIT</span>(<span class="type">void</span> <span class="built_in">findline_lefthand_adaptive</span>(<span class="type">image_t</span> *img, <span class="type">int</span> block_size, <span class="type">int</span> clip_value, <span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> pts[][<span class="number">2</span>], <span class="type">int</span> *num)) &#123;</span><br><span class="line">    <span class="built_in">assert</span>(img &amp;&amp; img-&gt;data);</span><br><span class="line">    <span class="built_in">assert</span>(num &amp;&amp; *num &gt;= <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">assert</span>(block_size &gt; <span class="number">1</span> &amp;&amp; block_size % <span class="number">2</span> == <span class="number">1</span>);</span><br><span class="line">    <span class="type">int</span> half = block_size / <span class="number">2</span>;</span><br><span class="line">    <span class="type">int</span> step = <span class="number">0</span>, dir = <span class="number">0</span>, turn = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (step &lt; *num &amp;&amp; half &lt; x &amp;&amp; x &lt; img-&gt;width - half - <span class="number">1</span> &amp;&amp; half &lt; y &amp;&amp; y &lt; img-&gt;height - half - <span class="number">1</span> &amp;&amp; turn &lt; <span class="number">4</span>) &#123;</span><br><span class="line">        <span class="type">int</span> local_thres = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> dy = -half; dy &lt;= half; dy++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> dx = -half; dx &lt;= half; dx++) &#123;</span><br><span class="line">                local_thres += <span class="built_in">AT</span>(img, x + dx, y + dy);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        local_thres /= block_size * block_size;</span><br><span class="line">        local_thres -= clip_value;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> current_value = <span class="built_in">AT</span>(img, x, y);</span><br><span class="line">        <span class="type">int</span> front_value = <span class="built_in">AT</span>(img, x + dir_front[dir][<span class="number">0</span>], y + dir_front[dir][<span class="number">1</span>]);</span><br><span class="line">        <span class="type">int</span> frontleft_value = <span class="built_in">AT</span>(img, x + dir_frontleft[dir][<span class="number">0</span>], y + dir_frontleft[dir][<span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">if</span> (front_value &lt; local_thres) &#123;</span><br><span class="line">            dir = (dir + <span class="number">1</span>) % <span class="number">4</span>;</span><br><span class="line">            turn++;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (frontleft_value &lt; local_thres) &#123;</span><br><span class="line">            x += dir_front[dir][<span class="number">0</span>];</span><br><span class="line">            y += dir_front[dir][<span class="number">1</span>];</span><br><span class="line">            pts[step][<span class="number">0</span>] = x;</span><br><span class="line">            pts[step][<span class="number">1</span>] = y;</span><br><span class="line">            step++;</span><br><span class="line">            turn = <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            x += dir_frontleft[dir][<span class="number">0</span>];</span><br><span class="line">            y += dir_frontleft[dir][<span class="number">1</span>];</span><br><span class="line">            dir = (dir + <span class="number">3</span>) % <span class="number">4</span>;</span><br><span class="line">            pts[step][<span class="number">0</span>] = x;</span><br><span class="line">            pts[step][<span class="number">1</span>] = y;</span><br><span class="line">            step++;</span><br><span class="line">            turn = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    *num = step;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// å³æ‰‹è¿·å®«å·¡çº¿</span></span><br><span class="line"><span class="built_in">AT_ITCM_SECTION_INIT</span>(<span class="type">void</span> <span class="built_in">findline_righthand_adaptive</span>(<span class="type">image_t</span> *img, <span class="type">int</span> block_size, <span class="type">int</span> clip_value, <span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> pts[][<span class="number">2</span>], <span class="type">int</span> *num)) &#123;</span><br><span class="line">    <span class="built_in">assert</span>(img &amp;&amp; img-&gt;data);</span><br><span class="line">    <span class="built_in">assert</span>(num &amp;&amp; *num &gt;= <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">assert</span>(block_size &gt; <span class="number">1</span> &amp;&amp; block_size % <span class="number">2</span> == <span class="number">1</span>);</span><br><span class="line">    <span class="type">int</span> half = block_size / <span class="number">2</span>;</span><br><span class="line">    <span class="type">int</span> step = <span class="number">0</span>, dir = <span class="number">0</span>, turn = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (step &lt; *num &amp;&amp; <span class="number">0</span> &lt; x &amp;&amp; x &lt; img-&gt;width - <span class="number">1</span> &amp;&amp; <span class="number">0</span> &lt; y &amp;&amp; y &lt; img-&gt;height - <span class="number">1</span> &amp;&amp; turn &lt; <span class="number">4</span>) &#123;</span><br><span class="line">        <span class="type">int</span> local_thres = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> dy = -half; dy &lt;= half; dy++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> dx = -half; dx &lt;= half; dx++) &#123;</span><br><span class="line">                local_thres += <span class="built_in">AT</span>(img, x + dx, y + dy);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        local_thres /= block_size * block_size;</span><br><span class="line">        local_thres -= clip_value;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> current_value = <span class="built_in">AT</span>(img, x, y);</span><br><span class="line">        <span class="type">int</span> front_value = <span class="built_in">AT</span>(img, x + dir_front[dir][<span class="number">0</span>], y + dir_front[dir][<span class="number">1</span>]);</span><br><span class="line">        <span class="type">int</span> frontright_value = <span class="built_in">AT</span>(img, x + dir_frontright[dir][<span class="number">0</span>], y + dir_frontright[dir][<span class="number">1</span>]);</span><br><span class="line">        <span class="keyword">if</span> (front_value &lt; local_thres) &#123;</span><br><span class="line">            dir = (dir + <span class="number">3</span>) % <span class="number">4</span>;</span><br><span class="line">            turn++;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (frontright_value &lt; local_thres) &#123;</span><br><span class="line">            x += dir_front[dir][<span class="number">0</span>];</span><br><span class="line">            y += dir_front[dir][<span class="number">1</span>];</span><br><span class="line">            pts[step][<span class="number">0</span>] = x;</span><br><span class="line">            pts[step][<span class="number">1</span>] = y;</span><br><span class="line">            step++;</span><br><span class="line">            turn = <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            x += dir_frontright[dir][<span class="number">0</span>];</span><br><span class="line">            y += dir_frontright[dir][<span class="number">1</span>];</span><br><span class="line">            dir = (dir + <span class="number">1</span>) % <span class="number">4</span>;</span><br><span class="line">            pts[step][<span class="number">0</span>] = x;</span><br><span class="line">            pts[step][<span class="number">1</span>] = y;</span><br><span class="line">            step++;</span><br><span class="line">            turn = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    *num = step;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é€†é€è§†"><a href="#é€†é€è§†" class="headerlink" title="é€†é€è§†"></a>é€†é€è§†</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">warpPerspective</span><span class="params">(InputArray src, OutputArray dst, InputArray M, Size dsize,</span></span></span><br><span class="line"><span class="params"><span class="function">                      <span class="type">int</span> flags = INTER_LINEAR, <span class="type">int</span> borderMode = BORDER_CONSTANT,</span></span></span><br><span class="line"><span class="params"><span class="function">                      <span class="type">const</span> Scalar &amp;borderValue = Scalar())</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">CV_INSTRUMENT_REGION</span>()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">CV_Assert</span>(!src.<span class="built_in">empty</span>());</span><br><span class="line">    <span class="built_in">CV_Assert</span>(src.<span class="built_in">depth</span>() == CV_8U || src.<span class="built_in">depth</span>() == CV_32F);</span><br><span class="line">    <span class="built_in">CV_Assert</span>(M.<span class="built_in">rows</span>() == <span class="number">3</span> &amp;&amp; M.<span class="built_in">cols</span>() == <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function">Mat <span class="title">mapx</span><span class="params">(dsize, CV_32F)</span></span>;</span><br><span class="line">    <span class="function">Mat <span class="title">mapy</span><span class="params">(dsize, CV_32F)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">Mat <span class="title">transform</span><span class="params">(<span class="number">2</span>, <span class="number">3</span>, CV_64F)</span></span>;</span><br><span class="line">    M.<span class="built_in">getMat</span>().<span class="built_in">colRange</span>(<span class="number">0</span>, <span class="number">2</span>).<span class="built_in">convertTo</span>(transform, transform.<span class="built_in">type</span>());</span><br><span class="line"></span><br><span class="line">    <span class="built_in">buildWarpPerspectiveMaps</span>(transform, flags, dsize, mapx, mapy);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">remap</span>(src, dst, mapx, mapy, flags, borderMode, borderValue);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç æ˜¯OpenCVä¸­çš„warpPerspectiveå‡½æ•°çš„å®ç°ï¼Œç”¨äºå¯¹è¾“å…¥å›¾åƒè¿›è¡Œé€è§†å˜æ¢ã€‚ä¸‹é¢æ˜¯å¯¹ä»£ç ä¸­çš„å‡½æ•°åŠå‚æ•°çš„è¯¦ç»†è§£é‡Šï¼š</p><h3 id="warpPerspectiveå‡½æ•°å‚æ•°è§£é‡Šï¼š"><a href="#warpPerspectiveå‡½æ•°å‚æ•°è§£é‡Šï¼š" class="headerlink" title="warpPerspectiveå‡½æ•°å‚æ•°è§£é‡Šï¼š"></a>warpPerspectiveå‡½æ•°å‚æ•°è§£é‡Šï¼š</h3><ul><li><strong>src</strong>ï¼šè¾“å…¥å›¾åƒï¼Œç±»å‹ä¸ºInputArrayã€‚</li><li><strong>dst</strong>ï¼šè¾“å‡ºå›¾åƒï¼Œç±»å‹ä¸ºOutputArrayã€‚</li><li><strong>M</strong>ï¼š3x3çš„å˜æ¢çŸ©é˜µï¼Œæè¿°äº†é€è§†å˜æ¢ï¼Œç±»å‹ä¸ºInputArrayã€‚</li><li><strong>dsize</strong>ï¼šè¾“å‡ºå›¾åƒçš„å°ºå¯¸ï¼Œç±»å‹ä¸ºSizeã€‚</li><li><strong>flags</strong>ï¼šæ’å€¼æ–¹æ³•ï¼Œç”¨äºæŒ‡å®šåœ¨è¿›è¡Œåƒç´ å€¼æ’å€¼æ—¶è¦ä½¿ç”¨çš„æ–¹æ³•ï¼Œé»˜è®¤ä¸ºINTER_LINEARã€‚</li><li><strong>borderMode</strong>ï¼šè¾¹ç•Œåƒç´ æ’å€¼æ¨¡å¼ï¼Œç”¨äºæŒ‡å®šå½“ç›®æ ‡å›¾åƒåƒç´ ä½äºæºå›¾åƒä¹‹å¤–æ—¶çš„å¤„ç†æ–¹å¼ï¼Œé»˜è®¤ä¸ºBORDER_CONSTANTã€‚</li><li><strong>borderValue</strong>ï¼šè¾¹ç•Œå¡«å……çš„åƒç´ å€¼ï¼Œç±»å‹ä¸ºScalarã€‚</li></ul><h3 id="warpPerspectiveå‡½æ•°ä¸»è¦æ­¥éª¤è§£é‡Šï¼š"><a href="#warpPerspectiveå‡½æ•°ä¸»è¦æ­¥éª¤è§£é‡Šï¼š" class="headerlink" title="warpPerspectiveå‡½æ•°ä¸»è¦æ­¥éª¤è§£é‡Šï¼š"></a>warpPerspectiveå‡½æ•°ä¸»è¦æ­¥éª¤è§£é‡Šï¼š</h3><ol><li><p><strong>CV_INSTRUMENT_REGION</strong>ï¼šç”¨äºæ€§èƒ½æµ‹é‡å’Œä¼˜åŒ–çš„å®å®šä¹‰ã€‚</p></li><li><p><strong>CV_Assert</strong>ï¼šæ–­è¨€ï¼Œç”¨äºåˆ¤æ–­æ¡ä»¶æ˜¯å¦æˆç«‹ï¼Œå¦‚æœæ¡ä»¶ä¸æˆç«‹åˆ™ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚</p></li><li><p><strong>Mat mapx</strong>å’Œ<strong>Mat mapy</strong>ï¼šåˆ†åˆ«ç”¨äºå­˜å‚¨Xå’ŒYæ–¹å‘çš„æ˜ å°„ç»“æœã€‚</p></li><li><p><strong>Mat transform</strong>ï¼šæ˜¯ä¸€ä¸ª2x3çš„çŸ©é˜µï¼Œç”¨äºä¿å­˜MçŸ©é˜µçš„å‰ä¸¤åˆ—ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºCV_64Fç±»å‹ã€‚</p></li><li><p><strong>buildWarpPerspectiveMaps</strong>ï¼šæ ¹æ®é€è§†å˜æ¢çŸ©é˜µå’ŒæŒ‡å®šçš„æ’å€¼æ–¹æ³•ï¼Œæ„å»ºå‡ºç›®æ ‡å›¾åƒåœ¨æºå›¾åƒä¸Šçš„æ˜ å°„å…³ç³»ã€‚</p></li><li><p><strong>remap</strong>ï¼šæ ¹æ®ç”Ÿæˆçš„æ˜ å°„å…³ç³»å¯¹è¾“å…¥å›¾åƒè¿›è¡Œé€è§†å˜æ¢ï¼Œå¹¶å­˜å‚¨ç»“æœåˆ°è¾“å‡ºå›¾åƒdstä¸­ã€‚<br>  M.getMat().colRange(0, 2).convertTo(transform, transform.type());è¯¦ç»†è§£é‡Š<br>  è¿™è¡Œä»£ç æ˜¯é’ˆå¯¹OpenCVä¸­çš„çŸ©é˜µæ“ä½œã€‚è®©æˆ‘é€æ­¥è§£é‡Šä¸€ä¸‹ï¼š</p></li><li><p><code>M.getMat()</code>: è¿™éƒ¨åˆ†è·å–ä¸€ä¸ªOpenCVçš„çŸ©é˜µ<code>M</code>ã€‚</p></li><li><p><code>.colRange(0, 2)</code>: è¿™ä¸ªéƒ¨åˆ†è¡¨ç¤ºå¯¹è¯¥çŸ©é˜µ<code>M</code>çš„åˆ—è¿›è¡Œåˆ‡ç‰‡æ“ä½œï¼Œåªé€‰æ‹©ä»ç¬¬0åˆ—åˆ°ç¬¬2åˆ—ï¼ˆä¸åŒ…æ‹¬ç¬¬2åˆ—ï¼‰çš„éƒ¨åˆ†ã€‚</p></li><li><p><code>.convertTo(transform, transform.type())</code>: è¿™ä¸€éƒ¨åˆ†æ˜¯å°†åˆ‡ç‰‡åçš„åˆ—æ•°æ®è¿›è¡Œç±»å‹è½¬æ¢å¹¶èµ‹å€¼ç»™å¦å¤–ä¸€ä¸ªçŸ©é˜µ<code>transform</code>ã€‚è¿™é‡Œçš„<code>transform</code>æ˜¯ä¸€ä¸ªç›®æ ‡çŸ©é˜µï¼Œå®ƒå°†åŒ…å«è½¬æ¢åçš„æ•°æ®ã€‚<code>transform.type()</code>è¿”å›<code>transform</code>çŸ©é˜µçš„ç±»å‹ã€‚</p></li></ol><p>å› æ­¤ï¼Œæ•´ä½“æ¥çœ‹ï¼Œè¿™è¡Œä»£ç çš„ä½œç”¨æ˜¯ä»çŸ©é˜µ<code>M</code>ä¸­é€‰æ‹©ç¬¬0åˆ—åˆ°ç¬¬1åˆ—çš„æ•°æ®ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºæŒ‡å®šç±»å‹ï¼Œç„¶åå­˜å‚¨åˆ°çŸ©é˜µ<code>transform</code>ä¸­ã€‚</p><p>è¿™æ˜¯ <code>buildWarpPerspectiveMaps</code> å‡½æ•°çš„ä¼ªä»£ç å®ç°ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">buildWarpPerspectiveMaps</span><span class="params">(Size src_size, Matx33f M, <span class="type">bool</span> inverse_map, Mat&amp; xmap, Mat&amp; ymap)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> width = src_size.width;</span><br><span class="line">    <span class="type">int</span> height = src_size.height;</span><br><span class="line">    </span><br><span class="line">    xmap.<span class="built_in">create</span>(height, width, CV_32F);</span><br><span class="line">    ymap.<span class="built_in">create</span>(height, width, CV_32F);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> y = <span class="number">0</span>; y &lt; height; y++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> x = <span class="number">0</span>; x &lt; width; x++) &#123;</span><br><span class="line">            Vec3f src_pt = <span class="built_in">Vec3f</span>(x, y, <span class="number">1</span>); <span class="comment">// Source point</span></span><br><span class="line">            Vec3f dst_pt = M * src_pt;      <span class="comment">// Apply transformation matrix</span></span><br><span class="line"></span><br><span class="line">            <span class="type">float</span> map_x, map_y;</span><br><span class="line">            <span class="keyword">if</span> (!inverse_map) &#123;</span><br><span class="line">                map_x = dst_pt[<span class="number">0</span>] / dst_pt[<span class="number">2</span>];</span><br><span class="line">                map_y = dst_pt[<span class="number">1</span>] / dst_pt[<span class="number">2</span>];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                map_x = src_pt[<span class="number">0</span>] - dst_pt[<span class="number">0</span>];</span><br><span class="line">                map_y = src_pt[<span class="number">1</span>] - dst_pt[<span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            xmap.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(y, x) = map_x;</span><br><span class="line">            ymap.<span class="built_in">at</span>&lt;<span class="type">float</span>&gt;(y, x) = map_y;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä¼ªä»£ç å®ç°æè¿°äº† <code>buildWarpPerspectiveMaps</code> å‡½æ•°çš„å¤§è‡´æ“ä½œæ­¥éª¤ã€‚å®é™…çš„ <code>buildWarpPerspectiveMaps</code> å‡½æ•°æ˜¯ OpenCV ä¸­ç”¨äºæ„å»ºé€è§†å˜æ¢æ˜ å°„çš„å‡½æ•°ï¼Œå…·ä½“å®ç°ä¼šæ›´åŠ å¤æ‚å¹¶ä¸”åŒ…å«äº†æ›´å¤šç»†èŠ‚ã€‚å¦‚æœä½ éœ€è¦å®é™…çš„ä»£ç å®ç°ï¼Œå»ºè®®æŸ¥é˜… OpenCV çš„æºä»£ç æˆ–è€…å®˜æ–¹æ–‡æ¡£ä¸­æä¾›çš„å…·ä½“å‡½æ•°å®ç°ã€‚å¸Œæœ›è¿™ä¸ªç®€è¦æè¿°èƒ½å¤Ÿå¸®åŠ©åˆ°ä½ ï¼Œå¦‚æœæœ‰å…¶ä»–é—®é¢˜æˆ–è€…éœ€è¦æ›´å¤šå¸®åŠ©ï¼Œè¯·éšæ—¶å‘Šè¯‰æˆ‘ã€‚</p><h3 id="æ³¨æ„äº‹é¡¹ï¼š"><a href="#æ³¨æ„äº‹é¡¹ï¼š" class="headerlink" title="æ³¨æ„äº‹é¡¹ï¼š"></a>æ³¨æ„äº‹é¡¹ï¼š</h3><ul><li>è¾“å…¥å›¾åƒsrcä¸èƒ½ä¸ºç©ºã€‚</li><li>è¾“å…¥å›¾åƒsrcçš„æ·±åº¦å¿…é¡»ä¸ºCV_8Uæˆ–CV_32Fã€‚</li><li>å˜æ¢çŸ©é˜µMå¿…é¡»ä¸ºä¸€ä¸ª3x3çŸ©é˜µã€‚</li><li>warpPerspectiveå‡½æ•°å®ç°äº†é€è§†å˜æ¢çš„æ ¸å¿ƒé€»è¾‘ï¼Œé€šè¿‡æ„å»ºå˜æ¢çŸ©é˜µå¹¶åˆ©ç”¨remapå‡½æ•°å®ç°å¯¹å›¾åƒçš„é€è§†å˜æ¢æ“ä½œã€‚</li></ul><p>å¦‚æœä½ æœ‰ä»»ä½•å…³äºè¿™æ®µä»£ç çš„ç–‘é—®æˆ–éœ€è¦è¿›ä¸€æ­¥è§£é‡Šï¼Œè¯·éšæ—¶å‘Šè¯‰æˆ‘ã€‚</p><p>@brief Applies a perspective transformation to an image.</p><p>The function warpPerspective transforms the source image using the specified matrix:</p><p>  [$\texttt{dst} (x,y) &#x3D;  \texttt{src} \left ( \frac{M_{11} x + M_{12} y + M_{13}}{M_{31} x + M_{32} y + M_{33}} ,<br>     \frac{M_{21} x + M_{22} y + M_{23}}{M_{31} x + M_{32} y + M_{33}} \right )$] </p><p>when the flag #WARP_INVERSE_MAP is set. Otherwise, the transformation is first inverted with invert<br>and then put in the formula above instead of M. The function cannot operate in-place.</p><p>@param src input image.<br>@param dst output image that has the size dsize and the same type as src .<br>@param M  $ 3\times 3 $ transformation matrix.<br>@param dsize size of the output image.<br>@param flags combination of interpolation methods (#INTER_LINEAR or #INTER_NEAREST) and the<br>optional flag #WARP_INVERSE_MAP, that sets M as the inverse transformation (<br>$\texttt{dst}\rightarrow\texttt{src} $ ).<br>@param borderMode pixel extrapolation method (#BORDER_CONSTANT or #BORDER_REPLICATE).<br>@param borderValue value used in case of a constant border; by default, it equals 0.</p><p>@sa  warpAffine, resize, remap, getRectSubPix, perspectiveTransform</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;åœ†ç¯circle&quot;&gt;&lt;a href=&quot;#åœ†ç¯circle&quot; class=&quot;headerlink&quot; title=&quot;åœ†ç¯circle&quot;&gt;&lt;/a&gt;åœ†ç¯circle&lt;/h2&gt;&lt;details &gt;&lt;summary pointer&gt; circle.c &lt;/summary&gt;
 </summary>
      
    
    
    
    <category term="æ™ºèƒ½è½¦" scheme="http://tumytime.github.io/categories/%E6%99%BA%E8%83%BD%E8%BD%A6/"/>
    
    
    <category term="æ™ºèƒ½è½¦" scheme="http://tumytime.github.io/tags/%E6%99%BA%E8%83%BD%E8%BD%A6/"/>
    
  </entry>
  
  <entry>
    <title>é€†é€è§†</title>
    <link href="http://tumytime.github.io/2024/04/27/%E9%80%86%E9%80%8F%E8%A7%86/"/>
    <id>http://tumytime.github.io/2024/04/27/%E9%80%86%E9%80%8F%E8%A7%86/</id>
    <published>2024-04-26T17:14:17.000Z</published>
    <updated>2024-04-26T17:17:07.839Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * @brief IPMåˆå§‹åŒ–</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @param origSize è¾“å…¥åŸå§‹å›¾åƒSize</span></span><br><span class="line"><span class="comment">     * @param dstSize è¾“å‡ºå›¾åƒSize</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">init</span><span class="params">(<span class="type">const</span> cv::Size &amp;origSize, <span class="type">const</span> cv::Size &amp;dstSize)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// åŸå§‹åŸŸï¼šåˆ†è¾¨ç‡320x240</span></span><br><span class="line">        <span class="comment">// The 4-points at the input image</span></span><br><span class="line">        m_origPoints.<span class="built_in">clear</span>();</span><br><span class="line">        <span class="comment">// [ç¬¬äºŒç‰ˆæ— å¸¦ç•¸å˜é•œå¤´å‚æ•°]</span></span><br><span class="line">        m_origPoints.<span class="built_in">push_back</span>(<span class="built_in">Point2f</span>(<span class="number">0</span>, <span class="number">214</span>));   <span class="comment">// å·¦ä¸‹</span></span><br><span class="line">        m_origPoints.<span class="built_in">push_back</span>(<span class="built_in">Point2f</span>(<span class="number">319</span>, <span class="number">214</span>)); <span class="comment">// å³ä¸‹</span></span><br><span class="line">        m_origPoints.<span class="built_in">push_back</span>(<span class="built_in">Point2f</span>(<span class="number">192</span>, <span class="number">0</span>));   <span class="comment">// å³ä¸Š</span></span><br><span class="line">        m_origPoints.<span class="built_in">push_back</span>(<span class="built_in">Point2f</span>(<span class="number">128</span>, <span class="number">0</span>));   <span class="comment">// å·¦ä¸Š</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// çŸ«æ­£åŸŸï¼šåˆ†è¾¨ç‡320x240</span></span><br><span class="line">        <span class="comment">// The 4-points correspondences in the destination image</span></span><br><span class="line">        m_dstPoints.<span class="built_in">clear</span>();</span><br><span class="line">        m_dstPoints.<span class="built_in">push_back</span>(<span class="built_in">Point2f</span>(<span class="number">100</span>, <span class="number">400</span>)); <span class="comment">// å·¦ä¸‹</span></span><br><span class="line">        m_dstPoints.<span class="built_in">push_back</span>(<span class="built_in">Point2f</span>(<span class="number">220</span>, <span class="number">400</span>)); <span class="comment">// å³ä¸‹</span></span><br><span class="line">        m_dstPoints.<span class="built_in">push_back</span>(<span class="built_in">Point2f</span>(<span class="number">220</span>, <span class="number">0</span>));   <span class="comment">// å³ä¸Š</span></span><br><span class="line">        m_dstPoints.<span class="built_in">push_back</span>(<span class="built_in">Point2f</span>(<span class="number">100</span>, <span class="number">0</span>));   <span class="comment">// å·¦ä¸Š</span></span><br><span class="line"></span><br><span class="line">        m_origSize = origSize;</span><br><span class="line">        m_dstSize = dstSize;</span><br><span class="line">        <span class="built_in">assert</span>(m_origPoints.<span class="built_in">size</span>() == <span class="number">4</span> &amp;&amp; m_dstPoints.<span class="built_in">size</span>() == <span class="number">4</span> &amp;&amp; <span class="string">&quot;Orig. points and Dst. points must vectors of 4 points&quot;</span>);</span><br><span class="line">        m_H = <span class="built_in">getPerspectiveTransform</span>(m_origPoints, m_dstPoints); <span class="comment">// è®¡ç®—å˜æ¢çŸ©é˜µ [3x3]</span></span><br><span class="line">        m_H_inv = m_H.<span class="built_in">inv</span>();                                      <span class="comment">// æ±‚è§£é€†è½¬æ¢çŸ©é˜µ</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">createMaps</span>();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ol><li><p><code>void init(const cv::Size &amp;origSize, const cv::Size &amp;dstSize)</code>: è¿™æ˜¯ä¸€ä¸ªåä¸º<code>init</code>çš„å‡½æ•°ï¼Œå®ƒæ¥å—ä¸¤ä¸ªå‚æ•°<code>origSize</code>å’Œ<code>dstSize</code>ï¼Œè¿™ä¸¤ä¸ªå‚æ•°æ˜¯OpenCVåº“ä¸­çš„<code>cv::Size</code>ç±»å‹ï¼Œç”¨æ¥è¡¨ç¤ºå›¾åƒçš„å°ºå¯¸ã€‚</p></li><li><p><code>m_origPoints.clear();</code>: æ¸…ç©ºå­˜å‚¨åŸå§‹åŸŸç‚¹åæ ‡çš„å®¹å™¨<code>m_origPoints</code>ã€‚</p></li><li><p><code>m_origPoints.push_back(Point2f(0, 214));</code>: å°†<code>(0, 214)</code>ç‚¹åæ ‡æ·»åŠ åˆ°åŸå§‹åŸŸçš„ç‚¹åæ ‡é›†åˆä¸­ï¼Œä»£è¡¨åŸå§‹å›¾åƒçš„å·¦ä¸‹è§’ã€‚</p></li><li><p>ä¾æ¬¡ç±»æ¨ï¼Œå°†åŸå§‹åŸŸçš„å››ä¸ªè§’çš„ç‚¹åæ ‡æ·»åŠ åˆ°<code>m_origPoints</code>ä¸­ï¼Œä¾æ¬¡æ˜¯å·¦ä¸‹ã€å³ä¸‹ã€å³ä¸Šå’Œå·¦ä¸Šã€‚</p></li><li><p><code>m_dstPoints.clear();</code>: æ¸…ç©ºå­˜å‚¨çŸ«æ­£åŸŸç‚¹åæ ‡çš„å®¹å™¨<code>m_dstPoints</code>ã€‚</p></li><li><p><code>m_dstPoints.push_back(Point2f(100, 400));</code>: å°†<code>(100, 400)</code>ç‚¹åæ ‡æ·»åŠ åˆ°çŸ«æ­£åŸŸçš„ç‚¹åæ ‡é›†åˆä¸­ï¼Œä»£è¡¨çŸ«æ­£å›¾åƒçš„å·¦ä¸‹è§’ã€‚</p></li><li><p>ä¾æ¬¡ç±»æ¨ï¼Œå°†çŸ«æ­£åŸŸçš„å››ä¸ªè§’çš„ç‚¹åæ ‡æ·»åŠ åˆ°<code>m_dstPoints</code>ä¸­ï¼Œä¾æ¬¡æ˜¯å·¦ä¸‹ã€å³ä¸‹ã€å³ä¸Šå’Œå·¦ä¸Šã€‚</p></li><li><p><code>m_origSize = origSize;</code>å’Œ<code>m_dstSize = dstSize;</code>: å°†åŸå§‹å›¾åƒå°ºå¯¸å’Œç›®æ ‡å›¾åƒå°ºå¯¸ä¿å­˜ä¸‹æ¥ã€‚</p></li><li><p><code>assert(m_origPoints.size() == 4 &amp;&amp; m_dstPoints.size() == 4 &amp;&amp; &quot;Orig. points and Dst. points must vectors of 4 points&quot;);</code>: ä½¿ç”¨<code>assert</code>æ–­è¨€æ¥ç¡®ä¿åŸå§‹åŸŸå’ŒçŸ«æ­£åŸŸçš„ç‚¹åæ ‡é›†åˆéƒ½åŒ…å«å››ä¸ªç‚¹ã€‚</p></li><li><p><code>m_H = getPerspectiveTransform(m_origPoints, m_dstPoints);</code>: é€šè¿‡åŸå§‹åŸŸå’ŒçŸ«æ­£åŸŸçš„ç‚¹åæ ‡è®¡ç®—é€è§†å˜æ¢çŸ©é˜µ<code>m_H</code>ã€‚</p></li><li><p><code>m_H_inv = m_H.inv();</code>: æ±‚è§£é€è§†å˜æ¢çŸ©é˜µ<code>m_H</code>çš„é€†çŸ©é˜µï¼Œå­˜å‚¨åœ¨<code>m_H_inv</code>ä¸­ã€‚</p></li><li><p><code>createMaps();</code>: è°ƒç”¨<code>createMaps</code>å‡½æ•°ï¼Œåˆ›å»ºåœ°å›¾ã€‚</p></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;figure class=&quot;highlight c++&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;</summary>
      
    
    
    
    <category term="æ™ºèƒ½è½¦" scheme="http://tumytime.github.io/categories/%E6%99%BA%E8%83%BD%E8%BD%A6/"/>
    
    
    <category term="æ™ºèƒ½è½¦" scheme="http://tumytime.github.io/tags/%E6%99%BA%E8%83%BD%E8%BD%A6/"/>
    
    <category term="å›¾åƒå¤„ç†" scheme="http://tumytime.github.io/tags/%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>æ•°æ®é›†æ ‡æ³¨jsonè½¬xmlè„šæœ¬</title>
    <link href="http://tumytime.github.io/2024/04/26/%E6%95%B0%E6%8D%AE%E9%9B%86%E6%A0%87%E6%B3%A8json%E8%BD%ACxml%E8%84%9A%E6%9C%AC/"/>
    <id>http://tumytime.github.io/2024/04/26/%E6%95%B0%E6%8D%AE%E9%9B%86%E6%A0%87%E6%B3%A8json%E8%BD%ACxml%E8%84%9A%E6%9C%AC/</id>
    <published>2024-04-26T12:43:07.000Z</published>
    <updated>2024-04-26T12:47:40.715Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> xml.etree.ElementTree <span class="keyword">as</span> ET</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">convert_json_to_xml</span>(<span class="params">json_data</span>):</span><br><span class="line">    root = ET.Element(<span class="string">&quot;annotation&quot;</span>)</span><br><span class="line">    filename = ET.SubElement(root, <span class="string">&quot;filename&quot;</span>)</span><br><span class="line">    filename.text = json_data[<span class="string">&quot;imagePath&quot;</span>]</span><br><span class="line">    object_num = ET.SubElement(root, <span class="string">&quot;object_num&quot;</span>)</span><br><span class="line">    object_num.text = <span class="built_in">str</span>(<span class="built_in">len</span>(json_data[<span class="string">&quot;shapes&quot;</span>]))</span><br><span class="line">    size = ET.SubElement(root, <span class="string">&quot;size&quot;</span>)</span><br><span class="line">    width = ET.SubElement(size, <span class="string">&quot;width&quot;</span>)</span><br><span class="line">    width.text = <span class="built_in">str</span>(json_data[<span class="string">&quot;imageWidth&quot;</span>])</span><br><span class="line">    height = ET.SubElement(size, <span class="string">&quot;height&quot;</span>)</span><br><span class="line">    height.text = <span class="built_in">str</span>(json_data[<span class="string">&quot;imageHeight&quot;</span>])</span><br><span class="line">    <span class="keyword">for</span> shape <span class="keyword">in</span> json_data[<span class="string">&quot;shapes&quot;</span>]:</span><br><span class="line">        object_element = ET.SubElement(root, <span class="string">&quot;object&quot;</span>)</span><br><span class="line">        name = ET.SubElement(object_element, <span class="string">&quot;name&quot;</span>)</span><br><span class="line">        name.text = shape[<span class="string">&quot;label&quot;</span>]</span><br><span class="line">        difficult = ET.SubElement(object_element, <span class="string">&quot;difficult&quot;</span>)</span><br><span class="line">        difficult.text = <span class="string">&quot;0&quot;</span></span><br><span class="line">        bndbox = ET.SubElement(object_element, <span class="string">&quot;bndbox&quot;</span>)</span><br><span class="line">        xmin = ET.SubElement(bndbox, <span class="string">&quot;xmin&quot;</span>)</span><br><span class="line">        xmin.text = <span class="built_in">str</span>(<span class="built_in">int</span>(shape[<span class="string">&quot;points&quot;</span>][<span class="number">0</span>][<span class="number">0</span>]))</span><br><span class="line">        ymin = ET.SubElement(bndbox, <span class="string">&quot;ymin&quot;</span>)</span><br><span class="line">        ymin.text = <span class="built_in">str</span>(<span class="built_in">int</span>(shape[<span class="string">&quot;points&quot;</span>][<span class="number">0</span>][<span class="number">1</span>]))</span><br><span class="line">        xmax = ET.SubElement(bndbox, <span class="string">&quot;xmax&quot;</span>)</span><br><span class="line">        xmax.text = <span class="built_in">str</span>(<span class="built_in">int</span>(shape[<span class="string">&quot;points&quot;</span>][<span class="number">1</span>][<span class="number">0</span>]))</span><br><span class="line">        ymax = ET.SubElement(bndbox, <span class="string">&quot;ymax&quot;</span>)</span><br><span class="line">        ymax.text = <span class="built_in">str</span>(<span class="built_in">int</span>(shape[<span class="string">&quot;points&quot;</span>][<span class="number">1</span>][<span class="number">1</span>]))</span><br><span class="line">    <span class="keyword">return</span> ET.tostring(root, encoding=<span class="string">&quot;unicode&quot;</span>)</span><br><span class="line">current_dir = os.getcwd()</span><br><span class="line">parent_dir = os.path.abspath(os.path.join(current_dir, os.pardir))</span><br><span class="line">output_dir = os.path.join(parent_dir, <span class="string">&quot;xml_output&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(output_dir):</span><br><span class="line">    os.makedirs(output_dir)</span><br><span class="line"><span class="keyword">for</span> file <span class="keyword">in</span> os.listdir(current_dir):</span><br><span class="line">    <span class="keyword">if</span> file.endswith(<span class="string">&quot;.json&quot;</span>):</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(os.path.join(current_dir, file), <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> json_file:</span><br><span class="line">            json_data = json.load(json_file)</span><br><span class="line">            xml_data = convert_json_to_xml(json_data)</span><br><span class="line">            xml_filename = file.replace(<span class="string">&quot;.json&quot;</span>, <span class="string">&quot;.xml&quot;</span>)</span><br><span class="line">            output_path = os.path.join(output_dir, xml_filename)</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(output_path, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> xml_file:</span><br><span class="line">                xml_file.write(xml_data)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;æ‰€æœ‰JSONæ–‡ä»¶å·²ç»è½¬æ¢ä¸ºXMLå¹¶ä¿å­˜åœ¨æ–‡ä»¶å¤¹ xml_output ä¸­&quot;</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span clas</summary>
      
    
    
    
    <category term="æ™ºèƒ½è½¦" scheme="http://tumytime.github.io/categories/%E6%99%BA%E8%83%BD%E8%BD%A6/"/>
    
    
    <category term="AI" scheme="http://tumytime.github.io/tags/AI/"/>
    
    <category term="python" scheme="http://tumytime.github.io/tags/python/"/>
    
    <category term="æ•°æ®é›†" scheme="http://tumytime.github.io/tags/%E6%95%B0%E6%8D%AE%E9%9B%86/"/>
    
  </entry>
  
  <entry>
    <title>æ— äººé©¾é©¶æ±½è½¦ç³»ç»Ÿå…¥é—¨ï¼ˆä¸€ï¼‰å¡å°”æ›¼æ»¤æ³¢ä¸ç›®æ ‡è¿½è¸ª</title>
    <link href="http://tumytime.github.io/2024/04/25/%E6%97%A0%E4%BA%BA%E9%A9%BE%E9%A9%B6%E6%B1%BD%E8%BD%A6%E7%B3%BB%E7%BB%9F%E5%85%A5%E9%97%A8%EF%BC%88%E4%B8%80%EF%BC%89%E5%8D%A1%E5%B0%94%E6%9B%BC%E6%BB%A4%E6%B3%A2%E4%B8%8E%E7%9B%AE%E6%A0%87%E8%BF%BD%E8%B8%AA/"/>
    <id>http://tumytime.github.io/2024/04/25/%E6%97%A0%E4%BA%BA%E9%A9%BE%E9%A9%B6%E6%B1%BD%E8%BD%A6%E7%B3%BB%E7%BB%9F%E5%85%A5%E9%97%A8%EF%BC%88%E4%B8%80%EF%BC%89%E5%8D%A1%E5%B0%94%E6%9B%BC%E6%BB%A4%E6%B3%A2%E4%B8%8E%E7%9B%AE%E6%A0%87%E8%BF%BD%E8%B8%AA/</id>
    <published>2024-04-25T10:40:25.000Z</published>
    <updated>2024-04-26T07:50:11.547Z</updated>
    
    <content type="html"><![CDATA[<div class="tagLink"><a class="link-card" title="å¡å°”æ›¼æ»¤æ³¢æ•™ç¨‹" href="https://www.kalmanfilter.net/CN/background_cn.html"><span class="link-card-backdrop" style="background-image: url(https://www.kalmanfilter.net/img/profile.png)"></span><div class="left"><img src="https://www.kalmanfilter.net/img/profile.png" class="lazyload placeholder" data-srcset="https://www.kalmanfilter.net/img/profile.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div><div class="right"><p class="text">å¡å°”æ›¼æ»¤æ³¢æ•™ç¨‹</p><p class="url">https://www.kalmanfilter.net/CN/background_cn.html</p></div></a></div><div class="tagLink"><a class="link-card" title="ä¸€ä¸ªä¾‹å­ææ¸…æ¥šï¼ˆå…ˆéªŒåˆ†å¸ƒ/åéªŒåˆ†å¸ƒ/ä¼¼ç„¶ä¼°è®¡ï¼‰" href="https://blog.csdn.net/qq_23947237/article/details/78265026"><span class="link-card-backdrop" style="background-image: url(https://img-blog.csdn.net/20171021161006627?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjM5NDcyMzc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)"></span><div class="left"><img src="https://img-blog.csdn.net/20171021161006627?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjM5NDcyMzc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" class="lazyload placeholder" data-srcset="https://img-blog.csdn.net/20171021161006627?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjM5NDcyMzc=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div><div class="right"><p class="text">ä¸€ä¸ªä¾‹å­ææ¸…æ¥šï¼ˆå…ˆéªŒåˆ†å¸ƒ/åéªŒåˆ†å¸ƒ/ä¼¼ç„¶ä¼°è®¡ï¼‰</p><p class="url">https://blog.csdn.net/qq_23947237/article/details/78265026</p></div></a></div><p>åœ¨è´å¶æ–¯æ¨æ–­ä¸­ï¼ŒåéªŒåˆ†å¸ƒä¸å…ˆéªŒåˆ†å¸ƒå’Œä¼¼ç„¶ä¹‹é—´å­˜åœ¨ä¸€ç§é‡è¦çš„å…³ç³»ï¼Œå³åéªŒåˆ†å¸ƒæ­£æ¯”äºå…ˆéªŒåˆ†å¸ƒä¹˜ä»¥ä¼¼ç„¶ã€‚è¿™ç§å…³ç³»å¯ä»¥é€šè¿‡è´å¶æ–¯å®šç†æ¥è¿›è¡Œæ¨å¯¼å’Œè§£é‡Šã€‚</p><h3 id="è´å¶æ–¯å®šç†ï¼š"><a href="#è´å¶æ–¯å®šç†ï¼š" class="headerlink" title="è´å¶æ–¯å®šç†ï¼š"></a>è´å¶æ–¯å®šç†ï¼š</h3><p>è´å¶æ–¯å®šç†æè¿°äº†åœ¨è§‚æµ‹åˆ°æ•°æ® $( D ) $åï¼Œå‚æ•° $( \theta )$ çš„åéªŒæ¦‚ç‡å¦‚ä½•æ ¹æ®å…ˆéªŒæ¦‚ç‡ $( P(\theta) )$ å’Œä¼¼ç„¶æ€§å‡½æ•° $( P(D|\theta) )$ æ¥æ›´æ–°ã€‚è¡¨è¾¾å¼å¦‚ä¸‹ï¼š<br>$[ P(\theta|D) &#x3D; \frac{P(D|\theta) \times P(\theta)}{P(D)} ]$</p><p>å…¶ä¸­ï¼š</p><ul><li>$( P(\theta|D) )$ æ˜¯åœ¨ç»™å®šè§‚æµ‹æ•°æ® $( D )$ åå‚æ•°$ ( \theta )$ çš„åéªŒæ¦‚ç‡ï¼›</li><li>$( P(D|\theta) )$ æ˜¯åœ¨ç»™å®šå‚æ•° $( \theta ) $çš„æ¡ä»¶ä¸‹è§‚æµ‹æ•°æ® $( D )$ çš„ä¼¼ç„¶æ€§ï¼›</li><li>$( P(\theta) )$ æ˜¯å‚æ•° $( \theta )$ çš„å…ˆéªŒæ¦‚ç‡ï¼›</li><li>$( P(D) )$ æ˜¯æ•°æ® $( D )$ çš„è¾¹é™…æ¦‚ç‡ã€‚</li></ul><h3 id="åéªŒåˆ†å¸ƒæ­£æ¯”äºå…ˆéªŒåˆ†å¸ƒä¹˜ä»¥ä¼¼ç„¶ï¼š"><a href="#åéªŒåˆ†å¸ƒæ­£æ¯”äºå…ˆéªŒåˆ†å¸ƒä¹˜ä»¥ä¼¼ç„¶ï¼š" class="headerlink" title="åéªŒåˆ†å¸ƒæ­£æ¯”äºå…ˆéªŒåˆ†å¸ƒä¹˜ä»¥ä¼¼ç„¶ï¼š"></a>åéªŒåˆ†å¸ƒæ­£æ¯”äºå…ˆéªŒåˆ†å¸ƒä¹˜ä»¥ä¼¼ç„¶ï¼š</h3><p>ä»è´å¶æ–¯å®šç†ä¸­å¯ä»¥å¾—å‡ºåéªŒåˆ†å¸ƒæ­£æ¯”äºå…ˆéªŒåˆ†å¸ƒä¹˜ä»¥ä¼¼ç„¶çš„ç»“è®ºï¼Œè¡¨è¾¾å¼å¦‚ä¸‹ï¼š<br>$[ P(\theta|D) \propto P(D|\theta) \times P(\theta) ]$</p><p>è¿™æ„å‘³ç€åéªŒåˆ†å¸ƒä¸å…ˆéªŒåˆ†å¸ƒä¹˜ä»¥ä¼¼ç„¶æ€§å‡½æ•°ä¹‹é—´å­˜åœ¨æ¯”ä¾‹å…³ç³»ã€‚å…·ä½“è§£é‡Šå¦‚ä¸‹ï¼š</p><ul><li>å…ˆéªŒåˆ†å¸ƒ $( P(\theta) )$ æè¿°äº†åœ¨è§‚æµ‹æ•°æ®ä¹‹å‰å¯¹å‚æ•° $( \theta )$ çš„ä¸ç¡®å®šæ€§çš„åˆå§‹ä¼°è®¡ï¼›</li><li>ä¼¼ç„¶æ€§å‡½æ•° $( P(D|\theta) ) $æè¿°äº†åœ¨ç»™å®šå‚æ•° $( \theta )$ çš„æƒ…å†µä¸‹è§‚æµ‹åˆ°æ•°æ® $( D )$ çš„æ¦‚ç‡ï¼›</li><li>åéªŒåˆ†å¸ƒ $( P(\theta|D) )$ ç»“åˆäº†å…ˆéªŒä¿¡æ¯å’Œæ–°æ•°æ®çš„ä¿¡æ¯ï¼Œæä¾›äº†åœ¨ç»™å®šæ•°æ® $( D )$ åå¯¹å‚æ•° $( \theta )$ çš„æ›´å‡†ç¡®ä¼°è®¡ã€‚</li></ul><p>é€šè¿‡è¿™ç§å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å…ˆéªŒçŸ¥è¯†å’Œè§‚æµ‹åˆ°çš„æ•°æ®æ¥æ›´æ–°å¯¹å‚æ•°çš„ä¼°è®¡ï¼Œä»è€Œæ›´å¥½åœ°ç†è§£æ•°æ®å’Œè¿›è¡Œæ¨æ–­ã€‚è¿™ç§è´å¶æ–¯æ–¹æ³•åœ¨å¤„ç†ä¸ç¡®å®šæ€§å’Œå°æ ·æœ¬æ•°æ®æ—¶éå¸¸æœ‰ç”¨ã€‚</p><iframe src="//player.bilibili.com/player.html?aid=399758288&bvid=BV1zo4y1J76H&cid=1164008541&p=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe><p>å¡å°”æ›¼æ»¤æ³¢ï¼ˆKalman Filterï¼‰æ˜¯ä¸€ç§ç”¨äºä¼°è®¡ç³»ç»ŸçŠ¶æ€çš„æ•°å­¦ç®—æ³•ï¼Œé€šè¿‡èåˆç³»ç»Ÿæ¨¡å‹çš„é¢„æµ‹ä¿¡æ¯å’Œå®é™…è§‚æµ‹çš„æµ‹é‡ä¿¡æ¯ï¼Œä»¥ä¼˜åŒ–å¯¹ç³»ç»Ÿå½“å‰çŠ¶æ€çš„ä¼°è®¡ã€‚å¡å°”æ›¼æ»¤æ³¢ç®—æ³•çš„æ ¸å¿ƒæ€æƒ³å°±æ˜¯é€šè¿‡å¯¹ç³»ç»ŸçŠ¶æ€çš„åŠ¨æ€å»ºæ¨¡å’Œä¸ç¡®å®šæ€§çš„ä¼°è®¡ï¼Œæ¥è·å¾—ç³»ç»ŸçŠ¶æ€çš„æœ€ä¼˜ä¼°è®¡ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œå¡å°”æ›¼æ»¤æ³¢é€šè¿‡ä»¥ä¸‹æ­¥éª¤å®ç°å¯¹å½“å‰çŠ¶æ€çš„ä¼°è®¡ï¼š</p><ol><li><p><strong>é¢„æµ‹çŠ¶æ€</strong>ï¼šé¦–å…ˆæ ¹æ®ç³»ç»Ÿçš„åŠ¨æ€æ¨¡å‹ï¼Œåˆ©ç”¨ç³»ç»Ÿçš„ä¸Šä¸€ä¸ªçŠ¶æ€å€¼å’Œç³»ç»Ÿçš„çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼Œé¢„æµ‹ç³»ç»Ÿçš„å½“å‰çŠ¶æ€å€¼ã€‚è¿™ä¸€æ­¥æ˜¯åŸºäºç³»ç»Ÿçš„å†…åœ¨è§„å¾‹è¿›è¡Œçš„çŠ¶æ€é¢„æµ‹ï¼Œä¸è€ƒè™‘è§‚æµ‹å€¼ã€‚</p></li><li><p><strong>æ›´æ–°çŠ¶æ€</strong>ï¼šæ¥ç€ï¼Œå¡å°”æ›¼æ»¤æ³¢è€ƒè™‘åˆ°å½“å‰çš„æµ‹é‡å€¼ï¼Œå³è§‚æµ‹åˆ°çš„ç³»ç»ŸçŠ¶æ€å€¼ã€‚é€šè¿‡æ¯”è¾ƒå®é™…è§‚æµ‹å€¼å’Œé¢„æµ‹çŠ¶æ€å€¼ä¹‹é—´çš„å·®å¼‚ï¼Œç»“åˆç³»ç»Ÿçš„æµ‹é‡æ–¹ç¨‹å’Œåæ–¹å·®çŸ©é˜µï¼Œæ›´æ–°å¯¹ç³»ç»Ÿå½“å‰çŠ¶æ€çš„ä¼°è®¡ã€‚è¿™ä¸€æ­¥å¯ä»¥ç†è§£ä¸ºæ ¹æ®æµ‹é‡ç»“æœå¯¹ç³»ç»ŸçŠ¶æ€è¿›è¡Œä¿®æ­£å’Œä¼˜åŒ–ï¼ŒåŒæ—¶è€ƒè™‘åˆ°æµ‹é‡è¯¯å·®å’Œç³»ç»ŸåŠ¨æ€çš„ä¸ç¡®å®šæ€§ã€‚</p></li><li><p><strong>çŠ¶æ€æ›´æ–°</strong>ï¼šç»è¿‡é¢„æµ‹å’Œæ›´æ–°ä¹‹åï¼Œå¡å°”æ›¼æ»¤æ³¢ä¼šæ ¹æ®é¢„æµ‹å’Œæ›´æ–°çš„ç»“æœæ¥æ›´æ–°ç³»ç»Ÿçš„çŠ¶æ€ä¼°è®¡å’ŒçŠ¶æ€çš„ä¸ç¡®å®šæ€§ï¼Œç„¶åå¾ªç¯è¿­ä»£è¿™äº›æ­¥éª¤ä»¥è·å¾—å¯¹ç³»ç»ŸçŠ¶æ€çš„è¿ç»­ä¼°è®¡ã€‚</p></li></ol><p>æ€»çš„æ¥è¯´ï¼Œå¡å°”æ›¼æ»¤æ³¢ç®—æ³•å……åˆ†åˆ©ç”¨äº†ç³»ç»ŸåŠ¨æ€æ¨¡å‹å’Œä¼ æ„Ÿå™¨æµ‹é‡ä¿¡æ¯ï¼Œé€šè¿‡é¢„æµ‹å’Œæ›´æ–°çš„æ­¥éª¤æ¥è·å¾—å¯¹ç³»ç»ŸçŠ¶æ€çš„æœ€ä¼˜ä¼°è®¡ã€‚é€šè¿‡åŒæ—¶è€ƒè™‘ä¸Šä¸€ä¸ªçŠ¶æ€å€¼å’Œå½“å‰çš„æµ‹é‡å€¼ï¼Œå¡å°”æ›¼æ»¤æ³¢èƒ½å¤Ÿæœ‰æ•ˆåœ°å¤„ç†ç³»ç»ŸåŠ¨æ€ã€æµ‹é‡è¯¯å·®å’Œä¸ç¡®å®šæ€§ï¼Œä»è€Œæé«˜å¯¹ç³»ç»ŸçŠ¶æ€çš„ä¼°è®¡ç²¾åº¦ã€‚</p><h2 id="è´å¡å°”æ ¡æ­£"><a href="#è´å¡å°”æ ¡æ­£" class="headerlink" title="è´å¡å°”æ ¡æ­£"></a>è´å¡å°”æ ¡æ­£</h2><p>åœ¨é«˜æ–¯åˆ†å¸ƒï¼ˆæ­£æ€åˆ†å¸ƒï¼‰ä¸­ï¼Œå¦‚æœæˆ‘ä»¬ä»æ€»ä½“åˆ†å¸ƒä¸­æŠ½å–ä¸€å°éƒ¨åˆ†æ ·æœ¬æ¥ä¼°è®¡æ€»ä½“çš„æ–¹å·®ï¼Œé€šå¸¸æƒ…å†µä¸‹æ ·æœ¬æ–¹å·®ä¼šä½ä¼°æ€»ä½“æ–¹å·®ã€‚è¿™ç§ç°è±¡çš„åŸå› ä¸»è¦æ˜¯ç”±äºæ ·æœ¬æŠ½å–çš„å±€é™æ€§å’Œé«˜æ–¯åˆ†å¸ƒæ¦‚ç‡å¯†åº¦å‡½æ•°çš„å½¢çŠ¶æ‰€å¯¼è‡´çš„ã€‚</p><p>å½“æˆ‘ä»¬ä»é«˜æ–¯åˆ†å¸ƒä¸­æŠ½å–æ ·æœ¬æ—¶ï¼Œç”±äºé«˜æ–¯åˆ†å¸ƒçš„ä¸­å¿ƒå€¼ï¼ˆå‡å€¼ï¼‰å…·æœ‰æ›´é«˜çš„æ¦‚ç‡å¯†åº¦ï¼Œå¤§éƒ¨åˆ†æ ·æœ¬ä¼šé›†ä¸­åœ¨å‡å€¼é™„è¿‘ï¼Œè€Œåœ¨åˆ†å¸ƒçš„å°¾éƒ¨ï¼ˆè¾¹æ²¿ï¼‰ä½ç½®ä¸Šï¼Œæ ·æœ¬æ•°é‡ç›¸å¯¹è¾ƒå°‘ã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬åªä»é«˜æ–¯åˆ†å¸ƒçš„ä¸­å¿ƒå€¼é™„è¿‘æŠ½å–æ ·æœ¬æ¥ä¼°è®¡æ€»ä½“æ–¹å·®ï¼Œç”±äºæœªèƒ½å¾ˆå¥½åœ°è¦†ç›–æ•´ä¸ªåˆ†å¸ƒï¼Œå¾ˆå¯èƒ½ä¼šå¯¼è‡´æ€»ä½“æ–¹å·®çš„ä½ä¼°ã€‚</p><p>æ ·æœ¬æ–¹å·®çš„è®¡ç®—æ˜¯åŸºäºæ ·æœ¬æ•°æ®ä¸æ ·æœ¬å‡å€¼ä¹‹é—´çš„å·®å¼‚æ¥è¡¡é‡çš„ã€‚å½“æ ·æœ¬ä¸»è¦é›†ä¸­åœ¨æ€»ä½“åˆ†å¸ƒçš„ä¸­å¿ƒå€¼é™„è¿‘æ—¶ï¼Œéƒ¨åˆ†æ ·æœ¬ä¸æ ·æœ¬å‡å€¼ä¹‹é—´çš„å·®å¼‚ç›¸å¯¹è¾ƒå°ï¼Œå¯¼è‡´æ ·æœ¬æ–¹å·®çš„è®¡ç®—ç»“æœè¾ƒå°ã€‚è€Œæ€»ä½“çš„æ–¹å·®æ˜¯è€ƒè™‘äº†æ•´ä¸ªåˆ†å¸ƒèŒƒå›´å†…æ•°æ®ç‚¹ä¸æ€»ä½“å‡å€¼ä¹‹é—´çš„å·®å¼‚ï¼ˆåŒ…æ‹¬è¾¹ç¼˜å€¼ï¼‰ï¼Œå› æ­¤æ€»ä½“æ–¹å·®é€šå¸¸ä¼šå¤§äºæ ·æœ¬æ–¹å·®ã€‚</p><p>å› æ­¤ï¼Œç”±äºæ ·æœ¬ä¸»è¦é›†ä¸­åœ¨é«˜æ–¯åˆ†å¸ƒçš„ä¸­å¿ƒå€¼é™„è¿‘ä¸”æ ·æœ¬æ•°é‡æœ‰é™ï¼Œä½¿ç”¨è¿™éƒ¨åˆ†æ ·æœ¬æ¥ä¼°è®¡æ€»ä½“çš„æ–¹å·®å¾€å¾€ä¼šä½ä¼°æ€»ä½“æ–¹å·®ã€‚ä¸ºäº†æ›´å‡†ç¡®åœ°ä¼°è®¡æ€»ä½“æ–¹å·®ï¼Œå¯ä»¥è€ƒè™‘å¢åŠ æ ·æœ¬æ•°é‡ã€åœ¨æ•´ä¸ªåˆ†å¸ƒèŒƒå›´å†…å‡åŒ€æŠ½æ ·æˆ–è€…ä½¿ç”¨æ›´å¤æ‚çš„ç»Ÿè®¡æ–¹æ³•æ¥å¤„ç†è¿™ç§æƒ…å†µã€‚</p><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.2obbpl0e33.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.2obbpl0e33.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div><p>&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;å¡å°”æ›¼æ»¤æ³¢å™¨æ•™ç¨‹&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;&#x2F;</p><h2 id="ké˜¶åŸç‚¹çŸ©å’Œké˜¶ä¸­å¿ƒçŸ©"><a href="#ké˜¶åŸç‚¹çŸ©å’Œké˜¶ä¸­å¿ƒçŸ©" class="headerlink" title="ké˜¶åŸç‚¹çŸ©å’Œké˜¶ä¸­å¿ƒçŸ©"></a>ké˜¶åŸç‚¹çŸ©å’Œké˜¶ä¸­å¿ƒçŸ©</h2><p>åœ¨ç»Ÿè®¡å­¦ä¸­ï¼Œké˜¶åŸç‚¹çŸ©å’Œké˜¶ä¸­å¿ƒçŸ©æ˜¯ç”¨äºæè¿°æ¦‚ç‡åˆ†å¸ƒç‰¹æ€§çš„æ¦‚å¿µã€‚</p><ol><li><p>ké˜¶åŸç‚¹çŸ©ï¼š<br>å¯¹äºä¸€ä¸ªéšæœºå˜é‡Xï¼Œå®ƒçš„ké˜¶åŸç‚¹çŸ©è¡¨ç¤ºä¸ºÎ¼_k &#x3D; E(X^k)ï¼Œå³è¯¥éšæœºå˜é‡çš„kæ¬¡å¹‚çš„æœŸæœ›å€¼ã€‚æ¢å¥è¯è¯´ï¼Œké˜¶åŸç‚¹çŸ©æè¿°äº†éšæœºå˜é‡Xåœ¨kæ¬¡å¹‚ä¸Šçš„å¹³å‡å€¼ã€‚</p></li><li><p>ké˜¶ä¸­å¿ƒçŸ©ï¼š<br>å¯¹äºä¸€ä¸ªéšæœºå˜é‡Xï¼Œå®ƒçš„ké˜¶ä¸­å¿ƒçŸ©è¡¨ç¤ºä¸ºÎ¼â€™_k &#x3D; E[(X - Î¼)^k]ï¼Œå…¶ä¸­Î¼ä¸ºéšæœºå˜é‡Xçš„æœŸæœ›å€¼ï¼ˆå‡å€¼ï¼‰ã€‚ké˜¶ä¸­å¿ƒçŸ©æ˜¯æŒ‡å°†éšæœºå˜é‡Xå‡å»å…¶å‡å€¼åå†å–kæ¬¡å¹‚çš„æœŸæœ›ã€‚æ¢å¥è¯è¯´ï¼Œké˜¶ä¸­å¿ƒçŸ©æè¿°äº†éšæœºå˜é‡Xå…³äºå‡å€¼çš„kæ¬¡å¹‚çš„æœŸæœ›å€¼ã€‚</p></li></ol><p>å…³äºké˜¶åŸç‚¹çŸ©å’Œké˜¶ä¸­å¿ƒçŸ©çš„ä¸€äº›å…³é”®ç‚¹ï¼š</p><ul><li>ké˜¶åŸç‚¹çŸ©åŒ…å«æ•°æ®çš„ç»å¯¹ä¿¡æ¯ï¼Œè€Œké˜¶ä¸­å¿ƒçŸ©åŒ…å«æ•°æ®çš„ç›¸å¯¹ä¿¡æ¯ã€‚</li><li>ä¸€é˜¶ä¸­å¿ƒçŸ©å§‹ç»ˆä¸º0ï¼Œå› ä¸ºå®ƒè¡¨ç¤ºéšæœºå˜é‡å‡å»è‡ªèº«çš„å‡å€¼ï¼Œç»“æœå¿…ç„¶ä¸º0ã€‚</li><li>äºŒé˜¶ä¸­å¿ƒçŸ©æ˜¯æ–¹å·®çš„å¹³æ–¹æ ¹ï¼Œç”¨äºè¡¡é‡æ•°æ®çš„ç¦»æ•£ç¨‹åº¦ã€‚</li><li>ä¸‰é˜¶ä¸­å¿ƒçŸ©æ˜¯ååº¦ï¼Œç”¨äºè¡¡é‡åˆ†å¸ƒçš„å¯¹ç§°æ€§ã€‚</li><li>å››é˜¶ä¸­å¿ƒçŸ©æ˜¯å³°åº¦ï¼Œç”¨äºè¡¡é‡åˆ†å¸ƒçš„å°–å³­ç¨‹åº¦æˆ–å¹³å¦åº¦ã€‚</li></ul><p>æ€»çš„æ¥è¯´ï¼Œké˜¶åŸç‚¹çŸ©å’Œké˜¶ä¸­å¿ƒçŸ©æ˜¯ç”¨äºæ·±å…¥äº†è§£éšæœºå˜é‡æ•°æ®åˆ†å¸ƒç‰¹æ€§çš„é‡è¦ç»Ÿè®¡é‡ã€‚å®ƒä»¬æä¾›äº†å…³äºæ•°æ®çš„é«˜é˜¶ç»Ÿè®¡ä¿¡æ¯ï¼Œèƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬æ›´å…¨é¢åœ°ç†è§£éšæœºå˜é‡çš„æ€§è´¨å’Œè¡Œä¸ºã€‚</p><h2 id="å‡†åº¦å’Œç²¾åº¦"><a href="#å‡†åº¦å’Œç²¾åº¦" class="headerlink" title="å‡†åº¦å’Œç²¾åº¦"></a>å‡†åº¦å’Œç²¾åº¦</h2><p>å‡†åº¦å’Œç²¾åº¦æ˜¯ä¸¤ä¸ªç»å¸¸åœ¨ç§‘å­¦ä¸å·¥ç¨‹é¢†åŸŸä¸­ä½¿ç”¨çš„æ¦‚å¿µï¼Œå®ƒä»¬è¡¨ç¤ºäº†æµ‹é‡ç»“æœæˆ–æ•°æ®çš„è´¨é‡ï¼Œä½†åœ¨å«ä¹‰ä¸Šæœ‰æ‰€ä¸åŒã€‚</p><ol><li><p>å‡†åº¦ï¼ˆAccuracyï¼‰ï¼š<br>å‡†åº¦æŒ‡çš„æ˜¯æµ‹é‡ç»“æœæˆ–æ•°æ®ä¸çœŸå®æ•°å€¼ä¹‹é—´çš„åå·®ç¨‹åº¦ï¼Œå³æµ‹é‡ç»“æœçš„æ¥è¿‘ç¨‹åº¦ã€‚å¦‚æœæµ‹é‡ç»“æœä¸çœŸå®æ•°å€¼éå¸¸æ¥è¿‘ï¼Œåˆ™è®¤ä¸ºè¯¥æµ‹é‡æ˜¯å‡†ç¡®çš„ï¼Œå…·æœ‰é«˜å‡†åº¦ã€‚å‡†åº¦é€šå¸¸ç”¨è¯¯å·®æˆ–åå·®æ¥è¡¨ç¤ºï¼Œå¯ä»¥æ˜¯ç³»ç»Ÿæ€§çš„ï¼ˆåå·®æ’å®šï¼‰æˆ–éšæœºæ€§çš„ï¼ˆéšæœºè¯¯å·®ï¼‰ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå‡†åº¦çš„æé«˜æ„å‘³ç€æ›´æ¥è¿‘çœŸå®å€¼çš„æµ‹é‡ç»“æœï¼Œå³æ›´å°‘çš„è¯¯å·®ã€‚</p></li><li><p>ç²¾åº¦ï¼ˆPrecisionï¼‰ï¼š<br>ç²¾åº¦æŒ‡çš„æ˜¯å¤šæ¬¡æµ‹é‡æ‰€å¾—ç»“æœä¹‹é—´çš„ä¸€è‡´æ€§æˆ–é‡å¤æ€§ï¼Œå³æµ‹é‡ç»“æœçš„ç¨³å®šç¨‹åº¦ã€‚å¦‚æœå¤šæ¬¡æµ‹é‡æ‰€å¾—ç»“æœéå¸¸æ¥è¿‘ï¼Œå¯ä»¥è®¤ä¸ºè¯¥æµ‹é‡æ˜¯ç²¾ç¡®çš„ï¼Œå…·æœ‰é«˜ç²¾åº¦ã€‚ç²¾åº¦é€šå¸¸ç”¨æ ‡å‡†åå·®æˆ–æ–¹å·®æ¥æè¿°ï¼Œç”¨æ¥è¡¡é‡æµ‹é‡æ•°æ®çš„ç¦»æ•£ç¨‹åº¦ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œç²¾åº¦çš„æé«˜æ„å‘³ç€æµ‹é‡ç»“æœä¹‹é—´çš„ä¸€è‡´æ€§æ›´é«˜ï¼Œå³æ•°æ®æ›´åŠ ç¨³å®šã€‚</p></li></ol><p>åŒºåˆ«æ€»ç»“ï¼š</p><ul><li>å‡†åº¦å¼ºè°ƒæµ‹é‡ç»“æœä¸çœŸå®å€¼ä¹‹é—´çš„æ¥è¿‘ç¨‹åº¦ï¼Œè€Œç²¾åº¦å¼ºè°ƒå¤šæ¬¡æµ‹é‡ç»“æœä¹‹é—´çš„ä¸€è‡´æ€§ã€‚</li><li>å‡†åº¦æ¶‰åŠæµ‹é‡ç»“æœçš„å‡†ç¡®ç¨‹åº¦ï¼Œç²¾åº¦æ¶‰åŠæµ‹é‡ç»“æœçš„ç¨³å®šç¨‹åº¦ã€‚</li><li>æé«˜å‡†åº¦æ„å‘³ç€å‡å°‘ä¸çœŸå®å€¼çš„å·®è·ï¼Œè€Œæé«˜ç²¾åº¦æ„å‘³ç€å¢åŠ æµ‹é‡ç»“æœä¹‹é—´çš„ä¸€è‡´æ€§ã€‚</li></ul><p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå‡†ç¡®åº¦å’Œç²¾åº¦é€šå¸¸éœ€è¦å¹³è¡¡è€ƒè™‘ã€‚ä¸€ä¸ªæµ‹é‡æ—¢è¦å‡†ç¡®åœ°è¡¨è¾¾çœŸå®å€¼ï¼Œåˆè¦å…·æœ‰é‡å¤æ€§å’Œä¸€è‡´æ€§ï¼Œè¿™æ ·æ‰èƒ½æä¾›å¯é çš„æ•°æ®æ”¯æŒç§‘å­¦ç ”ç©¶ã€å·¥ç¨‹è®¾è®¡ç­‰é¢†åŸŸçš„å†³ç­–å’Œåˆ¤æ–­ã€‚</p><h2 id="Î±âˆ’Î²âˆ’Î³æ»¤æ³¢å™¨å’Œå¡å°”æ›¼æ»¤æ³¢å™¨çš„è”ç³»å’ŒåŒºåˆ«"><a href="#Î±âˆ’Î²âˆ’Î³æ»¤æ³¢å™¨å’Œå¡å°”æ›¼æ»¤æ³¢å™¨çš„è”ç³»å’ŒåŒºåˆ«" class="headerlink" title="Î±âˆ’Î²âˆ’Î³æ»¤æ³¢å™¨å’Œå¡å°”æ›¼æ»¤æ³¢å™¨çš„è”ç³»å’ŒåŒºåˆ«"></a>Î±âˆ’Î²âˆ’Î³æ»¤æ³¢å™¨å’Œå¡å°”æ›¼æ»¤æ³¢å™¨çš„è”ç³»å’ŒåŒºåˆ«</h2><p>Î±-Î²-Î³æ»¤æ³¢å™¨å’Œå¡å°”æ›¼æ»¤æ³¢å™¨éƒ½æ˜¯ç”¨äºä¼°è®¡ç³»ç»ŸçŠ¶æ€çš„æ»¤æ³¢å™¨ï¼Œå®ƒä»¬æœ‰ä¸€äº›è”ç³»å’ŒåŒºåˆ«ï¼š</p><ol><li><p>è”ç³»ï¼š</p><ul><li>ä¸¤è€…éƒ½æ˜¯å¸¸ç”¨çš„æ»¤æ³¢å™¨ç®—æ³•ï¼Œç”¨äºä¼°è®¡ç³»ç»Ÿçš„çŠ¶æ€ï¼Œå¹¶å¯¹ä¼ æ„Ÿå™¨æ•°æ®è¿›è¡Œå¹³æ»‘å¤„ç†ã€‚</li><li>åœ¨ä¸€å®šç¨‹åº¦ä¸Šï¼ŒÎ±-Î²-Î³æ»¤æ³¢å™¨å¯ä»¥çœ‹ä½œæ˜¯å¡å°”æ›¼æ»¤æ³¢å™¨çš„ä¸€ç§ç®€åŒ–ç‰ˆæœ¬ï¼Œé€‚ç”¨äºä¸€äº›ç®€å•çš„ç³»ç»Ÿã€‚</li></ul></li><li><p>åŒºåˆ«ï¼š</p><ul><li>å¡å°”æ›¼æ»¤æ³¢å™¨æ˜¯ä¸€ç§åŸºäºçŠ¶æ€ç©ºé—´æ¨¡å‹çš„é€’å½’æ»¤æ³¢å™¨ï¼Œå¯ä»¥å¤„ç†å…·æœ‰é«˜æ–¯å™ªå£°çš„åŠ¨æ€ç³»ç»Ÿã€‚å®ƒé€šè¿‡çŠ¶æ€ä¼°è®¡å’Œè¯¯å·®åæ–¹å·®ä¼°è®¡æ¥æœ€ä¼˜åœ°ç»“åˆå…ˆéªŒä¿¡æ¯å’Œæµ‹é‡æ•°æ®ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒÎ±-Î²-Î³æ»¤æ³¢å™¨æ˜¯ä¸€ç§æ›´ç®€å•çš„æ»¤æ³¢å™¨ï¼Œé€šå¸¸ç”¨äºä½æˆæœ¬çš„åº”ç”¨å’Œå¯¹è®¡ç®—èµ„æºè¦æ±‚è¾ƒä½çš„åœºæ™¯ã€‚</li><li>åœ¨å•ä¸ªç»´åº¦ä¸Šï¼ŒÎ±-Î²-Î³æ»¤æ³¢å™¨å¯ç”¨äºå¯¹åŠ é€Ÿåº¦æ•°æ®è¿›è¡Œæ»¤æ³¢å’Œå¹³æ»‘å¤„ç†ï¼Œè€Œå¡å°”æ›¼æ»¤æ³¢å™¨æ›´å¸¸ç”¨äºå¤šç»´åº¦çŠ¶æ€ä¼°è®¡ï¼Œä¾‹å¦‚è·Ÿè¸ªç§»åŠ¨ç›®æ ‡ã€‚</li><li>å¡å°”æ›¼æ»¤æ³¢å™¨åœ¨å¤„ç†éçº¿æ€§ç³»ç»Ÿå’Œéé«˜æ–¯å™ªå£°æ—¶æ•ˆæœæ›´å¥½ï¼Œå› ä¸ºå®ƒèƒ½å¤Ÿè‡ªé€‚åº”åœ°è°ƒæ•´åæ–¹å·®çŸ©é˜µã€‚è€ŒÎ±-Î²-Î³æ»¤æ³¢å™¨åˆ™æ›´é€‚ç”¨äºçº¿æ€§ç³»ç»Ÿæˆ–é«˜æ–¯å™ªå£°çš„æƒ…å†µã€‚</li></ul></li></ol><p>æ€»çš„æ¥è¯´ï¼Œå¡å°”æ›¼æ»¤æ³¢å™¨æ˜¯ä¸€ç§æ›´åŠ é€šç”¨å’Œçµæ´»çš„æ»¤æ³¢å™¨ç®—æ³•ï¼Œé€‚ç”¨äºè¾ƒä¸ºå¤æ‚çš„ç³»ç»ŸçŠ¶æ€ä¼°è®¡é—®é¢˜ï¼Œè€ŒÎ±-Î²-Î³æ»¤æ³¢å™¨åˆ™æ˜¯ä¸€ç§ç®€å•çš„æ»¤æ³¢å™¨ç®—æ³•ï¼Œé€‚ç”¨äºä¸€äº›ç®€å•çš„ç³»ç»Ÿå¹³æ»‘å¤„ç†ä»»åŠ¡ã€‚é€‰æ‹©å“ªç§æ»¤æ³¢å™¨å–å†³äºå…·ä½“çš„åº”ç”¨åœºæ™¯å’Œç³»ç»Ÿè¦æ±‚ã€‚</p><h2 id="å¡å°”æ›¼æ»¤æ³¢"><a href="#å¡å°”æ›¼æ»¤æ³¢" class="headerlink" title="å¡å°”æ›¼æ»¤æ³¢"></a>å¡å°”æ›¼æ»¤æ³¢</h2><p><strong>Q:</strong><br>å¡å°”æ›¼æ»¤æ³¢æ˜¯æ ¹æ®ä¸Šä¸€æ¬¡çš„å€¼å¾—å‡ºçš„è¿™ä¸€æ¬¡çš„é¢„æµ‹å€¼å’Œè¿™ä¸€æ¬¡çš„æµ‹é‡å€¼è¿™ä¸¤ä¸ªå€¼åŠ æƒæ±‚å¾—çš„å€¼å—<br><strong>A:</strong><br>å¡å°”æ›¼æ»¤æ³¢æ˜¯ä¸€ç§ç”¨äºä¼°è®¡ç³»ç»ŸçŠ¶æ€çš„å¼ºå¤§æŠ€æœ¯ï¼Œç¡®å®æ¶‰åŠåˆ°å¯¹ä¸Šä¸€æ¬¡çŠ¶æ€çš„ä¼°è®¡å€¼ã€å½“å‰æ—¶åˆ»çš„æµ‹é‡å€¼å’Œé¢„æµ‹å€¼è¿›è¡ŒåŠ æƒå¹³å‡ã€‚åœ¨å¡å°”æ›¼æ»¤æ³¢ä¸­ï¼Œç³»ç»ŸçŠ¶æ€è¢«è¡¨ç¤ºä¸ºä¸€ä¸ªå«æœ‰çŠ¶æ€å˜é‡çš„å‘é‡ï¼Œè€Œç³»ç»Ÿçš„åŠ¨æ€è¡Œä¸ºé€šå¸¸ç”±ä¸€ç»„çº¿æ€§åŠ¨æ€æ–¹ç¨‹å’Œä¸€ç»„çº¿æ€§æµ‹é‡æ–¹ç¨‹æè¿°ã€‚</p><p>åœ¨æ¯ä¸ªæ—¶é—´æ­¥ï¼Œå¡å°”æ›¼æ»¤æ³¢å™¨æ‰§è¡Œä»¥ä¸‹ä¸¤ä¸ªä¸»è¦æ­¥éª¤ï¼š</p><ol><li><p><strong>é¢„æµ‹æ­¥éª¤ï¼ˆPredictï¼‰</strong>ï¼šåŸºäºä¸Šä¸€æ¬¡çš„çŠ¶æ€ä¼°è®¡ä»¥åŠç³»ç»ŸåŠ¨æ€æ–¹ç¨‹ï¼Œé¢„æµ‹ç³»ç»Ÿçš„å½“å‰çŠ¶æ€ã€‚è¿™ä¸€é¢„æµ‹è€ƒè™‘äº†ä¸Šä¸€æ¬¡çš„çŠ¶æ€ä¼°è®¡å’Œç³»ç»Ÿè¡Œä¸ºæ¨¡å‹ï¼Œäº§ç”Ÿä¸€ä¸ªé¢„æµ‹çš„çŠ¶æ€å’Œåæ–¹å·®ä¼°è®¡ã€‚</p></li><li><p><strong>æ›´æ–°æ­¥éª¤ï¼ˆUpdateï¼‰</strong>ï¼šå°†é¢„æµ‹çš„çŠ¶æ€ä¸å½“å‰çš„æµ‹é‡å€¼è¿›è¡Œæ¯”è¾ƒï¼Œæ ¹æ®äºŒè€…çš„å…³ç³»æ¥ä¿®æ­£é¢„æµ‹çŠ¶æ€ï¼Œå¾—åˆ°æ›´å‡†ç¡®çš„çŠ¶æ€ä¼°è®¡ã€‚è¿™ä¸€æ­¥éª¤æ¶‰åŠå¡å°”æ›¼å¢ç›Šçš„è®¡ç®—ï¼Œä»¥ç¡®ä¿é¢„æµ‹çŠ¶æ€å’Œæµ‹é‡çŠ¶æ€ä¹‹é—´çš„åŠ æƒå¹³å‡ã€‚</p></li></ol><p>å› æ­¤ï¼Œåœ¨å¡å°”æ›¼æ»¤æ³¢ä¸­ï¼Œé€šè¿‡å°†ä¸Šä¸€æ¬¡çš„çŠ¶æ€ä¼°è®¡ã€å½“å‰æ—¶åˆ»çš„é¢„æµ‹å€¼å’Œæµ‹é‡å€¼è¿›è¡Œåˆç†çš„åŠ æƒç»„åˆï¼Œå¯ä»¥æ›´å¥½åœ°ä¼°è®¡ç³»ç»Ÿçš„çœŸå®çŠ¶æ€ï¼Œå¹¶å¯¹å™ªå£°è¿›è¡Œæœ‰æ•ˆæŠ‘åˆ¶ã€‚æ•´ä¸ªè¿‡ç¨‹é€šè¿‡ä¸æ–­è¿­ä»£é¢„æµ‹å’Œæ›´æ–°æ­¥éª¤ï¼Œé€æ¸æé«˜çŠ¶æ€ä¼°è®¡çš„å‡†ç¡®æ€§ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;tagLink&quot;&gt;&lt;a class=&quot;link-card&quot; title=&quot;å¡å°”æ›¼æ»¤æ³¢æ•™ç¨‹&quot; href=&quot;https://www.kalmanfilter.net/CN/background_cn.html&quot;&gt;&lt;span class=&quot;link-card-b</summary>
      
    
    
    
    <category term="æ™ºèƒ½è½¦" scheme="http://tumytime.github.io/categories/%E6%99%BA%E8%83%BD%E8%BD%A6/"/>
    
    
    <category term="æ™ºèƒ½è½¦" scheme="http://tumytime.github.io/tags/%E6%99%BA%E8%83%BD%E8%BD%A6/"/>
    
    <category term="æ— äººé©¾é©¶" scheme="http://tumytime.github.io/tags/%E6%97%A0%E4%BA%BA%E9%A9%BE%E9%A9%B6/"/>
    
    <category term="æ¦‚ç‡è®º" scheme="http://tumytime.github.io/tags/%E6%A6%82%E7%8E%87%E8%AE%BA/"/>
    
  </entry>
  
  <entry>
    <title>è“æ¡¥æ¯åµŒå…¥å¼å®¢è§‚é¢˜ç¬”è®°</title>
    <link href="http://tumytime.github.io/2024/03/30/%E8%93%9D%E6%A1%A5%E6%9D%AF%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%AE%A2%E8%A7%82%E9%A2%98%E7%AC%94%E8%AE%B0/"/>
    <id>http://tumytime.github.io/2024/03/30/%E8%93%9D%E6%A1%A5%E6%9D%AF%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%AE%A2%E8%A7%82%E9%A2%98%E7%AC%94%E8%AE%B0/</id>
    <published>2024-03-30T08:23:34.000Z</published>
    <updated>2024-03-31T08:04:37.417Z</updated>
    
    <content type="html"><![CDATA[<details open><summary pointer> æ—¶åºé€»è¾‘ç”µè·¯ </summary>              <div class='content'>              <div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.8hg8xhmilq.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.8hg8xhmilq.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div><p><strong>æ—¶åºé€»è¾‘ç”µè·¯:</strong><br>è®¡æ•°å™¨<br>åˆ†é¢‘å™¨<br>è§¦å‘å™¨<br>ç§¯åˆ†å™¨<br>ç§»ä½å¯„å­˜å™¨<br>æ—¶åºæ¯”è¾ƒå™¨<br><strong>ç»„åˆé€»è¾‘ç”µè·¯:</strong><br>é€»è¾‘é—¨<br>è¯‘ç å™¨<br>ç¼–ç å™¨<br>å¤šè·¯é€‰æ‹©å™¨<br>åŠ æ³•å™¨<br>æ¯”è¾ƒå™¨<br>æ•°å­—æ¯”ä¾‹è°ƒèŠ‚å™¨</p>              </div>            </details><details open><summary pointer> å‡æ³•è®¡æ•°å™¨ </summary>              <div class='content'>              <p>ä¸€ä¸ª 8ä½äºŒè¿›åˆ¶å‡æ³•è®¡æ•°å™¨ï¼Œ åˆå§‹çŠ¶æ€ä¸º 00000000ï¼Œ é—®ç»è¿‡ 268ä¸ªè¾“å…¥è„‰å†²åï¼Œ æ­¤è®¡æ•°å™¨çš„çŠ¶æ€ä¸º ______ã€‚<br>A.11001111<br>B.11110100<br>C.11110010<br>D.11110011<br>ç­”æ¡ˆï¼šB<br>è§£æï¼š8ä½äºŒè¿›åˆ¶æ•°è®¡æ•°2^8 &#x3D; 256æ¬¡åå›åˆ°00000000ï¼Œè¿˜å‰©268-256&#x3D;12æ¬¡è®¡æ•°ï¼Œè®¡æ•°1æ¬¡åä»â€œ00000000â€å‡ä¸ºâ€œ11111111â€ï¼Œæ­¤åå†å‡11ï¼ˆ00001011ï¼‰ï¼Œå¾—åˆ°11110100ï¼Œé€‰Bã€‚<br>1111 1111<br>â€“ 0000 1011<br>1111 0100</p>              </div>            </details>]]></content>
    
    
      
      
    <summary type="html">&lt;details open&gt;&lt;summary pointer&gt; æ—¶åºé€»è¾‘ç”µè·¯ &lt;/summary&gt;
              &lt;div class=&#39;content&#39;&gt;
              &lt;div class=&quot;img-wrap&quot;&gt;&lt;div class=&quot;img-bg</summary>
      
    
    
    
    <category term="åµŒå…¥å¼" scheme="http://tumytime.github.io/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/"/>
    
    
    <category term="åµŒå…¥å¼" scheme="http://tumytime.github.io/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/"/>
    
    <category term="stm32" scheme="http://tumytime.github.io/tags/stm32/"/>
    
    <category term="è“æ¡¥æ¯" scheme="http://tumytime.github.io/tags/%E8%93%9D%E6%A1%A5%E6%9D%AF/"/>
    
  </entry>
  
  <entry>
    <title>æ‘„åƒå¤´è€ƒæ ¸</title>
    <link href="http://tumytime.github.io/2024/03/25/%E6%91%84%E5%83%8F%E5%A4%B4%E8%80%83%E6%A0%B8/"/>
    <id>http://tumytime.github.io/2024/03/25/%E6%91%84%E5%83%8F%E5%A4%B4%E8%80%83%E6%A0%B8/</id>
    <published>2024-03-25T13:50:31.000Z</published>
    <updated>2024-03-25T13:50:49.176Z</updated>
    
    
    
    
    <category term="æ™ºèƒ½è½¦" scheme="http://tumytime.github.io/categories/%E6%99%BA%E8%83%BD%E8%BD%A6/"/>
    
    
    <category term="Python" scheme="http://tumytime.github.io/tags/Python/"/>
    
    <category term="æ™ºèƒ½è½¦" scheme="http://tumytime.github.io/tags/%E6%99%BA%E8%83%BD%E8%BD%A6/"/>
    
    <category term="å›¾åƒå¤„ç†" scheme="http://tumytime.github.io/tags/%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/"/>
    
    <category term="OpenCV" scheme="http://tumytime.github.io/tags/OpenCV/"/>
    
  </entry>
  
  <entry>
    <title>å›¾åƒå¤„ç†ç¬”è®°ï¼ˆäºŒï¼‰ç°åº¦å˜æ¢å’Œç©ºé—´æ»¤æ³¢åŸºç¡€</title>
    <link href="http://tumytime.github.io/2024/03/25/%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86%E7%AC%94%E8%AE%B0%EF%BC%88%E4%BA%8C%EF%BC%89%E7%81%B0%E5%BA%A6%E5%8F%98%E6%8D%A2%E5%92%8C%E7%A9%BA%E9%97%B4%E6%BB%A4%E6%B3%A2%E5%9F%BA%E7%A1%80/"/>
    <id>http://tumytime.github.io/2024/03/25/%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86%E7%AC%94%E8%AE%B0%EF%BC%88%E4%BA%8C%EF%BC%89%E7%81%B0%E5%BA%A6%E5%8F%98%E6%8D%A2%E5%92%8C%E7%A9%BA%E9%97%B4%E6%BB%A4%E6%B3%A2%E5%9F%BA%E7%A1%80/</id>
    <published>2024-03-25T13:04:31.000Z</published>
    <updated>2024-03-25T13:50:12.291Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç°åº¦å˜æ¢å’Œç©ºé—´æ»¤æ³¢åŸºç¡€"><a href="#ç°åº¦å˜æ¢å’Œç©ºé—´æ»¤æ³¢åŸºç¡€" class="headerlink" title="ç°åº¦å˜æ¢å’Œç©ºé—´æ»¤æ³¢åŸºç¡€"></a>ç°åº¦å˜æ¢å’Œç©ºé—´æ»¤æ³¢åŸºç¡€</h2><h3 id="ç°åº¦å˜æ¢ï¼ˆç°åº¦åè½¬ï¼Œå¯¹æ•°å˜æ¢ï¼Œå¹‚å¾‹å˜æ¢ï¼‰"><a href="#ç°åº¦å˜æ¢ï¼ˆç°åº¦åè½¬ï¼Œå¯¹æ•°å˜æ¢ï¼Œå¹‚å¾‹å˜æ¢ï¼‰" class="headerlink" title="ç°åº¦å˜æ¢ï¼ˆç°åº¦åè½¬ï¼Œå¯¹æ•°å˜æ¢ï¼Œå¹‚å¾‹å˜æ¢ï¼‰"></a>ç°åº¦å˜æ¢ï¼ˆç°åº¦åè½¬ï¼Œå¯¹æ•°å˜æ¢ï¼Œå¹‚å¾‹å˜æ¢ï¼‰</h3><h4 id="ç°åº¦å˜æ¢åŸç†"><a href="#ç°åº¦å˜æ¢åŸç†" class="headerlink" title="ç°åº¦å˜æ¢åŸç†"></a>ç°åº¦å˜æ¢åŸç†</h4><p>å˜æ¢åŸç†ï¼šé€šè¿‡å˜æ¢å‡½æ•°Tå°†åŸå›¾åƒåƒç´ ç°åº¦å€¼ræ˜ å°„ä¸ºç°åº¦å€¼sï¼š</p><p>$s&#x3D;T(r)$</p><h4 id="ç°åº¦åè½¬"><a href="#ç°åº¦åè½¬" class="headerlink" title="ç°åº¦åè½¬"></a>ç°åº¦åè½¬</h4><h5 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†:"></a>åŸç†:</h5><p>ç°åº¦åè½¬ï¼šå°†å›¾åƒäº®æš—å¯¹è°ƒï¼Œå¯ä»¥å¢å¼ºå›¾åƒä¸­æš—è‰²åŒºåŸŸç»†èŠ‚<br>$s&#x3D;T(r)&#x3D;L-1-r$<br>å…¶ä¸­Lä¸ºå›¾åƒç°åº¦çº§ï¼Œ0~255ç°åº¦å›¾åƒçš„ç°åº¦çº§ä¸º256.</p><h5 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line">using namespace cv;</span><br><span class="line">using namespace <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">Mat image1, output_image, image1_gray;   <span class="comment">//å®šä¹‰è¾“å…¥å›¾åƒï¼Œè¾“å‡ºå›¾åƒï¼Œç°åº¦å›¾åƒ</span></span><br><span class="line">image1 = imread(<span class="string">&quot;fire.jpg&quot;</span>);  <span class="comment">//è¯»å–å›¾åƒï¼›</span></span><br><span class="line"><span class="keyword">if</span> (image1.empty())</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;è¯»å–é”™è¯¯&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">cvtColor(image1, image1_gray, COLOR_BGR2GRAY);  <span class="comment">//ç°åº¦åŒ–</span></span><br><span class="line">imshow(<span class="string">&quot; image1_gray&quot;</span>, image1_gray);   <span class="comment">//æ˜¾ç¤ºç°åº¦å›¾åƒ</span></span><br><span class="line"></span><br><span class="line">output_image = image1_gray.clone();</span><br><span class="line"><span class="comment">//éå†åƒç´ ç‚¹</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; image1_gray.rows; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; image1_gray.cols; j++)</span><br><span class="line">&#123;</span><br><span class="line">output_image.at&lt;uchar&gt;(i, j) = <span class="number">255</span> - image1_gray.at&lt;uchar&gt;(i, j);  <span class="comment">//ç°åº¦åè½¬</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">imshow(<span class="string">&quot;output_image&quot;</span>, output_image);  <span class="comment">//æ˜¾ç¤ºåè½¬å›¾åƒ</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">waitKey(<span class="number">0</span>);  <span class="comment">//æš‚åœï¼Œä¿æŒå›¾åƒæ˜¾ç¤ºï¼Œç­‰å¾…æŒ‰é”®ç»“æŸ</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è¾“å‡º</strong></p><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.lvht9o5v6.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.lvht9o5v6.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div><h4 id="å¯¹æ•°å˜æ¢"><a href="#å¯¹æ•°å˜æ¢" class="headerlink" title="å¯¹æ•°å˜æ¢"></a>å¯¹æ•°å˜æ¢</h4><h5 id="åŸç†-1"><a href="#åŸç†-1" class="headerlink" title="åŸç†"></a>åŸç†</h5><p>å¯¹æ•°å˜æ¢ï¼šæ‰©å±•å›¾åƒä¸­çš„æš—åƒç´ å€¼ï¼Œå‹ç¼©é«˜ç°åº¦å€¼ã€‚<br>$s&#x3D;T(r)&#x3D;c*log(1+r)$<br>$log(1+r)$æ–œç‡é€æ¸é™ä½ï¼Œä¸Šå‡è¶‹åŠ¿é€æ¸æ”¾ç¼“</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line">using namespace cv;</span><br><span class="line">using namespace <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">Mat image1, output_image, image1_gray;   <span class="comment">//å®šä¹‰è¾“å…¥å›¾åƒï¼Œè¾“å‡ºå›¾åƒï¼Œç°åº¦å›¾åƒ</span></span><br><span class="line">image1 = imread(<span class="string">&quot;fire.jpg&quot;</span>);  <span class="comment">//è¯»å–å›¾åƒï¼›</span></span><br><span class="line"><span class="keyword">if</span> (image1.empty())</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;è¯»å–é”™è¯¯&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">cvtColor(image1, image1_gray, COLOR_BGR2GRAY);  <span class="comment">//ç°åº¦åŒ–</span></span><br><span class="line">imshow(<span class="string">&quot; image1_gray&quot;</span>, image1_gray);   <span class="comment">//æ˜¾ç¤ºç°åº¦å›¾åƒ</span></span><br><span class="line"></span><br><span class="line">output_image = image1_gray.clone();</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; image1_gray.rows; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; image1_gray.cols; j++)</span><br><span class="line">&#123;</span><br><span class="line">output_image.at&lt;uchar&gt;(i, j) = <span class="number">6</span> * <span class="built_in">log</span>((<span class="type">double</span>)(image1_gray.at&lt;uchar&gt;(i, j)) + <span class="number">1</span>);  <span class="comment">//å¯¹æ•°å˜æ¢ s=6*log(r+1)</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">normalize(output_image, output_image, <span class="number">0</span>, <span class="number">255</span>, NORM_MINMAX);  <span class="comment">//å›¾åƒå½’ä¸€åŒ–ï¼Œè½¬åˆ°0~255èŒƒå›´å†…</span></span><br><span class="line">convertScaleAbs(output_image, output_image);  <span class="comment">//æ•°æ®ç±»å‹è½¬æ¢åˆ°CV_8U</span></span><br><span class="line">imshow(<span class="string">&quot; output_image&quot;</span>, output_image);  <span class="comment">//æ˜¾ç¤ºå˜æ¢å›¾åƒ</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">waitKey(<span class="number">0</span>);  <span class="comment">//æš‚åœï¼Œä¿æŒå›¾åƒæ˜¾ç¤ºï¼Œç­‰å¾…æŒ‰é”®ç»“æŸ</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è¾“å‡º</strong></p><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.3uulpxj04i.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.3uulpxj04i.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div><h4 id="å¹‚å¾‹ï¼ˆä¼½é©¬å˜æ¢ï¼‰"><a href="#å¹‚å¾‹ï¼ˆä¼½é©¬å˜æ¢ï¼‰" class="headerlink" title="å¹‚å¾‹ï¼ˆä¼½é©¬å˜æ¢ï¼‰"></a>å¹‚å¾‹ï¼ˆä¼½é©¬å˜æ¢ï¼‰</h4><h5 id="åŸç†-2"><a href="#åŸç†-2" class="headerlink" title="åŸç†"></a>åŸç†</h5><p>å¹‚å¾‹å˜æ¢ä¸å¯¹æ•°å˜æ¢ç±»ä¼¼ï¼š<br>$s&#x3D;T(r)&#x3D;c*r^Î³$</p><h5 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a>ä»£ç </h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line">using namespace cv;</span><br><span class="line">using namespace <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123; </span><br><span class="line">Mat image1, output_image, image1_gray;   <span class="comment">//å®šä¹‰è¾“å…¥å›¾åƒï¼Œè¾“å‡ºå›¾åƒï¼Œç°åº¦å›¾åƒ</span></span><br><span class="line">image1 = imread(<span class="string">&quot;lena.png&quot;</span>);  <span class="comment">//è¯»å–å›¾åƒï¼›</span></span><br><span class="line"><span class="keyword">if</span> (image1.empty())</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;è¯»å–é”™è¯¯&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">cvtColor(image1, image1_gray, COLOR_BGR2GRAY);  <span class="comment">//ç°åº¦åŒ–</span></span><br><span class="line">imshow(<span class="string">&quot; image1_gray&quot;</span>, image1_gray);   <span class="comment">//æ˜¾ç¤ºç°åº¦å›¾åƒ</span></span><br><span class="line"></span><br><span class="line">output_image = image1_gray.clone();</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; image1_gray.rows; i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; image1_gray.cols; j++)</span><br><span class="line">&#123;</span><br><span class="line">output_image.at&lt;uchar&gt;(i, j) =<span class="number">6</span>*<span class="built_in">pow</span>((<span class="type">double</span>)image1_gray.at&lt;uchar&gt;(i, j),<span class="number">0.5</span>);  <span class="comment">//å¹‚å¾‹å˜æ¢ s=6*r^0.5</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">normalize(output_image, output_image, <span class="number">0</span>, <span class="number">255</span>, NORM_MINMAX);  <span class="comment">//å›¾åƒå½’ä¸€åŒ–ï¼Œè½¬åˆ°0~255èŒƒå›´å†…</span></span><br><span class="line">convertScaleAbs(output_image, output_image);  <span class="comment">//æ•°æ®ç±»å‹è½¬æ¢åˆ°CV_8U</span></span><br><span class="line">imshow(<span class="string">&quot; output_image&quot;</span>, output_image);  <span class="comment">//æ˜¾ç¤ºå˜æ¢å›¾åƒ</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">waitKey(<span class="number">0</span>);  <span class="comment">//æš‚åœï¼Œä¿æŒå›¾åƒæ˜¾ç¤ºï¼Œç­‰å¾…æŒ‰é”®ç»“æŸ</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è¾“å‡º</strong></p><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.2obahbyue1.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.2obahbyue1.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div><h3 id="ç›´æ–¹å›¾å¤„ç†ï¼ˆç›´æ–¹å›¾å‡è¡¡åŒ–ï¼Œç›´æ–¹å›¾åŒ¹é…ï¼ˆè§„å®šåŒ–ï¼‰ï¼‰"><a href="#ç›´æ–¹å›¾å¤„ç†ï¼ˆç›´æ–¹å›¾å‡è¡¡åŒ–ï¼Œç›´æ–¹å›¾åŒ¹é…ï¼ˆè§„å®šåŒ–ï¼‰ï¼‰" class="headerlink" title="ç›´æ–¹å›¾å¤„ç†ï¼ˆç›´æ–¹å›¾å‡è¡¡åŒ–ï¼Œç›´æ–¹å›¾åŒ¹é…ï¼ˆè§„å®šåŒ–ï¼‰ï¼‰"></a>ç›´æ–¹å›¾å¤„ç†ï¼ˆç›´æ–¹å›¾å‡è¡¡åŒ–ï¼Œç›´æ–¹å›¾åŒ¹é…ï¼ˆè§„å®šåŒ–ï¼‰ï¼‰</h3><p>ç›´æ–¹å›¾æ˜¾ç¤ºäº†æ¯ä¸ªåƒç´ å€¼åœ¨æ•´å¹…å›¾åƒä¸­å‡ºç°çš„é¢‘ç‡æˆ–æ•°é‡ï¼Œä»è€Œå¸®åŠ©æˆ‘ä»¬ç†è§£å›¾åƒçš„äº®åº¦åˆ†å¸ƒæƒ…å†µã€‚</p><h4 id="å›¾åƒç›´æ–¹å›¾"><a href="#å›¾åƒç›´æ–¹å›¾" class="headerlink" title="å›¾åƒç›´æ–¹å›¾"></a>å›¾åƒç›´æ–¹å›¾</h4><p>éå½’ä¸€åŒ–ç›´æ–¹å›¾:<br>$h(r_k)&#x3D;n_k$<br>å½’ä¸€åŒ–ç›´æ–¹å›¾:<br>$p(r_k)&#x3D;{n_k \over MN}$<br>å…¶ä¸­MNä¸ºå›¾åƒè¡Œæ•°å’Œåˆ—æ•°ï¼Œå¸¸è¯´çš„å›¾åƒç›´æ–¹å›¾å°±æ˜¯å½’ä¸€åŒ–ç›´æ–¹å›¾ã€‚</p><p>è·å–å›¾åƒç›´æ–¹å›¾ç¤ºä¾‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line">using namespace cv;</span><br><span class="line">using namespace <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">Mat image, image_gray, hist;   <span class="comment">//å®šä¹‰è¾“å…¥å›¾åƒï¼Œç°åº¦å›¾åƒ, ç›´æ–¹å›¾</span></span><br><span class="line">image = imread(<span class="string">&quot;fire.jpg&quot;</span>);  <span class="comment">//è¯»å–å›¾åƒï¼›</span></span><br><span class="line"><span class="keyword">if</span> (image.empty())</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;è¯»å–é”™è¯¯&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">cvtColor(image, image_gray, COLOR_BGR2GRAY);  <span class="comment">//ç°åº¦åŒ–</span></span><br><span class="line">imshow(<span class="string">&quot; image_gray&quot;</span>, image_gray);   <span class="comment">//æ˜¾ç¤ºç°åº¦å›¾åƒ</span></span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è·å–å›¾åƒç›´æ–¹å›¾</span></span><br><span class="line"><span class="type">int</span> histsize = <span class="number">256</span>;</span><br><span class="line"><span class="type">float</span> ranges[] = &#123; <span class="number">0</span>,<span class="number">256</span> &#125;;</span><br><span class="line"><span class="type">const</span> <span class="type">float</span>* histRanges = &#123; ranges &#125;;</span><br><span class="line">calcHist(&amp;image_gray, <span class="number">1</span>, <span class="number">0</span>, Mat(), hist, <span class="number">1</span>, &amp;histsize, &amp;histRanges, <span class="literal">true</span>, <span class="literal">false</span>);</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç ç”¨äºè®¡ç®—å›¾åƒçš„ç›´æ–¹å›¾ï¼Œä¸‹é¢æ˜¯å¯¹è¿™æ®µä»£ç çš„è¯¦ç»†è§£é‡Šï¼š</p><ol><li><p><strong>histsize &#x3D; 256ï¼š</strong> è¿™é‡Œå®šä¹‰äº†ç›´æ–¹å›¾çš„å¤§å°ä¸º256ï¼Œè¡¨ç¤ºç›´æ–¹å›¾çš„æ¨ªè½´èŒƒå›´ï¼Œé€šå¸¸å¯¹åº”ç€å›¾åƒå¯èƒ½çš„åƒç´ å€¼èŒƒå›´ï¼ˆ0åˆ°255ï¼‰ã€‚</p></li><li><p><strong>ranges[] &#x3D; {0, 256}ï¼š</strong> è¿™é‡Œå®šä¹‰äº†ç›´æ–¹å›¾å¯èƒ½çš„åƒç´ å€¼èŒƒå›´ä¸º0åˆ°256ï¼Œç”¨äºæŒ‡å®šç›´æ–¹å›¾ä¸­æ¯ä¸ªåƒç´ å€¼çš„èŒƒå›´ã€‚</p></li><li><p><em><em>const float</em> histRanges &#x3D; {ranges};</em>* è¿™ä¸€è¡Œç”¨äºå°†rangesæ•°ç»„è½¬æ¢ä¸ºæŒ‡å‘å¸¸é‡æµ®ç‚¹æ•°çš„æŒ‡é’ˆï¼Œä¾›calcHistå‡½æ•°ä½¿ç”¨ã€‚</p></li><li><p><strong>calcHist(&amp;image_gray, 1, 0, Mat(), hist, 1, &amp;histsize, &amp;histRanges, true, false)ï¼š</strong></p><ul><li><strong>&amp;image_grayï¼š</strong> è¿™æ˜¯è¾“å…¥çš„ç°åº¦å›¾åƒï¼Œè¡¨ç¤ºè¦è®¡ç®—ç›´æ–¹å›¾çš„åŸå§‹å›¾åƒã€‚</li><li><strong>1ï¼š</strong> è¡¨ç¤ºè¦è®¡ç®—çš„å›¾åƒæ•°é‡ã€‚</li><li><strong>0ï¼š</strong> è¡¨ç¤ºç›´æ–¹å›¾è¦è®¡ç®—çš„é€šé“ç´¢å¼•ï¼Œ0è¡¨ç¤ºç°åº¦å›¾åƒã€‚</li><li><strong>Mat()ï¼š</strong> è¿™é‡Œæ˜¯ä¸€ä¸ªæ©ç å›¾åƒï¼Œç”¨äºæŒ‡å®šè¦è®¡ç®—ç›´æ–¹å›¾çš„åŒºåŸŸï¼›åœ¨è¿™é‡Œæ²¡æœ‰ä½¿ç”¨ï¼Œå› æ­¤ä¸ºç©ºã€‚</li><li><strong>histï¼š</strong> è¿™æ˜¯ç”¨äºå­˜å‚¨è®¡ç®—åç›´æ–¹å›¾çš„Matå¯¹è±¡ã€‚</li><li><strong>1ï¼š</strong> ç›´æ–¹å›¾çš„ç»´æ•°ï¼Œå¯¹äºç°åº¦å›¾åƒæ˜¯1ç»´ã€‚</li><li><strong>&amp;histsizeï¼š</strong> è¿™æ˜¯åŒ…å«ç›´æ–¹å›¾å¤§å°ï¼ˆ256ï¼‰çš„æŒ‡é’ˆã€‚</li><li><strong>&amp;histRangesï¼š</strong> æŒ‡å‘ç›´æ–¹å›¾èŒƒå›´çš„æŒ‡é’ˆã€‚</li><li><strong>trueï¼š</strong> æŒ‡ç¤ºç›´æ–¹å›¾æ˜¯å¦å‡ä¸€åŒ–ï¼Œå³åœ¨èŒƒå›´0åˆ°255å†…å¯¹ç›´æ–¹å›¾è¿›è¡Œå½’ä¸€åŒ–å¤„ç†ã€‚</li><li><strong>falseï¼š</strong> æŒ‡ç¤ºç›´æ–¹å›¾æ˜¯å¦ç´¯ç§¯ï¼Œå³è¡¨ç¤ºç›´æ–¹å›¾æ˜¯å¦ç´¯ç§¯è®¡ç®—ã€‚</li></ul></li></ol><p>é€šè¿‡è¿™æ®µä»£ç ï¼Œå¯ä»¥é€šè¿‡calcHistå‡½æ•°è®¡ç®—å›¾åƒimage_grayçš„ç›´æ–¹å›¾ï¼Œå¹¶å°†ç»“æœå­˜å‚¨åœ¨histå¯¹è±¡ä¸­ã€‚ç›´æ–¹å›¾çš„èŒƒå›´æ˜¯0åˆ°255ä¹‹é—´ï¼Œä¸”è¿›è¡Œäº†å½’ä¸€åŒ–å¤„ç†ã€‚è¿™èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬äº†è§£å›¾åƒçš„åƒç´ å€¼åˆ†å¸ƒæƒ…å†µï¼Œä¸ºåç»­çš„å›¾åƒå¤„ç†å’Œåˆ†ææä¾›æ•°æ®æ”¯æŒã€‚å¸Œæœ›è¿™ä¸ªè§£é‡Šå¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œå¦‚æœæ‚¨æœ‰ä»»ä½•å…¶ä»–é—®é¢˜ï¼Œè¯·éšæ—¶å‘Šè¯‰æˆ‘ï¼</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºç›´æ–¹å›¾æ˜¾ç¤ºå›¾åƒ</span></span><br><span class="line"><span class="type">int</span> hist_h = <span class="number">300</span>;<span class="comment">//ç›´æ–¹å›¾çš„å›¾åƒçš„é«˜</span></span><br><span class="line"><span class="type">int</span> hist_w = <span class="number">512</span>; <span class="comment">//ç›´æ–¹å›¾çš„å›¾åƒçš„å®½</span></span><br><span class="line"><span class="type">int</span> bin_w = hist_w / histsize;<span class="comment">//ç›´æ–¹å›¾çš„ç­‰çº§</span></span><br><span class="line">Mat <span class="title function_">histImage</span><span class="params">(hist_h, hist_w, CV_8UC3, Scalar(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>))</span>;<span class="comment">//ç»˜åˆ¶ç›´æ–¹å›¾æ˜¾ç¤ºçš„å›¾åƒ</span></span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç»˜åˆ¶å¹¶æ˜¾ç¤ºç›´æ–¹å›¾</span></span><br><span class="line">normalize(hist, hist, <span class="number">0</span>, hist_h, NORM_MINMAX, <span class="number">-1</span>, Mat());<span class="comment">//å½’ä¸€åŒ–ç›´æ–¹å›¾</span></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; histsize; i++)</span><br><span class="line">&#123;</span><br><span class="line">line(histImage, Point((i - <span class="number">1</span>) * bin_w, hist_h - cvRound(hist.at&lt;<span class="type">float</span>&gt;(i - <span class="number">1</span>))),</span><br><span class="line">Point((i)*bin_w, hist_h - cvRound(hist.at&lt;<span class="type">float</span>&gt;(i))), Scalar(<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>), <span class="number">2</span>, <span class="number">8</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line">imshow(<span class="string">&quot;histImage&quot;</span>, histImage);</span><br><span class="line"></span><br><span class="line">waitKey(<span class="number">0</span>);  <span class="comment">//æš‚åœï¼Œä¿æŒå›¾åƒæ˜¾ç¤ºï¼Œç­‰å¾…æŒ‰é”®ç»“æŸ</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç æ˜¯ç”¨äºå°†å½’ä¸€åŒ–åçš„ç›´æ–¹å›¾æ•°æ®ç»˜åˆ¶æˆç›´æ–¹å›¾å›¾åƒçš„è¿‡ç¨‹ã€‚ä¸‹é¢æ˜¯å¯¹ä»£ç çš„è¯¦ç»†è§£é‡Šï¼š</p><ol><li><p><strong><code>for</code>å¾ªç¯ï¼š</strong></p><ul><li>è¿™æ®µä»£ç ä½¿ç”¨<code>for</code>å¾ªç¯éå†ç›´æ–¹å›¾çš„æ¯ä¸ªæ¡ï¼Œä»ç¬¬2ä¸ªæ¡å¼€å§‹åˆ°æœ€åä¸€ä¸ªæ¡ã€‚</li><li><code>i</code>ä»1å¼€å§‹ï¼Œå› ä¸ºç¬¬0ä¸ªæ¡é€šå¸¸ä»£è¡¨èƒŒæ™¯ï¼Œå¯ä»¥è·³è¿‡ä¸ç»˜åˆ¶ã€‚</li></ul></li><li><p><strong><code>line()</code>å‡½æ•°ï¼š</strong></p><ul><li><code>line()</code>å‡½æ•°ç”¨äºåœ¨<code>histImage</code>ä¸Šç»˜åˆ¶ç›´æ–¹å›¾çš„æ¡ã€‚</li><li><code>Point((i - 1) * bin_w, hist_h - cvRound(hist.at&lt;float&gt;(i - 1)))</code>è¡¨ç¤ºå½“å‰æ¡çš„èµ·å§‹ç‚¹ä½ç½®ï¼Œå‰ä¸€ä¸ªæ¡çš„ç»“æŸç‚¹ä½ç½®ã€‚</li><li><code>Point((i)*bin_w, hist_h - cvRound(hist.at&lt;float&gt;(i)))</code> è¡¨ç¤ºå½“å‰æ¡çš„ç»ˆç‚¹ä½ç½®ã€‚</li><li><code>Scalar(255, 0, 0)</code>æŒ‡å®šç»˜åˆ¶ç›´çº¿çš„é¢œè‰²ä¸ºè“è‰²ã€‚</li><li><code>2</code>è¡¨ç¤ºçº¿çš„ç²—ç»†ä¸º2ä¸ªåƒç´ ã€‚</li><li><code>8</code>è¡¨ç¤ºçº¿çš„ç±»å‹ä¸º8-connectedã€‚</li><li><code>0</code>è¡¨ç¤ºçº¿çš„åç§»å€¼ä¸º0ã€‚</li></ul></li><li><p><strong>ç»˜åˆ¶ç›´æ–¹å›¾æ¡ï¼š</strong></p><ul><li>é€šè¿‡è®¡ç®—æ¯ä¸ªç›´æ–¹å›¾æ¡çš„èµ·å§‹å’Œç»ˆæ­¢ç‚¹ï¼Œä½¿ç”¨<code>line()</code>å‡½æ•°åœ¨<code>histImage</code>ä¸Šç»˜åˆ¶ç›´æ–¹å›¾æ¡ã€‚</li><li><code>cvRound()</code>ç”¨äºå°†æµ®ç‚¹å€¼å››èˆäº”å…¥ä¸ºæœ€æ¥è¿‘çš„æ•´æ•°ï¼Œç¡®ä¿ç›´æ–¹å›¾èƒ½å¤Ÿæ­£ç¡®æ˜ å°„åˆ°å›¾åƒä¸Šã€‚</li></ul></li></ol><h4 id="ç›´æ–¹å›¾å‡è¡¡åŒ–"><a href="#ç›´æ–¹å›¾å‡è¡¡åŒ–" class="headerlink" title="ç›´æ–¹å›¾å‡è¡¡åŒ–"></a>ç›´æ–¹å›¾å‡è¡¡åŒ–</h4><p>(æˆ‘æ„Ÿè§‰å·®ä¸å¤šäº†ï¼Œæˆ‘å»åšè€ƒæ ¸å’¯~)</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;ç°åº¦å˜æ¢å’Œç©ºé—´æ»¤æ³¢åŸºç¡€&quot;&gt;&lt;a href=&quot;#ç°åº¦å˜æ¢å’Œç©ºé—´æ»¤æ³¢åŸºç¡€&quot; class=&quot;headerlink&quot; title=&quot;ç°åº¦å˜æ¢å’Œç©ºé—´æ»¤æ³¢åŸºç¡€&quot;&gt;&lt;/a&gt;ç°åº¦å˜æ¢å’Œç©ºé—´æ»¤æ³¢åŸºç¡€&lt;/h2&gt;&lt;h3 id=&quot;ç°åº¦å˜æ¢ï¼ˆç°åº¦åè½¬ï¼Œå¯¹æ•°å˜æ¢ï¼Œå¹‚å¾‹å˜æ¢ï¼‰&quot;&gt;&lt;a href</summary>
      
    
    
    
    <category term="æ™ºèƒ½è½¦" scheme="http://tumytime.github.io/categories/%E6%99%BA%E8%83%BD%E8%BD%A6/"/>
    
    
    <category term="Python" scheme="http://tumytime.github.io/tags/Python/"/>
    
    <category term="æ™ºèƒ½è½¦" scheme="http://tumytime.github.io/tags/%E6%99%BA%E8%83%BD%E8%BD%A6/"/>
    
    <category term="å›¾åƒå¤„ç†" scheme="http://tumytime.github.io/tags/%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/"/>
    
    <category term="OpenCV" scheme="http://tumytime.github.io/tags/OpenCV/"/>
    
  </entry>
  
  <entry>
    <title>å›¾åƒå¤„ç†ç¬”è®°ï¼ˆä¸€ï¼‰åŸºç¡€æ“ä½œ</title>
    <link href="http://tumytime.github.io/2024/03/25/%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86%E7%AC%94%E8%AE%B0-1/"/>
    <id>http://tumytime.github.io/2024/03/25/%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86%E7%AC%94%E8%AE%B0-1/</id>
    <published>2024-03-25T03:51:05.000Z</published>
    <updated>2024-03-25T13:05:31.723Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>å‰é¢ä¸€éƒ¨åˆ†ç¬”è®°éƒ½æ˜¯å­¦ä¹ ä¸€ä¸ªå¤§ä½¬çš„æ•™ç¨‹åšçš„ï¼Œä½†æ˜¯å¤§ä½¬ç”¨çš„pythonï¼Œæˆ‘åœ¨ç¬”è®°é‡Œéƒ½è½¬æ¢æˆäº†c++</p></blockquote><h2 id="åŸºç¡€é…ç½®"><a href="#åŸºç¡€é…ç½®" class="headerlink" title="åŸºç¡€é…ç½®"></a>åŸºç¡€é…ç½®</h2><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.2kroj52zde.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.2kroj52zde.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.pf3qismjr.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.pf3qismjr.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.4g49bri91j.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.4g49bri91j.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.1set1eq2uf.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.1set1eq2uf.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.58h4ti0gy2.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.58h4ti0gy2.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.1hrz89c5f9.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.1hrz89c5f9.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div><h2 id="å›¾ç‰‡åŸºæœ¬è¯»å–æ“ä½œ"><a href="#å›¾ç‰‡åŸºæœ¬è¯»å–æ“ä½œ" class="headerlink" title="å›¾ç‰‡åŸºæœ¬è¯»å–æ“ä½œ"></a>å›¾ç‰‡åŸºæœ¬è¯»å–æ“ä½œ</h2><p>ç”µè„‘ä¸Šçš„å½©è‰²å›¾æ˜¯ä»¥ RGB(çº¢ - ç»¿-è“ï¼ŒRed-Green-Blue) é¢œè‰²æ¨¡å¼æ˜¾ç¤ºçš„ï¼Œä½† OpenCV ä¸­å½©è‰²å›¾æ˜¯ä»¥ B-G-R é€šé“é¡ºåºå­˜å‚¨çš„ï¼Œç°åº¦å›¾åªæœ‰ä¸€ä¸ªé€šé“ã€‚</p><p>å›¾åƒåæ ‡çš„èµ·å§‹ç‚¹æ˜¯åœ¨å·¦ä¸Šè§’ï¼Œæ‰€ä»¥è¡Œå¯¹åº”çš„æ˜¯ yï¼Œåˆ—å¯¹åº”çš„æ˜¯ xï¼š</p><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.54xivstf47.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.54xivstf47.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div><h3 id="åŠ è½½å›¾ç‰‡"><a href="#åŠ è½½å›¾ç‰‡" class="headerlink" title="åŠ è½½å›¾ç‰‡"></a>åŠ è½½å›¾ç‰‡</h3><blockquote><span class='pbg info'>imread()</span><blockquote><p><strong>ä¸¤ä¸ªå‚æ•°:</strong></p><ul><li>å‚æ•° 1ï¼šå›¾ç‰‡çš„æ–‡ä»¶å<br> å¦‚æœå›¾ç‰‡æ”¾åœ¨å½“å‰æ–‡ä»¶å¤¹ä¸‹ï¼Œç›´æ¥å†™æ–‡ä»¶åå°±è¡Œï¼Œå¦‚â€lena.jpgâ€<br> å¦åˆ™éœ€è¦ç»™å‡ºç»å¯¹è·¯å¾„ï¼Œå¦‚â€C:&#x2F;Users&#x2F;lxcqm&#x2F;Desktop&#x2F;å›¾ç‰‡å’Œè§†é¢‘&#x2F;11111.pngâ€</li><li>å‚æ•° 2ï¼šè¯»å…¥æ–¹å¼ï¼Œçœç•¥å³é‡‡ç”¨é»˜è®¤å€¼<br> cv2.IMREAD_COLORï¼šå½©è‰²å›¾ï¼Œé»˜è®¤å€¼(1)or(IMREAD_COLOR)<br> cv2.IMREAD_GRAYSCALEï¼šç°åº¦å›¾(0)or(IMREAD_GRAYSCALE)<br> cv2.IMREAD_UNCHANGEDï¼šåŒ…å«é€æ˜é€šé“çš„å½©è‰²å›¾(-1)or(IMREAD_UNCHANGED)</li></ul></blockquote></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åŠ è½½ç°åº¦å›¾</span></span><br><span class="line">Mat  img = imread(<span class="string">&quot;C:/Users/lxcqm/Desktop/images/11111.png&quot;</span>,<span class="number">0</span>);</span><br></pre></td></tr></table></figure><blockquote><p>ç»éªŒä¹‹è°ˆï¼šè·¯å¾„ä¸­ä¸èƒ½æœ‰ä¸­æ–‡å™¢ï¼Œå¹¶ä¸”æ²¡æœ‰åŠ è½½æˆåŠŸçš„è¯æ˜¯ä¸ä¼šæŠ¥é”™çš„ï¼Œprint(img)çš„ç»“æœä¸º Noneï¼Œåé¢å¤„ç†æ‰ä¼šæŠ¥é”™ï¼Œç®—æ˜¯ä¸ªå°å‘ã€‚</p></blockquote><h1 id=""><a href="#" class="headerlink" title=""></a></h1><h2 id="æ˜¾ç¤ºå›¾ç‰‡"><a href="#æ˜¾ç¤ºå›¾ç‰‡" class="headerlink" title="æ˜¾ç¤ºå›¾ç‰‡"></a>æ˜¾ç¤ºå›¾ç‰‡</h2><p>ä½¿ç”¨<code>imshow()</code>æ˜¾ç¤ºå›¾ç‰‡ï¼Œçª—å£ä¼šè‡ªé€‚åº”å›¾ç‰‡çš„å¤§å°ï¼š</p><blockquote><p><code>imshow()</code></p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åŠ è½½ç°åº¦å›¾</span></span><br><span class="line">Mat  img = imread(<span class="string">&quot;C:/Users/lxcqm/Desktop/images/11111.png&quot;</span>,<span class="number">0</span>);</span><br><span class="line">imshow(<span class="string">&quot;pic&quot;</span>, img);</span><br><span class="line">waitKey(<span class="number">0</span>);</span><br></pre></td></tr></table></figure><p>å‚æ•° 1 æ˜¯çª—å£çš„åå­—ï¼Œå‚æ•° 2 æ˜¯è¦æ˜¾ç¤ºçš„å›¾ç‰‡ã€‚ä¸åŒçª—å£ä¹‹é—´ç”¨çª—å£ååŒºåˆ†ï¼Œæ‰€ä»¥çª—å£åç›¸åŒå°±è¡¨ç¤ºæ˜¯åŒä¸€ä¸ªçª—å£ï¼Œæ˜¾ç¤ºç»“æœå¦‚ä¸‹ï¼š<br><strong>æ•ˆæœ:</strong></p><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.32hq7r8seh.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.32hq7r8seh.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div><blockquote><p><code>waitKey()</code>æ˜¯è®©ç¨‹åºæš‚åœçš„æ„æ€ï¼Œå‚æ•°æ˜¯ç­‰å¾…æ—¶é—´ï¼ˆæ¯«ç§’ msï¼‰ã€‚<br>æ—¶é—´ä¸€åˆ°ï¼Œä¼šç»§ç»­æ‰§è¡Œæ¥ä¸‹æ¥çš„ç¨‹åºï¼Œä¼ å…¥ 0 çš„è¯è¡¨ç¤ºä¸€ç›´ç­‰å¾…ã€‚ç­‰å¾…æœŸé—´ä¹Ÿå¯ä»¥è·å–ç”¨æˆ·çš„æŒ‰é”®è¾“å…¥ï¼šk &#x3D; waitKey(0)</p></blockquote><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥å…ˆç”¨<code>namedWindow()</code>åˆ›å»ºä¸€ä¸ªçª—å£ï¼Œä¹‹åå†æ˜¾ç¤ºå›¾ç‰‡ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">namedWindow(<span class="string">&quot;pic2&quot;</span>, WINDOW_NORMAL);</span><br><span class="line">imshow(<span class="string">&quot;pic2&quot;</span>, img);</span><br><span class="line">waitKey(<span class="number">0</span>);</span><br></pre></td></tr></table></figure><p>å‚æ•° 1 ä¾æ—§æ˜¯çª—å£çš„åå­—ï¼Œå‚æ•° 2 é»˜è®¤æ˜¯<code>WINDOW_AUTOSIZE</code>ï¼Œè¡¨ç¤ºçª—å£å¤§å°è‡ªé€‚åº”å›¾ç‰‡ï¼Œä¹Ÿå¯ä»¥è®¾ç½®ä¸º<code>WINDOW_NORMAL</code>ï¼Œè¡¨ç¤ºçª—å£å¤§å°å¯è°ƒæ•´ã€‚å›¾ç‰‡æ¯”è¾ƒå¤§çš„æ—¶å€™ï¼Œå¯ä»¥è€ƒè™‘ç”¨åè€…ã€‚</p><h3 id="ä¿å­˜å›¾ç‰‡"><a href="#ä¿å­˜å›¾ç‰‡" class="headerlink" title="ä¿å­˜å›¾ç‰‡"></a>ä¿å­˜å›¾ç‰‡</h3><blockquote><p><code>imwrite()</code></p></blockquote><p>ä½¿ç”¨<code>imwrite()</code>ä¿å­˜å›¾ç‰‡ï¼Œå‚æ•° 1 æ˜¯åŒ…å«åç¼€åçš„æ–‡ä»¶åï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">imwrite(<span class="string">&quot;pictest.jpg&quot;</span>, img);</span><br></pre></td></tr></table></figure><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.sypoa1fpo.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.sypoa1fpo.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div><p>ä¼šä¿å­˜åœ¨ç›®å½•æ–‡ä»¶å¤¹é‡Œ</p><h2 id="æ‘„åƒå¤´"><a href="#æ‘„åƒå¤´" class="headerlink" title="æ‘„åƒå¤´"></a>æ‘„åƒå¤´</h2><h3 id="æ‰“å¼€æ‘„åƒå¤´"><a href="#æ‰“å¼€æ‘„åƒå¤´" class="headerlink" title="æ‰“å¼€æ‘„åƒå¤´"></a>æ‰“å¼€æ‘„åƒå¤´</h3><p>è¦ä½¿ç”¨æ‘„åƒå¤´ï¼Œéœ€è¦ä½¿ç”¨<code>VideoCapture capture(0);</code>å‚æ•° <code>0</code> æŒ‡çš„æ˜¯æ‘„åƒå¤´çš„ç¼–å·ï¼Œå¦‚æœä½ ç”µè„‘ä¸Šæœ‰ä¸¤ä¸ªæ‘„åƒå¤´çš„è¯ï¼Œè®¿é—®ç¬¬ 2 ä¸ªæ‘„åƒå¤´å°±å¯ä»¥ä¼ å…¥ <code>1</code>ï¼Œä¾æ­¤ç±»æ¨ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    VideoCapture <span class="title function_">capture</span><span class="params">(<span class="number">0</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!capture.isOpened()) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        Mat frame;</span><br><span class="line">        <span class="comment">//&gt;&gt; æ˜¯è¾“å…¥æµæå–è¿ç®—ç¬¦</span></span><br><span class="line">        <span class="comment">// å®ƒé€šå¸¸ç”¨äºä»è¾“å…¥æµä¸­æå–æ•°æ®å¹¶å°†å…¶å­˜å‚¨åœ¨ç›¸åº”çš„å˜é‡ä¸­</span></span><br><span class="line">        <span class="comment">// è¡¨ç¤ºä» capture è¾“å…¥æµä¸­è¯»å–æ•°æ®ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨ frame å˜é‡ä¸­</span></span><br><span class="line">        capture &gt;&gt; frame;</span><br><span class="line"></span><br><span class="line">        Mat gray;</span><br><span class="line">        cvtColor(frame, gray, COLOR_BGR2GRAY);</span><br><span class="line"></span><br><span class="line">        imshow(<span class="string">&quot;frame&quot;</span>, gray);</span><br><span class="line">        <span class="keyword">if</span> (waitKey(<span class="number">1</span>) == <span class="string">&#x27;q&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>cv2.cvtColor()</code>ç”¨æ¥è½¬æ¢é¢œè‰²ï¼Œè¿™é‡Œå°†å½©è‰²å›¾è½¬æˆç°åº¦å›¾ã€‚<br>é€šè¿‡cap.get(propId)å¯ä»¥è·å–æ‘„åƒå¤´çš„ä¸€äº›å±æ€§ï¼Œæ¯”å¦‚æ•è·çš„åˆ†è¾¨ç‡ï¼Œäº®åº¦å’Œå¯¹æ¯”åº¦ç­‰ã€‚propId æ˜¯ä» 0~18 çš„æ•°å­—ï¼Œä»£è¡¨ä¸åŒçš„å±æ€§ï¼Œå®Œæ•´çš„å±æ€§åˆ—è¡¨å¯ä»¥å‚è€ƒï¼šVideoCaptureProperties(<a href="https://docs.opencv.org/4.0.0/d4/d15/group__videoio__flags__base.html#gaeb8dd9c89c10a5c63c139bf7c4f5704d">https://docs.opencv.org/4.0.0/d4/d15/group__videoio__flags__base.html#gaeb8dd9c89c10a5c63c139bf7c4f5704d</a>)<br>ä¹Ÿå¯ä»¥ä½¿ç”¨cap.set(propId,value)æ¥ä¿®æ”¹å±æ€§å€¼ã€‚æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬åœ¨ while ä¹‹å‰æ·»åŠ ä¸‹é¢çš„ä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">double</span> width = capture.get(CAP_PROP_FRAME_WIDTH);</span><br><span class="line"><span class="type">double</span> height = capture.get(CAP_PROP_FRAME_HEIGHT);</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Original width: &quot;</span> &lt;&lt; width &lt;&lt; <span class="string">&quot;, height: &quot;</span> &lt;&lt; height &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">capture.<span class="built_in">set</span>(CAP_PROP_FRAME_WIDTH, width * <span class="number">2</span>);</span><br><span class="line">capture.<span class="built_in">set</span>(CAP_PROP_FRAME_HEIGHT, height * <span class="number">2</span>);</span><br></pre></td></tr></table></figure><details open><summary pointer> std::cout << Original width: << width << </summary>              <div class='content'>              <p>è¿™è¡Œä»£ç ä½¿ç”¨äº†C++ä¸­çš„æµè¾“å‡ºæ“ä½œç¬¦â€&lt;&lt;â€ï¼Œå®ƒç”¨äºå°†æ•°æ®æ’å…¥åˆ°è¾“å‡ºæµä¸­ã€‚åœ¨è¿™ä¸ªè¯­å¥ä¸­ï¼š</p><ul><li><code>std::cout</code>: æ˜¯C++æ ‡å‡†åº“ä¸­çš„æ ‡å‡†è¾“å‡ºæµå¯¹è±¡ï¼Œç”¨äºå°†æ•°æ®è¾“å‡ºåˆ°æ§åˆ¶å°ã€‚</li><li><code>&quot;Original width: &quot;</code>ã€<code>width</code>ã€<code>&quot;, height: &quot;</code>ã€<code>height</code>ã€<code>std::endl</code> éƒ½æ˜¯è¦è¾“å‡ºçš„å…·ä½“å†…å®¹ã€‚</li><li><code>&lt;&lt;</code>ï¼šæ˜¯æµè¾“å‡ºæ“ä½œç¬¦ï¼Œç”¨äºå°†åé¢çš„å†…å®¹æ’å…¥åˆ°è¾“å‡ºæµä¸­ã€‚</li></ul><p>æ‰€ä»¥ï¼Œ<code>std::cout &lt;&lt; &quot;Original width: &quot; &lt;&lt; width &lt;&lt; &quot;, height: &quot; &lt;&lt; height &lt;&lt; std::endl;</code> è¿™è¡Œä»£ç çš„ä½œç”¨æ˜¯å°†æè¿°åŸå§‹å®½åº¦å’Œé«˜åº¦çš„å­—ç¬¦ä¸²ä»¥åŠç›¸åº”çš„å˜é‡å€¼è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œå¹¶åœ¨æœ€åæ¢è¡Œã€‚</p>              </div>            </details><p><strong>è¾“å‡º</strong></p><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.86texdkg7l.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.86texdkg7l.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div><blockquote><p>ç»éªŒä¹‹è°ˆï¼šæŸäº›æ‘„åƒå¤´è®¾å®šåˆ†è¾¨ç‡ç­‰å‚æ•°æ—¶ä¼šæ— æ•ˆï¼Œå› ä¸ºå®ƒæœ‰å›ºå®šçš„åˆ†è¾¨ç‡å¤§å°æ”¯æŒï¼Œä¸€èˆ¬å¯åœ¨æ‘„åƒå¤´çš„èµ„æ–™é¡µä¸­æ‰¾åˆ°ã€‚</p></blockquote><h3 id="æ’­æ”¾æœ¬åœ°è§†é¢‘"><a href="#æ’­æ”¾æœ¬åœ°è§†é¢‘" class="headerlink" title="æ’­æ”¾æœ¬åœ°è§†é¢‘"></a>æ’­æ”¾æœ¬åœ°è§†é¢‘</h3><p>è·Ÿæ‰“å¼€æ‘„åƒå¤´ä¸€æ ·ï¼Œå¦‚æœæŠŠæ‘„åƒå¤´çš„ç¼–å·æ¢æˆè§†é¢‘çš„è·¯å¾„å°±å¯ä»¥æ’­æ”¾æœ¬åœ°è§†é¢‘äº†ã€‚å›æƒ³ä¸€ä¸‹<code>waitKey()</code>ï¼Œå®ƒçš„å‚æ•°è¡¨ç¤ºæš‚åœæ—¶é—´ï¼Œæ‰€ä»¥è¿™ä¸ªå€¼è¶Šå¤§ï¼Œè§†é¢‘æ’­æ”¾é€Ÿåº¦è¶Šæ…¢ï¼Œåä¹‹ï¼Œæ’­æ”¾é€Ÿåº¦è¶Šå¿«ï¼Œé€šå¸¸è®¾ç½®ä¸º <code>25</code> æˆ– <code>30</code>ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/core/core.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/highgui/highgui.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/imgproc.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line">using namespace <span class="built_in">std</span>;</span><br><span class="line">using namespace cv;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    VideoCapture <span class="title function_">capture</span><span class="params">(<span class="string">&quot;C:/Users/lxcqm/Desktop/WeChat_20240325194731.mp4&quot;</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!capture.isOpened()) &#123;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Error opening video file&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">     Mat frame, gray;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!capture.read(frame)) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        cvtColor(frame, gray, COLOR_BGR2GRAY);</span><br><span class="line"></span><br><span class="line">        imshow(<span class="string">&quot;frame&quot;</span>, gray);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (waitKey(<span class="number">30</span>) == <span class="string">&#x27;q&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    capture.release();</span><br><span class="line">    destroyAllWindows();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å½•åˆ¶è§†é¢‘"><a href="#å½•åˆ¶è§†é¢‘" class="headerlink" title="å½•åˆ¶è§†é¢‘"></a>å½•åˆ¶è§†é¢‘</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/core/core.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/highgui/highgui.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;opencv2/imgproc.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line">using namespace <span class="built_in">std</span>;</span><br><span class="line">using namespace cv;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    VideoCapture <span class="title function_">capture</span><span class="params">(<span class="number">0</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰ç¼–ç æ–¹å¼å¹¶åˆ›å»º VideoWriter å¯¹è±¡</span></span><br><span class="line">    VideoWriter <span class="title function_">outfile</span><span class="params">(<span class="string">&quot;output.avi&quot;</span>, VideoWriter::fourcc(<span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;J&#x27;</span>, <span class="string">&#x27;P&#x27;</span>, <span class="string">&#x27;G&#x27;</span>), <span class="number">25.</span>, Size(<span class="number">640</span>, <span class="number">480</span>))</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (capture.isOpened()) &#123;</span><br><span class="line">        Mat frame;</span><br><span class="line">        capture.read(frame);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!frame.empty()) &#123;</span><br><span class="line">            outfile.write(frame); <span class="comment">// å†™å…¥æ–‡ä»¶</span></span><br><span class="line">            imshow(<span class="string">&quot;frame&quot;</span>, frame);</span><br><span class="line">            <span class="keyword">if</span> (waitKey(<span class="number">1</span>) == <span class="string">&#x27;q&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åŸºæœ¬æ“ä½œ"><a href="#åŸºæœ¬æ“ä½œ" class="headerlink" title="åŸºæœ¬æ“ä½œ"></a>åŸºæœ¬æ“ä½œ</h2><h3 id="Matåˆ›å»ºå›¾åƒï¼ˆçŸ©é˜µï¼‰"><a href="#Matåˆ›å»ºå›¾åƒï¼ˆçŸ©é˜µï¼‰" class="headerlink" title="Matåˆ›å»ºå›¾åƒï¼ˆçŸ©é˜µï¼‰"></a>Matåˆ›å»ºå›¾åƒï¼ˆçŸ©é˜µï¼‰</h3><h4 id="åˆ›å»ºå›¾åƒï¼ˆçŸ©é˜µï¼‰ï¼šMat"><a href="#åˆ›å»ºå›¾åƒï¼ˆçŸ©é˜µï¼‰ï¼šMat" class="headerlink" title="åˆ›å»ºå›¾åƒï¼ˆçŸ©é˜µï¼‰ï¼šMat"></a>åˆ›å»ºå›¾åƒï¼ˆçŸ©é˜µï¼‰ï¼šMat</h4><p>ä½¿ç”¨Matåˆ›å»ºå›¾åƒï¼ˆçŸ©é˜µï¼‰çš„å¸¸ç”¨å½¢å¼æœ‰ï¼š</p><ol><li><p>åˆ›å»ºä¸€ä¸ªç©ºå›¾åƒï¼Œå¤§å°ä¸º0</p> <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Mat image1;</span><br></pre></td></tr></table></figure></li><li><p>æŒ‡å®šçŸ©é˜µå¤§å°ï¼ŒæŒ‡å®šæ•°æ®ç±»å‹ï¼š</p> <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Mat <span class="title function_">image1</span><span class="params">(<span class="number">100</span>,<span class="number">100</span>,CV_8U)</span>;</span><br></pre></td></tr></table></figure><p> å‚æ•°:çŸ©é˜µè¡Œæ•°ï¼ŒçŸ©é˜µåˆ—æ•°ï¼Œæ•°æ®ç±»å‹</p><p> å…¶ä¸­æ•°æ®ç±»å‹æœ‰å¾ˆå¤šç§ï¼Œå¸¸ç”¨çš„åº”è¯¥æœ‰ï¼š</p><p> CV_8Uï¼š8ä½æ— ç¬¦å·å‹ï¼ˆ0~255ï¼‰ï¼Œå³ç°åº¦å›¾åƒï¼›</p><p> CV_8UC3ï¼šä¸‰é€šé“8ä½æ— ç¬¦å·å‹ï¼Œè¿™é‡Œä¸‰é€šé“æŒ‡Bï¼ˆè“ï¼‰Gï¼ˆç»¿ï¼‰Rï¼ˆçº¢ï¼‰ï¼Œä¸matlabä¸­çš„RGBæ­£å¥½ç›¸åã€‚</p><p> è¿™é‡Œåˆ›å»ºçŸ©é˜µæ—¶æœªæŒ‡å®šçŸ©é˜µçš„å€¼ï¼Œå‘ç°é»˜è®¤å€¼çš„å¤§å°ä¸º205.</p></li><li><p>æŒ‡å®šçŸ©é˜µå¤§å°ï¼ŒæŒ‡å®šæ•°æ®ç±»å‹ï¼Œè®¾ç½®åˆå§‹å€¼ï¼š</p> <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Mat <span class="title function_">image1</span><span class="params">(<span class="number">100</span>,<span class="number">100</span>,CV_8U, <span class="number">100</span>)</span>;</span><br></pre></td></tr></table></figure><p> è¿™é‡ŒåŒ…å«å››ä¸ªå‚æ•°ï¼šçŸ©é˜µè¡Œæ•°ï¼ŒçŸ©é˜µåˆ—æ•°ï¼Œæ•°æ®ç±»å‹ï¼Œåˆå§‹å€¼ï¼›<br> å¯¹äºç°åº¦å›¾åƒï¼šå¯ä»¥ç›´æ¥ç»™å‡ºåˆå§‹å€¼ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Scalarï¼ˆï¼‰ï¼›</p> <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> Mat <span class="title function_">image1</span><span class="params">(<span class="number">100</span>,<span class="number">100</span>,CV_8U, <span class="number">100</span>)</span>;</span><br><span class="line">Mat <span class="title function_">image1</span><span class="params">(<span class="number">100</span>,<span class="number">100</span>,CV_8U, Scalar(<span class="number">100</span>))</span>;<span class="comment">//Scalar:æ ‡é‡</span></span><br></pre></td></tr></table></figure><p> å¯¹äºä¸‰é€šé“å›¾åƒï¼šä½¿ç”¨Scalarï¼ˆï¼‰ï¼›</p> <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Mat <span class="title function_">image1</span><span class="params">(<span class="number">100</span>,<span class="number">100</span>,CV_8UC3, Scalar(<span class="number">100</span>,<span class="number">100</span>,<span class="number">100</span>))</span>;</span><br></pre></td></tr></table></figure></li></ol><h3 id="è·å–å›¾åƒä¿¡æ¯"><a href="#è·å–å›¾åƒä¿¡æ¯" class="headerlink" title="è·å–å›¾åƒä¿¡æ¯"></a>è·å–å›¾åƒä¿¡æ¯</h3><p>è·å–å›¾åƒçš„å®½åº¦ï¼ˆåˆ—æ•°ï¼‰ï¼Œé«˜åº¦ï¼ˆè¡Œæ•°ï¼‰ï¼Œå°ºå¯¸å’Œé€šé“æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line">using namespace cv;</span><br><span class="line">using namespace <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">Mat image1 = imread(<span class="string">&quot;lena.png&quot;</span>);  <span class="comment">//è¯»å–å›¾åƒï¼›</span></span><br><span class="line"><span class="keyword">if</span> (image1.empty())</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;è¯»å–é”™è¯¯&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">imshow(<span class="string">&quot;image1&quot;</span>, image1);  <span class="comment">//æ˜¾ç¤ºå›¾åƒï¼›</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;å›¾åƒçš„è¡Œæ•°ä¸ºï¼š &quot;</span> &lt;&lt; image1.rows &lt;&lt; <span class="built_in">endl</span>;  <span class="comment">//è·å–å›¾åƒçš„é«˜åº¦ï¼Œè¡Œæ•°ï¼›</span></span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;å›¾åƒçš„åˆ—æ•°ä¸ºï¼š &quot;</span> &lt;&lt; image1.cols &lt;&lt; <span class="built_in">endl</span>;  <span class="comment">//è·å–å›¾åƒçš„å®½åº¦ï¼Œåˆ—æ•°ï¼›</span></span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;å›¾åƒçš„é€šé“æ•°ä¸ºï¼š &quot;</span> &lt;&lt; image1.channels() &lt;&lt; <span class="built_in">endl</span>;  <span class="comment">//è·å–å›¾åƒçš„é€šé“æ•°ï¼Œå½©è‰²å›¾=3ï¼Œç°åº¦å›¾=1ï¼›</span></span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;å›¾åƒçš„å°ºå¯¸ä¸ºï¼š &quot;</span> &lt;&lt; image1.size &lt;&lt; <span class="built_in">endl</span>;  <span class="comment">//è·å–å›¾åƒçš„å°ºå¯¸ï¼Œè¡Œ*åˆ—ï¼›</span></span><br><span class="line"></span><br><span class="line">waitKey(<span class="number">0</span>);  <span class="comment">//æš‚åœï¼Œä¿æŒå›¾åƒæ˜¾ç¤ºï¼Œç­‰å¾…æŒ‰é”®ç»“æŸ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è¾“å‡º</strong></p><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.64dm9cq5y1.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.64dm9cq5y1.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div><h3 id="æ„Ÿå…´è¶£åŒºåŸŸ"><a href="#æ„Ÿå…´è¶£åŒºåŸŸ" class="headerlink" title="æ„Ÿå…´è¶£åŒºåŸŸ"></a>æ„Ÿå…´è¶£åŒºåŸŸ</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line">using namespace cv;</span><br><span class="line">using namespace <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">Mat image1 = imread(<span class="string">&quot;fire.jpg&quot;</span>);  <span class="comment">//è¯»å–å›¾åƒï¼›</span></span><br><span class="line"><span class="keyword">if</span> (image1.empty())</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;è¯»å–é”™è¯¯&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">imshow(<span class="string">&quot;image1&quot;</span>, image1);  <span class="comment">//æ˜¾ç¤ºå›¾åƒï¼›</span></span><br><span class="line"></span><br><span class="line">Mat <span class="title function_">imageROI</span><span class="params">(image1, Rect(<span class="number">0</span>, <span class="number">0</span>, <span class="number">10</span>, <span class="number">10</span>))</span>;  <span class="comment">//å®šä¹‰æ„Ÿå…´è¶£åŒºåŸŸ</span></span><br><span class="line"></span><br><span class="line">waitKey(<span class="number">0</span>);  <span class="comment">//æš‚åœï¼Œä¿æŒå›¾åƒæ˜¾ç¤ºï¼Œç­‰å¾…æŒ‰é”®ç»“æŸ</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­Rectï¼ˆï¼‰æœ‰å››ä¸ªå‚æ•°ï¼ŒRectï¼ˆa,b,c,dï¼‰:</p><ul><li>aï¼šæ„Ÿå…´è¶£åŒºåŸŸåˆ—(cols)çš„èµ·ç‚¹ï¼›</li><li>bï¼šæ„Ÿå…´è¶£åŒºåŸŸè¡Œ(rows)çš„èµ·ç‚¹ï¼›</li><li>cï¼šæ„Ÿå…´è¶£åŒºåŸŸçš„åˆ—æ•°(cols)ï¼›</li><li>dï¼šæ„Ÿå…´è¶£åŒºåŸŸçš„è¡Œæ•°(rows)ï¼›</li></ul><h3 id="é€šè¿‡é¼ æ ‡ç‚¹å‡»æ“ä½œè·å–å›¾åƒçš„åƒç´ åæ ‡å’Œåƒç´ å€¼"><a href="#é€šè¿‡é¼ æ ‡ç‚¹å‡»æ“ä½œè·å–å›¾åƒçš„åƒç´ åæ ‡å’Œåƒç´ å€¼" class="headerlink" title="é€šè¿‡é¼ æ ‡ç‚¹å‡»æ“ä½œè·å–å›¾åƒçš„åƒç´ åæ ‡å’Œåƒç´ å€¼"></a>é€šè¿‡é¼ æ ‡ç‚¹å‡»æ“ä½œè·å–å›¾åƒçš„åƒç´ åæ ‡å’Œåƒç´ å€¼</h3><h4 id="åˆ›å»ºé¼ æ ‡æ“ä½œå‡½æ•°çš„å¤´æ–‡ä»¶"><a href="#åˆ›å»ºé¼ æ ‡æ“ä½œå‡½æ•°çš„å¤´æ–‡ä»¶" class="headerlink" title="åˆ›å»ºé¼ æ ‡æ“ä½œå‡½æ•°çš„å¤´æ–‡ä»¶"></a>åˆ›å»ºé¼ æ ‡æ“ä½œå‡½æ•°çš„å¤´æ–‡ä»¶</h4><details open><summary pointer> onMouse.h </summary>              <div class='content'>              <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line">using namespace cv;</span><br><span class="line">using namespace <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">onMouse</span><span class="params">(<span class="type">int</span> event, <span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> flags, <span class="type">void</span>* param)</span>;  <span class="comment">//evnet:é¼ æ ‡äº‹ä»¶ç±»å‹ x,y:é¼ æ ‡åæ ‡ flagsï¼šé¼ æ ‡å“ªä¸ªé”®</span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">onMouse</span><span class="params">(<span class="type">int</span> event, <span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> flags, <span class="type">void</span>* param)</span>  <span class="comment">//evnet:é¼ æ ‡äº‹ä»¶ç±»å‹ x,y:é¼ æ ‡åæ ‡ flagsï¼šé¼ æ ‡å“ªä¸ªé”®</span></span><br><span class="line">&#123;</span><br><span class="line">Mat* im = reinterpret_cast&lt;Mat*&gt;(param);</span><br><span class="line"><span class="keyword">switch</span> (event) &#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> EVENT_LBUTTONDOWN:</span><br><span class="line"><span class="comment">//æ˜¾ç¤ºå›¾åƒåƒç´ å€¼</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (static_cast&lt;<span class="type">int</span>&gt;(im-&gt;channels()) == <span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//è‹¥å›¾åƒä¸ºå•é€šé“å›¾åƒï¼Œåˆ™æ˜¾ç¤ºé¼ æ ‡ç‚¹å‡»çš„åæ ‡ä»¥åŠç°åº¦å€¼</span></span><br><span class="line"><span class="keyword">switch</span> (im-&gt;type())</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;at (&quot;</span> &lt;&lt; x &lt;&lt; <span class="string">&quot;, &quot;</span> &lt;&lt; y &lt;&lt; <span class="string">&quot; ) value is: &quot;</span> &lt;&lt; static_cast&lt;<span class="type">int</span>&gt;(im-&gt;at&lt;uchar&gt;(Point(x, y))) &lt;&lt; <span class="built_in">endl</span>; <span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;at (&quot;</span> &lt;&lt; x &lt;&lt; <span class="string">&quot;, &quot;</span> &lt;&lt; y &lt;&lt; <span class="string">&quot; ) value is: &quot;</span> &lt;&lt; static_cast&lt;<span class="type">int</span>&gt;(im-&gt;at&lt;<span class="type">char</span>&gt;(Point(x, y))) &lt;&lt; <span class="built_in">endl</span>; <span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;at (&quot;</span> &lt;&lt; x &lt;&lt; <span class="string">&quot;, &quot;</span> &lt;&lt; y &lt;&lt; <span class="string">&quot; ) value is: &quot;</span> &lt;&lt; static_cast&lt;<span class="type">int</span>&gt;(im-&gt;at&lt;ushort&gt;(Point(x, y))) &lt;&lt; <span class="built_in">endl</span>; <span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;at (&quot;</span> &lt;&lt; x &lt;&lt; <span class="string">&quot;, &quot;</span> &lt;&lt; y &lt;&lt; <span class="string">&quot; ) value is: &quot;</span> &lt;&lt; static_cast&lt;<span class="type">int</span>&gt;(im-&gt;at&lt;<span class="type">short</span>&gt;(Point(x, y))) &lt;&lt; <span class="built_in">endl</span>; <span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;at (&quot;</span> &lt;&lt; x &lt;&lt; <span class="string">&quot;, &quot;</span> &lt;&lt; y &lt;&lt; <span class="string">&quot; ) value is: &quot;</span> &lt;&lt; static_cast&lt;<span class="type">int</span>&gt;(im-&gt;at&lt;<span class="type">int</span>&gt;(Point(x, y))) &lt;&lt; <span class="built_in">endl</span>; <span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;at (&quot;</span> &lt;&lt; x &lt;&lt; <span class="string">&quot;, &quot;</span> &lt;&lt; y &lt;&lt; <span class="string">&quot; ) value is: &quot;</span> &lt;&lt; static_cast&lt;<span class="type">int</span>&gt;(im-&gt;at&lt;<span class="type">float</span>&gt;(Point(x, y))) &lt;&lt; <span class="built_in">endl</span>; <span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;at (&quot;</span> &lt;&lt; x &lt;&lt; <span class="string">&quot;, &quot;</span> &lt;&lt; y &lt;&lt; <span class="string">&quot; ) value is: &quot;</span> &lt;&lt; static_cast&lt;<span class="type">int</span>&gt;(im-&gt;at&lt;<span class="type">double</span>&gt;(Point(x, y))) &lt;&lt; <span class="built_in">endl</span>; <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//è‹¥å›¾åƒä¸ºå½©è‰²å›¾åƒï¼Œåˆ™æ˜¾ç¤ºé¼ æ ‡ç‚¹å‡»åæ ‡ä»¥åŠå¯¹åº”çš„B, G, Rå€¼</span></span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;at (&quot;</span> &lt;&lt; x &lt;&lt; <span class="string">&quot;, &quot;</span> &lt;&lt; y &lt;&lt; <span class="string">&quot;)&quot;</span></span><br><span class="line">&lt;&lt; <span class="string">&quot;  B value is: &quot;</span> &lt;&lt; static_cast&lt;<span class="type">int</span>&gt;(im-&gt;at&lt;Vec3b&gt;(Point(x, y))[<span class="number">0</span>])</span><br><span class="line">&lt;&lt; <span class="string">&quot;  G value is: &quot;</span> &lt;&lt; static_cast&lt;<span class="type">int</span>&gt;(im-&gt;at&lt;Vec3b&gt;(Point(x, y))[<span class="number">1</span>])</span><br><span class="line">&lt;&lt; <span class="string">&quot;  R value is: &quot;</span> &lt;&lt; static_cast&lt;<span class="type">int</span>&gt;(im-&gt;at&lt;Vec3b&gt;(Point(x, y))[<span class="number">2</span>])</span><br><span class="line">&lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//setMouseCallback(&quot;image1&quot;, onMouse, reinterpret_cast&lt;void*&gt;(&amp;image1)); //å…³è”å›¾åƒæ˜¾ç¤ºçª—å£å’ŒonMouseå‡½æ•°</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//Matæ¯ä¸ªæ ¼å­å†…çš„æ•°æ®æ ¼å¼---------- - Matå®šä¹‰</span></span><br><span class="line"><span class="comment">//Mat_&lt;uchar&gt;-------- - CV_8Uï¼ˆ0-255ï¼‰</span></span><br><span class="line"><span class="comment">//Mat&lt;char&gt;---------- - CV_8Sï¼ˆ-128-127ï¼‰</span></span><br><span class="line"><span class="comment">//Nat_&lt;short&gt;-------- - CV_16Sï¼ˆ-32768-32767ï¼‰</span></span><br><span class="line"><span class="comment">//Mat_&lt;ushort&gt;--------CV_16Uï¼ˆ0-65535ï¼‰</span></span><br><span class="line"><span class="comment">//Mat_&lt;int&gt;---------- - CV_32Sï¼ˆ-2147483648-2147483647ï¼‰</span></span><br><span class="line"><span class="comment">//Mat_&lt;float&gt;----------CV_32Fï¼ˆ-FLT_MAXâ€¦FLT_MAXï¼ŒINFï¼ŒNANï¼‰</span></span><br><span class="line"><span class="comment">//Mat_&lt;double&gt;--------CV_64Fï¼ˆ-DBL_MAXâ€¦DBL_MAXï¼ŒINFï¼ŒNANï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Matæ•°æ®ç±»å‹å’Œé€šé“å¯¹åº”çš„type()</span></span><br><span class="line"><span class="comment">//              C1          C2          C3          C4</span></span><br><span class="line"><span class="comment">//CV_8U         0           8           16          24</span></span><br><span class="line"><span class="comment">//CV_8S         1           9           17          25</span></span><br><span class="line"><span class="comment">//CV_16U        2          10           18          26</span></span><br><span class="line"><span class="comment">//CV_16S        3          11           19          27</span></span><br><span class="line"><span class="comment">//CV_32S        4          12           20          28</span></span><br><span class="line"><span class="comment">//CV_32F        5          13           21          29</span></span><br><span class="line"><span class="comment">//CV_64F        6          14           22          30</span></span><br></pre></td></tr></table></figure>              </div>            </details><h4 id="ä¸»å‡½æ•°"><a href="#ä¸»å‡½æ•°" class="headerlink" title="ä¸»å‡½æ•°"></a>ä¸»å‡½æ•°</h4><details open><summary pointer>  </summary>              <div class='content'>              <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;onMouse.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">using namespace cv;</span><br><span class="line">using namespace <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">Mat image1 = imread(<span class="string">&quot;fire.jpg&quot;</span>);  <span class="comment">//è¯»å–å›¾åƒï¼›</span></span><br><span class="line"><span class="keyword">if</span> (image1.empty())</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;è¯»å–é”™è¯¯&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line">imshow(<span class="string">&quot;image1&quot;</span>, image1);  <span class="comment">//æ˜¾ç¤ºå›¾åƒï¼›</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">setMouseCallback(<span class="string">&quot;image1&quot;</span>, onMouse, reinterpret_cast&lt;<span class="type">void</span>*&gt;(&amp;image1)); <span class="comment">//å…³è”å›¾åƒæ˜¾ç¤ºçª—å£å’ŒonMouseå‡½æ•°</span></span><br><span class="line">waitKey(<span class="number">0</span>);  <span class="comment">//æš‚åœï¼Œä¿æŒå›¾åƒæ˜¾ç¤ºï¼Œç­‰å¾…æŒ‰é”®ç»“æŸ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>              </div>            </details><p><strong>æ•ˆæœ</strong></p><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.6f0g2iecfm.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.6f0g2iecfm.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div><h3 id="è®¿é—®å›¾åƒåƒç´ "><a href="#è®¿é—®å›¾åƒåƒç´ " class="headerlink" title="è®¿é—®å›¾åƒåƒç´ "></a>è®¿é—®å›¾åƒåƒç´ </h3><h4 id="è®¿é—®ï¼ˆj-iï¼‰å¤„åƒç´ "><a href="#è®¿é—®ï¼ˆj-iï¼‰å¤„åƒç´ " class="headerlink" title="è®¿é—®ï¼ˆj,iï¼‰å¤„åƒç´ "></a>è®¿é—®ï¼ˆj,iï¼‰å¤„åƒç´ </h4><p>ä»¥8ä½ï¼ˆ0~255ï¼‰ç°åº¦å›¾åƒå’ŒBGRå½©è‰²å›¾åƒä¸ºä¾‹ï¼Œç”¨atå¯ä»¥è®¿é—®å›¾åƒåƒç´ ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç°åº¦å›¾åƒï¼š</span></span><br><span class="line">image.at&lt;uchar&gt;(j, i) <span class="comment">//jä¸ºè¡Œæ•°ï¼Œiä¸ºåˆ—æ•°</span></span><br><span class="line"><span class="comment">//BGRå½©è‰²å›¾åƒ</span></span><br><span class="line">image.at&lt;Vec3b&gt;(j, i)[<span class="number">0</span>] <span class="comment">//Båˆ†é‡</span></span><br><span class="line">image.at&lt;Vec3b&gt;(j, i)[<span class="number">1</span>] <span class="comment">//Gåˆ†é‡</span></span><br><span class="line">image.at&lt;Vec3b&gt;(j, i)[<span class="number">2</span>] <span class="comment">//Råˆ†é‡</span></span><br></pre></td></tr></table></figure><p><strong>ä¾‹:</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line">using namespace cv;</span><br><span class="line">using namespace <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">Mat image1 = imread(<span class="string">&quot;fire.jpg&quot;</span>);  <span class="comment">//è¯»å–å›¾åƒï¼›</span></span><br><span class="line">imshow(<span class="string">&quot;image1&quot;</span>, image1);  <span class="comment">//æ˜¾ç¤ºå›¾åƒï¼›</span></span><br><span class="line"><span class="type">int</span> i = <span class="number">50</span>, j = <span class="number">50</span>;</span><br><span class="line"><span class="type">int</span> b = image1.at&lt;Vec3b&gt;(j, i)[<span class="number">0</span>];</span><br><span class="line"><span class="type">int</span> g = image1.at&lt;Vec3b&gt;(j, i)[<span class="number">1</span>];</span><br><span class="line"><span class="type">int</span> r = image1.at&lt;Vec3b&gt;(j, i)[<span class="number">2</span>];</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;å›¾åƒè¯¥ç‚¹çš„åƒç´ (BGR):&quot;</span>&lt;&lt;b&lt;&lt;<span class="string">&quot;,&quot;</span> &lt;&lt; g &lt;&lt; <span class="string">&quot;,&quot;</span> &lt;&lt; r &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">waitKey(<span class="number">0</span>);  </span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è¾“å‡º:</strong></p><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.7p22d7s7r.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.7p22d7s7r.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div><h4 id="åœ¨å›¾åƒä¸­åŠ å…¥ç™½è‰²æ¤’ç›å™ªå£°"><a href="#åœ¨å›¾åƒä¸­åŠ å…¥ç™½è‰²æ¤’ç›å™ªå£°" class="headerlink" title="åœ¨å›¾åƒä¸­åŠ å…¥ç™½è‰²æ¤’ç›å™ªå£°"></a>åœ¨å›¾åƒä¸­åŠ å…¥ç™½è‰²æ¤’ç›å™ªå£°</h4><h5 id="åˆ›å»ºSaltå¤´æ–‡ä»¶"><a href="#åˆ›å»ºSaltå¤´æ–‡ä»¶" class="headerlink" title="åˆ›å»ºSaltå¤´æ–‡ä»¶"></a>åˆ›å»ºSaltå¤´æ–‡ä»¶</h5><details open><summary pointer> Salt.h </summary>              <div class='content'>              <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;random&gt;</span>  <span class="comment">//éšæœºæ•°å¤´æ–‡ä»¶</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">using namespace cv;</span><br><span class="line">using namespace <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Salt</span><span class="params">(Mat image, <span class="type">int</span> n)</span>; <span class="comment">//nï¼šåŠ å…¥å™ªå£°ç‚¹æ•°</span></span><br></pre></td></tr></table></figure>              </div>            </details><h5 id="åˆ›å»ºSaltæºæ–‡ä»¶"><a href="#åˆ›å»ºSaltæºæ–‡ä»¶" class="headerlink" title="åˆ›å»ºSaltæºæ–‡ä»¶"></a>åˆ›å»ºSaltæºæ–‡ä»¶</h5><details open><summary pointer> Salt.cpp </summary>              <div class='content'>              <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Salt.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">Salt</span><span class="params">(Mat image, <span class="type">int</span> n)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//éšæœºæ•°ç”Ÿæˆå™¨</span></span><br><span class="line">default_random_engine generater;</span><br><span class="line">uniform_int_distribution&lt;<span class="type">int</span>&gt;randomRow(<span class="number">0</span>, image.rows - <span class="number">1</span>);</span><br><span class="line">uniform_int_distribution&lt;<span class="type">int</span>&gt;randomCol(<span class="number">0</span>, image.cols - <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> i, j;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; n; k++)</span><br><span class="line">&#123;</span><br><span class="line">i = randomCol(generater);</span><br><span class="line">j = randomRow(generater);</span><br><span class="line"><span class="keyword">if</span> (image.channels() == <span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">image.at&lt;uchar&gt;(j, i) = <span class="number">255</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (image.channels() == <span class="number">3</span>)</span><br><span class="line">&#123;</span><br><span class="line">image.at&lt;Vec3b&gt;(j, i)[<span class="number">0</span>] = <span class="number">255</span>;</span><br><span class="line">image.at&lt;Vec3b&gt;(j, i)[<span class="number">1</span>] = <span class="number">255</span>;</span><br><span class="line">image.at&lt;Vec3b&gt;(j, i)[<span class="number">2</span>] = <span class="number">255</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>              </div>            </details><h5 id="main"><a href="#main" class="headerlink" title="main"></a>main</h5><details open><summary pointer> main.cpp </summary>              <div class='content'>              <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;Salt.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">using namespace cv;</span><br><span class="line">using namespace <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123; </span><br><span class="line"></span><br><span class="line">Mat image1 = imread(<span class="string">&quot;lena.png&quot;</span>);  <span class="comment">//è¯»å–å›¾åƒï¼›</span></span><br><span class="line"><span class="keyword">if</span> (image1.empty())</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;è¯»å–é”™è¯¯&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line">imshow(<span class="string">&quot;image1&quot;</span>, image1);  <span class="comment">//æ˜¾ç¤ºåŸå›¾åƒï¼›</span></span><br><span class="line"></span><br><span class="line">Salt(image1, <span class="number">5000</span>); <span class="comment">//åŠ å…¥5000ä¸ªå™ªå£°ç‚¹</span></span><br><span class="line">imshow(<span class="string">&quot;image2&quot;</span>, image1);  <span class="comment">//æ˜¾ç¤ºå™ªå£°å›¾åƒï¼›</span></span><br><span class="line"></span><br><span class="line">waitKey(<span class="number">0</span>);  <span class="comment">//æš‚åœï¼Œä¿æŒå›¾åƒæ˜¾ç¤ºï¼Œç­‰å¾…æŒ‰é”®ç»“æŸ</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>              </div>            </details><p><strong>æ•ˆæœ</strong></p><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.231muzt7o0.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.231muzt7o0.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div><h3 id="éå†å›¾åƒåƒç´ "><a href="#éå†å›¾åƒåƒç´ " class="headerlink" title="éå†å›¾åƒåƒç´ "></a>éå†å›¾åƒåƒç´ </h3><h4 id="æŒ‡é’ˆæ‰«æ"><a href="#æŒ‡é’ˆæ‰«æ" class="headerlink" title="æŒ‡é’ˆæ‰«æ"></a>æŒ‡é’ˆæ‰«æ</h4><p>ä»¥ä¸‹é¢æ¨¡æ¿å¯¹å›¾åƒè¿›è¡Œæ‰«æè¿ç®—ä¸ºä¾‹ï¼š</p><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.2h82lv6z7m.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.2h82lv6z7m.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line">using namespace cv;</span><br><span class="line">using namespace <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123; </span><br><span class="line">Mat image1, output_image;   <span class="comment">//å®šä¹‰è¾“å…¥å›¾åƒå’Œè¾“å‡ºå›¾åƒ</span></span><br><span class="line">image1 = imread(<span class="string">&quot;lena.png&quot;</span>);  <span class="comment">//è¯»å–å›¾åƒï¼›</span></span><br><span class="line"><span class="keyword">if</span> (image1.empty())</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;è¯»å–é”™è¯¯&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line">output_image = Mat(image1.size(), image1.type());  <span class="comment">//å®šä¹‰è¾“å‡ºå›¾åƒå¤§å°</span></span><br><span class="line">output_image = image1.clone();   <span class="comment">//å…‹éš†åŸå›¾åƒç´ å€¼</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> rows = image1.rows;    <span class="comment">//åŸå›¾è¡Œæ•°</span></span><br><span class="line"><span class="type">int</span> stepx = image1.channels();   <span class="comment">//åŸå›¾é€šé“æ•°</span></span><br><span class="line"><span class="type">int</span> cols = (image1.cols) * image1.channels();  <span class="comment">//çŸ©é˜µæ€»åˆ—æ•°ï¼Œåœ¨BGRå½©è‰²å›¾åƒä¸­ï¼Œæ¯ä¸ªåƒç´ çš„BGRé€šé“æŒ‰é¡ºåºæ’åˆ—ï¼Œå› æ­¤æ€»åˆ—æ•°=åƒç´ å®½åº¦*é€šé“æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> row =<span class="number">1</span> ; row &lt; (rows - <span class="number">1</span>); row++)   <span class="comment">//å¯¹è¡Œéå†</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="type">const</span> uchar* previous = image1.ptr&lt;uchar&gt;(row - <span class="number">1</span>);  <span class="comment">//åŸå›¾ä¸Šä¸€è¡ŒæŒ‡é’ˆ</span></span><br><span class="line"><span class="type">const</span> uchar* current = image1.ptr&lt;uchar&gt;(row);       <span class="comment">//åŸå›¾å½“å‰è¡ŒæŒ‡é’ˆ</span></span><br><span class="line"><span class="type">const</span> uchar* next = image1.ptr&lt;uchar&gt;(row + <span class="number">1</span>);      <span class="comment">//åŸå›¾ä¸‹ä¸€è¡ŒæŒ‡é’ˆ</span></span><br><span class="line">uchar* output = output_image.ptr&lt;uchar&gt;(row);        <span class="comment">//è¾“å‡ºå›¾åƒå½“å‰è¡ŒæŒ‡é’ˆ</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> col = stepx; col &lt; (cols- stepx); col++)  <span class="comment">//å¯¹åˆ—éå†</span></span><br><span class="line">&#123;</span><br><span class="line">            <span class="comment">//å·ç§¯è®¡ç®—</span></span><br><span class="line">output[col] = saturate_cast&lt;uchar&gt;(<span class="number">5</span>*current[col] - (previous[col]+ current[col- stepx]+ current[col + stepx]+ next[col]));</span><br><span class="line"><span class="comment">//saturate_cast&lt;uchar&gt;(a)ï¼Œå½“aåœ¨0â€”255æ—¶è¾“å‡ºaï¼Œå½“aå°äº0è¾“å‡º0ï¼Œå½“aå¤§äº255è¾“å‡º255ï¼Œä¿è¯açš„å€¼åœ¨0~255ä¹‹é—´</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">imshow(<span class="string">&quot;image1&quot;</span>, image1);</span><br><span class="line">imshow(<span class="string">&quot;output_image&quot;</span>, output_image);</span><br><span class="line"></span><br><span class="line">waitKey(<span class="number">0</span>);  <span class="comment">//æš‚åœï¼Œä¿æŒå›¾åƒæ˜¾ç¤ºï¼Œç­‰å¾…æŒ‰é”®ç»“æŸ</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è¾“å‡º</strong></p><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.2a4uqfua0g.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.2a4uqfua0g.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div><p><strong>æŠŠå·ç§¯æ ¸ä¸­é—´æ”¹æˆ4ï¼š</strong><br><strong>è¾“å‡º</strong></p><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.8hg8qlrb43.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.8hg8qlrb43.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div><h4 id="opencvè‡ªå¸¦çš„å·ç§¯è¿ç®—ï¼šfilter2D"><a href="#opencvè‡ªå¸¦çš„å·ç§¯è¿ç®—ï¼šfilter2D" class="headerlink" title="opencvè‡ªå¸¦çš„å·ç§¯è¿ç®—ï¼šfilter2D"></a>opencvè‡ªå¸¦çš„å·ç§¯è¿ç®—ï¼šfilter2D</h4><p>ä¸Šé¢çš„æ–¹æ³•å¯ä»¥ç®€åŒ–ä¸º:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;opencv2/opencv.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line">using namespace cv;</span><br><span class="line">using namespace <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123; </span><br><span class="line">Mat image1, output_image;   <span class="comment">//å®šä¹‰è¾“å…¥å›¾åƒå’Œè¾“å‡ºå›¾åƒ</span></span><br><span class="line">image1 = imread(<span class="string">&quot;lena.png&quot;</span>);  <span class="comment">//è¯»å–å›¾åƒï¼›</span></span><br><span class="line"><span class="keyword">if</span> (image1.empty())</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;è¯»å–é”™è¯¯&quot;</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Mat kernel = (Mat_&lt;<span class="type">char</span>&gt;(<span class="number">3</span>,<span class="number">3</span>) &lt;&lt; <span class="number">0</span>, <span class="number">-1</span>, <span class="number">0</span>, <span class="number">-1</span>, <span class="number">5</span>, <span class="number">-1</span>, <span class="number">0</span>, <span class="number">-1</span>, <span class="number">0</span>);  <span class="comment">//åˆ›å»ºæ»¤æ³¢å™¨</span></span><br><span class="line">filter2D(image1, output_image, image1.depth(), kernel);  <span class="comment">//å·ç§¯</span></span><br><span class="line"></span><br><span class="line">imshow(<span class="string">&quot;image1&quot;</span>, image1);</span><br><span class="line">imshow(<span class="string">&quot;output_image&quot;</span>, output_image);</span><br><span class="line"></span><br><span class="line">waitKey(<span class="number">0</span>);  <span class="comment">//æš‚åœï¼Œä¿æŒå›¾åƒæ˜¾ç¤ºï¼Œç­‰å¾…æŒ‰é”®ç»“æŸ</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨filter2Då‡½æ•°ä¸­ï¼Œimage1.depth()æ˜¯ç”¨æ¥è·å–å›¾åƒimage1çš„æ·±åº¦ï¼ˆdepthï¼‰ä¿¡æ¯çš„å‡½æ•°è°ƒç”¨ã€‚</p><p>å›¾åƒçš„æ·±åº¦è¡¨ç¤ºå›¾åƒä¸­æ¯ä¸ªåƒç´ å€¼çš„æ•°æ®ç±»å‹ã€‚åœ¨OpenCVä¸­ï¼Œå¸¸è§çš„å›¾åƒæ·±åº¦åŒ…æ‹¬ï¼š</p><ul><li>CV_8Uï¼š8ä½æ— ç¬¦å·æ•´æ•°ï¼ˆå³Unsigned charï¼‰ï¼Œå¯¹åº”äºç°åº¦å›¾åƒçš„æ·±åº¦</li><li>CV_16Uï¼š16ä½æ— ç¬¦å·æ•´æ•°</li><li>CV_16Sï¼š16ä½æœ‰ç¬¦å·æ•´æ•°</li><li>CV_32Sï¼š32ä½æœ‰ç¬¦å·æ•´æ•°</li><li>CV_32Fï¼š32ä½æµ®ç‚¹æ•°</li><li>CV_64Fï¼š64ä½æµ®ç‚¹æ•°</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;å‰é¢ä¸€éƒ¨åˆ†ç¬”è®°éƒ½æ˜¯å­¦ä¹ ä¸€ä¸ªå¤§ä½¬çš„æ•™ç¨‹åšçš„ï¼Œä½†æ˜¯å¤§ä½¬ç”¨çš„pythonï¼Œæˆ‘åœ¨ç¬”è®°é‡Œéƒ½è½¬æ¢æˆäº†c++&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;åŸºç¡€é…ç½®&quot;&gt;&lt;a href=&quot;#åŸºç¡€é…ç½®&quot; class=&quot;headerlink&quot; title=&quot;åŸºç¡€</summary>
      
    
    
    
    <category term="æ™ºèƒ½è½¦" scheme="http://tumytime.github.io/categories/%E6%99%BA%E8%83%BD%E8%BD%A6/"/>
    
    
    <category term="Python" scheme="http://tumytime.github.io/tags/Python/"/>
    
    <category term="æ™ºèƒ½è½¦" scheme="http://tumytime.github.io/tags/%E6%99%BA%E8%83%BD%E8%BD%A6/"/>
    
    <category term="å›¾åƒå¤„ç†" scheme="http://tumytime.github.io/tags/%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/"/>
    
    <category term="OpenCV" scheme="http://tumytime.github.io/tags/OpenCV/"/>
    
  </entry>
  
  <entry>
    <title>cè¯­è¨€è®¡ç®—æœºäºŒçº§ç¬”è®°</title>
    <link href="http://tumytime.github.io/2024/03/23/c%E8%AF%AD%E8%A8%80%E8%AE%A1%E7%AE%97%E6%9C%BA%E4%BA%8C%E7%BA%A7%E7%AC%94%E8%AE%B0/"/>
    <id>http://tumytime.github.io/2024/03/23/c%E8%AF%AD%E8%A8%80%E8%AE%A1%E7%AE%97%E6%9C%BA%E4%BA%8C%E7%BA%A7%E7%AC%94%E8%AE%B0/</id>
    <published>2024-03-23T08:39:11.000Z</published>
    <updated>2024-03-25T03:50:05.109Z</updated>
    
    <content type="html"><![CDATA[<h2 id="è®¡ç®—æœºç³»ç»Ÿ"><a href="#è®¡ç®—æœºç³»ç»Ÿ" class="headerlink" title="è®¡ç®—æœºç³»ç»Ÿ"></a>è®¡ç®—æœºç³»ç»Ÿ</h2><h3 id="E-Rå®ä½“è”ç³»"><a href="#E-Rå®ä½“è”ç³»" class="headerlink" title="E-Rå®ä½“è”ç³»"></a>E-Rå®ä½“è”ç³»</h3><ol><li><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.2krogi3z4f.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.2krogi3z4f.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div> çŸ©å½¢è¡¨ç¤ºå®ä½“ï¼Œè±å½¢è¡¨ç¤ºå®ä½“ä¹‹é—´çš„è”ç³»</li><li>åœ¨å…³ç³»æ•°æ®åº“ä¸­ï¼Œç”¨äºè¡¨ç¤ºå®ä½“é—´è”ç³»çš„æ˜¯<strong>äºŒç»´è¡¨</strong></li><li>å°†E-Rå›¾è½¬æ¢ä¸ºå…³ç³»æ¨¡å¼æ—¶ï¼Œå®ä½“å’Œè”ç³»éƒ½å¯ä»¥è¡¨ç¤ºä¸º<strong>å…³ç³»</strong>(å…³ç³»å°±æ˜¯äºŒç»´è¡¨)</li><li><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.969i7jl0dn.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.969i7jl0dn.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div></li><li></li></ol><p>å·²ç»è€ƒå®Œäº†ã€‚ã€‚ã€‚ã€‚ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;è®¡ç®—æœºç³»ç»Ÿ&quot;&gt;&lt;a href=&quot;#è®¡ç®—æœºç³»ç»Ÿ&quot; class=&quot;headerlink&quot; title=&quot;è®¡ç®—æœºç³»ç»Ÿ&quot;&gt;&lt;/a&gt;è®¡ç®—æœºç³»ç»Ÿ&lt;/h2&gt;&lt;h3 id=&quot;E-Rå®ä½“è”ç³»&quot;&gt;&lt;a href=&quot;#E-Rå®ä½“è”ç³»&quot; class=&quot;headerlink&quot; title=</summary>
      
    
    
    
    <category term="cè¯­è¨€" scheme="http://tumytime.github.io/categories/c%E8%AF%AD%E8%A8%80/"/>
    
    
    <category term="cè¯­è¨€" scheme="http://tumytime.github.io/tags/c%E8%AF%AD%E8%A8%80/"/>
    
    <category term="è®¡ç®—æœºäºŒçº§" scheme="http://tumytime.github.io/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E4%BA%8C%E7%BA%A7/"/>
    
  </entry>
  
  <entry>
    <title>æ”¶è—å¤¹</title>
    <link href="http://tumytime.github.io/2024/03/22/%E6%94%B6%E8%97%8F%E5%A4%B9/"/>
    <id>http://tumytime.github.io/2024/03/22/%E6%94%B6%E8%97%8F%E5%A4%B9/</id>
    <published>2024-03-22T11:54:52.000Z</published>
    <updated>2024-03-25T05:21:58.138Z</updated>
    
    <content type="html"><![CDATA[<h2 id="AI"><a href="#AI" class="headerlink" title="AI"></a>AI</h2><div class="tagLink"><a class="link-card" title="ä»å¤´å¼€å§‹å®ç°ä¸€ä¸ªç¥ç»ç½‘ç»œ" href="https://mp.weixin.qq.com/s/lk12kP2fbuSBSV5lSFKTlA"><span class="link-card-backdrop" style="background-image: url(https://picx.zhimg.com/80/v2-0b63b54fc59d235ad97530a98bc0e014_1440w.webp?source=2c26e567)"></span><div class="left"><img src="https://picx.zhimg.com/80/v2-0b63b54fc59d235ad97530a98bc0e014_1440w.webp?source=2c26e567" class="lazyload placeholder" data-srcset="https://picx.zhimg.com/80/v2-0b63b54fc59d235ad97530a98bc0e014_1440w.webp?source=2c26e567" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div><div class="right"><p class="text">ä»å¤´å¼€å§‹å®ç°ä¸€ä¸ªç¥ç»ç½‘ç»œ</p><p class="url">https://mp.weixin.qq.com/s/lk12kP2fbuSBSV5lSFKTlA</p></div></a></div><div class="tagLink"><a class="link-card" title="æ•°æ®å¤„ç†ä¹‹å½’ä¸€åŒ–ã€æ ‡å‡†åŒ–ã€æ­£åˆ™åŒ–" href="https://job.yanxishe.com/blogDetail/27604"><span class="link-card-backdrop" style="background-image: url(https://static.leiphone.com/uploads/new/sns/blogSpe/article/202110/616c488c9c69f.png)"></span><div class="left"><img src="https://static.leiphone.com/uploads/new/sns/blogSpe/article/202110/616c488c9c69f.png" class="lazyload placeholder" data-srcset="https://static.leiphone.com/uploads/new/sns/blogSpe/article/202110/616c488c9c69f.png" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div><div class="right"><p class="text">æ•°æ®å¤„ç†ä¹‹å½’ä¸€åŒ–ã€æ ‡å‡†åŒ–ã€æ­£åˆ™åŒ–</p><p class="url">https://job.yanxishe.com/blogDetail/27604</p></div></a></div><iframe src="//player.bilibili.com/player.html?aid=770444004&bvid=BV18r4y1M71J&cid=760424160&p=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe><iframe src="//player.bilibili.com/player.html?aid=541842600&bvid=BV1yi4y1g7ro&cid=227677652&p=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe><h2 id="å›¾åƒå¤„ç†"><a href="#å›¾åƒå¤„ç†" class="headerlink" title="å›¾åƒå¤„ç†"></a>å›¾åƒå¤„ç†</h2><details ><summary pointer> å­˜ä¸€ä¸‹åŒ…ç‰ˆæœ¬ </summary>              <div class='content'>              <p>(Paddle_Py3.12) C:\Users\lxcqm&gt;pip list<br>Package                 Version</p><hr><p>absl-py                 2.1.0<br>anyio                   4.3.0<br>archspec                0.2.3<br>astor                   0.8.1<br>astunparse              1.6.3<br>boltons                 23.1.1<br>Brotli                  1.0.9<br>certifi                 2024.2.2<br>cffi                    1.16.0<br>charset-normalizer      3.3.2<br>cloudpickle             3.0.0<br>cmake                   3.28.3<br>colorama                0.4.6<br>conda                   24.1.2<br>conda-libmamba-solver   24.1.0<br>conda-package-handling  2.2.0<br>conda_package_streaming 0.9.0<br>contourpy               1.2.0<br>cycler                  0.11.0<br>Cython                  3.0.9<br>decorator               5.1.1<br>distro                  1.9.0<br>filelock                3.13.1<br>flatbuffers             24.3.7<br>fonttools               4.25.0<br>gast                    0.5.4<br>google-pasta            0.2.0<br>grpcio                  1.62.1<br>gym                     0.26.2<br>gym-notices             0.0.8<br>h11                     0.14.0<br>h5py                    3.10.0<br>httpcore                1.0.4<br>httpx                   0.27.0<br>idna                    3.6<br>Jinja2                  3.1.3<br>joblib                  1.3.2<br>jsonpatch               1.33<br>jsonpointer             2.4<br>keras                   3.1.1<br>kiwisolver              1.4.4<br>libclang                18.1.1<br>libmambapy              1.5.7<br>mamba                   1.5.7<br>Markdown                3.6<br>markdown-it-py          3.0.0<br>MarkupSafe              2.1.5<br>matplotlib              3.8.0<br>mdurl                   0.1.2<br>menuinst                2.0.2<br>meson                   1.3.2<br>mkl-fft                 1.3.8<br>mkl-random              1.2.4<br>mkl-service             2.4.0<br>ml-dtypes               0.3.2<br>mpmath                  1.3.0<br>munkres                 1.1.4<br>namex                   0.0.7<br>nes_py                  8.2.1<br>networkx                3.2.1<br>numpy                   1.26.4<br>opencv-python           4.9.0.80<br>opt-einsum              3.3.0<br>optree                  0.10.0<br>packaging               23.1<br>paddlepaddle-gpu        2.6.0.post120<br>pandas                  2.2.1<br>pillow                  10.2.0<br>pip                     24.0<br>platformdirs            4.2.0<br>pluggy                  1.4.0<br>ply                     3.11<br>protobuf                4.25.2<br>pycocotools             2.0<br>pycosat                 0.6.6<br>pycparser               2.21<br>pyglet                  1.5.21<br>Pygments                2.17.2<br>pyparsing               3.0.9<br>PyQt5                   5.15.10<br>PyQt5-sip               12.13.0<br>PySocks                 1.7.1<br>python-dateutil         2.8.2<br>pytz                    2024.1<br>PyYAML                  6.0.1<br>requests                2.31.0<br>rich                    13.7.1<br>ruamel.yaml             0.18.6<br>ruamel.yaml.clib        0.2.8<br>scipy                   1.12.0<br>setuptools              69.1.1<br>sip                     6.7.12<br>six                     1.16.0<br>sniffio                 1.3.1<br>sympy                   1.12<br>tensorboard             2.16.2<br>tensorboard-data-server 0.7.2<br>tensorflow              2.16.1<br>tensorflow-intel        2.16.1<br>termcolor               2.4.0<br>threadpoolctl           3.3.0<br>torch                   2.2.1<br>torchaudio              2.2.1<br>torchvision             0.17.1<br>tornado                 6.3.3<br>tqdm                    4.66.2<br>truststore              0.8.0<br>typing_extensions       4.10.0<br>tzdata                  2024.1<br>urllib3                 2.2.1<br>Werkzeug                3.0.1<br>wheel                   0.43.0<br>win-inet-pton           1.1.0<br>wrapt                   1.16.0<br>zstandard               0.22.0</p>              </div>            </details>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;AI&quot;&gt;&lt;a href=&quot;#AI&quot; class=&quot;headerlink&quot; title=&quot;AI&quot;&gt;&lt;/a&gt;AI&lt;/h2&gt;&lt;div class=&quot;tagLink&quot;&gt;&lt;a class=&quot;link-card&quot; title=&quot;ä»å¤´å¼€å§‹å®ç°ä¸€ä¸ªç¥ç»ç½‘ç»œ&quot; href=&quot;http</summary>
      
    
    
    
    <category term="æ™ºèƒ½è½¦" scheme="http://tumytime.github.io/categories/%E6%99%BA%E8%83%BD%E8%BD%A6/"/>
    
    
    <category term="Python" scheme="http://tumytime.github.io/tags/Python/"/>
    
    <category term="æ·±åº¦å­¦ä¹ " scheme="http://tumytime.github.io/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="æ™ºèƒ½è½¦" scheme="http://tumytime.github.io/tags/%E6%99%BA%E8%83%BD%E8%BD%A6/"/>
    
    <category term="YoloV3" scheme="http://tumytime.github.io/tags/YoloV3/"/>
    
  </entry>
  
  <entry>
    <title>YoloV3æ¨¡å‹æ„å»º</title>
    <link href="http://tumytime.github.io/2024/03/21/YoloV3%E6%A8%A1%E5%9E%8B%E6%9E%84%E5%BB%BA/"/>
    <id>http://tumytime.github.io/2024/03/21/YoloV3%E6%A8%A1%E5%9E%8B%E6%9E%84%E5%BB%BA/</id>
    <published>2024-03-21T13:28:10.000Z</published>
    <updated>2024-03-21T15:34:27.534Z</updated>
    
    <content type="html"><![CDATA[<div class="tagLink"><a class="link-card" title="ã€yolov3è¯¦è§£ã€‘ä¸€æ–‡è®©ä½ è¯»æ‡‚yolov3ç›®æ ‡æ£€æµ‹åŸç†" href="https://blog.csdn.net/weixin_39615182/article/details/109752498"><span class="link-card-backdrop" style="background-image: url(https://tumytime.github.io/picx-images-hosting/image.7i057r983s.webp)"></span><div class="left"><img src="https://tumytime.github.io/picx-images-hosting/image.7i057r983s.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.7i057r983s.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div><div class="right"><p class="text">ã€yolov3è¯¦è§£ã€‘ä¸€æ–‡è®©ä½ è¯»æ‡‚yolov3ç›®æ ‡æ£€æµ‹åŸç†</p><p class="url">https://blog.csdn.net/weixin_39615182/article/details/109752498</p></div></a></div><p><strong>yolov3æ£€æµ‹åˆ†ä¸¤æ­¥ï¼š</strong><br>1ã€ç¡®å®šæ£€æµ‹å¯¹è±¡ä½ç½®<br>2ã€å¯¹æ£€æµ‹å¯¹è±¡åˆ†ç±»ï¼ˆæ˜¯ä»€ä¹ˆä¸œè¥¿ï¼‰<br>å³åœ¨è¯†åˆ«å›¾ç‰‡æ˜¯ä»€ä¹ˆçš„åŸºç¡€ä¸Šï¼Œè¿˜éœ€å®šä½è¯†åˆ«å¯¹è±¡çš„ä½ç½®ï¼Œå¹¶æ¡†å‡ºã€‚</p><p>æˆ‘ä»¬é¦–å…ˆä¸Šä¸€å¹…å›¾å®è§‚ç†è§£ä¸‹</p><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.7i057r983s.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.7i057r983s.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div><p>å›¾ä¸­çš„çº¢æ¡†æ˜¯é€šè¿‡åœ¨yolov3æ£€æµ‹æœ€åå¾—å‡ºçš„<strong>è¾¹ç•Œæ¡†</strong>ï¼ˆbounding boxï¼‰ï¼Œåˆå¦‚ä¸‹å›¾çš„é»„è‰²æ¡†ä¹Ÿæ˜¯è¾¹ç•Œæ¡†</p><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.7smz0wp6zw.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.7smz0wp6zw.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div><p>yolov3å¤„ç†å›¾ç‰‡è¿‡ç¨‹å¦‚ä¸‹</p><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.pf3lakvam.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.pf3lakvam.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div><p>é¦–å…ˆä¸€å¼ å›¾ç‰‡ä¼ è¿›yoloï¼Œyoloä¼šå°†å…¶è½¬åŒ–ä¸º416Ã—416å¤§å°çš„ç½‘æ ¼ï¼Œå¢åŠ ç°åº¦æ¡ç”¨äºé˜²æ­¢å¤±çœŸï¼Œä¹‹åå›¾ç‰‡ä¼šåˆ†æˆä¸‰ä¸ªç½‘æ ¼å›¾ç‰‡ï¼ˆ13Ã—13ï¼Œ26Ã—26ï¼Œ52Ã—52ï¼‰<br>ç”±äºå›¾åƒåœ¨å¤šæ¬¡å·ç§¯å‹ç¼©åï¼Œå°ç‰©ä½“çš„ç‰¹å¾å®¹æ˜“ä¸¢å¤±ï¼Œæ‰€ä»¥ç”¨52x52çš„ç½‘æ ¼æ£€æµ‹å°ç‰©ä½“ï¼Œç”±äºçŒ«å±äºå¤§ç‰©ä½“ï¼Œæ‰€ä»¥ç”¨13x13çš„ç½‘æ ¼æ£€æµ‹</p><h2 id="è¯¦ç»†è¿‡ç¨‹"><a href="#è¯¦ç»†è¿‡ç¨‹" class="headerlink" title="è¯¦ç»†è¿‡ç¨‹"></a>è¯¦ç»†è¿‡ç¨‹</h2><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.8ad0phujlt.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.8ad0phujlt.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div><p>å…ˆä¸Šæµç¨‹å›¾ï¼Œè¯¥å›¾æ˜¯åŸºäº<strong>vocæ•°æ®é›†</strong>è®²è§£çš„ï¼Œvocæ•°æ®é›†æœ‰20ä¸ªç±»åˆ«ï¼Œæœ€ä¸‹é¢çº¢æ¡†ä¸­(13ï¼Œ13ï¼Œ75)è¡¨ç¤ºé¢„æµ‹ç»“æœçš„shapeï¼Œå®é™…ä¸Šæ˜¯13,13,3Ã—25,è¡¨ç¤ºæœ‰13*13çš„ç½‘æ ¼ï¼Œæ¯ä¸ªç½‘æ ¼æœ‰3ä¸ªå…ˆéªŒæ¡†ï¼ˆåˆç§°é”šæ¡†ï¼Œanchorsï¼Œå…ˆéªŒæ¡†ä¸‹é¢æœ‰è§£é‡Šï¼‰ï¼Œæ¯ä¸ªå…ˆéªŒæ¡†æœ‰25ä¸ªå‚æ•°(20ä¸ªç±»åˆ«+5ä¸ªå‚æ•°)ï¼Œè¿™5ä¸ªå‚æ•°åˆ†åˆ«æ˜¯<strong>x_offset</strong>ã€<strong>y_offset</strong>ã€<strong>height</strong>ã€<strong>width</strong>ä¸<strong>ç½®ä¿¡åº¦confidence</strong>ï¼Œç”¨è¿™3ä¸ªæ¡†å»è¯•æ¢ï¼Œè¯•æ¢æ˜¯å¦æ¡†ä¸­æœ‰ç‰©ä½“ï¼Œå¦‚æœæœ‰ï¼Œå°±ä¼šæŠŠè¿™ä¸ªç‰©ä½“ç»™æ¡†èµ·æ¥ã€‚å¦‚æœæ˜¯åŸºäºcocoçš„æ•°æ®é›†å°±ä¼šæœ‰80ç§ç±»åˆ«ï¼Œæœ€åçš„ç»´åº¦åº”è¯¥ä¸º3x(80+5)&#x3D;255ï¼Œæœ€ä¸Šé¢ä¸¤ä¸ªé¢„æµ‹ç»“æœshapeåŒç†</p><p>yolov3ä¸»å¹²ç½‘ç»œä¸ºDarknet53ï¼Œé‡è¦çš„æ˜¯ä½¿ç”¨äº†<strong>æ®‹å·®ç½‘ç»œResidual</strong>ï¼Œdarknet53çš„æ¯ä¸€ä¸ªå·ç§¯éƒ¨åˆ†ä½¿ç”¨äº†ç‰¹æœ‰çš„<strong>DarknetConv2Dç»“æ„</strong>ï¼Œæ¯ä¸€æ¬¡å·ç§¯çš„æ—¶å€™è¿›è¡Œ<strong>l2æ­£åˆ™åŒ–</strong>ï¼Œå®Œæˆå·ç§¯åè¿›è¡Œ<strong>BatchNormalizationæ ‡å‡†åŒ–</strong>ä¸<strong>LeakyReLUæ¿€æ´»å‡½æ•°</strong></p><p>å¯¹åº”ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#--------------------------------------------------#</span></span><br><span class="line"><span class="comment">#   å•æ¬¡å·ç§¯</span></span><br><span class="line"><span class="comment">#--------------------------------------------------#</span></span><br><span class="line"><span class="meta">@wraps(<span class="params">Conv2D</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">DarknetConv2D</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">    darknet_conv_kwargs = &#123;<span class="string">&#x27;kernel_regularizer&#x27;</span>: l2(<span class="number">5e-4</span>)&#125;</span><br><span class="line">    darknet_conv_kwargs[<span class="string">&#x27;padding&#x27;</span>] = <span class="string">&#x27;valid&#x27;</span> <span class="keyword">if</span> kwargs.get(<span class="string">&#x27;strides&#x27;</span>)==(<span class="number">2</span>,<span class="number">2</span>) <span class="keyword">else</span> <span class="string">&#x27;same&#x27;</span></span><br><span class="line">    darknet_conv_kwargs.update(kwargs)</span><br><span class="line">    <span class="keyword">return</span> Conv2D(*args, **darknet_conv_kwargs)</span><br><span class="line"></span><br><span class="line"><span class="comment">#---------------------------------------------------#</span></span><br><span class="line"><span class="comment">#   å·ç§¯å—</span></span><br><span class="line"><span class="comment">#   DarknetConv2D + BatchNormalization + LeakyReLU</span></span><br><span class="line"><span class="comment">#---------------------------------------------------#</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">DarknetConv2D_BN_Leaky</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">    no_bias_kwargs = &#123;<span class="string">&#x27;use_bias&#x27;</span>: <span class="literal">False</span>&#125;</span><br><span class="line">    no_bias_kwargs.update(kwargs)</span><br><span class="line">    <span class="keyword">return</span> compose( </span><br><span class="line">        DarknetConv2D(*args, **no_bias_kwargs),<span class="comment">#è°ƒç”¨å•æ¬¡å·ç§¯å‡½æ•°è¿›è¡Œæ­£åˆ™åŒ–</span></span><br><span class="line">        BatchNormalization(),<span class="comment"># æ ‡å‡†åŒ–</span></span><br><span class="line">        LeakyReLU(alpha=<span class="number">0.1</span>))<span class="comment"># æ¿€æ´»å‡½æ•°</span></span><br></pre></td></tr></table></figure><details open><summary pointer> pythonè£…é¥°å™¨ </summary>              <div class='content'>              <p><strong>å°†å‡½æ•°ä½œä¸ºå‚æ•°ä¼ ç»™å¦ä¸€ä¸ªå‡½æ•°</strong></p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">hi</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hi yasoob!&quot;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">doSomethingBeforeHi</span>(<span class="params">func</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;I am doing some boring work before executing hi()&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(func())</span><br><span class="line"> </span><br><span class="line">doSomethingBeforeHi(hi)</span><br><span class="line"><span class="comment">#outputs:I am doing some boring work before executing hi()</span></span><br><span class="line"><span class="comment">#        hi yasoob!</span></span><br></pre></td></tr></table></figure><p>ç°åœ¨ä½ å·²ç»å…·å¤‡æ‰€æœ‰å¿…éœ€çŸ¥è¯†ï¼Œæ¥è¿›ä¸€æ­¥å­¦ä¹ è£…é¥°å™¨çœŸæ­£æ˜¯ä»€ä¹ˆäº†ã€‚è£…é¥°å™¨è®©ä½ åœ¨ä¸€ä¸ªå‡½æ•°çš„å‰åå»æ‰§è¡Œä»£ç ã€‚</p><p><strong>ä½ çš„ç¬¬ä¸€ä¸ªè£…é¥°å™¨</strong></p><p>åœ¨ä¸Šä¸€ä¸ªä¾‹å­é‡Œï¼Œå…¶å®æˆ‘ä»¬å·²ç»åˆ›å»ºäº†ä¸€ä¸ªè£…é¥°å™¨ï¼ç°åœ¨æˆ‘ä»¬ä¿®æ”¹ä¸‹ä¸Šä¸€ä¸ªè£…é¥°å™¨ï¼Œå¹¶ç¼–å†™ä¸€ä¸ªç¨å¾®æ›´æœ‰ç”¨ç‚¹çš„ç¨‹åºï¼š</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">a_new_decorator</span>(<span class="params">a_func</span>):</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wrapTheFunction</span>():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;I am doing some boring work before executing a_func()&quot;</span>)</span><br><span class="line"> </span><br><span class="line">        a_func()</span><br><span class="line"> </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;I am doing some boring work after executing a_func()&quot;</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> wrapTheFunction</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">a_function_requiring_decoration</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;I am the function which needs some decoration to remove my foul smell&quot;</span>)</span><br><span class="line"> </span><br><span class="line">a_function_requiring_decoration()</span><br><span class="line"><span class="comment">#outputs: &quot;I am the function which needs some decoration to remove my foul smell&quot;</span></span><br><span class="line"> </span><br><span class="line">a_function_requiring_decoration = a_new_decorator(a_function_requiring_decoration)</span><br><span class="line"><span class="comment">#now a_function_requiring_decoration is wrapped by wrapTheFunction()</span></span><br><span class="line"> </span><br><span class="line">a_function_requiring_decoration()</span><br><span class="line"><span class="comment">#outputs:I am doing some boring work before executing a_func()</span></span><br><span class="line"><span class="comment">#        I am the function which needs some decoration to remove my foul smell</span></span><br><span class="line"><span class="comment">#        I am doing some boring work after executing a_func()</span></span><br></pre></td></tr></table></figure><p>ä½ çœ‹æ˜ç™½äº†å—ï¼Ÿæˆ‘ä»¬åˆšåˆšåº”ç”¨äº†ä¹‹å‰å­¦ä¹ åˆ°çš„åŸç†ã€‚è¿™æ­£æ˜¯pythonä¸­è£…é¥°å™¨åšçš„äº‹æƒ…ï¼å®ƒä»¬å°è£…ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶ä¸”ç”¨è¿™æ ·æˆ–è€…é‚£æ ·çš„æ–¹å¼æ¥ä¿®æ”¹å®ƒçš„è¡Œä¸ºã€‚ç°åœ¨ä½ ä¹Ÿè®¸ç–‘æƒ‘ï¼Œæˆ‘ä»¬åœ¨ä»£ç é‡Œå¹¶æ²¡æœ‰ä½¿ç”¨<code>@</code>ç¬¦å·ï¼Ÿé‚£åªæ˜¯ä¸€ä¸ªç®€çŸ­çš„æ–¹å¼æ¥ç”Ÿæˆä¸€ä¸ªè¢«è£…é¥°çš„å‡½æ•°ã€‚è¿™é‡Œæ˜¯æˆ‘ä»¬å¦‚ä½•ä½¿ç”¨<code>@</code>æ¥è¿è¡Œä¹‹å‰çš„ä»£ç ï¼š</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@a_new_decorator</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">a_function_requiring_decoration</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Hey you! Decorate me!&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;I am the function which needs some decoration to &quot;</span></span><br><span class="line">          <span class="string">&quot;remove my foul smell&quot;</span>)</span><br><span class="line"> </span><br><span class="line">a_function_requiring_decoration()</span><br><span class="line"><span class="comment">#outputs: I am doing some boring work before executing a_func()</span></span><br><span class="line"><span class="comment">#         I am the function which needs some decoration to remove my foul smell</span></span><br><span class="line"><span class="comment">#         I am doing some boring work after executing a_func()</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#the @a_new_decorator is just a short way of saying:</span></span><br><span class="line">a_function_requiring_decoration = a_new_decorator(a_function_requiring_decoration)</span><br></pre></td></tr></table></figure>              </div>            </details><p>è®²è§£æµç¨‹ä¹‹å‰çš„<strong>åŸºæœ¬æ¦‚å¿µ</strong>äº†è§£ä¸€ä¸‹ï¼Œåé¢ä¸è®°å¾—å›æ¥å†çœ‹çœ‹</p><p><strong>x_offset</strong>ï¼šè¡¨ç¤ºç½‘æ ¼å·¦ä¸Šè§’ç›¸å¯¹xè½´çš„è·ç¦»ï¼ˆåç§»é‡ï¼‰<br><strong>y_offset</strong>ï¼šè¡¨ç¤ºç½‘æ ¼å·¦ä¸Šè§’ç›¸å¯¹yè½´çš„è·ç¦»ï¼ˆåç§»é‡ï¼‰</p><p><strong>ä¸Šé‡‡æ ·</strong>ï¼šç¼©å°å›¾åƒï¼ˆæˆ–ç§°ä¸ºä¸‹é‡‡æ ·ï¼ˆsubsampledï¼‰ï¼Œå¦‚æ± åŒ–ï¼‰çš„ä¸»è¦ç›®çš„æœ‰ä¸¤ä¸ªï¼š1ã€ä½¿å¾—å›¾åƒç¬¦åˆæ˜¾ç¤ºåŒºåŸŸçš„å¤§å°ï¼›2ã€ç”Ÿæˆå¯¹åº”å›¾åƒçš„ç¼©ç•¥å›¾ã€‚æ”¾å¤§å›¾åƒï¼ˆæˆ–ç§°ä¸ºä¸Šé‡‡æ ·ï¼ˆupSamplingï¼‰æˆ–å›¾åƒæ’å€¼ï¼ˆinterpolatingï¼‰ï¼‰çš„ä¸»è¦ç›®çš„æ˜¯æ”¾å¤§åŸå›¾åƒ,ä»è€Œå¯ä»¥æ˜¾ç¤ºåœ¨æ›´é«˜åˆ†è¾¨ç‡çš„æ˜¾ç¤ºè®¾å¤‡ä¸Šã€‚</p><p><strong>å…ˆéªŒæ¡†</strong>ï¼ˆanchor boxï¼‰ï¼šå°±æ˜¯å¸®åŠ©æˆ‘ä»¬å®šå¥½äº†å¸¸è§ç›®æ ‡çš„å®½å’Œé«˜ï¼Œåœ¨è¿›è¡Œé¢„æµ‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªå·²ç»å®šå¥½çš„å®½å’Œé«˜æ¥è¿›è¡Œå¤„ç†ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬è¿›è¡Œé¢„æµ‹ï¼Œä½œç”¨å°±æ˜¯è¾…åŠ©å¤„ç†x_offsetã€y_offsetã€hå’Œwã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œç”¨çš„æ˜¯cocoæ•°æ®é›†ï¼Œè¾“å‡ºæ˜¯(13,13,(80+5)*3)ï¼Œä¹˜3è¡¨ç¤ºï¼Œæœ‰3ä¸ªå…ˆéªŒæ¡†ï¼Œæ¯ä¸ªå…ˆéªŒæ¡†éƒ½æœ‰85ä¸ªå‚æ•°ï¼Œä¸‹å›¾å°±æœ‰3ä¸ªè“è‰²æ¡†ï¼Œä¹Ÿå³å…ˆéªŒæ¡†ï¼Œå¯ä»¥ç†è§£æˆç»™ä½ çš„å»ºè®®æ¡†ï¼Œè¯†åˆ«çš„å¯¹è±¡å¯èƒ½åœ¨è¿™äº›å»ºè®®æ¡†ä¸­ï¼Œç›®çš„æ˜¯å¸¦ä½ å¾—åˆ°æ›´é«˜çš„IOUï¼Œå³æ›´é«˜ç½®ä¿¡åº¦ã€æ›´å¯èƒ½æœ‰å¯¹è±¡å¾—éƒ¨åˆ†ï¼Œé»„è‰²æ¡†ä¸ºçœŸå®æœ€åæ˜¾ç¤ºçš„è¾¹ç•Œæ¡†ï¼Œçº¢è‰²æ¡†è¡¨ç¤ºä¸­å¿ƒä½ç½®ã€‚</p><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.2kroe0h5ah.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.2kroe0h5ah.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div><p><strong>ç½®ä¿¡åº¦</strong>ï¼ˆconfidenceï¼‰ï¼šå°±æ˜¯é¢„æµ‹çš„å…ˆéªŒæ¡†å’ŒçœŸå®æ¡†ground truth boxï¼ˆçœŸå®å¯¹è±¡çš„æ¡†ï¼‰çš„IOUå€¼ï¼Œå³å…ˆéªŒæ¡†æ˜¯å¦æœ‰å¯¹è±¡çš„æ¦‚ç‡Pr(Object)ï¼Œå¦‚è¿›è¡Œäººè„¸è¯†åˆ«ï¼Œä¸€å¼ å›¾ä¸­æœ‰æˆ¿å­ï¼Œæ ‘ï¼Œè½¦ï¼Œäººç­‰ï¼Œè¯†åˆ«æ—¶èƒŒæ™¯å’Œäººçš„èº«ä½“éƒ½æ²¡æœ‰è„¸è¿™ä¸ªéœ€è¦è¯†åˆ«çš„å¯¹è±¡ï¼Œé‚£ä¹ˆè¿™äº›åœ°æ–¹çš„ç½®ä¿¡åº¦å°±æ˜¯0ï¼Œæ¡†ä¸­çš„äººè„¸è¶Šå¤šï¼Œç½®ä¿¡åº¦ï¼ˆæœ‰å¯¹è±¡æ¦‚ç‡ï¼‰å°±è¶Šå¤§ï¼Œç½®ä¿¡åº¦æ˜¯æ£€æµ‹ä¸­éå¸¸é‡è¦çš„å‚æ•°</p><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.5tqsao8853.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.5tqsao8853.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div><p>IOUè¡¨ç¤ºäº¤å¹¶æ¯”</p><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.3razmma7pz.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.3razmma7pz.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div><p><strong>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ®‹å·®ï¼ˆResidualï¼‰ç¥ç»ç½‘ç»œï¼Ÿ</strong><br>ç­”ï¼šç½‘ç»œè¶Šæ·±ï¼Œæ¢¯åº¦æ¶ˆå¤±çš„ç°è±¡å°±è¶Šæ¥è¶Šæ˜æ˜¾ï¼Œç½‘ç»œçš„è®­ç»ƒæ•ˆæœä¹Ÿä¸ä¼šå¾ˆå¥½ã€‚æ®‹å·®ç¥ç»ç½‘ç»œå°±æ˜¯ä¸ºäº†åœ¨åŠ æ·±ç½‘ç»œçš„æƒ…å†µä¸‹åˆè§£å†³æ¢¯åº¦æ¶ˆå¤±çš„é—®é¢˜ã€‚æ®‹å·®ç»“æ„å¯ä»¥ä¸é€šè¿‡å·ç§¯ï¼Œç›´æ¥ä»å‰é¢ä¸€ä¸ªç‰¹å¾å±‚æ˜ å°„åˆ°åé¢çš„ç‰¹å¾å±‚ï¼ˆè·³è·ƒè¿æ¥ï¼‰ï¼Œæœ‰åŠ©äºè®­ç»ƒï¼Œä¹Ÿæœ‰åŠ©äºç‰¹å¾çš„æå–ï¼Œå®¹æ˜“ä¼˜åŒ–ã€‚</p><h2 id="yolov3æ£€æµ‹æµç¨‹åŸç†"><a href="#yolov3æ£€æµ‹æµç¨‹åŸç†" class="headerlink" title="yolov3æ£€æµ‹æµç¨‹åŸç†"></a>yolov3æ£€æµ‹æµç¨‹åŸç†</h2><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.26l8n5exyl.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.26l8n5exyl.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div><h3 id="ç¬¬ä¸€æ­¥ï¼šä»ç‰¹å¾è·å–é¢„æµ‹ç»“æœ"><a href="#ç¬¬ä¸€æ­¥ï¼šä»ç‰¹å¾è·å–é¢„æµ‹ç»“æœ" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼šä»ç‰¹å¾è·å–é¢„æµ‹ç»“æœ"></a>ç¬¬ä¸€æ­¥ï¼šä»ç‰¹å¾è·å–é¢„æµ‹ç»“æœ</h3><ol><li><p>yolov3æå–å¤šç‰¹å¾å±‚è¿›è¡Œç›®æ ‡æ£€æµ‹ï¼Œä¸€å…±æå–ä¸‰ä¸ªç‰¹å¾å±‚ï¼Œä¸‰ä¸ªç‰¹å¾å±‚ä½äºä¸»å¹²ç‰¹å¾æå–ç½‘ç»œdarknet53çš„ä¸åŒä½ç½®ï¼Œåˆ†åˆ«ä½äºä¸­é—´å±‚ï¼Œä¸­ä¸‹å±‚ï¼Œåº•å±‚ï¼Œä¸‰ä¸ªç‰¹å¾å±‚çš„shapeåˆ†åˆ«ä¸º(52,52,256)ã€(26,26,512)ã€(13,13,1024)ï¼Œè¿™ä¸‰ä¸ªç‰¹å¾å±‚åé¢ç”¨äºä¸ä¸Šé‡‡æ ·åçš„å…¶ä»–ç‰¹å¾å±‚å †å æ‹¼æ¥ï¼ˆConcatï¼‰</p></li><li><p>ç¬¬ä¸‰ä¸ªç‰¹å¾å±‚(13,13,1024)è¿›è¡Œ5æ¬¡å·ç§¯å¤„ç†ï¼ˆä¸ºäº†ç‰¹å¾æå–ï¼‰ï¼Œå¤„ç†å®Œåä¸€éƒ¨åˆ†ç”¨äºå·ç§¯+ä¸Šé‡‡æ ·UpSamplingï¼Œå¦ä¸€éƒ¨åˆ†ç”¨äºè¾“å‡ºå¯¹åº”çš„é¢„æµ‹ç»“æœï¼ˆ13,13,75ï¼‰ï¼ŒConv2D 3Ã—3å’ŒConv2D1Ã—1ä¸¤ä¸ªå·ç§¯èµ·é€šé“è°ƒæ•´çš„ä½œç”¨ï¼Œè°ƒæ•´æˆè¾“å‡ºéœ€è¦çš„å¤§å°ã€‚</p></li><li><p>å·ç§¯+ä¸Šé‡‡æ ·åå¾—åˆ°(26,26,256)çš„ç‰¹å¾å±‚ï¼Œç„¶åä¸Darknet53ç½‘ç»œä¸­çš„ç‰¹å¾å±‚(26,26,512)è¿›è¡Œæ‹¼æ¥ï¼Œå¾—åˆ°çš„shapeä¸º(26,26,768)ï¼Œå†è¿›è¡Œ5æ¬¡å·ç§¯ï¼Œå¤„ç†å®Œåä¸€éƒ¨åˆ†ç”¨äºå·ç§¯ä¸Šé‡‡æ ·ï¼Œå¦ä¸€éƒ¨åˆ†ç”¨äºè¾“å‡ºå¯¹åº”çš„é¢„æµ‹ç»“æœ(26,26,75)ï¼ŒConv2D 3Ã—3å’ŒConv2D1Ã—1åŒä¸Šä¸ºé€šé“è°ƒæ•´</p></li><li><p>ä¹‹åå†å°†3ä¸­å·ç§¯+ä¸Šé‡‡æ ·çš„ç‰¹å¾å±‚ä¸shapeä¸º(52,52,256)çš„ç‰¹å¾å±‚æ‹¼æ¥ï¼ˆConcatï¼‰,å†è¿›è¡Œå·ç§¯å¾—åˆ°shapeä¸º(52,52,128)çš„ç‰¹å¾å±‚ï¼Œæœ€åå†Conv2D 3Ã—3å’ŒConv2D1Ã—1ä¸¤ä¸ªå·ç§¯ï¼Œå¾—åˆ°(52,52,75)ç‰¹å¾å±‚</p></li></ol><p>æœ€åå›¾ä¸­æœ‰ä¸‰ä¸ªçº¢æ¡†åŸå› å°±æ˜¯æœ‰äº›ç‰©ä½“ç›¸å¯¹åœ¨å›¾ä¸­è¾ƒå¤§ï¼Œå°±ç”¨13Ã—13æ£€æµ‹ï¼Œç‰©ä½“åœ¨å›¾ä¸­æ¯”è¾ƒå°ï¼Œå°±ä¼šå½’ä¸º52Ã—52æ¥æ£€æµ‹</p><h3 id="ç¬¬äºŒæ­¥ï¼šé¢„æµ‹ç»“æœçš„è§£ç "><a href="#ç¬¬äºŒæ­¥ï¼šé¢„æµ‹ç»“æœçš„è§£ç " class="headerlink" title="ç¬¬äºŒæ­¥ï¼šé¢„æµ‹ç»“æœçš„è§£ç "></a>ç¬¬äºŒæ­¥ï¼šé¢„æµ‹ç»“æœçš„è§£ç </h3><p>é¢„æµ‹ç»“æœè§£ç åŸå› ï¼šé¢„æµ‹ç»“æœ(çº¢æ¡†)å¹¶ä¸å¯¹åº”ç€æœ€ç»ˆçš„é¢„æµ‹æ¡†åœ¨å›¾ç‰‡ä¸Šçš„ä½ç½®ï¼Œè¿˜éœ€è¦è§£ç ï¼‰</p><p>yolov3çš„é¢„æµ‹åŸç†æ˜¯åˆ†åˆ«å°†æ•´å¹…å›¾åˆ†ä¸º13x13ã€26x26ã€52x52çš„ç½‘æ ¼ï¼Œæ¯ä¸ªç½‘ç»œç‚¹è´Ÿè´£ä¸€ä¸ªåŒºåŸŸçš„æ£€æµ‹ã€‚è§£ç è¿‡ç¨‹å°±æ˜¯è®¡ç®—å¾—å‡ºæœ€åæ˜¾ç¤ºçš„è¾¹ç•Œæ¡†çš„åæ ‡bx,byï¼Œä»¥åŠå®½é«˜bw,bhï¼Œè¿™æ ·å°±å¾—å‡ºäº†è¾¹ç•Œæ¡†çš„ä½ç½®ï¼Œè®¡ç®—è¿‡ç¨‹å¦‚å›¾ï¼ˆbâ€“ä¸ºbounding box ç¼©å†™ï¼‰</p><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.1e8d5fao6l.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.1e8d5fao6l.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div><p>(cx,cy)ï¼šè¯¥ç‚¹æ‰€åœ¨ç½‘æ ¼çš„å·¦ä¸Šè§’è·ç¦»æœ€å·¦ä¸Šè§’ç›¸å·®çš„æ ¼å­æ•°ã€‚<br>(pw,ph)ï¼šå…ˆéªŒæ¡†çš„è¾¹é•¿<br>(tx,ty)ï¼šç›®æ ‡ä¸­å¿ƒç‚¹ç›¸å¯¹äºè¯¥ç‚¹æ‰€åœ¨ç½‘æ ¼å·¦ä¸Šè§’çš„åç§»é‡<br>(tw,th)ï¼šé¢„æµ‹è¾¹æ¡†çš„å®½å’Œé«˜<br>Ïƒï¼šæ¿€æ´»å‡½æ•°ï¼Œè®ºæ–‡ä½œè€…ç”¨çš„æ˜¯sigmoidå‡½æ•°ï¼Œ[0,1]ä¹‹é—´æ¦‚ç‡ï¼Œä¹‹æ‰€ä»¥ç”¨sigmoidå–ä»£ä¹‹å‰ç‰ˆæœ¬çš„softmaxï¼ŒåŸå› æ˜¯softmaxä¼šæ‰©å¤§æœ€å¤§ç±»åˆ«æ¦‚ç‡å€¼è€ŒæŠ‘åˆ¶å…¶ä»–ç±»åˆ«æ¦‚ç‡å€¼ ï¼Œå›¾è§£å¦‚ä¸‹</p><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.9rj5rcytb7.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.9rj5rcytb7.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div><p>æ³¨ï¼šæœ€ç»ˆå¾—åˆ°çš„è¾¹æ¡†åæ ‡å€¼æ˜¯bx,by,bw,bh.è€Œç½‘ç»œå­¦ä¹ ç›®æ ‡æ˜¯txï¼Œtyï¼Œtwï¼Œthã€‚<br>å¦å¤–cyå‘ä¸‹æ­¤å¤„ä¸ºæ­£å‘</p><h3 id="ç¬¬ä¸‰æ­¥ï¼šå¯¹é¢„æµ‹å‡ºçš„è¾¹ç•Œæ¡†å¾—åˆ†æ’åºä¸éæå¤§æŠ‘åˆ¶ç­›é€‰"><a href="#ç¬¬ä¸‰æ­¥ï¼šå¯¹é¢„æµ‹å‡ºçš„è¾¹ç•Œæ¡†å¾—åˆ†æ’åºä¸éæå¤§æŠ‘åˆ¶ç­›é€‰" class="headerlink" title="ç¬¬ä¸‰æ­¥ï¼šå¯¹é¢„æµ‹å‡ºçš„è¾¹ç•Œæ¡†å¾—åˆ†æ’åºä¸éæå¤§æŠ‘åˆ¶ç­›é€‰"></a>ç¬¬ä¸‰æ­¥ï¼šå¯¹é¢„æµ‹å‡ºçš„è¾¹ç•Œæ¡†å¾—åˆ†æ’åºä¸éæå¤§æŠ‘åˆ¶ç­›é€‰</h3><p>è¿™æ­¥å°±æ˜¯å°†æœ€å¤§æ¦‚ç‡çš„æ¡†ç­›é€‰å‡ºæ¥<br>1ã€å–å‡ºæ¯ä¸€ç±»å¾—åˆ†å¤§äºä¸€å®šé˜ˆå€¼çš„æ¡†å’Œå¾—åˆ†è¿›è¡Œæ’åºã€‚<br>2ã€åˆ©ç”¨æ¡†çš„ä½ç½®å’Œå¾—åˆ†è¿›è¡Œéæå¤§æŠ‘åˆ¶ã€‚æœ€åå¯ä»¥å¾—å‡ºæ¦‚ç‡æœ€å¤§çš„è¾¹ç•Œæ¡†ï¼Œä¹Ÿå°±æ˜¯æœ€åæ˜¾ç¤ºå‡ºçš„æ¡†<br>å¦‚ä¸‹å‡ å¹…å›¾ï¼Œä¸€æ­¥æ­¥ç­›é€‰å¾—åˆ°æœ€ç»ˆè¾¹ç•Œæ¡†</p>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;tagLink&quot;&gt;&lt;a class=&quot;link-card&quot; title=&quot;ã€yolov3è¯¦è§£ã€‘ä¸€æ–‡è®©ä½ è¯»æ‡‚yolov3ç›®æ ‡æ£€æµ‹åŸç†&quot; href=&quot;https://blog.csdn.net/weixin_39615182/article/details/1</summary>
      
    
    
    
    <category term="æ™ºèƒ½è½¦" scheme="http://tumytime.github.io/categories/%E6%99%BA%E8%83%BD%E8%BD%A6/"/>
    
    
    <category term="Python" scheme="http://tumytime.github.io/tags/Python/"/>
    
    <category term="æ·±åº¦å­¦ä¹ " scheme="http://tumytime.github.io/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="æ™ºèƒ½è½¦" scheme="http://tumytime.github.io/tags/%E6%99%BA%E8%83%BD%E8%BD%A6/"/>
    
    <category term="YoloV3" scheme="http://tumytime.github.io/tags/YoloV3/"/>
    
  </entry>
  
  <entry>
    <title>1x1å·ç§¯æ ¸</title>
    <link href="http://tumytime.github.io/2024/03/21/1x1%E5%8D%B7%E7%A7%AF%E6%A0%B8/"/>
    <id>http://tumytime.github.io/2024/03/21/1x1%E5%8D%B7%E7%A7%AF%E6%A0%B8/</id>
    <published>2024-03-21T09:40:05.000Z</published>
    <updated>2024-03-21T12:15:18.385Z</updated>
    
    <content type="html"><![CDATA[<div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.7awxc3fekp.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.7awxc3fekp.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div><blockquote><p>åœ¨å·ç§¯ç¥ç»ç½‘ç»œçš„å·ç§¯å±‚ä¸­ï¼Œä¸åŒçš„é€šé“ä½¿ç”¨çš„å·ç§¯æ ¸å‚æ•°æ˜¯ä¸ä¸€æ ·çš„ã€‚æ¯ä¸ªé€šé“éƒ½æœ‰è‡ªå·±å¯¹åº”çš„å·ç§¯æ ¸å‚æ•°ï¼Œè¿™äº›å‚æ•°ç”¨äºåœ¨è¯¥é€šé“ä¸Šå¯¹è¾“å…¥æ•°æ®è¿›è¡Œæ»¤æ³¢æ“ä½œï¼Œæå–ç‰¹å®šçš„ç‰¹å¾ã€‚<br>é€šé“ä¹‹é—´çš„å·ç§¯æ ¸å‚æ•°æ˜¯ä¸å…±äº«çš„ï¼Œå³æ¯ä¸ªé€šé“éƒ½æœ‰è‡ªå·±ç‹¬ç‰¹çš„å·ç§¯æ ¸å‚æ•°ã€‚è¿™ç§è®¾è®¡å¯ä»¥è®©ç¥ç»ç½‘ç»œæ›´åŠ çµæ´»åœ°å­¦ä¹ ä¸åŒé€šé“ä¹‹é—´çš„ç‰¹å¾è¡¨ç¤ºï¼Œä»è€Œæé«˜ç½‘ç»œçš„è¡¨å¾èƒ½åŠ›ã€‚</p></blockquote><h2 id="1Ã—1-å·ç§¯æ ¸ä½œç”¨"><a href="#1Ã—1-å·ç§¯æ ¸ä½œç”¨" class="headerlink" title="$1Ã—1$å·ç§¯æ ¸ä½œç”¨"></a>$1Ã—1$å·ç§¯æ ¸ä½œç”¨</h2><p><strong>å·ç§¯å±‚ä¸­çš„å·ç§¯æ ¸æ•°é‡å†³å®šäº†è¾“å‡ºçš„é€šé“æ•°ï¼Œè€Œæ¯ä¸ªå·ç§¯æ ¸çš„é€šé“æ•°å–å†³äºè¾“å…¥æ•°æ®çš„é€šé“æ•°</strong></p><ol><li><p><strong>å·ç§¯æ ¸æ•°å†³å®šäº†è¾“å‡ºé€šé“æ•°ï¼š</strong> åœ¨å·ç§¯ç¥ç»ç½‘ç»œä¸­ï¼Œæ¯ä¸ªå·ç§¯å±‚åŒ…å«å¤šä¸ªå·ç§¯æ ¸ã€‚æ¯ä¸ªå·ç§¯æ ¸åœ¨è¾“å…¥æ•°æ®ä¸Šè¿›è¡Œå·ç§¯æ“ä½œï¼Œç”Ÿæˆä¸€ä¸ªå¯¹åº”çš„è¾“å‡ºç‰¹å¾å›¾ï¼ˆé€šé“ï¼‰ã€‚å› æ­¤ï¼Œå·ç§¯æ ¸çš„æ•°é‡å†³å®šäº†è¾“å‡ºç‰¹å¾å›¾çš„é€šé“æ•°ã€‚å¦‚æœä¸€ä¸ªå·ç§¯å±‚æœ‰nä¸ªå·ç§¯æ ¸ï¼Œé‚£ä¹ˆè¾“å‡ºå°†åŒ…å«nä¸ªé€šé“ã€‚</p></li><li><p><strong>æ¯ä¸ªå·ç§¯æ ¸çš„é€šé“æ•°å–å†³äºè¾“å…¥çš„é€šé“æ•°ï¼š</strong> å½“å·ç§¯æ ¸åœ¨è¾“å…¥æ•°æ®ä¸Šè¿›è¡Œå·ç§¯æ“ä½œæ—¶ï¼Œæ¯ä¸ªå·ç§¯æ ¸ä¼šåŒæ—¶å¤„ç†è¾“å…¥æ•°æ®çš„æ‰€æœ‰é€šé“ã€‚ä¾‹å¦‚ï¼Œå¦‚æœè¾“å…¥æ•°æ®æ˜¯RGBå›¾åƒï¼Œæœ‰3ä¸ªé€šé“ï¼ˆçº¢è‰²ã€ç»¿è‰²ã€è“è‰²ï¼‰ï¼Œé‚£ä¹ˆæ¯ä¸ªå·ç§¯æ ¸å°†åŒæ—¶åœ¨è¿™3ä¸ªé€šé“ä¸Šè¿›è¡Œå·ç§¯æ“ä½œã€‚è¿™æ ·ï¼Œæ¯ä¸ªå·ç§¯æ ¸çš„é€šé“æ•°å°±ç­‰äºè¾“å…¥æ•°æ®çš„é€šé“æ•°ã€‚å› æ­¤ï¼Œå·ç§¯æ ¸çš„é€šé“æ•°å–å†³äºè¾“å…¥æ•°æ®çš„é€šé“æ•°ã€‚</p></li></ol><h3 id="å¢åŠ ç½‘ç»œæ·±åº¦-å¢åŠ éçº¿æ€§æ˜ å°„æ¬¡æ•°"><a href="#å¢åŠ ç½‘ç»œæ·±åº¦-å¢åŠ éçº¿æ€§æ˜ å°„æ¬¡æ•°" class="headerlink" title="å¢åŠ ç½‘ç»œæ·±åº¦(å¢åŠ éçº¿æ€§æ˜ å°„æ¬¡æ•°)"></a>å¢åŠ ç½‘ç»œæ·±åº¦(å¢åŠ éçº¿æ€§æ˜ å°„æ¬¡æ•°)</h3><iframe src="//player.bilibili.com/player.html?aid=696259725&bvid=BV11m4y1r7jK&cid=1062261407&p=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"> </iframe><p>é¦–å…ˆç›´æ¥ä»ç½‘ç»œæ·±åº¦æ¥ç†è§£ï¼Œ1x1 çš„å·ç§¯æ ¸è™½å°ï¼Œä½†ä¹Ÿæ˜¯å·ç§¯æ ¸ï¼ŒåŠ  1 å±‚å·ç§¯ï¼Œç½‘ç»œæ·±åº¦è‡ªç„¶ä¼šå¢åŠ ã€‚<br>1x1å·ç§¯æ ¸ï¼Œå¯ä»¥åœ¨ä¿æŒfeature mapå°ºåº¦ä¸å˜çš„ï¼ˆå³ä¸æŸå¤±åˆ†è¾¨ç‡ï¼‰çš„å‰æä¸‹å¤§å¹…å¢åŠ éçº¿æ€§ç‰¹æ€§ï¼ˆåˆ©ç”¨åæ¥çš„éçº¿æ€§æ¿€æ´»å‡½æ•°ï¼‰ï¼ŒæŠŠç½‘ç»œåšçš„å¾ˆæ·±ã€‚å¹¶ä¸”1x1å·ç§¯æ ¸çš„å·ç§¯è¿‡ç¨‹ç›¸å½“äºå…¨è¿æ¥çš„è®¡ç®—è¿‡ç¨‹ï¼Œé€šè¿‡<strong>åŠ å…¥éçº¿æ€§æ¿€æ´»å‡½æ•°</strong>ï¼Œå¯ä»¥<strong>å¢åŠ ç½‘ç»œçš„éçº¿æ€§</strong>ï¼Œä½¿å¾—ç½‘ç»œå¯ä»¥è¡¨è¾¾æ›´å¤æ‚çš„ç‰¹å¾ã€‚</p><h4 id="feature-mapçš„å«ä¹‰"><a href="#feature-mapçš„å«ä¹‰" class="headerlink" title="feature mapçš„å«ä¹‰"></a>feature mapçš„å«ä¹‰</h4><p>åœ¨æ¯ä¸ªå·ç§¯å±‚ï¼Œæ•°æ®éƒ½æ˜¯ä»¥ä¸‰ç»´å½¢å¼å­˜åœ¨çš„ã€‚ä½ å¯ä»¥æŠŠå®ƒçœ‹æˆè®¸å¤šä¸ªäºŒç»´å›¾ç‰‡å åœ¨ä¸€èµ·ï¼Œå…¶ä¸­æ¯ä¸€ä¸ªç§°ä¸ºä¸€ä¸ªfeature mapã€‚åœ¨è¾“å…¥å±‚ï¼Œå¦‚æœæ˜¯ç°åº¦å›¾ç‰‡ï¼Œé‚£å°±åªæœ‰ä¸€ä¸ªfeature mapï¼›å¦‚æœæ˜¯å½©è‰²å›¾ç‰‡ï¼Œä¸€èˆ¬å°±æ˜¯3ä¸ªfeature mapï¼ˆçº¢ç»¿è“ï¼‰ã€‚å±‚ä¸å±‚ä¹‹é—´ä¼šæœ‰è‹¥å¹²ä¸ªå·ç§¯æ ¸ï¼ˆkernelï¼‰ï¼Œä¸Šä¸€å±‚å’Œæ¯ä¸ªfeature mapè·Ÿæ¯ä¸ªå·ç§¯æ ¸åšå·ç§¯ï¼Œéƒ½ä¼šäº§ç”Ÿä¸‹ä¸€å±‚çš„ä¸€ä¸ªfeature mapã€‚</p><p>feature mapï¼ˆä¸‹å›¾çº¢çº¿æ ‡å‡ºï¼‰ å³ï¼šè¯¥å±‚å·ç§¯æ ¸çš„ä¸ªæ•°ï¼Œæœ‰å¤šå°‘ä¸ªå·ç§¯æ ¸ï¼Œç»è¿‡å·ç§¯å°±ä¼šäº§ç”Ÿå¤šå°‘ä¸ªfeature mapï¼Œä¹Ÿå°±æ˜¯ä¸‹å›¾ä¸­ <code>è±†è…çš®å„¿</code>çš„å±‚æ•°ã€åŒæ—¶ä¹Ÿæ˜¯ä¸‹å›¾<code>è±†è…å—</code>çš„æ·±åº¦ï¼ˆå®½åº¦ï¼‰ï¼ï¼è¿™ä¸ªå®½åº¦å¯ä»¥æ‰‹åŠ¨æŒ‡å®šï¼Œä¸€èˆ¬ç½‘ç»œè¶Šæ·±çš„åœ°æ–¹è¿™ä¸ªå€¼è¶Šå¤§ï¼Œå› ä¸ºéšç€ç½‘ç»œçš„åŠ æ·±ï¼Œfeature mapçš„é•¿å®½å°ºå¯¸ç¼©å°ï¼Œæœ¬å·ç§¯å±‚çš„æ¯ä¸ªmapæå–çš„ç‰¹å¾è¶Šå…·æœ‰ä»£è¡¨æ€§ï¼ˆç²¾åéƒ¨åˆ†ï¼‰ï¼Œæ‰€ä»¥åä¸€å±‚å·ç§¯å±‚éœ€è¦å¢åŠ feature mapçš„æ•°é‡ï¼Œæ‰èƒ½æ›´å……åˆ†çš„æå–å‡ºå‰ä¸€å±‚çš„ç‰¹å¾ï¼Œä¸€èˆ¬æ˜¯æˆå€å¢åŠ ï¼ˆä¸è¿‡å…·ä½“è®ºæ–‡ä¼šæ ¹æ®å®éªŒæƒ…å†µå…·ä½“è®¾ç½®ï¼‰ï¼</p><p>åœ¨å·ç§¯ç¥ç»ç½‘ç»œä¸­ï¼Œæ¯ä¸ªå·ç§¯å±‚éƒ½åŒ…å«å¤šä¸ªå·ç§¯æ ¸ï¼ˆä¹Ÿç§°ä¸ºæ»¤æ³¢å™¨ï¼‰ï¼Œæ¯ä¸ªå·ç§¯æ ¸ç”Ÿæˆä¸€ä¸ªç‰¹å¾å›¾ã€‚å½“å‰ä¸€å±‚è¾“å‡ºçš„ç‰¹å¾å›¾ä¸åä¸€å±‚å·ç§¯æ ¸è¿›è¡Œå·ç§¯æ“ä½œæ—¶ï¼Œå¯ä»¥çœ‹ä½œæ˜¯åœ¨è¿›è¡ŒçŸ©é˜µç›¸ä¹˜æ“ä½œã€‚å¢åŠ åä¸€å±‚çš„ç‰¹å¾å›¾æ•°é‡å®é™…ä¸Šæ„å‘³ç€å¢åŠ äº†åä¸€å±‚å·ç§¯æ ¸çš„æ•°é‡ï¼Œè¿™å¯ä»¥ä½¿ç½‘ç»œåœ¨è¿›è¡Œç‰¹å¾æå–æ—¶æ‹¥æœ‰æ›´å¤šçš„â€œè¿‡æ»¤å™¨â€ï¼Œä»è€Œæ›´å…¨é¢åœ°æ•è·è¾“å…¥æ•°æ®ä¸­çš„ä¸åŒç‰¹å¾å’Œæ¨¡å¼ã€‚</p><p>å·ç§¯ç‰¹å¾çš„å¯è§†åŒ–ï¼Œæœ‰åŠ©äºæˆ‘ä»¬æ›´å¥½åœ°ç†è§£æ·±åº¦ç½‘ç»œã€‚å·ç§¯ç½‘ç»œåœ¨å­¦ä¹ è¿‡ç¨‹ä¸­ä¿æŒäº†å›¾åƒçš„ç©ºé—´ç»“æ„ï¼Œä¹Ÿå°±æ˜¯è¯´æœ€åä¸€å±‚çš„æ¿€æ´»å€¼ï¼ˆfeature mapï¼‰æ€»å’ŒåŸå§‹å›¾åƒå…·æœ‰ç©ºé—´ä¸Šçš„å¯¹åº”å…³ç³»ï¼Œå…·ä½“å¯¹åº”çš„ä½ç½®ä»¥åŠå¤§å°ï¼Œå¯ä»¥ç”¨æ„Ÿå—é‡æ¥åº¦é‡ã€‚åˆ©ç”¨è¿™ç‚¹æ€§è´¨å¯ä»¥åšå¾ˆå¤šäº‹æƒ…ï¼š</p><ol><li>å‰å‘è®¡ç®—ã€‚æˆ‘ä»¬ç›´æ¥å¯è§†åŒ–ç½‘ç»œæ¯å±‚çš„ feature mapï¼Œç„¶åè§‚å¯Ÿfeature map çš„æ•°å€¼å˜åŒ–. ä¸€ä¸ªè®­ç»ƒæˆåŠŸçš„CNN ç½‘ç»œï¼Œå…¶feature map çš„å€¼ä¼´éšç½‘ç»œæ·±åº¦çš„å¢åŠ ï¼Œä¼šè¶Šæ¥è¶Šç¨€ç–ã€‚è¿™å¯ä»¥ç†è§£ç½‘ç»œå–ç²¾å»ç‡¥ã€‚ <details open><summary pointer> WHYè¶Šæ¥è¶Šç¨€ç– </summary>              <div class='content'>              <p>åœ¨ä¸€ä¸ªè®­ç»ƒæˆåŠŸçš„CNNï¼ˆConvolutional Neural Networkï¼‰ç½‘ç»œä¸­ï¼Œéšç€ç½‘ç»œæ·±åº¦çš„å¢åŠ ï¼Œfeature map çš„å€¼ä¼šè¶Šæ¥è¶Šç¨€ç–çš„ç°è±¡å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹é¢è¿›è¡Œè¯¦ç»†è§£é‡Šï¼š</p><ol><li><p><strong>ç‰¹å¾ç¨€ç–æ€§åœ¨æ·±å±‚ç½‘ç»œä¸­çš„åŸå› </strong>ï¼š</p><ul><li><strong>æ¿€æ´»å‡½æ•°çš„éçº¿æ€§ä½œç”¨</strong>ï¼šåœ¨å·ç§¯ç¥ç»ç½‘ç»œä¸­ï¼Œé€šå¸¸åœ¨æ¯ä¸ªå·ç§¯å±‚ä¹‹åéƒ½ä¼šä½¿ç”¨éçº¿æ€§æ¿€æ´»å‡½æ•°ï¼ˆå¦‚ReLUï¼‰ã€‚è¿™ç§éçº¿æ€§æ¿€æ´»ä¼šå¯¼è‡´å¤§éƒ¨åˆ†ç¥ç»å…ƒçš„è¾“å‡ºæ¥è¿‘äº0ï¼Œåªæœ‰éƒ¨åˆ†ç¥ç»å…ƒä¼šæ¿€æ´»å¹¶è¾“å‡ºéé›¶å€¼ï¼Œä»è€Œå¯¼è‡´ feature map çš„ç¨€ç–æ€§ã€‚</li><li><strong>æƒé‡æ›´æ–°å’Œç‰¹å¾é€‰æ‹©</strong>ï¼šéšç€ç½‘ç»œçš„è®­ç»ƒï¼ŒCNN ä¼šæ ¹æ®æŸå¤±å‡½æ•°è¿›è¡Œæƒé‡æ›´æ–°ï¼Œé€šè¿‡å­¦ä¹ æå–å¯¹åˆ†ç±»ä»»åŠ¡æœ‰ç”¨çš„ç‰¹å¾ã€‚åœ¨ç½‘ç»œæ·±åº¦å¢åŠ çš„è¿‡ç¨‹ä¸­ï¼Œç½‘ç»œä¼šæ›´åŠ æ³¨é‡å¯¹å…³é”®ç‰¹å¾çš„æå–ï¼Œè€Œç›¸å¯¹ä¸é‡è¦çš„ç‰¹å¾å¾ˆå¯èƒ½è¢«æŠ‘åˆ¶ï¼Œè¿™ä¹Ÿä¼šå¯¼è‡´ feature map çš„ç¨€ç–æ€§ã€‚</li></ul></li><li><p><strong>ç¨€ç–ç‰¹å¾å¯¹ç½‘ç»œæ€§èƒ½çš„å½±å“</strong>ï¼š</p><ul><li><strong>æ³›åŒ–èƒ½åŠ›æå‡</strong>ï¼šå­˜å‚¨è¾ƒå°‘çš„æ¿€æ´»å€¼å¯ä»¥å¢åŠ ç½‘ç»œçš„æ³›åŒ–èƒ½åŠ›ï¼Œå‡å°‘è¿‡æ‹Ÿåˆçš„é£é™©ï¼Œå› ä¸ºç½‘ç»œæ›´å¤šåœ°å…³æ³¨äºå¯¹åŒºåˆ†æ€§é‡è¦çš„ç‰¹å¾è¿›è¡Œå­¦ä¹ ã€‚</li><li><strong>è®¡ç®—æ•ˆç‡æé«˜</strong>ï¼šç¨€ç–çš„ç‰¹å¾å›¾åœ¨åç»­çš„å±‚æ¬¡ä¸­å‡å°‘äº†è®¡ç®—é‡ï¼Œå› ä¸ºå¯¹äºå¾ˆå¤šå€¼è¾ƒå°æˆ–æ¥è¿‘äºé›¶çš„ç¥ç»å…ƒï¼Œä¸å¿…æ‰§è¡Œé¢å¤–çš„ä¹˜æ³•è¿ç®—ï¼Œä»è€Œæé«˜äº†ç½‘ç»œçš„è®¡ç®—æ•ˆç‡ã€‚</li></ul></li><li><p><strong>æ·±åº¦å¢åŠ å¯¼è‡´ç‰¹å¾å¤æ‚æ€§</strong>ï¼š</p><ul><li>éšç€ç½‘ç»œæ·±åº¦çš„å¢åŠ ï¼Œç‰¹å¾å›¾è¡¨ç¤ºçš„ç‰¹å¾ä¹Ÿä¼šå˜å¾—è¶Šæ¥è¶Šå¤æ‚å’ŒæŠ½è±¡ï¼Œéœ€è¦æ›´å°‘çš„æ¿€æ´»æ¥æè¿°ä¸€ä¸ªé«˜çº§åˆ«çš„ç‰¹å¾ï¼Œè¿™ä¹Ÿé—´æ¥å¯¼è‡´ feature map çš„ç¨€ç–æ€§ã€‚</li></ul></li></ol><p>ç»¼ä¸Šæ‰€è¿°ï¼Œéšç€ç½‘ç»œæ·±åº¦çš„å¢åŠ ï¼Œä¸€ä¸ªè®­ç»ƒæˆåŠŸçš„CNN ç½‘ç»œä¸­çš„ feature map çš„å€¼ä¼šå˜å¾—è¶Šæ¥è¶Šç¨€ç–ï¼Œè¿™ä¸»è¦æ˜¯ç”±äºéçº¿æ€§æ¿€æ´»å‡½æ•°çš„ä½œç”¨ã€æƒé‡æ›´æ–°å’Œç‰¹å¾é€‰æ‹©æœºåˆ¶ï¼Œä»¥åŠæ·±å±‚ç½‘ç»œä¸­å¤æ‚ç‰¹å¾çš„è¡¨ç¤ºæ‰€å¯¼è‡´çš„ç»“æœã€‚è¿™ç§ç¨€ç–æ€§æœ‰åŠ©äºæå‡ç½‘ç»œçš„æ³›åŒ–èƒ½åŠ›ã€è®¡ç®—æ•ˆç‡ï¼Œå¹¶åæ˜ äº†ç½‘ç»œå¯¹å…³é”®ç‰¹å¾çš„å­¦ä¹ å’ŒæŠ½è±¡èƒ½åŠ›ã€‚</p><details open><summary pointer> æ¿€æ´»ä¸€ä¸ªç¥ç»å…ƒçš„è¿‡ç¨‹ </summary>          <div class='content'>          <p>æ¿€æ´»ä¸€ä¸ªç¥ç»å…ƒçš„è¿‡ç¨‹å¯ä»¥ç®€å•æè¿°ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p><ol><li><p><strong>åŠ æƒæ±‚å’Œï¼ˆWeighted Summationï¼‰</strong>ï¼šç¥ç»å…ƒæ¥æ”¶æ¥è‡ªä¸Šä¸€å±‚æˆ–è¾“å…¥æ•°æ®çš„è¾“å…¥ä¿¡å·ï¼Œæ¯ä¸ªè¾“å…¥ä¿¡å·éƒ½ä¼šä¹˜ä»¥å¯¹åº”çš„è¿æ¥æƒé‡ï¼ˆweightsï¼‰ï¼Œç„¶åå°†æ‰€æœ‰åŠ æƒè¾“å…¥ä¿¡å·æ±‚å’Œï¼Œå¾—åˆ°ä¸€ä¸ªåŠ æƒå’Œã€‚è¿™ä¸ªåŠ æƒå’Œå¯ä»¥è¡¨ç¤ºä¸ºï¼š$[ z &#x3D; \sum_{i&#x3D;1}^{n} (w_i \cdot x_i) + b ]$ï¼Œå…¶ä¸­ $(w_i)$ æ˜¯ç¬¬ $(i)$ ä¸ªè¾“å…¥ä¿¡å·çš„æƒé‡ï¼Œ$(x_i)$ æ˜¯å¯¹åº”çš„è¾“å…¥å€¼ï¼Œ$(b)$ æ˜¯ç¥ç»å…ƒçš„åç½®é¡¹ï¼ˆbiasï¼‰ã€‚</p></li><li><p><strong>æ¿€æ´»å‡½æ•°ï¼ˆActivation Functionï¼‰</strong>ï¼šå°†ä¸Šä¸€æ­¥è®¡ç®—å¾—åˆ°çš„åŠ æƒå’Œ$(z)$è¾“å…¥åˆ°æ¿€æ´»å‡½æ•°ä¸­ï¼Œæ¿€æ´»å‡½æ•°ä¼šå¯¹åŠ æƒå’Œè¿›è¡Œéçº¿æ€§å˜æ¢ï¼Œä»è€Œè¾“å‡ºç¥ç»å…ƒçš„æ¿€æ´»å€¼ï¼ˆactivation valueï¼‰ã€‚å¸¸è§çš„æ¿€æ´»å‡½æ•°åŒ…æ‹¬ReLUã€Sigmoidã€Tanhç­‰ã€‚æ¿€æ´»å‡½æ•°å°†å†³å®šç¥ç»å…ƒæ˜¯å¦è¢«æ¿€æ´»ï¼Œä»¥åŠæ¿€æ´»çº§åˆ«å¦‚ä½•ã€‚</p></li><li><p><strong>è¾“å‡ºå€¼ï¼ˆOutputï¼‰</strong>ï¼šæ¿€æ´»å‡½æ•°çš„è¾“å‡ºå€¼å³ä¸ºç¥ç»å…ƒçš„æœ€ç»ˆè¾“å‡ºï¼Œä¹Ÿå¯ä»¥è¡¨ç¤ºä¸ºç¥ç»å…ƒçš„æ¿€æ´»å€¼ã€‚è¿™ä¸ªè¾“å‡ºå€¼å°†ä¼šè¢«ä¼ é€’åˆ°ä¸‹ä¸€å±‚ç¥ç»å…ƒæˆ–ä½œä¸ºæœ€ç»ˆè¾“å‡ºã€‚</p></li></ol><p>æ€»ç»“èµ·æ¥ï¼Œæ¿€æ´»ä¸€ä¸ªç¥ç»å…ƒçš„è¯¦ç»†è¿‡ç¨‹å°±æ˜¯é€šè¿‡åŠ æƒæ±‚å’Œå¾—åˆ°è¾“å…¥ä¿¡å·çš„åŠ æƒå’Œï¼Œç„¶åç»è¿‡æ¿€æ´»å‡½æ•°è¿›è¡Œéçº¿æ€§å˜æ¢å¾—åˆ°æœ€ç»ˆçš„è¾“å‡ºå€¼ã€‚è¿™ä¸ªè¿‡ç¨‹åœ¨ç¥ç»ç½‘ç»œçš„æ¯ä¸€å±‚éƒ½ä¼šè¢«é‡å¤æ‰§è¡Œï¼Œç”¨äºå¤„ç†æ¥è‡ªå‰ä¸€å±‚ç¥ç»å…ƒçš„ä¿¡å·å¹¶ç”Ÿæˆæ–°çš„è¡¨ç¤ºã€‚</p>          </div>        </details>               </div>            </details></li><li>åå‘è®¡ç®—ã€‚æ ¹æ®ç½‘ç»œæœ€åä¸€å±‚æœ€å¼ºçš„æ¿€æ´»å€¼ï¼Œåˆ©ç”¨æ„Ÿå—é‡æ±‚å‡ºåŸå§‹è¾“å…¥å›¾åƒçš„åŒºåŸŸã€‚å¯ä»¥è§‚å¯Ÿè¾“å…¥å›¾åƒçš„é‚£äº›åŒºåŸŸæ¿€æ´»äº†ç½‘ç»œï¼Œåˆ©ç”¨è¿™ä¸ªæ€è·¯å¯ä»¥åšä¸€äº›ç‰©ä½“å®šä½ã€‚</li></ol><h4 id="1x1å·ç§¯æ ¸å¢åŠ ç½‘ç»œæ·±åº¦çš„åŸå› "><a href="#1x1å·ç§¯æ ¸å¢åŠ ç½‘ç»œæ·±åº¦çš„åŸå› " class="headerlink" title="1x1å·ç§¯æ ¸å¢åŠ ç½‘ç»œæ·±åº¦çš„åŸå› "></a>1x1å·ç§¯æ ¸å¢åŠ ç½‘ç»œæ·±åº¦çš„åŸå› </h4><p>åœ¨å·ç§¯ç¥ç»ç½‘ç»œä¸­ï¼Œ1x1å·ç§¯æ ¸é€šè¿‡åœ¨é€šé“ç»´åº¦ä¸Šè¿›è¡Œå·ç§¯æ“ä½œï¼Œå¯ä»¥èµ·åˆ°å¢åŠ ç½‘ç»œæ·±åº¦çš„ä½œç”¨ã€‚è¿™æ˜¯å› ä¸º1x1å·ç§¯æ ¸å¯ä»¥åœ¨ä¸æ”¹å˜ç©ºé—´å°ºå¯¸çš„æƒ…å†µä¸‹ï¼Œå¢åŠ é€šé“æ•°é‡ï¼Œä»è€Œå¢åŠ ç½‘ç»œçš„æ·±åº¦ï¼Œæä¾›æ›´å¤šçš„éçº¿æ€§å˜æ¢å’Œè¡¨è¾¾èƒ½åŠ›ã€‚ä»¥ä¸‹æ˜¯1x1å·ç§¯æ ¸å¦‚ä½•å¢åŠ ç½‘ç»œæ·±åº¦çš„åŸç†ï¼š</p><ol><li><p><strong>é€šé“ç»´åº¦çš„å˜æ¢ï¼š</strong> 1x1å·ç§¯æ ¸çš„ä½œç”¨æ˜¯åœ¨æ¯ä¸ªç©ºé—´ä½ç½®å¯¹è¾“å…¥æ•°æ®çš„é€šé“è¿›è¡Œçº¿æ€§å˜æ¢ã€‚é€šè¿‡å¯¹è¾“å…¥æ•°æ®çš„æ¯ä¸ªé€šé“åˆ†åˆ«è¿›è¡ŒåŠ æƒæ±‚å’Œï¼Œå¯ä»¥ç”Ÿæˆæ–°çš„ç‰¹å¾è¡¨ç¤ºã€‚è¿™æ ·ï¼Œåœ¨1x1å·ç§¯å±‚ä¹‹åï¼Œè¾“å‡ºå°†å…·æœ‰æ›´å¤šçš„é€šé“æ•°ï¼Œå› æ­¤ç½‘ç»œçš„æ·±åº¦ä¹Ÿä¼šå¢åŠ ã€‚</p></li><li><p><strong>å¼•å…¥éçº¿æ€§å˜æ¢ï¼š</strong> å°½ç®¡1x1å·ç§¯æ ¸æ˜¯åœ¨é€šé“ç»´åº¦ä¸Šè¿›è¡Œå·ç§¯æ“ä½œï¼Œä½†å…¶å¼•å…¥çš„éçº¿æ€§æ¿€æ´»å‡½æ•°ï¼ˆå¦‚ReLUï¼‰ä¼šä½¿è¾“å‡ºå…·æœ‰æ›´ä¸°å¯Œçš„ç‰¹å¾è¡¨ç¤ºèƒ½åŠ›ã€‚è¿™ç§éçº¿æ€§å˜æ¢æœ‰åŠ©äºå¢åŠ ç½‘ç»œçš„æ·±åº¦ï¼Œä½¿ç½‘ç»œèƒ½å¤Ÿå­¦ä¹ åˆ°æ›´å¤æ‚çš„ç‰¹å¾ã€‚</p></li><li><p><strong>å¢åŠ ç½‘ç»œçš„è¡¨è¾¾èƒ½åŠ›ï¼š</strong> é€šè¿‡1x1å·ç§¯æ ¸å¢åŠ ç½‘ç»œçš„æ·±åº¦ï¼Œç½‘ç»œå¯ä»¥æ›´å¥½åœ°æ•è·ä¸åŒæŠ½è±¡çº§åˆ«çš„ç‰¹å¾ã€‚æ¯ä¸ª1x1å·ç§¯å±‚éƒ½å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªå«æœ‰éçº¿æ€§æ¿€æ´»å‡½æ•°çš„å…¨è¿æ¥å±‚ï¼Œå› æ­¤å¯ä»¥æé«˜ç½‘ç»œçš„è¡¨è¾¾èƒ½åŠ›å’Œå­¦ä¹ èƒ½åŠ›ã€‚</p></li></ol><h4 id="WHYä½¿ç”¨1x1å·ç§¯æ ¸"><a href="#WHYä½¿ç”¨1x1å·ç§¯æ ¸" class="headerlink" title="WHYä½¿ç”¨1x1å·ç§¯æ ¸"></a>WHYä½¿ç”¨1x1å·ç§¯æ ¸</h4><p><strong>å¢åŠ ç½‘ç»œæ·±åº¦æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿä¸ºä»€ä¹ˆéè¦ç”¨ 1x1 æ¥å¢åŠ æ·±åº¦å‘¢ï¼Ÿå…¶å®ƒçš„ä¸å¯ä»¥å—ï¼Ÿ</strong></p><p>å…¶å®ï¼Œè¿™æ¶‰åŠåˆ°<code>æ„Ÿå—é‡</code>(æ„Ÿå—é‡ï¼ˆReceptive Fieldï¼‰çš„å®šä¹‰æ˜¯å·ç§¯ç¥ç»ç½‘ç»œæ¯ä¸€å±‚è¾“å‡ºçš„ç‰¹å¾å›¾ï¼ˆfeature mapï¼‰ä¸Šçš„åƒç´ ç‚¹åœ¨è¾“å…¥å›¾ç‰‡ä¸Šæ˜ å°„çš„åŒºåŸŸå¤§å°)çš„é—®é¢˜ï¼Œæˆ‘ä»¬çŸ¥é“<strong>å·ç§¯æ ¸è¶Šå¤§ï¼Œå®ƒç”Ÿæˆçš„ featuremap ä¸Šå•ä¸ªèŠ‚ç‚¹çš„æ„Ÿå—é‡å°±è¶Šå¤§</strong>ï¼Œéšç€ç½‘ç»œæ·±åº¦çš„å¢åŠ ï¼Œ<strong>è¶Šé åçš„ featuremap ä¸Šçš„èŠ‚ç‚¹æ„Ÿå—é‡ä¹Ÿè¶Šå¤§ã€‚å› æ­¤ç‰¹å¾ä¹Ÿè¶Šæ¥è¶ŠæŠ½è±¡</strong>ã€‚</p><p>ä½†æœ‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬æƒ³åœ¨ä¸å¢åŠ æ„Ÿå—é‡çš„æƒ…å†µä¸‹ï¼Œè®©ç½‘ç»œåŠ æ·±ï¼Œä¸ºçš„å°±æ˜¯å¼•å…¥æ›´å¤šçš„éçº¿æ€§ã€‚</p><p>è€Œ 1x1 å·ç§¯æ ¸ï¼Œæ°å·§å¯ä»¥åŠåˆ°ã€‚</p><p>æˆ‘ä»¬çŸ¥é“ï¼Œå·ç§¯åç”Ÿæˆå›¾ç‰‡çš„å°ºå¯¸å—å·ç§¯æ ¸çš„å¤§å°å’Œè·¨åº¦å½±å“ï¼Œä½†å¦‚æœå·ç§¯æ ¸æ˜¯ 1x1 ï¼Œè·¨åº¦ä¹Ÿæ˜¯ 1ï¼Œé‚£ä¹ˆç”Ÿæˆåçš„å›¾åƒå¤§å°å°±å¹¶æ²¡æœ‰å˜åŒ–ã€‚</p><p>ä½†é€šå¸¸ä¸€ä¸ªå·ç§¯è¿‡ç¨‹åŒ…æ‹¬ä¸€ä¸ªæ¿€æ´»å‡½æ•°ï¼Œæ¯”å¦‚ Sigmoid å’Œ Reluã€‚</p><p>æ‰€ä»¥ï¼Œ<strong>åœ¨è¾“å…¥ä¸å‘ç”Ÿå°ºå¯¸çš„å˜åŒ–ä¸‹ï¼Œå´å¼•å…¥äº†æ›´å¤šçš„éçº¿æ€§</strong>ï¼Œè¿™å°†å¢å¼ºç¥ç»ç½‘ç»œçš„è¡¨è¾¾èƒ½åŠ›</p><h3 id="å‡ç»´-é™ç»´"><a href="#å‡ç»´-é™ç»´" class="headerlink" title="å‡ç»´&#x2F;é™ç»´"></a>å‡ç»´&#x2F;é™ç»´</h3><p>å…¶å®è¿™é‡Œçš„å‡ç»´ã€é™ç»´å…·ä½“æŒ‡çš„æ˜¯é€šé“æ•°çš„å˜åŒ–ï¼Œå½“æˆ‘ä»¬ç¡®å®šäº†å·ç§¯æ ¸å°ºå¯¸åï¼Œæˆ‘ä»¬çš„heightã€widthéƒ½ä¸å˜ï¼Œé‚£ä¹ˆè¿™é‡Œçš„ç»´åº¦å…·ä½“æŒ‡çš„å°±æ˜¯channelsã€‚æˆ‘ä»¬é€šè¿‡æ”¹å˜å·ç§¯æ ¸çš„æ•°é‡æ¥æ”¹å˜å·ç§¯åç‰¹å¾å›¾çš„é€šé“channelsæ¥å®ç°å‡ç»´ã€é™ç»´çš„æ•ˆæœã€‚è¿™æ ·å¯ä»¥å°†åŸæœ¬çš„æ•°æ®é‡è¿›è¡Œå¢åŠ æˆ–è€…å‡å°‘<br>ä¸‹é¢åˆ†åˆ«ä¸¾ä¸¤ä¸ªä¾‹å­å°±èƒ½æ˜æ˜¾çœ‹åˆ°æ•ˆæœ</p><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.4ckn8pum0v.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.4ckn8pum0v.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div><h4 id="å‡ç»´"><a href="#å‡ç»´" class="headerlink" title="å‡ç»´"></a>å‡ç»´</h4><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.3nrdop8yvr.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.3nrdop8yvr.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div><h4 id="é™ç»´"><a href="#é™ç»´" class="headerlink" title="é™ç»´"></a>é™ç»´</h4><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.2ruw98zwjt.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.2ruw98zwjt.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.1e8d57p5wp.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.1e8d57p5wp.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div><p>å…¶å®å¾ˆæ˜æ˜¾çš„èƒ½çœ‹å‡ºæ¥ï¼Œæ— è®ºæ˜¯å‡ç»´è¿˜æ˜¯é™ç»´ï¼Œæˆ‘ä»¬éƒ½æ˜¯é€šè¿‡æ”¹å˜å·ç§¯æ ¸çš„æ•°é‡å®ç°çš„ï¼Œå·ç§¯åçš„ç‰¹å¾å›¾çš„é€šé“æ•°channelsåŒå·ç§¯æ ¸çš„æ•°é‡ä¿æŒä¸€è‡´ï¼Œè¿™é‡Œå…¶å®ä¸ä»…ä»…æ˜¯1x1å·ç§¯æ ¸èƒ½å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œå…¶ä»–å°ºå¯¸çš„å·ç§¯æ ¸ä¹Ÿå¯ä»¥ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸ºä»€ä¹ˆè¦é€‰ç”¨1x1å·ç§¯æ ¸å‘¢</p><h4 id="ä½¿ç”¨1x1å·ç§¯æ ¸å‡ç»´-é™ç»´çš„åŸå› "><a href="#ä½¿ç”¨1x1å·ç§¯æ ¸å‡ç»´-é™ç»´çš„åŸå› " class="headerlink" title="ä½¿ç”¨1x1å·ç§¯æ ¸å‡ç»´&#x2F;é™ç»´çš„åŸå› "></a>ä½¿ç”¨1x1å·ç§¯æ ¸å‡ç»´&#x2F;é™ç»´çš„åŸå› </h4><p>å½“æˆ‘ä»¬ä»…ä»…åªæ˜¯æƒ³è¦æ”¹å˜é€šé“æ•°çš„æƒ…å†µä¸‹ï¼Œ1x1å·ç§¯æ ¸æ˜¯æœ€å°çš„é€‰æ‹©ï¼Œå› ä¸ºå¤§äº1x1çš„å·ç§¯æ ¸æ— ç–‘ä¼šå¢åŠ è®¡ç®—çš„å‚æ•°é‡ï¼Œå†…å­˜ä¹Ÿä¼šéšä¹‹å¢å¤§ï¼Œæ‰€ä»¥åªæƒ³å•çº¯çš„å»æå‡æˆ–è€…é™ä½ç‰¹å¾å›¾çš„é€šé“ï¼Œé€‰ç”¨1x1å·ç§¯æ ¸æœ€ä¸ºåˆé€‚ï¼Œ 1x1å·ç§¯æ ¸ä¼šä½¿ç”¨æ›´å°‘çš„æƒé‡å‚æ•°æ•°é‡ã€‚</p><h3 id="è·¨é€šé“çš„ä¿¡æ¯äº¤äº’"><a href="#è·¨é€šé“çš„ä¿¡æ¯äº¤äº’" class="headerlink" title="è·¨é€šé“çš„ä¿¡æ¯äº¤äº’"></a>è·¨é€šé“çš„ä¿¡æ¯äº¤äº’</h3><p>1x1å·ç§¯æ ¸åªæœ‰ä¸€ä¸ªå‚æ•°ï¼Œå½“å®ƒä½œç”¨åœ¨å¤šé€šé“çš„feature mapä¸Šæ—¶ï¼Œç›¸å½“äºä¸åŒé€šé“ä¸Šçš„ä¸€ä¸ªçº¿æ€§ç»„åˆï¼Œå®é™…ä¸Šå°±æ˜¯ä¹˜ä»¥ä¸€ä¸ªç³»æ•°å†åŠ èµ·æ¥ï¼Œä½†æ˜¯è¿™æ ·è¾“å‡ºçš„feature mapå°±æ˜¯å¤šä¸ªé€šé“çš„æ•´åˆä¿¡æ¯äº†ï¼Œèƒ½å¤Ÿä½¿ç½‘ç»œæå–çš„ç‰¹å¾æ›´åŠ ä¸°å¯Œã€‚</p><p>ä½¿ç”¨1x1å·ç§¯æ ¸ï¼Œå®ç°é™ç»´å’Œå‡ç»´çš„æ“ä½œå…¶å®å°±æ˜¯ channel é—´ä¿¡æ¯çš„çº¿æ€§ç»„åˆå˜åŒ–ã€‚</p><p>æ¯”å¦‚ï¼šåœ¨å°ºå¯¸ 3x3ï¼Œ64é€šé“ä¸ªæ•°çš„å·ç§¯æ ¸åé¢æ·»åŠ ä¸€ä¸ªå°ºå¯¸1x1ï¼Œ28é€šé“ä¸ªæ•°çš„å·ç§¯æ ¸ï¼Œå°±å˜æˆäº†å°ºå¯¸3x3ï¼Œ28å°ºå¯¸çš„å·ç§¯æ ¸ã€‚ åŸæ¥çš„64ä¸ªé€šé“å°±å¯ä»¥ç†è§£ä¸ºè·¨é€šé“çº¿æ€§ç»„åˆå˜æˆäº†28é€šé“ï¼Œè¿™å°±æ˜¯é€šé“é—´çš„ä¿¡æ¯äº¤äº’ã€‚</p><p>æ³¨æ„ï¼šåªæ˜¯åœ¨é€šé“ç»´åº¦ä¸Šåšçº¿æ€§ç»„åˆï¼ŒWå’ŒHä¸Šæ˜¯å…±äº«æƒå€¼çš„æ»‘åŠ¨çª—å£ã€‚</p><h3 id="å‡å°‘å·ç§¯æ ¸å‚æ•°ï¼ˆç®€åŒ–æ¨¡å‹ï¼‰"><a href="#å‡å°‘å·ç§¯æ ¸å‚æ•°ï¼ˆç®€åŒ–æ¨¡å‹ï¼‰" class="headerlink" title="å‡å°‘å·ç§¯æ ¸å‚æ•°ï¼ˆç®€åŒ–æ¨¡å‹ï¼‰"></a>å‡å°‘å·ç§¯æ ¸å‚æ•°ï¼ˆç®€åŒ–æ¨¡å‹ï¼‰</h3><p>ä¸‹é¢ä»…ä»¥è®¡ç®—æƒé‡æ•°ä¸ºä¾‹å­è¿›è¡Œè®¡ç®—ï¼ˆä¸æ·»åŠ åå·®biasï¼‰</p><h4 id="ä¸€å±‚å·ç§¯æ·»åŠ 1x1å·ç§¯æ ¸ï¼Œåˆ†åˆ«è®¡ç®—æƒé‡æ•°"><a href="#ä¸€å±‚å·ç§¯æ·»åŠ 1x1å·ç§¯æ ¸ï¼Œåˆ†åˆ«è®¡ç®—æƒé‡æ•°" class="headerlink" title="ä¸€å±‚å·ç§¯æ·»åŠ 1x1å·ç§¯æ ¸ï¼Œåˆ†åˆ«è®¡ç®—æƒé‡æ•°"></a>ä¸€å±‚å·ç§¯æ·»åŠ 1x1å·ç§¯æ ¸ï¼Œåˆ†åˆ«è®¡ç®—æƒé‡æ•°</h4><ul><li><p>ä¸ä½¿ç”¨1x1å·ç§¯æ ¸</p>  <div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.839stz0ial.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.839stz0ial.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div></li><li><p>ä½¿ç”¨1x1å·ç§¯æ ¸</p>  <div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.73tpgsyher.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.73tpgsyher.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div></li></ul><p>å¯ä»¥çœ‹åˆ°ä¸ä½¿ç”¨1x1çš„å·ç§¯æ ¸æ˜¯ä½¿ç”¨å·ç§¯æ ¸çš„10å€å·¦å³</p><h4 id="GoogLeNetçš„3aæ¨¡å—"><a href="#GoogLeNetçš„3aæ¨¡å—" class="headerlink" title="GoogLeNetçš„3aæ¨¡å—"></a>GoogLeNetçš„3aæ¨¡å—</h4><ul><li>ä¸ä½¿ç”¨1x1å·ç§¯æ ¸  <div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.58h4o6olfv.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.58h4o6olfv.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div>  <div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.13ljc2ryvv.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.13ljc2ryvv.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div>æƒé‡æ•°ï¼š192 Ã— (1Ã—1Ã—64) +192 Ã— (3Ã—3Ã—128) + 192 Ã— (5Ã—5Ã—32) &#x3D; 387072<br>è¿™ä¸ªç½‘ç»œçš„è¯´æ˜å¦‚ä¸‹</li></ul><ol><li>é‡‡ç”¨ä¸åŒå¤§å°çš„å·ç§¯æ ¸æ„å‘³ç€ä¸åŒå¤§å°çš„æ„Ÿå—é‡ï¼Œæœ€åæ‹¼æ¥æ„å‘³ç€ä¸åŒå°ºåº¦ç‰¹å¾çš„èåˆï¼›</li><li>ä¹‹æ‰€ä»¥å·ç§¯æ ¸å¤§å°é‡‡ç”¨1ã€3å’Œ5ï¼Œä¸»è¦æ˜¯ä¸ºäº†æ–¹ä¾¿å¯¹é½ã€‚è®¾å®šå·ç§¯æ­¥é•¿stride&#x3D;1ä¹‹åï¼Œåªè¦åˆ†åˆ«è®¾å®špad&#x3D;0ã€1ã€2ï¼Œé‚£ä¹ˆå·ç§¯ä¹‹åä¾¿å¯ä»¥å¾—åˆ°ç›¸åŒç»´åº¦çš„ç‰¹å¾ï¼Œç„¶åè¿™äº›ç‰¹å¾å°±å¯ä»¥ç›´æ¥æ‹¼æ¥åœ¨ä¸€èµ·äº†ï¼›</li><li>æ–‡ç« è¯´å¾ˆå¤šåœ°æ–¹éƒ½è¡¨æ˜poolingæŒºæœ‰æ•ˆï¼Œæ‰€ä»¥Inceptioné‡Œé¢ä¹ŸåµŒå…¥äº†ã€‚</li><li>ç½‘ç»œè¶Šåˆ°åé¢ï¼Œç‰¹å¾è¶ŠæŠ½è±¡ï¼Œè€Œä¸”æ¯ä¸ªç‰¹å¾æ‰€æ¶‰åŠçš„æ„Ÿå—é‡ä¹Ÿæ›´å¤§äº†ï¼Œå› æ­¤éšç€å±‚æ•°çš„å¢åŠ ï¼Œ3x3å’Œ5x5å·ç§¯çš„æ¯”ä¾‹ä¹Ÿè¦å¢åŠ ã€‚</li></ol><ul><li>ä½¿ç”¨1x1å·ç§¯æ ¸  <div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.2a4ukoith5.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.2a4ukoith5.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div>  <div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.7zq6w9eiya.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.7zq6w9eiya.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div></li></ul><p>æƒé‡æ•°ï¼š192 Ã— (1Ã—1Ã—64) +ï¼ˆ192Ã—1Ã—1Ã—96+ 96 Ã— 3Ã—3Ã—128ï¼‰+ï¼ˆ192Ã—1Ã—1Ã—16+16Ã—5Ã—5Ã—32ï¼‰&#x3D; 157184</p><p>ä¸ä½¿ç”¨1x1çš„å·ç§¯æ ¸æ˜¯ä½¿ç”¨1x1å·ç§¯æ ¸çš„æƒé‡æ•°2å€</p><h4 id="ResNet"><a href="#ResNet" class="headerlink" title="ResNet"></a>ResNet</h4><p>ResNetåŒæ ·ä¹Ÿåˆ©ç”¨äº†1Ã—1å·ç§¯ï¼Œå¹¶ä¸”æ˜¯åœ¨3Ã—3å·ç§¯å±‚çš„å‰åéƒ½ä½¿ç”¨äº†ï¼Œä¸ä»…è¿›è¡Œäº†é™ç»´ï¼Œè¿˜è¿›è¡Œäº†å‡ç»´ï¼Œå‚æ•°æ•°é‡è¿›ä¸€æ­¥å‡å°‘</p><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.8ojgga406k.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.8ojgga406k.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div><p>å…¶ä¸­å³å›¾åˆç§°ä¸º<code>bottleneck design</code>ï¼Œç›®çš„ä¸€ç›®äº†ç„¶ï¼Œå°±æ˜¯ä¸ºäº†é™ä½å‚æ•°çš„æ•°ç›®ï¼Œç¬¬ä¸€ä¸ª1x1çš„å·ç§¯æŠŠ256ç»´channelé™åˆ°64ç»´ï¼Œç„¶ååœ¨æœ€åé€šè¿‡1x1å·ç§¯æ¢å¤ï¼Œ<br>å½“æˆ‘ä»¬çš„ç‰¹å¾å›¾é€šé“æ•°ä¸º256æ—¶ï¼Œå˜å¾—å¾ˆå¤§ï¼Œå‡ºç°çš„é—®é¢˜æ˜¯è®¡ç®—å¤æ‚åº¦ä¼šå¾ˆé«˜ï¼Œè¿™é‡Œåšæ³•æ˜¯é€šè¿‡1Ã—1å·ç§¯æŠ•å½±æ˜ å°„å›64ç»´ï¼Œå†åšä¸€ä¸ª3Ã—3é€šé“æ•°ä¸å˜çš„å·ç§¯ï¼Œç„¶åå†é€šè¿‡1Ã—1å·ç§¯æŠ•å½±å›å»256ç»´ï¼Œå› ä¸ºè¾“å…¥æ˜¯256ç»´ï¼Œè¾“å‡ºè¦åŒ¹é…ä¸Šï¼Œè¿™æ ·è®¾è®¡ä¹‹åå¤æ‚åº¦å°±è·Ÿå·¦å›¾å·®ä¸å¤šäº†ã€‚<br>å·¦å›¾å‚æ•°é‡ï¼š64 x ( 3 x 3 x 64)+64 x ( 3 x 3 x 64 ) &#x3D; 73728<br>å½“é€šé“æ•°å¢åŠ åˆ° 256æ—¶ï¼š256 x ( 3 x 3 x 256 ) + 256 x ( 3 x 3 x 256 ) &#x3D; 1179648<br>å³å›¾å‚æ•°é‡ï¼š256 x ( 1 x 1 x 64) + 64 x ( 3 x 3 x 64 ) + 256 x ( 1 x 1 x 64) &#x3D; 69632</p><p>å½“é€šé“æ•°å¢åŠ ä¸º256æ—¶ï¼Œå¯ä»¥å‘ç°æ·»åŠ ä¸¤å±‚1x1çš„å·ç§¯çš„å‚æ•°é‡å’Œ64ä¸ºåŸæœ‰æ®‹å·®å—å‚æ•°é‡å·®ä¸å¤šã€‚</p><p>å¯¹äºå¸¸è§„ResNetï¼Œå¯ä»¥ç”¨äº34å±‚æˆ–è€…æ›´å°‘çš„ç½‘ç»œä¸­ï¼Œå¯¹äºBottleneck Designçš„ResNeté€šå¸¸ç”¨äºæ›´æ·±çš„ç½‘ç»œä¸­ï¼Œç›®çš„æ˜¯å‡å°‘è®¡ç®—å’Œå‚æ•°é‡ï¼ˆå®ç”¨ç›®çš„ï¼‰</p>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;img-wrap&quot;&gt;&lt;div class=&quot;img-bg&quot;&gt;&lt;img class=&quot;img lazyload placeholder&quot; src=&quot;https://tumytime.github.io/picx-images-hosting/image.7a</summary>
      
    
    
    
    <category term="æ™ºèƒ½è½¦" scheme="http://tumytime.github.io/categories/%E6%99%BA%E8%83%BD%E8%BD%A6/"/>
    
    
    <category term="Python" scheme="http://tumytime.github.io/tags/Python/"/>
    
    <category term="æ·±åº¦å­¦ä¹ " scheme="http://tumytime.github.io/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="æ™ºèƒ½è½¦" scheme="http://tumytime.github.io/tags/%E6%99%BA%E8%83%BD%E8%BD%A6/"/>
    
  </entry>
  
  <entry>
    <title>æ®‹å·®ç½‘ç»œ</title>
    <link href="http://tumytime.github.io/2024/03/21/%E6%AE%8B%E5%B7%AE%E7%BD%91%E7%BB%9C/"/>
    <id>http://tumytime.github.io/2024/03/21/%E6%AE%8B%E5%B7%AE%E7%BD%91%E7%BB%9C/</id>
    <published>2024-03-21T08:49:21.000Z</published>
    <updated>2024-03-22T11:59:17.558Z</updated>
    
    <content type="html"><![CDATA[<div class="tagLink"><a class="link-card" title="è¯¦è§£æ®‹å·®ç½‘ç»œ" href="https://zhuanlan.zhihu.com/p/42706477"><span class="link-card-backdrop" style="background-image: url(https://pic2.zhimg.com/80/v2-bd76d0f10f84d74f90505eababd3d4a1_1440w.webp)"></span><div class="left"><img src="https://pic2.zhimg.com/80/v2-bd76d0f10f84d74f90505eababd3d4a1_1440w.webp" class="lazyload placeholder" data-srcset="https://pic2.zhimg.com/80/v2-bd76d0f10f84d74f90505eababd3d4a1_1440w.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div><div class="right"><p class="text">è¯¦è§£æ®‹å·®ç½‘ç»œ</p><p class="url">https://zhuanlan.zhihu.com/p/42706477</p></div></a></div><h2 id="WHYè¦æœ‰æ®‹å·®ç½‘ç»œ"><a href="#WHYè¦æœ‰æ®‹å·®ç½‘ç»œ" class="headerlink" title="WHYè¦æœ‰æ®‹å·®ç½‘ç»œ"></a><strong>WHYè¦æœ‰æ®‹å·®ç½‘ç»œ</strong></h2><blockquote><ul><li><p>é¦–å…ˆï¼Œå½“ç½‘ç»œå‘ç”Ÿé€€åŒ–æ—¶ï¼Œæ„å‘³ç€éšç€ç½‘ç»œå±‚æ•°çš„å¢åŠ ï¼Œæ¨¡å‹çš„æ€§èƒ½å¹¶æ²¡æœ‰ç›¸åº”åœ°æé«˜ï¼Œç”šè‡³å¯èƒ½å˜å¾—æ›´å·®ã€‚è¿™é€šå¸¸æ˜¯ç”±äºæ¢¯åº¦æ¶ˆå¤±ã€æ¢¯åº¦çˆ†ç‚¸æˆ–è€…æ¨¡å‹ä¼˜åŒ–éš¾åº¦å¢åŠ å¯¼è‡´çš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæµ…å±‚çš„ç½‘ç»œç”±äºæ¨¡å‹å¤æ‚åº¦è¾ƒä½ï¼Œå¯èƒ½æ›´å®¹æ˜“ä¼˜åŒ–ï¼Œå› æ­¤èƒ½å¤Ÿè¾¾åˆ°æ›´å¥½çš„è®­ç»ƒæ•ˆæœã€‚</p></li><li><p>æ¥ä¸‹æ¥ï¼Œå¦‚æœæˆ‘ä»¬èƒ½å¤Ÿ<strong>å°†ä½å±‚çš„ç‰¹å¾æœ‰æ•ˆåœ°ä¼ é€’åˆ°é«˜å±‚</strong>ï¼Œé‚£ä¹ˆé«˜å±‚ç½‘ç»œå°±æœ‰å¯èƒ½åˆ©ç”¨è¿™äº›æœ‰ç”¨çš„ç‰¹å¾æ¥æé«˜æ€§èƒ½ã€‚è¿™æ˜¯å› ä¸ºåœ¨æ·±åº¦å­¦ä¹ ä¸­ï¼Œ<strong>ä½å±‚ç½‘ç»œ</strong>é€šå¸¸å­¦ä¹ ä¸€äº›<strong>åŸºæœ¬çš„ã€é€šç”¨çš„ç‰¹å¾</strong>ï¼ˆå¦‚è¾¹ç¼˜ã€çº¹ç†ç­‰ï¼‰ï¼Œè€Œé«˜å±‚ç½‘ç»œåˆ™åœ¨æ­¤åŸºç¡€ä¸Šå­¦ä¹ æ›´å¤æ‚çš„ç‰¹å¾ã€‚å¦‚æœ<strong>é«˜å±‚ç½‘ç»œèƒ½å¤Ÿé‡ç”¨è¿™äº›ä½å±‚çš„ç‰¹å¾ï¼Œé‚£ä¹ˆå®ƒå°±æœ‰å¯èƒ½è¾¾åˆ°ç”šè‡³è¶…è¿‡æµ…å±‚ç½‘ç»œçš„æ€§èƒ½</strong>ã€‚</p></li><li><p>ä»¥VGG-100å’ŒVGG-16ä¸ºä¾‹ï¼Œå‡è®¾æˆ‘ä»¬åœ¨VGG-100çš„ç¬¬98å±‚å’Œç¬¬14å±‚ä¹‹é—´<strong>æ·»åŠ ä¸€æ¡ç›´æ¥æ˜ å°„</strong>ï¼ˆIdentity Mappingï¼‰ã€‚è¿™æ„å‘³ç€ç¬¬98å±‚çš„è¾“å‡ºå°†åŒ…å«ç¬¬14å±‚çš„è¾“å‡ºä½œä¸ºå…¶ä¸€éƒ¨åˆ†ã€‚<strong>å¦‚æœè¿™æ¡ç›´æ¥æ˜ å°„èƒ½å¤Ÿæœ‰æ•ˆåœ°ä¼ é€’æœ‰ç”¨çš„ç‰¹å¾ï¼Œå¹¶ä¸”é«˜å±‚ç½‘ç»œèƒ½å¤Ÿæœ‰æ•ˆåœ°åˆ©ç”¨è¿™äº›ç‰¹å¾ï¼Œé‚£ä¹ˆVGG-100çš„æ€§èƒ½ç†è®ºä¸Šåº”è¯¥è‡³å°‘ä¸VGG-16ç›¸å½“ï¼Œç”šè‡³å¯èƒ½æ›´å¥½ã€‚</strong></p></li><li><p>ç„¶è€Œï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç›´æ¥æ˜ å°„å¹¶ä¸æ„å‘³ç€ç®€å•åœ°å¤åˆ¶å’Œç²˜è´´ç‰¹å¾ã€‚å®ƒéœ€è¦ä»¥ä¸€ç§æœ‰æ•ˆçš„æ–¹å¼å°†ä½å±‚ç‰¹å¾æ•´åˆåˆ°é«˜å±‚ç½‘ç»œä¸­ï¼Œä»¥ç¡®ä¿é«˜å±‚ç½‘ç»œèƒ½å¤Ÿå……åˆ†åˆ©ç”¨è¿™äº›ç‰¹å¾ã€‚æ­¤å¤–ï¼Œè¿˜éœ€è¦è€ƒè™‘å¦‚ä½•å¹³è¡¡æ–°æ—§ç‰¹å¾ä¹‹é—´çš„å…³ç³»ï¼Œä»¥åŠå¦‚ä½•å¤„ç†ç‰¹å¾ç»´åº¦ä¸åŒ¹é…ç­‰é—®é¢˜ã€‚</p></li><li><p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œç›´æ¥æ˜ å°„çš„ç­–ç•¥å·²ç»åœ¨ä¸€äº›æ·±åº¦å­¦ä¹ æ¶æ„ä¸­å¾—åˆ°äº†åº”ç”¨ï¼Œå¦‚<strong>æ®‹å·®ç½‘ç»œï¼ˆResNetï¼‰å’Œå¯†é›†è¿æ¥ç½‘ç»œï¼ˆDenseNetï¼‰</strong>ã€‚è¿™äº›ç½‘ç»œé€šè¿‡å¼•å…¥æ®‹å·®å—æˆ–å¯†é›†è¿æ¥æ¥å®ç°ç›´æ¥æ˜ å°„ï¼Œä»è€Œæœ‰æ•ˆåœ°ç¼“è§£äº†ç½‘ç»œé€€åŒ–çš„é—®é¢˜ï¼Œå¹¶æé«˜äº†æ¨¡å‹çš„æ€§èƒ½ã€‚</p></li></ul></blockquote><details open><summary pointer> é«˜å±‚ç½‘ç»œ </summary>              <div class='content'>              <blockquote><p>åœ¨ä¸€ä¸ªç¥ç»ç½‘ç»œä¸­ï¼Œç¦»è¾“å…¥å±‚æ›´è¿œçš„ç½‘ç»œå±‚é€šå¸¸è¢«ç§°ä¸ºâ€œæ·±å±‚ç½‘ç»œâ€æˆ–â€œé«˜å±‚ç½‘ç»œâ€ï¼Œå› ä¸ºå®ƒä»¬åœ¨ç½‘ç»œä¸­çš„ä½ç½®æ›´æ·±æˆ–æ›´é è¿‘ç½‘ç»œçš„ä¸­é—´éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯ç›´æ¥ä¸è¾“å‡ºå±‚ç›¸è¿ã€‚è¿™äº›æ·±å±‚ç½‘ç»œé€šå¸¸åŒ…æ‹¬å¤šä¸ªéšè—å±‚ï¼Œå¹¶ä¸”åœ¨ç½‘ç»œçš„å±‚æ¬¡ç»“æ„ä¸­æ‰®æ¼”é‡è¦çš„è§’è‰²ï¼Œç”¨äºæå–æ›´åŠ æŠ½è±¡å’Œé«˜çº§çš„ç‰¹å¾ä¿¡æ¯ã€‚<br>ä¸€ä¸ªç¥ç»ç½‘ç»œçš„å±‚æ¬¡ç»“æ„é€šå¸¸åŒ…æ‹¬è¾“å…¥å±‚ã€å¤šä¸ªéšè—å±‚ï¼ˆåŒ…æ‹¬æ·±å±‚ç½‘ç»œï¼‰å’Œè¾“å‡ºå±‚ã€‚æ·±å±‚ç½‘ç»œåœ¨éšè—å±‚ä¸­é—´ä½ç½®ï¼Œè¿œç¦»è¾“å…¥å±‚ä½†ä¸æ˜¯é è¿‘è¾“å‡ºå±‚ï¼Œå› ä¸ºæ·±å±‚ç½‘ç»œé€šå¸¸åœ¨å¤šå±‚ç¥ç»ç½‘ç»œçš„ç»“æ„ä¸­å¤„äºä¸­é—´ä½ç½®ã€‚<br>å› æ­¤ï¼Œæ·±å±‚ç½‘ç»œä½äºè¾“å…¥å±‚å’Œè¾“å‡ºå±‚ä¹‹é—´ï¼Œé€šè¿‡å¤šä¸ªéšè—å±‚å¤„ç†è¾“å…¥æ•°æ®ï¼Œé€æ­¥æå–å’Œå­¦ä¹ ç‰¹å¾ï¼Œæœ€ç»ˆä¸ºè¾“å‡ºå±‚æä¾›ç»è¿‡å¤šæ¬¡éçº¿æ€§å˜æ¢åçš„è¡¨ç¤ºä»¥å®Œæˆå…·ä½“ä»»åŠ¡ã€‚æ·±åº¦å­¦ä¹ æ¨¡å‹çš„æ·±åº¦é€šå¸¸æŒ‡çš„æ˜¯éšè—å±‚çš„å±‚æ•°ï¼Œè€Œæ·±å±‚ç½‘ç»œåˆ™æ˜¯æŒ‡åŒ…å«å¤šä¸ªéšè—å±‚çš„éƒ¨åˆ†ã€‚</p></blockquote><blockquote><p>é«˜å±‚ç½‘ç»œï¼ˆå³æ·±å±‚ç½‘ç»œï¼‰åœ¨æ·±åº¦å­¦ä¹ ä¸­å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><ol><li><p><strong>å¤šå±‚ç»“æ„</strong>ï¼šé«˜å±‚ç½‘ç»œç”±å¤šä¸ªéšè—å±‚ç»„æˆï¼Œæ¯ä¸€å±‚éƒ½åŒ…å«å¤§é‡çš„ç¥ç»å…ƒã€‚é€šè¿‡å¤šå±‚ç»“æ„ï¼Œç½‘ç»œå¯ä»¥å­¦ä¹ å’Œè¡¨ç¤ºæ›´åŠ å¤æ‚å’ŒæŠ½è±¡çš„ç‰¹å¾ã€‚</p></li><li><p><strong>å±‚é—´è¿æ¥</strong>ï¼šä¸åŒå±‚ä¹‹é—´çš„ç¥ç»å…ƒç›¸äº’è¿æ¥ï¼Œä¿¡æ¯é€å±‚ä¼ é€’ã€‚æ¯ä¸€å±‚çš„è¾“å‡ºä½œä¸ºä¸‹ä¸€å±‚çš„è¾“å…¥ï¼Œé€šè¿‡å±‚é—´è¿æ¥å®ç°ç‰¹å¾çš„ç»„åˆå’ŒæŠ½è±¡ã€‚</p></li><li><p><strong>ç‰¹å¾æå–</strong>ï¼šé«˜å±‚ç½‘ç»œå¯ä»¥é€šè¿‡å¤šä¸ªéšè—å±‚é€æ­¥æå–æ•°æ®ä¸­çš„ç‰¹å¾ä¿¡æ¯ï¼Œä»ä½çº§ç‰¹å¾åˆ°é«˜çº§ç‰¹å¾çš„é€æ¸æŠ½è±¡è¿‡ç¨‹æœ‰åŠ©äºç½‘ç»œå­¦ä¹ æ›´æ·±å±‚æ¬¡çš„è¡¨ç¤ºã€‚</p></li><li><p><strong>è¡¨å¾å­¦ä¹ </strong>ï¼šé€šè¿‡æ·±åº¦å­¦ä¹ ï¼Œé«˜å±‚ç½‘ç»œå¯ä»¥è‡ªåŠ¨å­¦ä¹ è¡¨ç¤ºæ•°æ®çš„ç‰¹å¾ï¼Œè€Œæ— éœ€æ‰‹å·¥è®¾è®¡ç‰¹å¾æå–å™¨ã€‚è¿™ç§è¡¨å¾å­¦ä¹ çš„æ–¹å¼èƒ½å¤Ÿæ›´å¥½åœ°é€‚åº”ä¸åŒç±»å‹çš„æ•°æ®å’Œä»»åŠ¡ã€‚</p></li><li><p><strong>éçº¿æ€§å˜æ¢</strong>ï¼šé«˜å±‚ç½‘ç»œé€šè¿‡æ¿€æ´»å‡½æ•°å¼•å…¥éçº¿æ€§å˜æ¢ï¼Œä½¿ç½‘ç»œèƒ½å¤Ÿå­¦ä¹ å’Œè¡¨ç¤ºæ›´åŠ å¤æ‚çš„å‡½æ•°å…³ç³»ã€‚éçº¿æ€§æ¿€æ´»å‡½æ•°å¦‚ReLUã€Sigmoidç­‰æœ‰åŠ©äºç½‘ç»œå­¦ä¹ éçº¿æ€§æ¨¡å¼ã€‚</p></li><li><p><strong>ç«¯å¯¹ç«¯å­¦ä¹ </strong>ï¼šé«˜å±‚ç½‘ç»œæ”¯æŒç«¯å¯¹ç«¯å­¦ä¹ ï¼Œå³ä»åŸå§‹è¾“å…¥æ•°æ®ç«¯åˆ°æœ€ç»ˆè¾“å‡ºç»“æœç«¯çš„å…¨è¿‡ç¨‹è®­ç»ƒã€‚è¿™ç§ç«¯å¯¹ç«¯å­¦ä¹ èƒ½å¤Ÿæ›´å¥½åœ°ä¼˜åŒ–æ•´ä¸ªæ¨¡å‹ï¼Œæé«˜æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›å’Œæ€§èƒ½ã€‚</p></li></ol><p>æ€»çš„æ¥è¯´ï¼Œé«˜å±‚ç½‘ç»œçš„ç‰¹ç‚¹åŒ…æ‹¬å¤šå±‚ç»“æ„ã€ç‰¹å¾æå–ã€è¡¨å¾å­¦ä¹ ã€éçº¿æ€§å˜æ¢ç­‰ï¼Œä½¿å¾—æ·±åº¦å­¦ä¹ æ¨¡å‹èƒ½å¤Ÿæ›´å¥½åœ°é€‚åº”å’Œè§£å†³å¤æ‚çš„æœºå™¨å­¦ä¹ ä»»åŠ¡ã€‚</p></blockquote><blockquote><p>åœ¨æ·±åº¦ç¥ç»ç½‘ç»œä¸­ï¼Œä¸€æ—¦åˆ°è¾¾æœ€æ·±å±‚çº§ï¼Œé€šå¸¸ä¼šå¯¹ç½‘ç»œè¿›è¡Œä¸€äº›æ“ä½œï¼Œä»¥é™ä½ç½‘ç»œçš„æ·±åº¦æˆ–å‡å°‘å‚æ•°æ•°é‡ï¼Œä½¿æ¥ä¸‹æ¥çš„å±‚çº§é€æ¸å˜æµ…ã€‚è¿™äº›æ“ä½œåŒ…æ‹¬ï¼š</p><ol><li><p><strong>é™é‡‡æ ·ï¼ˆDownsamplingï¼‰</strong>ï¼šé€šè¿‡æ± åŒ–æ“ä½œï¼ˆå¦‚æœ€å¤§æ± åŒ–æˆ–å¹³å‡æ± åŒ–ï¼‰æˆ–æ­¥é•¿è¾ƒå¤§çš„å·ç§¯æ“ä½œæ¥å‡å°‘ç‰¹å¾å›¾çš„å®½åº¦å’Œé«˜åº¦ï¼Œä»è€Œå‡å°‘ä¸‹ä¸€å±‚çš„ç¥ç»å…ƒæ•°é‡ã€‚</p></li><li><p><strong>ç‰¹å¾åˆå¹¶ï¼ˆFeature Concatenationï¼‰</strong>ï¼šå°†å‰å‡ å±‚æå–çš„é«˜çº§ç‰¹å¾ä¸æµ…å±‚ç‰¹å¾è¿›è¡Œè¿æ¥æˆ–æ‹¼æ¥ï¼Œä½¿å¾—ç½‘ç»œåœ¨æ¥ä¸‹æ¥å±‚çº§ä¸­ä¸éœ€è¦å†å­¦ä¹ è¿™äº›é«˜çº§ç‰¹å¾ï¼Œä»è€Œå‡å°‘ç½‘ç»œçš„æ·±åº¦ã€‚</p></li><li><p><strong>ç‰¹å¾é€‰æ‹©ï¼ˆFeature Selectionï¼‰</strong>ï¼šå¯¹äºæŸäº›ç‰¹å¾è¿›è¡Œç­›é€‰æˆ–é™ç»´ï¼Œåªä¿ç•™æœ€é‡è¦çš„ç‰¹å¾ï¼Œå¯ä»¥é€šè¿‡é™ç»´æŠ€æœ¯ï¼ˆå¦‚ä¸»æˆåˆ†åˆ†æï¼‰æ¥å®ç°ã€‚</p></li><li><p><strong>æ®‹å·®è¿æ¥ï¼ˆResidual Connectionsï¼‰</strong>ï¼šåœ¨æ®‹å·®ç½‘ç»œï¼ˆResNetï¼‰ä¸­ä½¿ç”¨æ®‹å·®è¿æ¥ï¼Œä½¿å¾—æ·±å±‚ç½‘ç»œå¯ä»¥é€šè¿‡è·³è¿‡è¿æ¥è·å¾—æµ…å±‚ç½‘ç»œçš„ä¿¡æ¯ï¼Œä»è€Œå‡å°‘æ·±å±‚ç½‘ç»œçš„å †å å±‚æ•°ã€‚</p></li><li><p><strong>ç‰¹å¾æ˜ å°„ï¼ˆFeature Mappingï¼‰</strong>ï¼šé€šè¿‡å¯¹ç‰¹å¾å›¾è¿›è¡Œé€å±‚æ˜ å°„æˆ–æŠ½å–è¡¨ç¤ºï¼Œå¯ä»¥å°†åŸå§‹çš„æ·±å±‚ç‰¹å¾æ˜ å°„åˆ°æµ…å±‚ç½‘ç»œä¸­ï¼Œå‡å°‘ç½‘ç»œçš„æ·±åº¦ã€‚</p></li></ol><p>è¿™äº›æ“ä½œæ—¨åœ¨æé«˜ç½‘ç»œçš„æ•ˆç‡å’Œæ³›åŒ–èƒ½åŠ›ï¼Œé¿å…æ·±åº¦è¿‡æ·±å¯¼è‡´çš„æ¢¯åº¦æ¶ˆå¤±ã€è®¡ç®—é‡å¢åŠ å’Œè¿‡æ‹Ÿåˆç­‰é—®é¢˜ã€‚é€šè¿‡é€‚å½“çš„æ“ä½œï¼Œå¯ä»¥ä½¿æ·±åº¦ç¥ç»ç½‘ç»œåœ¨ä¿æŒè‰¯å¥½æ€§èƒ½çš„åŒæ—¶ï¼Œå‡å°‘æ·±åº¦æˆ–å±‚çº§ï¼Œæé«˜ç½‘ç»œçš„è®­ç»ƒæ•ˆç‡å’Œæ€§èƒ½ã€‚</p></blockquote>              </div>            </details><details open><summary pointer> CNNä¸­çš„åº•å±‚ã€é«˜å±‚ç‰¹å¾ã€ä¸Šä¸‹æ–‡ä¿¡æ¯ã€å¤šå°ºåº¦ </summary>              <div class='content'>              <ol><li><p><strong>CNNä¸­çš„åº•å±‚ã€é«˜å±‚ç‰¹å¾:</strong></p><p> ç®€çŸ­æ€»ç»“ï¼š åˆ†ç±»è¦æ±‚ç‰¹å¾æœ‰è¾ƒå¤šçš„é«˜çº§ä¿¡æ¯ï¼Œå›å½’ï¼ˆå®šä½ï¼‰è¦æ±‚ç‰¹å¾åŒ…å«æ›´å¤šçš„ç»†èŠ‚ä¿¡æ¯</p><ul><li><p><strong>å›¾åƒçš„ä½å±‚ç‰¹å¾</strong>ï¼ˆå¯¹å®šä½ä»»åŠ¡å¸®åŠ©å¤§ï¼Œæˆ‘ä»¬å¯ä»¥æƒ³æƒ³æ¯”å¦‚è½®å»“ä¿¡æ¯éƒ½ä¸å‡†é‚£æ€ä¹ˆå»è‰¯å¥½å®šä½ï¼‰:</p><p>  å›¾åƒåº•å±‚ç‰¹å¾æŒ‡çš„æ˜¯ï¼šè½®å»“ã€è¾¹ç¼˜ã€é¢œè‰²ã€çº¹ç†ã€æ£±è§’å’Œå½¢çŠ¶ç‰¹å¾ã€‚</p><p>  è¾¹ç¼˜å’Œè½®å»“èƒ½åæ˜ å›¾åƒå†…å®¹ï¼›å¦‚æœèƒ½å¯¹è¾¹ç¼˜å’Œå…³é”®ç‚¹è¿›è¡Œå¯é æå–çš„è¯ï¼Œå¾ˆå¤šè§†è§‰é—®é¢˜å°±åŸºæœ¬ä¸Šå¾—åˆ°äº†è§£å†³ã€‚å›¾åƒçš„ä½å±‚çš„ç‰¹å¾è¯­ä¹‰ä¿¡æ¯æ¯”è¾ƒå°‘ï¼Œä½†è¶Šæµ…çš„å±‚ç‰¹å¾è¶Šç»†èŠ‚ï¼ˆä½çº§ï¼‰ä¸”ç‰¹å¾å›¾åˆ†è¾¨ç‡å¤§ï¼Œæ‰€ä»¥ä½ç½®ä¿¡æ¯å¾ˆå……è¶³ï¼Œç›®æ ‡ä½ç½®å‡†ç¡®ã€‚å†ä»å¦ä¸€ä¸ªæ–¹é¢è®²ï¼Œè¶Šæµ…å±‚çš„ç‰¹å¾æ„Ÿå—é‡è¶Šå°ï¼ˆæ¯ä¸ªåƒç´ ç‚¹æ˜ å°„å›åŸå›¾çš„è¦†ç›–é¢ç§¯å°ï¼‰ï¼Œæ•…ç”¨æµ…å±‚ç‰¹å¾å›¾æ£€æµ‹å¤§ç›®æ ‡æ—¶å°±æœ‰ç‚¹åƒçå­æ‘¸è±¡çš„æ„Ÿè§‰æ•ˆæœå¹¶ä¸å¥½ï¼Œå› ä¸ºå…‰èƒ½çœ‹åˆ°è±¡è…¿ä¹Ÿä¸çŸ¥é“è¿™æ˜¯å•¥ä¸œè¥¿ã€‚å½“ç„¶å¯¹äºå°ç›®æ ‡æ£€æµ‹æ¥è¯´å¦‚æœèƒ½åˆ©ç”¨è¶³å¤Ÿçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ä¹Ÿæ˜¯æœ‰å¥½å¤„çš„ï¼ä¾‹å¦‚ï¼Œé€šè¿‡åªçœ‹å›¾ä¸­çš„ä¸€ä¸ªå°ç›®æ ‡æ‰€åœ¨çš„é‚£ä¸ªä½ç½®ï¼Œäººç±»ç”šè‡³å¾ˆéš¾è¯†åˆ«è¿™äº›ç‰©ä½“ã€‚ç„¶è€Œï¼Œé€šè¿‡è€ƒè™‘åˆ°å®ƒä½äºå¤©ç©ºä¸­çš„èƒŒæ™¯ï¼Œè¿™ä¸ªç‰©ä½“å¯ä»¥è¢«è¯†åˆ«ä¸ºé¸Ÿç±»ã€‚å› æ­¤ï¼Œæˆ‘ä»¬è®¤ä¸ºï¼Œè§£å†³è¿™ä¸ªé—®é¢˜çš„å…³é”®å–å†³äºæˆ‘ä»¬å¦‚ä½•å°†ä¸Šä¸‹æ–‡ä½œä¸ºé¢å¤–ä¿¡æ¯æ¥å¸®åŠ©æ£€æµ‹å°ç›®æ ‡ã€‚</p></li><li><p><strong>å›¾åƒçš„é«˜å±‚ç‰¹å¾</strong>ä¹Ÿå«è¯­ä¹‰ç‰¹å¾ï¼ˆé«˜å±‚ç‰¹å¾å³CNNä¸­ç½‘ç»œè¶Šæ·±çš„å±‚å¾—åˆ°çš„ç‰¹å¾ï¼Œé«˜å±‚çš„ç‰¹å¾åŒ…å«å¾ˆä¸°å¯Œçš„ç»„åˆä¿¡æ¯ï¼Œè±¡å¾ç€äººå¯¹å®ƒçš„åˆ†è¾¨èƒ½åŠ›ï¼Œè¶Šé«˜å±‚è¶Šå¥½åˆ†è¾¨å‡ºæ˜¯å•¥ä¸œè¥¿ï¼Œå¦‚è¡¨å¾ç€ç±»åˆ«å•¥çš„ï¼Œå¯¹è¯†åˆ«ä»»åŠ¡å¸®åŠ©å¤§ï¼‰:</p></li></ul><p> å›¾åƒçš„é«˜å±‚è¯­ä¹‰ç‰¹å¾å€¼å¾—æ˜¯æˆ‘ä»¬æ‰€èƒ½çœ‹çš„ä¸œè¥¿ï¼Œæ¯”å¦‚å¯¹ä¸€å¼ äººè„¸æå–ä½å±‚ç‰¹å¾æˆ‘ä»¬å¯ä»¥æå–åˆ°è¿çš„è½®å»“ã€é¼»å­ã€çœ¼ç›ä¹‹ç±»çš„ï¼Œé‚£ä¹ˆé«˜å±‚çš„ç‰¹å¾å°±æ˜¾ç¤ºä¸ºä¸€å¼ äººè„¸ã€‚é«˜å±‚çš„ç‰¹å¾è¯­ä¹‰ä¿¡æ¯æ¯”è¾ƒä¸°å¯Œï¼Œä½†æ˜¯ç›®æ ‡ä½ç½®æ¯”è¾ƒç²—ç•¥ã€‚</p><p> æ„ˆæ·±å±‚ç‰¹å¾åŒ…å«çš„é«˜å±‚è¯­ä¹‰æ€§æ„ˆå¼ºã€åˆ†è¾¨èƒ½åŠ›ä¹Ÿæ„ˆå¼ºã€‚æˆ‘ä»¬æŠŠå›¾åƒçš„è§†è§‰ç‰¹å¾ç§°ä¸ºè§†è§‰ç©ºé—´ (visual space)ï¼ŒæŠŠç§ç±»çš„è¯­ä¹‰ä¿¡æ¯ç§°ä¸ºè¯­ä¹‰ç©ºé—´ (semantic space)</p></li><li><p><strong>ä¸Šä¸‹æ–‡ä¿¡æ¯</strong></p><p> åšå›¾åƒçš„ï¼Œä¸Šä¸‹æ–‡ç‰¹å¾æ˜¯å¾ˆå¸¸è§çš„ï¼Œå…¶å®ä¸Šä¸‹æ–‡å¤§æ¦‚å»ç†è§£å°±æ˜¯å›¾åƒä¸­çš„æ¯ä¸€ä¸ªåƒç´ ç‚¹ä¸å¯èƒ½æ˜¯å­¤ç«‹çš„ï¼Œä¸€ä¸ªåƒç´ ä¸€å®šå’Œå‘¨å›´åƒç´ æ˜¯æœ‰ä¸€å®šçš„å…³ç³»çš„ï¼Œå¤§é‡åƒç´ çš„äº’ç›¸è”ç³»æ‰äº§ç”Ÿäº†å›¾åƒä¸­çš„å„ç§ç‰©ä½“ï¼Œæ‰€ä»¥ä¸Šä¸‹æ–‡ç‰¹å¾å°±æŒ‡åƒç´ ä»¥åŠå‘¨è¾¹åƒç´ çš„æŸç§è”ç³»ã€‚</p><p> å…·ä½“åˆ°å›¾åƒè¯­ä¹‰åˆ†å‰²ï¼Œä¸€èˆ¬è®ºæ–‡ä¼šè¯´æˆ‘ä»¬çš„XXXç®—æ³•å……åˆ†ç»“åˆäº†ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œæ„æ€ä¹Ÿå°±æ˜¯åœ¨åˆ¤æ–­æŸä¸€ä¸ªä½ç½®ä¸Šçš„åƒç´ å±äºå“ªç§ç±»åˆ«çš„æ—¶å€™ï¼Œä¸ä»…è€ƒå¯Ÿåˆ°è¯¥åƒç´ çš„ç°åº¦å€¼ï¼Œè¿˜å……åˆ†è€ƒè™‘å’Œå®ƒä¸´è¿‘çš„åƒç´ ã€‚</p><p> ç„¶åä¸Šä¸‹æ–‡ä¿¡æ¯è¿˜åˆ†å…¨å±€å’Œå±€éƒ¨ï¼Œæ„æ€å°±æ˜¯è€ƒè™‘å…¨å›¾ä¸åŒèŒƒå›´å†…çš„åƒç´ å’Œåªè€ƒè™‘é‚»è¿‘çš„ä¸€äº›åƒç´ ã€‚</p><p> å…¨å±€ä¸Šä¸‹æ–‡ä¿¡æ¯ ä¹Ÿå¯ä»¥ç†è§£ä¸ºèƒ½å¤Ÿæ•æ‰æ¥è‡ªæ›´å¤šçš„ä¸åŒå°ºåº¦çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä¸åŒå°ºåº¦å°±æ˜¯æŒ‡ä¸åŒæ„Ÿå—é‡ã€‚</p></li><li><p><strong>å¤šå°ºåº¦</strong></p><p> ä¸ªäººæ„Ÿè§‰ï¼Œå¤šå°ºåº¦ å°±æ˜¯ ä½ èƒ½çœ‹åˆ°çš„èŒƒå›´ï¼ˆçœ‹åˆ°å°ºåº¦å°±ç†è§£ä¸ºCNNçš„æ„Ÿå—é‡å°±å®Œäº‹äº†ï¼ï¼ï¼ï¼‰ã€‚</p><p> å›¾åƒä¸­ä¸€ä¸ªä¸œè¥¿çš„å°ºåº¦è¶Šå¤§ï¼Œå°±æŒ‡è·ç¦»è¶Šè¿‘ç›¸å½“äºè¢«æ”¾å¤§äº†ï¼Œé‚£ä¹ˆç»™äººæ„Ÿè§‰å°±è¶Šæ¨¡ç³Šã€‚ä¾‹å¦‚ï¼š</p><ul><li><p>è®­ç»ƒçš„æ—¶å€™ï¼ŒæŠŠå›¾ç‰‡ç¼©æ”¾åˆ°ä¸åŒå¤§å°è¾“å…¥ç»™åŒä¸€ä¸ªç½‘ç»œï¼Œç½‘ç»œå°±èƒ½çœ‹åˆ°ä¸ä¸€æ ·å¤§å°èŒƒå›´çš„å†…å®¹ï¼Œç¼©æ”¾å¾—åˆ†è¾¨ç‡è¶Šé«˜å°±æŒ‡å°ºåº¦è¶Šå¤§ï¼Œå› ä¸ºå¯¹å›¾ä¸­çš„æŸä¸€ä¸ªç‰©ä½“æ¥è®²å°±æ˜¯è¢«æ”¾å¤§çš„æ„Ÿè§‰ã€‚ç„¶åå°±æ˜¯å› ä¸ºç¼©æ”¾åï¼Œæ¯”å¦‚ä¸­é—´ç‰¹å¾å›¾ä¸Šçš„æŸä¸ªåƒç´ ç‚¹éƒ½åªèƒ½çœ‹åˆ°åŸå›¾3ä¹˜3çš„åŒºåŸŸï¼Œå¯éšç€è¾“å…¥çš„å›¾ç‰‡å°ºåº¦ä¸ä¸€æ ·ï¼ŒåŒæ ·æ˜¯çœ‹åˆ°çš„3ä¹˜3åŒºåŸŸï¼Œä½†ç›¸å¯¹äºæ•´å¼ å›¾çš„èŒƒå›´ä¹Ÿè‡ªç„¶å°±ä¸ä¸€æ ·äº†ï¼Œç„¶åå°±å«åšå¤šå°ºåº¦è®­ç»ƒï¼›å¥½å¤„æ˜¯å¯ä»¥é€‚åº”ä¸åŒå°ºåº¦çš„è¾“å…¥ï¼Œæ³›åŒ–æ€§å¥½ã€‚</p></li><li><p>æŠŠä¸€ä¸ªç‰¹å¾å±‚ç”¨ç”±ä¸åŒæ„Ÿå—é‡çš„å·ç§¯æ ¸ç»„æˆçš„ç½‘ç»œå±‚ï¼ˆä¾‹å¦‚SPPï¼‰å¤„ç†ï¼Œè¿™å±‚ç½‘ç»œçš„åŒä¸€ä¸ªåƒç´ ä½ç½®å°±èƒ½çœ‹åˆ°ä¸åŒèŒƒå›´çš„ä¸Šå±‚ç‰¹å¾ï¼Œå°±å«åšå¤šå°ºåº¦ç‰¹å¾èåˆï¼›å¥½å¤„æ˜¯èƒ½è€ƒè™‘åˆ°ä¸åŒèŒƒå›´çš„ç©ºé—´ç‰¹å¾ä¸Šä¸‹æ–‡ï¼ˆä¾‹å¦‚å¤´å‘ä¸‹é¢ä¸€èˆ¬ä¼šæœ‰ä¸€å¼ è„¸ï¼‰ã€‚</p></li><li><p>æŠŠä¸€ä¸ªç½‘ç»œä¸­ä¸åŒæ·±åº¦çš„å±‚åšèåˆï¼šæµ…å±‚æ„Ÿå—é‡å°ï¼Œåˆ†è¾¨ç‡å¤§ï¼Œèƒ½å¤Ÿå¤„ç†å¹¶ä¿å­˜å°å°ºåº¦çš„å‡ ä½•ç‰¹å¾ï¼›é«˜å±‚æ„Ÿå—é‡å¤§ï¼Œåˆ†è¾¨ç‡å°ï¼Œèƒ½å¤Ÿå¤„ç†å¹¶ä¿å­˜å¤§å°ºåº¦çš„è¯­ä¹‰ç‰¹å¾ã€‚è¿™ä¹Ÿå«åšå¤šå°ºåº¦ç‰¹å¾èåˆï¼›å¥½å¤„æ˜¯èƒ½å¤Ÿå°†è¯­ä¹‰ç‰¹å¾å’Œå‡ ä½•ç‰¹å¾è¿›è¡Œèåˆï¼ˆä¾‹å¦‚è¿™å—åŒºåŸŸæ˜¯å¤´å‘ï¼Œä½åˆ†è¾¨ç‡å›¾ä¸Šçš„åˆ†ç•Œçº¿ä¸€èˆ¬æ˜¯çº¿çŠ¶ç‰¹å¾å’Œéçº¿çŠ¶ç‰¹å¾çš„è¾¹ç•Œï¼‰ã€‚</p></li></ul></li></ol>              </div>            </details><blockquote><p>ä»ä¿¡æ¯è®ºçš„è§’åº¦è®²ï¼Œç”±äºDPI(æ•°æ®å¤„ç†ä¸ç­‰å¼)çš„å­˜åœ¨ï¼Œåœ¨å‰å‘ä¼ è¾“çš„è¿‡ç¨‹ä¸­ï¼Œéšç€å±‚æ•°çš„åŠ æ·±ï¼ŒFeature MapåŒ…å«çš„å›¾åƒä¿¡æ¯ä¼šé€å±‚å‡å°‘ï¼Œè€ŒResNetçš„ç›´æ¥æ˜ å°„çš„åŠ å…¥ï¼Œä¿è¯äº†$l+1$å±‚çš„ç½‘ç»œä¸€å®šæ¯”$l$å±‚åŒ…å«æ›´å¤šçš„å›¾åƒä¿¡æ¯ã€‚</p><details open><summary pointer> è§£é‡Š </summary>              <div class='content'>              <p>ä¿è¯äº†$l+1$å±‚çš„ç½‘ç»œä¸€å®šæ¯”lå±‚åŒ…å«æ›´å¤šçš„å›¾åƒä¿¡æ¯ï¼Œè¿™æ˜¯å› ä¸ºç›´æ¥æ˜ å°„ï¼ˆæ’ç­‰æ˜ å°„ï¼‰å°†å‰ä¸€å±‚çš„ä¿¡æ¯æ— æŸåœ°ä¼ é€’åˆ°äº†åä¸€å±‚ï¼Œç¡®ä¿äº†ä¿¡æ¯çš„å®Œæ•´æ€§ã€‚åŒæ—¶ï¼Œç”±äºæ®‹å·®éƒ¨åˆ†çš„å­˜åœ¨ï¼Œç½‘ç»œå¯ä»¥å­¦ä¹ è¾“å…¥å’Œè¾“å‡ºä¹‹é—´çš„å·®å€¼ï¼Œå³æ®‹å·®ã€‚è¿™ä¸ªæ®‹å·®éƒ¨åˆ†å¯èƒ½ä¼šå¼•å…¥ä¸€äº›æ–°çš„ã€æœ‰ç”¨çš„ç‰¹å¾æˆ–æ¨¡å¼ï¼Œè¿™äº›ç‰¹å¾æˆ–æ¨¡å¼åœ¨ä¹‹å‰çš„å±‚ä¸­å¯èƒ½å¹¶ä¸å­˜åœ¨ã€‚è¿™äº›æ–°å¢çš„ç‰¹å¾æˆ–æ¨¡å¼ä¼šä¸ç›´æ¥æ˜ å°„çš„ä¿¡æ¯ç›¸ç»“åˆï¼Œå¯¼è‡´$l+1$å±‚çš„ä¿¡æ¯é‡å®é™…ä¸Šæ¯”$l$å±‚æ›´å¤šã€‚<br>æ¢å¥è¯è¯´ï¼Œç›´æ¥æ˜ å°„ä¿è¯äº†ä¿¡æ¯é‡çš„ä¸‹é™ï¼ˆå³è‡³å°‘ä¸å‰ä¸€å±‚ç›¸åŒï¼‰ï¼Œè€Œæ®‹å·®éƒ¨åˆ†åˆ™æœ‰å¯èƒ½å¢åŠ é¢å¤–çš„ä¿¡æ¯é‡ã€‚å› æ­¤ï¼Œç»¼åˆè¿™ä¸¤éƒ¨åˆ†ï¼Œ$l+1$å±‚çš„ç½‘ç»œåŒ…å«çš„ä¿¡æ¯é‡ä¸€å®šä¼šæ¯”$l$å±‚æ›´å¤šã€‚è¿™ä¹Ÿæ˜¯ResNetèƒ½å¤Ÿåœ¨å¢åŠ ç½‘ç»œæ·±åº¦çš„åŒæ—¶ä¿æŒç”šè‡³æé«˜æ€§èƒ½çš„å…³é”®åŸå› ä¹‹ä¸€ã€‚<br>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œçš„â€œæ›´å¤šâ€å¹¶ä¸æ„å‘³ç€ç»å¯¹çš„ä¿¡æ¯é‡ä¸€å®šæ›´å¤§ï¼Œè€Œæ˜¯æŒ‡ç›¸å¯¹äºå‰ä¸€å±‚ï¼Œåä¸€å±‚æœ‰å¯èƒ½åŒ…å«æ›´å¤šçš„æœ‰ç”¨ç‰¹å¾æˆ–æ¨¡å¼ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿˜éœ€è¦è€ƒè™‘å…¶ä»–å› ç´ ï¼Œå¦‚ç½‘ç»œçš„è®­ç»ƒæ–¹å¼ã€æ•°æ®é›†çš„è´¨é‡ç­‰ï¼Œæ¥ç»¼åˆè¯„ä¼°ç½‘ç»œæ€§èƒ½ã€‚</p>              </div>            </details><p>åŸºäºè¿™ç§ä½¿ç”¨ç›´æ¥æ˜ å°„æ¥è¿æ¥ç½‘ç»œä¸åŒå±‚ç›´æ¥çš„æ€æƒ³ï¼Œæ®‹å·®ç½‘ç»œåº”è¿è€Œç”Ÿã€‚</p></blockquote><h2 id="æ®‹å·®ç½‘ç»œ"><a href="#æ®‹å·®ç½‘ç»œ" class="headerlink" title="æ®‹å·®ç½‘ç»œ"></a>æ®‹å·®ç½‘ç»œ</h2><h3 id="æ®‹å·®å—"><a href="#æ®‹å·®å—" class="headerlink" title="æ®‹å·®å—"></a>æ®‹å·®å—</h3><p>æ®‹å·®ç½‘ç»œæ˜¯ç”±ä¸€ç³»åˆ—æ®‹å·®å—ç»„æˆçš„ï¼ˆå›¾1ï¼‰ã€‚ä¸€ä¸ªæ®‹å·®å—å¯ä»¥ç”¨è¡¨ç¤ºä¸ºï¼š</p><p class='p center'>$x_{l+1}=x_l+F(x_lï¼ŒW_l)$</p><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.969i4oz9f9.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.969i4oz9f9.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp" alt="å›¾1:æ®‹å·®å—"/></div><span class="image-caption">å›¾1:æ®‹å·®å—</span></div><blockquote><p>å›¾1ä¸­çš„Weightåœ¨å·ç§¯ç½‘ç»œä¸­æ˜¯æŒ‡å·ç§¯æ“ä½œï¼ŒadditionæŒ‡çš„æ˜¯å•ä½åŠ æ“ä½œï¼Œå³åœ¨å·ç§¯è®¡ç®—ä¸­çš„ç›¸åŠ æ­¥éª¤ã€‚<br>å·ç§¯è®¡ç®—çš„4ä¸ªæ­¥éª¤ä¸ºåæŠ˜ã€å¹³ç§»ã€ç›¸ä¹˜ã€ç›¸åŠ ã€‚å°†ä¸¤ç»„æ•°è¿›è¡Œå·ç§¯åï¼Œå˜æˆç¬¬ä¸‰ç»„æ•°ï¼Œå…¶ä¸­ç›¸åŠ å°±æ˜¯additionã€‚</p></blockquote><p><strong>æ®‹å·®å—åˆ†æˆä¸¤éƒ¨åˆ†-ç›´æ¥æ˜ å°„éƒ¨åˆ†å’Œæ®‹å·®éƒ¨åˆ†ã€‚</strong></p><ul><li>$h(x_l)$æ˜¯ç›´æ¥æ˜ å°„ï¼Œååº”åœ¨å›¾1ä¸­æ˜¯å·¦è¾¹çš„æ›²çº¿</li><li>$F(x_lï¼ŒW_l)$æ˜¯æ®‹å·®éƒ¨åˆ†ï¼Œä¸€èˆ¬ç”±ä¸¤ä¸ªæˆ–è€…ä¸‰ä¸ªå·ç§¯æ“ä½œæ„æˆï¼Œå³å›¾1ä¸­å³ä¾§åŒ…å«å·ç§¯çš„éƒ¨åˆ†ã€‚</li></ul><p>åœ¨å·ç§¯ç½‘ç»œä¸­,$x_l$å¯èƒ½å’Œ$x_{l+1}$çš„Feature Mapçš„æ•°é‡ä¸ä¸€æ ·ï¼Œè¿™æ—¶å€™å°±éœ€è¦ä½¿ç”¨$1Ã—1$å·ç§¯è¿›è¡Œå‡ç»´æˆ–è€…é™ç»´ï¼ˆå›¾2ï¼‰ã€‚</p><div class="tagLink"><a class="link-card" title="$1Ã—1$å·ç§¯æ ¸" href="https://tumytime.space/2024/03/21/1x1%E5%8D%B7%E7%A7%AF%E6%A0%B8/"><span class="link-card-backdrop" style="background-image: url(https://tumytime.github.io/picx-images-hosting/image.7awxc3fekp.webp)"></span><div class="left"><img src="https://tumytime.github.io/picx-images-hosting/image.7awxc3fekp.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.7awxc3fekp.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div><div class="right"><p class="text">$1Ã—1$å·ç§¯æ ¸</p><p class="url">https://tumytime.space/2024/03/21/1x1%E5%8D%B7%E7%A7%AF%E6%A0%B8/</p></div></a></div><p>è¿™æ—¶ï¼Œæ®‹å·®å—è¡¨ç¤ºä¸ºï¼š</p><p class='p center'>$x_{l+1}=h(x_l)+F(x_lï¼ŒW_l)$</p><p>å…¶ä¸­$h(x_l)&#x3D;W_l^{â€˜}x$ã€‚å…¶ä¸­$W_l^{â€˜}$æ˜¯$1Ã—1$å·ç§¯æ“ä½œï¼Œä½†æ˜¯å®éªŒç»“æœ$1Ã—1$å·ç§¯å¯¹æ¨¡å‹æ€§èƒ½æå‡æœ‰é™ï¼Œæ‰€ä»¥ä¸€èˆ¬æ˜¯åœ¨å‡ç»´æˆ–è€…é™ç»´æ—¶æ‰ä¼šä½¿ç”¨ã€‚</p><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.54xiqiz1jd.webp ,alt=$1Ã—1$æ®‹å·®å—" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.54xiqiz1jd.webp ,alt=$1Ã—1$æ®‹å·®å—" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div><p>ä¸€èˆ¬ï¼Œè¿™ç§ç‰ˆæœ¬çš„æ®‹å·®å—å«åšresnet_v1ï¼Œkerasä»£ç å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">res_block_v1</span>(<span class="params">x, input_filter, output_filter</span>):</span><br><span class="line">    res_x = Conv2D(kernel_size=(<span class="number">3</span>,<span class="number">3</span>), filters=output_filter, strides=<span class="number">1</span>, padding=<span class="string">&#x27;same&#x27;</span>)(x)</span><br><span class="line">    res_x = BatchNormalization()(res_x)</span><br><span class="line">    res_x = Activation(<span class="string">&#x27;relu&#x27;</span>)(res_x)</span><br><span class="line">    res_x = Conv2D(kernel_size=(<span class="number">3</span>,<span class="number">3</span>), filters=output_filter, strides=<span class="number">1</span>, padding=<span class="string">&#x27;same&#x27;</span>)(res_x)</span><br><span class="line">    res_x = BatchNormalization()(res_x)</span><br><span class="line">    <span class="keyword">if</span> input_filter == output_filter:</span><br><span class="line">        identity = x</span><br><span class="line">    <span class="keyword">else</span>: <span class="comment">#éœ€è¦å‡ç»´æˆ–è€…é™ç»´</span></span><br><span class="line">        identity = Conv2D(kernel_size=(<span class="number">1</span>,<span class="number">1</span>), filters=output_filter, strides=<span class="number">1</span>, padding=<span class="string">&#x27;same&#x27;</span>)(x)</span><br><span class="line">    x = keras.layers.add([identity, res_x])</span><br><span class="line">    output = Activation(<span class="string">&#x27;relu&#x27;</span>)(x)</span><br><span class="line">    <span class="keyword">return</span> output</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç å®šä¹‰äº†ä¸€ä¸ªç®€å•çš„æ®‹å·®å—ï¼ˆresidual blockï¼‰ï¼Œç”¨äºæ„å»ºæ®‹å·®ç¥ç»ç½‘ç»œï¼ˆResNetï¼‰ä¸­çš„ä¸€ä¸ªåŸºæœ¬å•å…ƒã€‚åœ¨è¿™æ®µä»£ç ä¸­ï¼Œ<code>res_block_v1</code>å‡½æ•°æ¥å—è¾“å…¥ç‰¹å¾<code>x</code>ï¼Œè¾“å…¥çš„å·ç§¯æ ¸æ•°é‡<code>input_filter</code>å’Œè¾“å‡ºçš„å·ç§¯æ ¸æ•°é‡<code>output_filter</code>ä½œä¸ºå‚æ•°ï¼Œç„¶åæ„å»ºä¸€ä¸ªæ®‹å·®å—ï¼Œå¹¶è¿”å›å¤„ç†åçš„è¾“å‡ºç‰¹å¾ã€‚</p><p>å…·ä½“å®ç°è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ol><li>ä½¿ç”¨ä¸€ä¸ª3x3å¤§å°çš„å·ç§¯æ ¸ï¼Œè¾“å‡ºé€šé“æ•°ä¸º<code>output_filter</code>ï¼Œæ­¥é•¿ä¸º1ï¼Œå¡«å……æ–¹å¼ä¸ºâ€™sameâ€™è¿›è¡Œå·ç§¯æ“ä½œï¼Œå¹¶æ¥ä¸ŠBatchNormalizationå±‚å’ŒReLUæ¿€æ´»å‡½æ•°ã€‚</li><li>å†æ¬¡ä½¿ç”¨ä¸€ä¸ª3x3å¤§å°çš„å·ç§¯æ ¸ï¼Œè¾“å‡ºé€šé“æ•°ä¸º<code>output_filter</code>ï¼Œæ­¥é•¿ä¸º1ï¼Œå¡«å……æ–¹å¼ä¸ºâ€™sameâ€™è¿›è¡Œå·ç§¯æ“ä½œï¼Œå¹¶æ¥ä¸ŠBatchNormalizationå±‚ã€‚</li><li>æ ¹æ®è¾“å…¥å·ç§¯æ ¸æ•°é‡å’Œè¾“å‡ºå·ç§¯æ ¸æ•°é‡æ˜¯å¦ç›¸ç­‰ï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦è¿›è¡Œç»´åº¦åŠ å‡å˜æ¢ï¼Œå¦‚æœç›¸ç­‰åˆ™ç›´æ¥å°†è¾“å…¥ç‰¹å¾ä½œä¸ºæ’ç­‰æ˜ å°„ï¼ˆidentityï¼‰ï¼Œå¦åˆ™ä½¿ç”¨1x1çš„å·ç§¯æ ¸è¿›è¡Œç»´åº¦å˜æ¢ã€‚</li><li>å°†æ’ç­‰æ˜ å°„å’Œç»è¿‡ä¸¤æ¬¡å·ç§¯æ“ä½œçš„ç‰¹å¾ç›¸åŠ ï¼Œå¾—åˆ°æ®‹å·®è¿æ¥ã€‚</li><li>å¯¹æ®‹å·®è¿æ¥çš„ç»“æœè¿›è¡ŒReLUæ¿€æ´»å‡½æ•°æ“ä½œï¼Œæœ€ç»ˆè¾“å‡ºå¤„ç†åçš„ç‰¹å¾ã€‚</li></ol><p>è¿™æ®µä»£ç å±•ç¤ºäº†å¦‚ä½•å®ç°ä¸€ä¸ªç®€å•çš„æ®‹å·®å—ï¼Œç”¨äºæ­å»ºæ·±åº¦æ®‹å·®ç¥ç»ç½‘ç»œï¼Œé€šè¿‡æ®‹å·®è¿æ¥æ¥è§£å†³æ·±åº¦ç¥ç»ç½‘ç»œè®­ç»ƒä¸­çš„æ¢¯åº¦æ¶ˆå¤±å’Œæ¢¯åº¦çˆ†ç‚¸é—®é¢˜ï¼Œå¸®åŠ©ç½‘ç»œæ›´å¥½åœ°è®­ç»ƒå’Œä¼˜åŒ–ã€‚</p><h3 id="æ®‹å·®ç½‘ç»œçš„æ­å»º"><a href="#æ®‹å·®ç½‘ç»œçš„æ­å»º" class="headerlink" title="æ®‹å·®ç½‘ç»œçš„æ­å»º"></a>æ®‹å·®ç½‘ç»œçš„æ­å»º</h3><p>æ®‹å·®ç½‘ç»œçš„æ­å»ºåˆ†ä¸ºä¸¤æ­¥ï¼š</p><ol><li>ä½¿ç”¨VGGå…¬å¼æ­å»ºPlain VGGç½‘ç»œ</li><li>åœ¨Plain VGGçš„å·ç§¯ç½‘ç»œä¹‹é—´æ’å…¥Identity Mappingï¼Œæ³¨æ„éœ€è¦å‡ç»´æˆ–è€…é™ç»´çš„æ—¶å€™åŠ å…¥$1Ã—1$å·ç§¯ã€‚<br>åœ¨å®ç°è¿‡ç¨‹ä¸­ï¼Œä¸€èˆ¬æ˜¯ç›´æ¥stackæ®‹å·®å—çš„æ–¹å¼ã€‚<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">resnet_v1</span>(<span class="params">x</span>):</span><br><span class="line">    x = Conv2D(kernel_size=(<span class="number">3</span>,<span class="number">3</span>), filters=<span class="number">16</span>, strides=<span class="number">1</span>, padding=<span class="string">&#x27;same&#x27;</span>, activation=<span class="string">&#x27;relu&#x27;</span>)(x)</span><br><span class="line">    x = res_block_v1(x, <span class="number">16</span>, <span class="number">16</span>)</span><br><span class="line">    x = res_block_v1(x, <span class="number">16</span>, <span class="number">32</span>)</span><br><span class="line">    x = Flatten()(x)</span><br><span class="line">    outputs = Dense(<span class="number">10</span>, activation=<span class="string">&#x27;softmax&#x27;</span>, kernel_initializer=<span class="string">&#x27;he_normal&#x27;</span>)(x)</span><br><span class="line">    <span class="keyword">return</span> outputs</span><br></pre></td></tr></table></figure></li></ol><h3 id="ä¸ºä»€ä¹ˆå«æ®‹å·®ç½‘ç»œ"><a href="#ä¸ºä»€ä¹ˆå«æ®‹å·®ç½‘ç»œ" class="headerlink" title="ä¸ºä»€ä¹ˆå«æ®‹å·®ç½‘ç»œ"></a>ä¸ºä»€ä¹ˆå«æ®‹å·®ç½‘ç»œ</h3><p>åœ¨ç»Ÿè®¡å­¦ä¸­ï¼Œæ®‹å·®å’Œè¯¯å·®æ˜¯éå¸¸å®¹æ˜“æ··æ·†çš„ä¸¤ä¸ªæ¦‚å¿µã€‚è¯¯å·®æ˜¯è¡¡é‡è§‚æµ‹å€¼å’ŒçœŸå®å€¼ä¹‹é—´çš„å·®è·ï¼Œæ®‹å·®æ˜¯æŒ‡é¢„æµ‹å€¼å’Œè§‚æµ‹å€¼ä¹‹é—´çš„å·®è·ã€‚å¯¹äºæ®‹å·®ç½‘ç»œçš„å‘½ååŸå› ï¼Œä½œè€…ç»™å‡ºçš„è§£é‡Šæ˜¯ï¼Œç½‘ç»œçš„ä¸€å±‚é€šå¸¸å¯ä»¥çœ‹åš$y&#x3D;H(x)$, è€Œæ®‹å·®ç½‘ç»œçš„ä¸€ä¸ªæ®‹å·®å—å¯ä»¥è¡¨ç¤ºä¸º$H(x)&#x3D;F(x)+x$ï¼Œä¹Ÿå°±æ˜¯$F(x)&#x3D;H(x)-x$ï¼Œåœ¨å•ä½æ˜ å°„ä¸­ï¼Œ$y&#x3D;x$ä¾¿æ˜¯è§‚æµ‹å€¼ï¼Œè€Œ$H(x)$æ˜¯é¢„æµ‹å€¼ï¼Œæ‰€ä»¥$F(x)$ä¾¿å¯¹åº”ç€æ®‹å·®ï¼Œå› æ­¤å«åšæ®‹å·®ç½‘ç»œã€‚</p><h3 id="ç•¥"><a href="#ç•¥" class="headerlink" title="ç•¥"></a>ç•¥</h3><h3 id="å°†æ¿€æ´»å‡½æ•°ç§»åŠ¨åˆ°æ®‹å·®éƒ¨åˆ†å¯ä»¥æé«˜æ¨¡å‹çš„ç²¾åº¦"><a href="#å°†æ¿€æ´»å‡½æ•°ç§»åŠ¨åˆ°æ®‹å·®éƒ¨åˆ†å¯ä»¥æé«˜æ¨¡å‹çš„ç²¾åº¦" class="headerlink" title="å°†æ¿€æ´»å‡½æ•°ç§»åŠ¨åˆ°æ®‹å·®éƒ¨åˆ†å¯ä»¥æé«˜æ¨¡å‹çš„ç²¾åº¦"></a>å°†æ¿€æ´»å‡½æ•°ç§»åŠ¨åˆ°æ®‹å·®éƒ¨åˆ†å¯ä»¥æé«˜æ¨¡å‹çš„ç²¾åº¦</h3><p>è¯¥ç½‘ç»œä¸€èˆ¬å°±åœ¨resnet_v2ï¼Œkeraså®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">res_block_v2</span>(<span class="params">x, input_filter, output_filter</span>):</span><br><span class="line">    res_x = BatchNormalization()(x)</span><br><span class="line">    res_x = Activation(<span class="string">&#x27;relu&#x27;</span>)(res_x)</span><br><span class="line">    res_x = Conv2D(kernel_size=(<span class="number">3</span>,<span class="number">3</span>), filters=output_filter, strides=<span class="number">1</span>, padding=<span class="string">&#x27;same&#x27;</span>)(res_x)</span><br><span class="line">    res_x = BatchNormalization()(res_x)</span><br><span class="line">    res_x = Activation(<span class="string">&#x27;relu&#x27;</span>)(res_x)</span><br><span class="line">    res_x = Conv2D(kernel_size=(<span class="number">3</span>,<span class="number">3</span>), filters=output_filter, strides=<span class="number">1</span>, padding=<span class="string">&#x27;same&#x27;</span>)(res_x)</span><br><span class="line">    <span class="keyword">if</span> input_filter == output_filter:</span><br><span class="line">        identity = x</span><br><span class="line">    <span class="keyword">else</span>: <span class="comment">#éœ€è¦å‡ç»´æˆ–è€…é™ç»´</span></span><br><span class="line">        identity = Conv2D(kernel_size=(<span class="number">1</span>,<span class="number">1</span>), filters=output_filter, strides=<span class="number">1</span>, padding=<span class="string">&#x27;same&#x27;</span>)(x)</span><br><span class="line">    output= keras.layers.add([identity, res_x])</span><br><span class="line">    <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">resnet_v2</span>(<span class="params">x</span>):</span><br><span class="line">    x = Conv2D(kernel_size=(<span class="number">3</span>,<span class="number">3</span>), filters=<span class="number">16</span> , strides=<span class="number">1</span>, padding=<span class="string">&#x27;same&#x27;</span>, activation=<span class="string">&#x27;relu&#x27;</span>)(x)</span><br><span class="line">    x = res_block_v2(x, <span class="number">16</span>, <span class="number">16</span>)</span><br><span class="line">    x = res_block_v2(x, <span class="number">16</span>, <span class="number">32</span>)</span><br><span class="line">    x = BatchNormalization()(x)</span><br><span class="line">    y = Flatten()(x)</span><br><span class="line">    outputs = Dense(<span class="number">10</span>, activation=<span class="string">&#x27;softmax&#x27;</span>, kernel_initializer=<span class="string">&#x27;he_normal&#x27;</span>)(y)</span><br><span class="line">    <span class="keyword">return</span> outputs</span><br></pre></td></tr></table></figure><h2 id="åˆ†å‰²çº¿"><a href="#åˆ†å‰²çº¿" class="headerlink" title="åˆ†å‰²çº¿*******************"></a>åˆ†å‰²çº¿*******************</h2>]]></content>
    
    
      
      
    <summary type="html">&lt;div class=&quot;tagLink&quot;&gt;&lt;a class=&quot;link-card&quot; title=&quot;è¯¦è§£æ®‹å·®ç½‘ç»œ&quot; href=&quot;https://zhuanlan.zhihu.com/p/42706477&quot;&gt;&lt;span class=&quot;link-card-backdrop&quot; style</summary>
      
    
    
    
    <category term="æ™ºèƒ½è½¦" scheme="http://tumytime.github.io/categories/%E6%99%BA%E8%83%BD%E8%BD%A6/"/>
    
    
    <category term="Python" scheme="http://tumytime.github.io/tags/Python/"/>
    
    <category term="æ·±åº¦å­¦ä¹ " scheme="http://tumytime.github.io/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"/>
    
    <category term="æ™ºèƒ½è½¦" scheme="http://tumytime.github.io/tags/%E6%99%BA%E8%83%BD%E8%BD%A6/"/>
    
  </entry>
  
  <entry>
    <title>è“æ¡¥æ¯stm32å­¦ä¹ ç¬”è®°ï¼ˆå…«ï¼‰ï¼šæ¨¡æ•°è½¬æ¢ADC</title>
    <link href="http://tumytime.github.io/2024/03/18/%E8%93%9D%E6%A1%A5%E6%9D%AFstm32%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E5%85%AB%EF%BC%89%EF%BC%9A%E6%A8%A1%E6%95%B0%E8%BD%AC%E6%8D%A2ADC/"/>
    <id>http://tumytime.github.io/2024/03/18/%E8%93%9D%E6%A1%A5%E6%9D%AFstm32%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E5%85%AB%EF%BC%89%EF%BC%9A%E6%A8%A1%E6%95%B0%E8%BD%AC%E6%8D%A2ADC/</id>
    <published>2024-03-18T12:27:33.000Z</published>
    <updated>2024-03-19T09:16:54.795Z</updated>
    
    <content type="html"><![CDATA[<h3 id="CubeMXé…ç½®"><a href="#CubeMXé…ç½®" class="headerlink" title="CubeMXé…ç½®"></a>CubeMXé…ç½®</h3><h4 id="é…ç½®å¼•è„š"><a href="#é…ç½®å¼•è„š" class="headerlink" title="é…ç½®å¼•è„š"></a>é…ç½®å¼•è„š</h4><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.2h82d2oxha.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.2h82d2oxha.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div><p>æˆ‘ä»¬è¿™é‡Œå…ˆåªç”¨R37</p><p>é…ç½®<code>PB15</code>ä¸º<code>ADC2_IN15</code></p><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.6t6vkmcqb6.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.6t6vkmcqb6.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div><p>é€‰æ‹©<code>Single_ended</code></p><h4 id="ç”Ÿæˆå·¥ç¨‹"><a href="#ç”Ÿæˆå·¥ç¨‹" class="headerlink" title="ç”Ÿæˆå·¥ç¨‹"></a>ç”Ÿæˆå·¥ç¨‹</h4><p><strong>ç‚¹å‡»å³ä¸Šè§’â€GENERATE CODEâ€,ç”Ÿæˆå·¥ç¨‹</strong></p><h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><h4 id="aadc-c"><a href="#aadc-c" class="headerlink" title="aadc.c"></a>aadc.c</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;aadc.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">double</span> <span class="title function_">getADC</span><span class="params">(ADC_HandleTypeDef *pin)</span></span><br><span class="line">&#123;</span><br><span class="line">uint adc;</span><br><span class="line">HAL_ADC_Start (pin);</span><br><span class="line">adc = HAL_ADC_GetValue(pin);</span><br><span class="line"><span class="keyword">return</span> adc*<span class="number">3.3</span>/<span class="number">4096</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="aadc-h"><a href="#aadc-h" class="headerlink" title="aadc.h"></a>aadc.h</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;main.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">double</span> <span class="title function_">getADC</span><span class="params">(ADC_HandleTypeDef *pin)</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•° <code>getADC</code> æ˜¯ä¸€ä¸ªç”¨äºä»ADCï¼ˆæ¨¡æ‹Ÿåˆ°æ•°å­—è½¬æ¢å™¨ï¼‰è¯»å–æ¨¡æ‹Ÿä¿¡å·å¹¶å°†å…¶è½¬æ¢ä¸ºç”µå‹å€¼çš„å‡½æ•°ã€‚è®©æˆ‘ä»¬ä¸€æ­¥æ­¥åœ°åˆ†æè¿™ä¸ªå‡½æ•°ï¼š</p><ol><li><strong>å‡½æ•°ç­¾å</strong>:</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">double</span> <span class="title function_">getADC</span><span class="params">(ADC_HandleTypeDef *pin)</span></span><br></pre></td></tr></table></figure><ul><li><code>double</code>: å‡½æ•°çš„è¿”å›ç±»å‹æ˜¯<code>double</code>ï¼Œè¿™æ„å‘³ç€å®ƒå°†è¿”å›ä¸€ä¸ªæµ®ç‚¹æ•°ã€‚</li><li><code>ADC_HandleTypeDef *pin</code>: å‡½æ•°æ¥å—ä¸€ä¸ªæŒ‡å‘<code>ADC_HandleTypeDef</code>ç±»å‹çš„æŒ‡é’ˆï¼Œè¿™ä¸ªæŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªADCå¥æŸ„ï¼Œå®ƒåŒ…å«äº†ADCçš„é…ç½®ä¿¡æ¯å’ŒçŠ¶æ€ä¿¡æ¯ã€‚</li></ul><ol start="2"><li><strong>å‡½æ•°ä½“</strong>:</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"> uint adc;</span><br><span class="line"> HAL_ADC_Start (pin);</span><br><span class="line"> adc = HAL_ADC_GetValue(pin);</span><br><span class="line"> <span class="keyword">return</span> adc*<span class="number">3.3</span>/<span class="number">4096</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>uint adc;</code>: å®šä¹‰äº†ä¸€ä¸ªæ— ç¬¦å·æ•´æ•°å˜é‡<code>adc</code>ï¼Œç”¨äºå­˜å‚¨ä»ADCè¯»å–çš„åŸå§‹å€¼ã€‚</li><li><code>HAL_ADC_Start (pin);</code>: è°ƒç”¨HALåº“ï¼ˆç¡¬ä»¶æŠ½è±¡å±‚åº“ï¼‰ä¸­çš„<code>HAL_ADC_Start</code>å‡½æ•°æ¥å¯åŠ¨æŒ‡å®šçš„ADCã€‚è¿™ä¸ªå‡½æ•°æ¥å—ä¸€ä¸ªADCå¥æŸ„ï¼ˆå³<code>pin</code>ï¼‰ä½œä¸ºå‚æ•°ã€‚</li><li><code>adc = HAL_ADC_GetValue(pin);</code>: åœ¨ADCè½¬æ¢å®Œæˆåï¼Œè°ƒç”¨<code>HAL_ADC_GetValue</code>å‡½æ•°æ¥è·å–è½¬æ¢åçš„ADCå€¼ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨<code>adc</code>å˜é‡ä¸­ã€‚</li><li><code>return adc*3.3/4096;</code>: è¿”å›è½¬æ¢åçš„ç”µå‹å€¼ã€‚è¿™é‡Œå‡è®¾ADCæ˜¯ä¸€ä¸ª12ä½çš„ADCï¼ˆå› æ­¤æœ€å¤§å€¼æ˜¯4095æˆ–4096ï¼Œå–å†³äºå…·ä½“çš„å®ç°å’Œè®¡æ•°æ–¹å¼ï¼‰ï¼Œå…¶å‚è€ƒç”µå‹æ˜¯3.3Vã€‚å› æ­¤ï¼Œ<code>adc*3.3/4096</code>è¿™ä¸ªå…¬å¼å°†ADCçš„åŸå§‹è¯»æ•°è½¬æ¢æˆäº†ç›¸åº”çš„ç”µå‹å€¼ã€‚</li></ul><p>æ€»ä¹‹ï¼Œè¿™ä¸ªå‡½æ•°çš„ä¸»è¦ç›®çš„æ˜¯ä»æŒ‡å®šçš„ADCè¯»å–æ¨¡æ‹Ÿä¿¡å·ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºä¸€ä¸ªè¡¨ç¤ºç”µå‹çš„æµ®ç‚¹æ•°ã€‚è¿™ä¸ªç”µå‹å€¼æ˜¯åŸºäºADCçš„å‚è€ƒç”µå‹ï¼ˆåœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯3.3Vï¼‰å’ŒADCçš„ä½æ•°ï¼ˆåœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯12ä½ï¼‰æ¥è®¡ç®—çš„ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h3 id=&quot;CubeMXé…ç½®&quot;&gt;&lt;a href=&quot;#CubeMXé…ç½®&quot; class=&quot;headerlink&quot; title=&quot;CubeMXé…ç½®&quot;&gt;&lt;/a&gt;CubeMXé…ç½®&lt;/h3&gt;&lt;h4 id=&quot;é…ç½®å¼•è„š&quot;&gt;&lt;a href=&quot;#é…ç½®å¼•è„š&quot; class=&quot;headerlink&quot; </summary>
      
    
    
    
    <category term="åµŒå…¥å¼" scheme="http://tumytime.github.io/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/"/>
    
    
  </entry>
  
  <entry>
    <title>è“æ¡¥æ¯stm32å­¦ä¹ ç¬”è®°ï¼ˆä¸ƒï¼‰ï¼šè¾“å…¥æ•è·ï¼ˆé¢‘ç‡ï¼Œå ç©ºæ¯”æµ‹é‡ï¼‰</title>
    <link href="http://tumytime.github.io/2024/03/18/%E8%93%9D%E6%A1%A5%E6%9D%AFstm32%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%83%EF%BC%89%EF%BC%9A%E8%BE%93%E5%85%A5%E6%8D%95%E8%8E%B7%EF%BC%88%E9%A2%91%E7%8E%87%EF%BC%8C%E5%8D%A0%E7%A9%BA%E6%AF%94%E6%B5%8B%E9%87%8F%EF%BC%89/"/>
    <id>http://tumytime.github.io/2024/03/18/%E8%93%9D%E6%A1%A5%E6%9D%AFstm32%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%B8%83%EF%BC%89%EF%BC%9A%E8%BE%93%E5%85%A5%E6%8D%95%E8%8E%B7%EF%BC%88%E9%A2%91%E7%8E%87%EF%BC%8C%E5%8D%A0%E7%A9%BA%E6%AF%94%E6%B5%8B%E9%87%8F%EF%BC%89/</id>
    <published>2024-03-18T09:03:06.000Z</published>
    <updated>2024-03-19T08:58:06.330Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>è·³çº¿å¸½æ‹”äº†ä¸èƒ½çƒ§å·¥ç¨‹ã€‚ã€‚ã€‚ã€‚(å¥½åƒå¯ä»¥ã€‚ã€‚ã€‚é‚£å¤©ä¸çŸ¥é“æ€ä¹ˆäº†æ¿å­æŠ½é£)</p></blockquote><h3 id="CubeMXé…ç½®"><a href="#CubeMXé…ç½®" class="headerlink" title="CubeMXé…ç½®"></a>CubeMXé…ç½®</h3><h4 id="é…ç½®å¼•è„š"><a href="#é…ç½®å¼•è„š" class="headerlink" title="é…ç½®å¼•è„š"></a>é…ç½®å¼•è„š</h4><p><strong>æˆ‘ä»¬è¿™é‡Œä½¿ç”¨<code>PA7</code>è¿›è¡Œæ•è·</strong></p><p><strong>é…ç½®<code>PA7</code>ä¸º<code>TIM17_CH1</code></strong><br>(åªæœ‰ä¸€ä¸ªé€šé“æ²¡å…³ç³»ï¼Œæˆ‘çš„é¢˜ç›®é‡Œä¸ç”¨æµ‹å ç©ºæ¯”ï¼Œä½†æ˜¯æˆ‘åé¢ä¼šå†™åŠ ä¸Šæµ‹å ç©ºæ¯”çš„å¼•è„šå’Œç¨‹åºçš„)</p><ul><li>é…ç½®ä¸€ä¸‹å¼•è„š  <div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.5j3yd4e8d4.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.5j3yd4e8d4.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div></li><li>ä½¿èƒ½å®šæ—¶å™¨ä¸­æ–­  <div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.7awx810hqy.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.7awx810hqy.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div></li></ul><h4 id="ç”Ÿæˆå·¥ç¨‹"><a href="#ç”Ÿæˆå·¥ç¨‹" class="headerlink" title="ç”Ÿæˆå·¥ç¨‹"></a>ç”Ÿæˆå·¥ç¨‹</h4><p><strong>ç‚¹å‡»å³ä¸Šè§’â€GENERATE CODEâ€,ç”Ÿæˆå·¥ç¨‹</strong></p><h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><h4 id="ä¸­æ–­å‡½æ•°"><a href="#ä¸­æ–­å‡½æ•°" class="headerlink" title="ä¸­æ–­å‡½æ•°"></a>ä¸­æ–­å‡½æ•°</h4><p><strong>interrupt.cä¸­ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">uint ccrl_val=<span class="number">0</span>;</span><br><span class="line">uint frq=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">HAL_TIM_IC_CaptureCallback</span><span class="params">(TIM_HandleTypeDef *htim)</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸­æ–­å›è°ƒå‡½æ•°åè®°ä¸ä½çš„è¯å’ŒæŒ‰é”®é‚£ä¸€ç« ä¸€æ ·ï¼Œåœ¨tim.hæ–‡ä»¶é‡Œæ‰¾</p><details open><summary pointer> ä¸­æ–­å›è°ƒå‡½æ•° </summary>              <div class='content'>              <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">HAL_TIM_IC_CaptureCallback</span><span class="params">(TIM_HandleTypeDef *htim)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(htim-&gt;Instance==TIM17)</span><br><span class="line">&#123;</span><br><span class="line">ccrl_val = HAL_TIM_ReadCapturedValue(htim,TIM_CHANNEL_1);</span><br><span class="line">frq=(<span class="number">80000000</span>/<span class="number">80</span>)/ccrl_val;</span><br><span class="line">__HAL_TIM_SetCounter(htim,<span class="number">0</span>);</span><br><span class="line">HAL_TIM_IC_Start(htim,TIM_CHANNEL_1);<span class="comment">//IC:Input Capture</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>              </div>            </details><blockquote><p>æ³¨æ„è‡ªå·±å†™çš„ä¸­æ–­å›è°ƒå‡½æ•°æœ‰ä»€ä¹ˆç”¨ï¼Œå¦‚æœä¸å†™è‡ªå·±çš„å›è°ƒå‡½æ•°ï¼Œå·²è®¾ç½®çš„ä¸­æ–­ç…§æ ·æ­£å¸¸è¿è¡Œï¼Œè‡ªå·±çš„å‡½æ•°æ˜¯ç”¨æ¥ç‰¹æ®ŠåŒ–ä¸€äº›ä¸­æ–­æµç¨‹çš„ï¼Œæ²¡æœ‰ç‰¹æ®ŠåŒ–çš„ä»æ—§æŒ‰ç…§é»˜è®¤æ­£å¸¸è¿è¡Œ</p></blockquote><blockquote><p><strong>åŸç†è§£é‡Š:</strong><br>å½“TIM17çš„ä¸­æ–­è§¦å‘(å› ä¸ºé…ç½®äº†ä¸Šå‡æ²¿è§¦å‘ï¼Œå³å½“æ£€æµ‹åˆ°ä¸Šå‡æ²¿æ—¶)<br>è¿›å…¥ä¸­æ–­å›è°ƒå‡½æ•°<br>å› ä¸ºæœ€åä¸€è¡Œæ‰å¯åŠ¨å®šæ—¶å™¨çš„è¾“å…¥æ•è·é€šé“1<br>æ‰€ä»¥ç¬¬ä¸€æ¬¡è§¦å‘åï¼Œè®¡æ•°å™¨å½’0(__HAL_TIM_SetCounter(htim,0);)<br>å¯åŠ¨å®šæ—¶å™¨çš„è¾“å…¥æ•è·é€šé“1,å¼€å§‹è®¡æ•°<br>ç¬¬äºŒæ¬¡è§¦å‘ä¸­æ–­(å³ç¬¬äºŒæ¬¡ä¸Šå‡æ²¿)<br>ccrl_valè¯»å–åˆ°ä¸¤ä¸ªä¸Šå‡æ²¿é—´éš”(å› ä¸ºç¬¬ä¸€ä¸ªä¸Šå‡æ²¿æ‰å¼€å§‹è®¡æ•°)<br>æ‰€ä»¥é¢‘ç‡ç­‰äºæ—¶é’Ÿä¸»é¢‘é™¤ä»¥åˆ†é¢‘ç³»æ•°é™¤ä»¥å‘¨æœŸè®¡æ•°<br>é‡æ–°å¯åŠ¨å®šæ—¶å™¨çš„è¾“å…¥æ•è·é€šé“1</p></blockquote><h4 id="main-cä¸­é…ç½®"><a href="#main-cä¸­é…ç½®" class="headerlink" title="main.cä¸­é…ç½®"></a>main.cä¸­é…ç½®</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> uint frq;</span><br><span class="line">uchar pa1_duty=<span class="number">10</span>;<span class="comment">//åˆå§‹åŒ–å ç©ºæ¯”</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>mainå‡½æ•°é‡Œçš„åˆå§‹åŒ–:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">HAL_TIM_Base_Start_IT(&amp;htim4 );<span class="comment">//æŒ‰é”®çš„å®šæ—¶å™¨</span></span><br><span class="line">HAL_TIM_PWM_Start(&amp;htim2,TIM_CHANNEL_2);<span class="comment">//PA1çš„PWMè¾“å‡ºå¼€å¯</span></span><br><span class="line"></span><br><span class="line">HAL_TIM_IC_Start_IT(&amp;htim17,TIM_CHANNEL_1);<span class="comment">//é¢‘ç‡æµ‹é‡æ•è·å®šæ—¶å™¨å¼€å¯</span></span><br><span class="line"></span><br><span class="line">__HAL_TIM_SetCompare(&amp;htim2,TIM_CHANNEL_2,pa1_duty);<span class="comment">//è®¾ç½®åˆå§‹pwmé¢‘ç‡</span></span><br></pre></td></tr></table></figure><h3 id="åŒæ—¶æµ‹é¢‘ç‡å’Œå ç©ºæ¯”ï¼š"><a href="#åŒæ—¶æµ‹é¢‘ç‡å’Œå ç©ºæ¯”ï¼š" class="headerlink" title="åŒæ—¶æµ‹é¢‘ç‡å’Œå ç©ºæ¯”ï¼š"></a>åŒæ—¶æµ‹é¢‘ç‡å’Œå ç©ºæ¯”ï¼š</h3><h4 id="å¼•è„šé…ç½®"><a href="#å¼•è„šé…ç½®" class="headerlink" title="å¼•è„šé…ç½®"></a>å¼•è„šé…ç½®</h4><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.41xtci74hr.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.41xtci74hr.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/////////////////////////////æµ‹é‡é¢‘ç‡+å ç©ºæ¯”///////////////////</span></span><br><span class="line"><span class="type">double</span> ccr1_val1a=<span class="number">0</span>,ccr1_val2a=<span class="number">0</span>;</span><br><span class="line">uint ccr1_val1b=<span class="number">0</span>,ccr1_val2b=<span class="number">0</span>;</span><br><span class="line">uint frq1=<span class="number">0</span>,frq2=<span class="number">0</span>;<span class="comment">//é¢‘ç‡</span></span><br><span class="line"><span class="type">float</span> duty1=<span class="number">0</span>,duty2=<span class="number">0</span>;<span class="comment">//å ç©ºæ¯”</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">HAL_TIM_IC_CaptureCallback</span><span class="params">(TIM_HandleTypeDef *htim)</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(htim-&gt;Instance==TIM17)<span class="comment">//PA7</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//if(htim-&gt;Channel==HAL_TIM_ACTIVE_CHANNEL_1)//ä¸­æ–­æ¶ˆæ¯æ¥æº é€‰æ‹©ç›´æ¥è¾“å…¥çš„é€šé“</span></span><br><span class="line"><span class="comment">//&#123;</span></span><br><span class="line">ccr1_val1a=HAL_TIM_ReadCapturedValue(htim,TIM_CHANNEL_1);<span class="comment">//ç›´æ¥</span></span><br><span class="line"><span class="comment">//ccr1_val1b=HAL_TIM_ReadCapturedValue(htim,TIM_CHANNEL_2);//é—´æ¥</span></span><br><span class="line">__HAL_TIM_SetCounter(htim,<span class="number">0</span>);</span><br><span class="line">frq1=(<span class="number">80000000</span>/<span class="number">80</span>)/ccr1_val1a;</span><br><span class="line"><span class="comment">//duty1=(ccr1_val1b/ccr1_val1a)*100;</span></span><br><span class="line">HAL_TIM_IC_Start(htim,TIM_CHANNEL_1);</span><br><span class="line"><span class="comment">//HAL_TIM_IC_Start(htim,TIM_CHANNEL_2);</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(htim-&gt;Instance==TIM3)<span class="comment">//PB4</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(htim-&gt;Channel==HAL_TIM_ACTIVE_CHANNEL_1)<span class="comment">//ä¸­æ–­æ¶ˆæ¯æ¥æº é€‰æ‹©ç›´æ¥è¾“å…¥çš„é€šé“</span></span><br><span class="line">&#123;</span><br><span class="line">ccr1_val2a=HAL_TIM_ReadCapturedValue(htim,TIM_CHANNEL_1);</span><br><span class="line">ccr1_val2b=HAL_TIM_ReadCapturedValue(htim,TIM_CHANNEL_2);</span><br><span class="line">__HAL_TIM_SetCounter(htim,<span class="number">0</span>);</span><br><span class="line">frq2=(<span class="number">80000000</span>/<span class="number">80</span>)/ccr1_val2a;</span><br><span class="line">duty2=(ccr1_val2b/ccr1_val2a)*<span class="number">100</span>;</span><br><span class="line">HAL_TIM_IC_Start(htim,TIM_CHANNEL_1);</span><br><span class="line">HAL_TIM_IC_Start(htim,TIM_CHANNEL_2);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;è·³çº¿å¸½æ‹”äº†ä¸èƒ½çƒ§å·¥ç¨‹ã€‚ã€‚ã€‚ã€‚(å¥½åƒå¯ä»¥ã€‚ã€‚ã€‚é‚£å¤©ä¸çŸ¥é“æ€ä¹ˆäº†æ¿å­æŠ½é£)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;CubeMXé…ç½®&quot;&gt;&lt;a href=&quot;#CubeMXé…ç½®&quot; class=&quot;headerlink&quot; title=&quot;CubeMX</summary>
      
    
    
    
    <category term="åµŒå…¥å¼" scheme="http://tumytime.github.io/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/"/>
    
    
    <category term="åµŒå…¥å¼" scheme="http://tumytime.github.io/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/"/>
    
    <category term="stm32" scheme="http://tumytime.github.io/tags/stm32/"/>
    
    <category term="è“æ¡¥æ¯" scheme="http://tumytime.github.io/tags/%E8%93%9D%E6%A1%A5%E6%9D%AF/"/>
    
  </entry>
  
  <entry>
    <title>è“æ¡¥æ¯stm32å­¦ä¹ ç¬”è®°ï¼ˆå…­ï¼‰ï¼šPWMè¾“å‡º</title>
    <link href="http://tumytime.github.io/2024/03/17/%E8%93%9D%E6%A1%A5%E6%9D%AFstm32%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E5%85%AD%EF%BC%89%EF%BC%9APWM%E8%BE%93%E5%87%BA/"/>
    <id>http://tumytime.github.io/2024/03/17/%E8%93%9D%E6%A1%A5%E6%9D%AFstm32%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E5%85%AD%EF%BC%89%EF%BC%9APWM%E8%BE%93%E5%87%BA/</id>
    <published>2024-03-17T11:01:43.000Z</published>
    <updated>2024-03-19T08:39:12.112Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>PWMçš„å ç©ºæ¯”æ”¹å˜çš„æ˜¯CCRå¯„å­˜å™¨çš„å€¼ï¼ˆä¸åŒé€šé“å¯¹åº”ä¸åŒçš„CCRï¼‰ï¼Œé¢‘ç‡çš„æ”¹å˜å¯¹åº”çš„æ˜¯ARRå¯„å­˜å™¨çš„å€¼</p></blockquote><h3 id="CubeMXé…ç½®"><a href="#CubeMXé…ç½®" class="headerlink" title="CubeMXé…ç½®"></a>CubeMXé…ç½®</h3><h4 id="é…ç½®å¼•è„š"><a href="#é…ç½®å¼•è„š" class="headerlink" title="é…ç½®å¼•è„š"></a>é…ç½®å¼•è„š</h4><blockquote><p>é¢‘ç‡æ˜¯æŒ‡PWMä¿¡å·çš„å‘¨æœŸæ€§é‡å¤é¢‘ç‡ï¼Œå³PWMä¿¡å·åœ¨ä¸€æ®µæ—¶é—´å†…å®Œæ•´å‘¨æœŸé‡å¤çš„æ¬¡æ•°ã€‚é¢‘ç‡ä¸å ç©ºæ¯”å’Œè‡ªåŠ¨é‡è½½å€¼ä¹‹é—´å­˜åœ¨ä»¥ä¸‹å…³ç³»ï¼š</p><ol><li>PWMä¿¡å·çš„é¢‘ç‡ &#x3D; 1 &#x2F; PWMä¿¡å·çš„å‘¨æœŸ</li><li>PWMä¿¡å·çš„å‘¨æœŸ &#x3D; è‡ªåŠ¨é‡è½½å€¼ + 1</li><li>PWMä¿¡å·çš„å ç©ºæ¯” &#x3D; é«˜ç”µå¹³æ—¶é—´ &#x2F; PWMä¿¡å·çš„å‘¨æœŸ</li></ol></blockquote><p><strong>æˆ‘ä»¬è¿™é‡Œé…ç½®PC9è¾“å‡ºPWMæ³¢</strong><br>é…ç½®<code>PC9</code>å¼•è„šä¸º<code>TIM3_CH4</code>,é€‰æ‹©å®šæ—¶å™¨<code>TIM3</code>çš„é€šé“4(æœ‰å“ªä¸ªç”¨å“ªä¸ª)<br>(åé¢å¸¦<code>N</code>çš„æ˜¯äº’è¡¥PWMæ³¢)</p><blockquote><p>PWMé¢‘ç‡ &#x3D; 1 &#x2F; (å‘¨æœŸæ—¶é—´)<br>å•ä¸ªè„‰å†²å®½åº¦ &#x3D; (å ç©ºæ¯”) * (å‘¨æœŸæ—¶é—´)</p></blockquote><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.ibvk6580f.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.ibvk6580f.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div><h4 id="ç”Ÿæˆå·¥ç¨‹"><a href="#ç”Ÿæˆå·¥ç¨‹" class="headerlink" title="ç”Ÿæˆå·¥ç¨‹"></a>ç”Ÿæˆå·¥ç¨‹</h4><p><strong>ç‚¹å‡»å³ä¸Šè§’â€GENERATE CODEâ€,ç”Ÿæˆå·¥ç¨‹</strong></p><h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><h4 id="æ‰“å¼€å®šæ—¶å™¨"><a href="#æ‰“å¼€å®šæ—¶å™¨" class="headerlink" title="æ‰“å¼€å®šæ—¶å™¨"></a>æ‰“å¼€å®šæ—¶å™¨</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HAL_TIM_PWM_Start(&amp;htim3,TIM_CHANNEL_4);</span><br></pre></td></tr></table></figure><h4 id="ç¼–å†™ä»£ç "><a href="#ç¼–å†™ä»£ç " class="headerlink" title="ç¼–å†™ä»£ç "></a>ç¼–å†™ä»£ç </h4><details open><summary pointer> while(1) </summary>              <div class='content'>              <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">  &#123;</span><br><span class="line">LED_Disp(<span class="number">0x00</span>);<span class="comment">//LEDçš„åˆå§‹åŒ–</span></span><br><span class="line"><span class="keyword">if</span>(key[<span class="number">2</span>].single_flag==<span class="number">1</span>) &#123;</span><br><span class="line"></span><br><span class="line">w+=<span class="number">1000</span>;</span><br><span class="line"><span class="keyword">if</span>(w&gt;<span class="number">10000</span>)</span><br><span class="line">&#123;</span><br><span class="line">w=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">TIM3-&gt;CCR4 = w;</span><br><span class="line">key[<span class="number">2</span>].single_flag=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* USER CODE END WHILE */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* USER CODE BEGIN 3 */</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>              </div>            </details>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;PWMçš„å ç©ºæ¯”æ”¹å˜çš„æ˜¯CCRå¯„å­˜å™¨çš„å€¼ï¼ˆä¸åŒé€šé“å¯¹åº”ä¸åŒçš„CCRï¼‰ï¼Œé¢‘ç‡çš„æ”¹å˜å¯¹åº”çš„æ˜¯ARRå¯„å­˜å™¨çš„å€¼&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;CubeMXé…ç½®&quot;&gt;&lt;a href=&quot;#CubeMXé…ç½®&quot; class=&quot;headerlin</summary>
      
    
    
    
    <category term="åµŒå…¥å¼" scheme="http://tumytime.github.io/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/"/>
    
    
    <category term="åµŒå…¥å¼" scheme="http://tumytime.github.io/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/"/>
    
    <category term="stm32" scheme="http://tumytime.github.io/tags/stm32/"/>
    
    <category term="è“æ¡¥æ¯" scheme="http://tumytime.github.io/tags/%E8%93%9D%E6%A1%A5%E6%9D%AF/"/>
    
  </entry>
  
  <entry>
    <title>è“æ¡¥æ¯stm32å­¦ä¹ ç¬”è®°ï¼ˆäº”ï¼‰ï¼šæŒ‰é”®</title>
    <link href="http://tumytime.github.io/2024/03/16/%E8%93%9D%E6%A1%A5%E6%9D%AFstm32%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%BA%94%EF%BC%89%EF%BC%9A%E6%8C%89%E9%94%AE/"/>
    <id>http://tumytime.github.io/2024/03/16/%E8%93%9D%E6%A1%A5%E6%9D%AFstm32%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%EF%BC%88%E4%BA%94%EF%BC%89%EF%BC%9A%E6%8C%89%E9%94%AE/</id>
    <published>2024-03-16T10:24:00.000Z</published>
    <updated>2024-03-17T11:01:12.237Z</updated>
    
    <content type="html"><![CDATA[<h2 id="çŸ­æŒ‰é”®"><a href="#çŸ­æŒ‰é”®" class="headerlink" title="çŸ­æŒ‰é”®"></a>çŸ­æŒ‰é”®</h2><h3 id="ç”µè·¯å›¾"><a href="#ç”µè·¯å›¾" class="headerlink" title="ç”µè·¯å›¾"></a>ç”µè·¯å›¾</h3><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.1lbkuno8bo.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.1lbkuno8bo.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div><p>æŒ‰é”®æŒ‰ä¸‹åæ¥åœ°å˜ä¸ºä½ç”µå¹³ï¼ŒæœªæŒ‰ä¸‹ä¸ºé«˜ç”µå¹³ï¼›</p><h4 id="ä¸ç”¨å®šæ—¶å™¨çš„ç®€å•æŒ‰é”®ï¼š"><a href="#ä¸ç”¨å®šæ—¶å™¨çš„ç®€å•æŒ‰é”®ï¼š" class="headerlink" title="ä¸ç”¨å®šæ—¶å™¨çš„ç®€å•æŒ‰é”®ï¼š"></a>ä¸ç”¨å®šæ—¶å™¨çš„ç®€å•æŒ‰é”®ï¼š</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(HAL_GPIO_ReadPin (GPIOB,GPIO_PIN_0)==GPIO_PIN_RESET ) &#123;</span><br><span class="line">HAL_GPIO_WritePin(GPIOC,GPIO_PIN_8,GPIO_PIN_RESET );</span><br><span class="line">HAL_GPIO_WritePin(GPIOD,GPIO_PIN_2,GPIO_PIN_SET);</span><br><span class="line">HAL_GPIO_WritePin(GPIOD,GPIO_PIN_2,GPIO_PIN_RESET);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">HAL_GPIO_WritePin(GPIOC,GPIO_PIN_8,GPIO_PIN_SET );</span><br><span class="line">HAL_GPIO_WritePin(GPIOD,GPIO_PIN_2,GPIO_PIN_SET);</span><br><span class="line">HAL_GPIO_WritePin(GPIOD,GPIO_PIN_2,GPIO_PIN_RESET);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="CubeMXé…ç½®"><a href="#CubeMXé…ç½®" class="headerlink" title="CubeMXé…ç½®"></a>CubeMXé…ç½®</h3><h4 id="å¼•è„šé…ç½®"><a href="#å¼•è„šé…ç½®" class="headerlink" title="å¼•è„šé…ç½®"></a>å¼•è„šé…ç½®</h4><p>é…ç½®<code>PB0-2</code>å’Œ<code>PA0</code>ä¸º<code>GPIO_Input</code><br>å¹¶å°†<code>GPIO Pull-up/Pull-down</code>é…ç½®ä¸º<code>Pull-up</code></p><h4 id="å®šæ—¶å™¨é…ç½®"><a href="#å®šæ—¶å™¨é…ç½®" class="headerlink" title="å®šæ—¶å™¨é…ç½®"></a>å®šæ—¶å™¨é…ç½®</h4><p>é€‰ä¸€ä¸ªå®šæ—¶å™¨ï¼ˆè¿™é‡Œé€‰æ‹©TIM4ï¼‰</p><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.7smyutv65f.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.7smyutv65f.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div><p>é…ç½®æ—¶é’Ÿæºä¸ºå†…éƒ¨æ—¶é’Ÿ</p><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.wibapqvqk.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.wibapqvqk.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div><details open><summary pointer> é€‰é¡¹è§£é‡Š </summary>              <div class='content'>              <ol><li><p><strong>Prescaler (PSC-16 bits value)</strong>:</p><ul><li>Prescaleræ˜¯ç”¨äºå°†è¾“å…¥æ—¶é’Ÿé¢‘ç‡è¿›è¡Œåˆ†é¢‘çš„å‚æ•°ï¼Œä»¥é™ä½è®¡æ•°å™¨çš„å·¥ä½œé¢‘ç‡ã€‚16ä½å€¼è¡¨ç¤ºäº†åˆ†é¢‘æ¯”ï¼Œç”¨äºæ§åˆ¶è®¡æ•°å™¨æ¯æ¬¡è®¡æ•°ä¹‹å‰å¦‚ä½•åˆ†é¢‘è¾“å…¥æ—¶é’Ÿã€‚è¾ƒå¤§çš„åˆ†é¢‘æ¯”ä¼šä½¿è®¡æ•°å™¨å·¥ä½œåœ¨è¾ƒä½çš„é¢‘ç‡ä¸‹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªç³»ç»Ÿçš„è¾“å…¥æ—¶é’Ÿé¢‘ç‡ä¸º10 MHzï¼Œè€Œè®¡æ•°å™¨éœ€è¦ä»¥1 kHzçš„é¢‘ç‡è¿›è¡Œè®¡æ•°ï¼Œé‚£ä¹ˆå¯ä»¥é€šè¿‡è®¾ç½®é€‚å½“çš„é¢„åˆ†é¢‘å™¨å€¼æ¥å®ç°è¿™ä¸€è¦æ±‚ã€‚å‡è®¾æˆ‘ä»¬è®¾ç½®é¢„åˆ†é¢‘å™¨çš„16ä½å€¼ä¸º10000ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¾“å…¥æ—¶é’Ÿåœ¨è¿›å…¥è®¡æ•°å™¨ä¹‹å‰ä¼šå…ˆè¿›è¡Œ10,000å€çš„åˆ†é¢‘ã€‚è¿™æ ·ï¼Œæ¯10,000ä¸ªè¾“å…¥æ—¶é’Ÿå‘¨æœŸï¼Œè®¡æ•°å™¨æ‰ä¼šè®¡æ•°ä¸€æ¬¡ï¼Œä»è€Œä½¿å¾—è®¡æ•°å™¨çš„å·¥ä½œé¢‘ç‡ä¸º1 kHzã€‚ä¸åŒçš„åº”ç”¨åœºæ™¯ä¼šæœ‰ä¸åŒçš„è®¡æ•°éœ€æ±‚ã€‚ä¾‹å¦‚ï¼ŒæŸäº›åº”ç”¨å¯èƒ½éœ€è¦é«˜é€Ÿè®¡æ•°ï¼Œä¸€ç§è®¡æ•°å™¨çš„é¢‘ç‡å¯èƒ½éœ€è¦è¾¾åˆ°å‡ åMHzç”šè‡³æ›´é«˜çš„é¢‘ç‡ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè®¡æ•°å™¨éœ€è¦ä»¥æ›´é«˜çš„é€Ÿç‡è¿›è¡Œè®¡æ•°ï¼Œä»¥æ»¡è¶³å¯¹è®¡æ•°ç²¾åº¦å’Œé€Ÿåº¦çš„è¦æ±‚ã€‚å¦ä¸€æ–¹é¢ï¼Œä¸€äº›åº”ç”¨å¯èƒ½åªéœ€è¦ä½é€Ÿè®¡æ•°ï¼Œæ¯”å¦‚åœ¨ä¸€äº›ä¼ æ„Ÿå™¨ç›‘æµ‹ç³»ç»Ÿä¸­ï¼Œè®¡æ•°å™¨å¯ä»¥ä»¥è¾ƒä½çš„é¢‘ç‡è¿›è¡Œè®¡æ•°ï¼Œä»¥å®æ—¶ç›‘æµ‹å¹¶è®°å½•äº‹ä»¶å‘ç”Ÿçš„æ¬¡æ•°ã€‚</li></ul></li><li><p><strong>Counter Mode</strong>:</p><ul><li>æ­¤å¤„è®¾ç½®è®¡æ•°å™¨çš„å·¥ä½œæ¨¡å¼ä¸ºâ€Upâ€ï¼Œå³è®¡æ•°å™¨ä¼šä»0å¼€å§‹é€’å¢è®¡æ•°ï¼Œè®¡æ•°åˆ°æœ€å¤§å€¼åé‡æ–°ä»0å¼€å§‹ã€‚</li></ul></li><li><p><strong>Dithering</strong>:</p><ul><li>åœ¨è¿™é‡Œè®¾ç½®äº†ç¦ç”¨æŠ–åŠ¨ï¼ˆDitheringï¼‰ï¼ŒæŠ–åŠ¨æ˜¯æŒ‡é€šè¿‡å¾®å°çš„éšæœºå˜åŒ–æ¥å‡å°é‡åŒ–è¯¯å·®çš„ä¸€ç§æŠ€æœ¯ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒæŠ–åŠ¨è¢«ç¦ç”¨ï¼Œå³ä¸ä¼šåœ¨è®¡æ•°å™¨ä¸­å¼•å…¥è¿™ç§å¾®å°çš„å˜åŒ–ã€‚</li></ul></li><li><p><strong>Counter Period (AutoReload Register)</strong>:</p><ul><li>è®¾ç½®è®¡æ•°å™¨çš„è®¡æ•°å‘¨æœŸï¼Œé€šå¸¸é€šè¿‡AutoReload Registerï¼ˆè‡ªåŠ¨é‡è£…è½½å¯„å­˜å™¨ï¼‰æ¥å®ç°ã€‚åœ¨è¿™é‡Œè®¾ç½®äº†è®¡æ•°å™¨çš„å‘¨æœŸä¸º0åˆ°65535ä¹‹é—´çš„å€¼ï¼Œå½“è®¡æ•°å™¨è¾¾åˆ°æœ€å¤§å€¼æ—¶ä¼šé‡æ–°åŠ è½½åˆå§‹å€¼ã€‚</li></ul></li><li><p><strong>Internal Clock Division (CKD)</strong>:</p><ul><li>è®¾ç½®å†…éƒ¨æ—¶é’Ÿåˆ†é¢‘ï¼ˆCKDï¼‰ï¼Œåœ¨è¿™é‡Œé€‰æ‹©äº†â€No Divisionâ€ï¼Œè¡¨ç¤ºè®¡æ•°å™¨çš„æ—¶é’Ÿä¸ä¼šè¢«åˆ†é¢‘ï¼Œä»¥ç¡®ä¿è®¡æ•°å™¨è¿è¡Œåœ¨è¾“å…¥æ—¶é’Ÿçš„æœ€é«˜é¢‘ç‡ä¸‹ã€‚</li></ul></li><li><p><strong>Auto-reload preload</strong>:</p><ul><li>åœ¨è¿™é‡Œç¦ç”¨äº†è‡ªåŠ¨åŠ è½½é¢„è®¾å€¼åŠŸèƒ½ï¼Œå³ä¸ä¼šåœ¨è®¡æ•°å™¨è‡ªåŠ¨é‡æ–°åŠ è½½æ—¶é¢„å…ˆè£…è½½æ–°çš„å€¼ã€‚</li></ul></li></ol><p>è¿™äº›è®¾ç½®æœ‰åŠ©äºè°ƒæ•´è®¡æ—¶å™¨&#x2F;è®¡æ•°å™¨çš„è¡Œä¸ºå’Œæ€§èƒ½ï¼Œä¾‹å¦‚è°ƒæ•´è®¡æ•°æ¨¡å¼ã€å‘¨æœŸä»¥åŠæ—¶é’Ÿåˆ†é¢‘ç­‰ï¼Œä»¥æ»¡è¶³ç‰¹å®šçš„åº”ç”¨éœ€æ±‚ã€‚é€šè¿‡åˆç†è®¾ç½®è¿™äº›å‚æ•°ï¼Œå¯ä»¥æœ‰æ•ˆåœ°æ§åˆ¶è®¡æ—¶å™¨&#x2F;è®¡æ•°å™¨çš„åŠŸèƒ½ï¼Œç¡®ä¿å…¶åœ¨ç³»ç»Ÿä¸­æ­£ç¡®ã€ç¨³å®šåœ°è¿è¡Œã€‚</p>              </div>            </details><ol><li><p><strong>Prescaler</strong>:åˆ†é¢‘ç³»æ•°ï¼Œå†³å®šå®šæ—¶å™¨çš„å·¥ä½œé¢‘ç‡<br> å®šæ—¶å™¨å·¥ä½œé¢‘ç‡&#x3D;å¤–éƒ¨æ€»çº¿é¢‘ç‡(80MHz)&#x2F;(PSC+1)<br> è¿™é‡Œè®¾ç½®ä¸º80-1,å³å®šæ—¶å™¨å·¥ä½œé¢‘ç‡&#x3D;80ï¼Œ000ï¼Œ000&#x2F;80&#x3D;1ï¼Œ000ï¼Œ000</p></li><li><p><strong>Counter Period</strong>:<br> å®šæ—¶é¢‘ç‡&#x3D;å®šæ—¶å™¨å·¥ä½œé¢‘ç‡&#x2F;counter<br> è¿™é‡Œè®¾ç½®ä¸º10000-1,å³å®šæ—¶é¢‘ç‡&#x3D;1ï¼Œ000ï¼Œ000&#x2F;10ï¼Œ000&#x3D;100Hzï¼Œå³å®šæ—¶å‘¨æœŸ10ms;<br> 10msä¸­æ–­ä¸€æ¬¡ï¼›</p></li></ol><p><strong>ä½¿èƒ½ä¸­æ–­</strong></p><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.4n7gvyvfe6.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.4n7gvyvfe6.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div><h4 id="ç”Ÿæˆå·¥ç¨‹"><a href="#ç”Ÿæˆå·¥ç¨‹" class="headerlink" title="ç”Ÿæˆå·¥ç¨‹"></a>ç”Ÿæˆå·¥ç¨‹</h4><p><strong>ç‚¹å‡»å³ä¸Šè§’â€GENERATE CODEâ€,ç”Ÿæˆå·¥ç¨‹</strong></p><h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><h4 id="æ–°å»ºä¸¤ä¸ªæ–‡ä»¶"><a href="#æ–°å»ºä¸¤ä¸ªæ–‡ä»¶" class="headerlink" title="æ–°å»ºä¸¤ä¸ªæ–‡ä»¶"></a>æ–°å»ºä¸¤ä¸ªæ–‡ä»¶</h4><p>ä¿å­˜<code>interrupt.c</code>å’Œ<code>interrupt.h</code>åˆ°<code>bsp</code>æ–‡ä»¶å¤¹<br>ç„¶åæ·»åŠ <code>interrupt.c</code>åˆ°é¡¹ç›®<code>bsp</code>æ–‡ä»¶å¤¹é‡Œ</p><h4 id="å†™ä¸­æ–­å›è°ƒå‡½æ•°"><a href="#å†™ä¸­æ–­å›è°ƒå‡½æ•°" class="headerlink" title="å†™ä¸­æ–­å›è°ƒå‡½æ•°"></a>å†™ä¸­æ–­å›è°ƒå‡½æ•°</h4><p>è®°ä¸ä½å‡½æ•°åå¤åˆ¶è¿™ä¸ª:</p><div class="img-wrap"><div class="img-bg"><img class="img lazyload placeholder" src="https://tumytime.github.io/picx-images-hosting/image.wibaqozwy.webp" class="lazyload placeholder" data-srcset="https://tumytime.github.io/picx-images-hosting/image.wibaqozwy.webp" srcset="https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp"/></div></div><h4 id="interrupt-h"><a href="#interrupt-h" class="headerlink" title="interrupt.h"></a>interrupt.h</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> _INTERRUPT_H_</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _INTERRUPT_H_</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;main.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdbool.h&quot;</span></span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">keys</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">uchar judge;</span><br><span class="line"><span class="type">bool</span> status;</span><br><span class="line"><span class="type">bool</span> single_flag;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><h4 id="interrupt-c"><a href="#interrupt-c" class="headerlink" title="interrupt.c"></a>interrupt.c</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;interrupt.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">keys</span> <span class="title">key</span>[4]=</span> &#123;&#123;<span class="number">0</span>,<span class="literal">false</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="literal">false</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="literal">false</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="literal">false</span>,<span class="number">0</span>&#125;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">HAL_TIM_PeriodElapsedCallback</span><span class="params">(TIM_HandleTypeDef *htim)</span> &#123;</span><br><span class="line"></span><br><span class="line">key[<span class="number">0</span>].status=HAL_GPIO_ReadPin (GPIOB,GPIO_PIN_0);</span><br><span class="line">key[<span class="number">1</span>].status=HAL_GPIO_ReadPin (GPIOB,GPIO_PIN_1);</span><br><span class="line">key[<span class="number">2</span>].status=HAL_GPIO_ReadPin (GPIOB,GPIO_PIN_2);</span><br><span class="line">key[<span class="number">3</span>].status=HAL_GPIO_ReadPin (GPIOA,GPIO_PIN_0);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(htim-&gt;Instance==TIM4) &#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">4</span>; i++) </span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">switch</span>(key[i].judge)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(key[i].status==<span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">key[i].judge=<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;<span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(key[i].status==<span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">key[i].judge=<span class="number">2</span>;</span><br><span class="line">key[i].single_flag=<span class="number">1</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;key[i].judge=<span class="number">0</span>;&#125;</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(key[i].status==<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">key[i].judge=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="main-cä¸­externç»“æ„ä½“-æ‰“å¼€ä¸­æ–­"><a href="#main-cä¸­externç»“æ„ä½“-æ‰“å¼€ä¸­æ–­" class="headerlink" title="main.cä¸­externç»“æ„ä½“&#x2F;æ‰“å¼€ä¸­æ–­"></a>main.cä¸­externç»“æ„ä½“&#x2F;æ‰“å¼€ä¸­æ–­</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">extern</span> <span class="class"><span class="keyword">struct</span> <span class="title">keys</span> <span class="title">key</span>[];</span></span><br></pre></td></tr></table></figure><p><strong>mainå‡½æ•°é‡Œï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HAL_TIM_Base_Start_IT(&amp;htim4 );</span><br></pre></td></tr></table></figure><blockquote><p>ä¸€å®šè¦æ”¾åœ¨<code>MX_TIM4_Init();</code>åé¢ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼</p></blockquote><blockquote><p>å¯åŠ¨å®šæ—¶å™¨ TIM4 çš„åŸºæœ¬å®šæ—¶å™¨æ¨¡å¼å¹¶ä½¿èƒ½å®šæ—¶å™¨ä¸­æ–­.</p></blockquote><h2 id="é•¿æŒ‰é”®"><a href="#é•¿æŒ‰é”®" class="headerlink" title="é•¿æŒ‰é”®"></a>é•¿æŒ‰é”®</h2><h3 id="interrupt-h-1"><a href="#interrupt-h-1" class="headerlink" title="interrupt.h"></a>interrupt.h</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> _INTERRUPT_H_</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> _INTERRUPT_H_</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;main.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;stdbool.h&quot;</span></span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">keys</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">uchar judge;</span><br><span class="line"><span class="type">bool</span> status;</span><br><span class="line"><span class="type">bool</span> single_flag;</span><br><span class="line"><span class="type">bool</span> long_flag;</span><br><span class="line">uint time;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure><h3 id="interrupt-c-1"><a href="#interrupt-c-1" class="headerlink" title="interrupt.c"></a>interrupt.c</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;interrupt.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">keys</span> <span class="title">key</span>[4]=</span> &#123;&#123;<span class="number">0</span>,<span class="literal">false</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="literal">false</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="literal">false</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;,&#123;<span class="number">0</span>,<span class="literal">false</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">HAL_TIM_PeriodElapsedCallback</span><span class="params">(TIM_HandleTypeDef *htim)</span> &#123;</span><br><span class="line"></span><br><span class="line">key[<span class="number">0</span>].status=HAL_GPIO_ReadPin (GPIOB,GPIO_PIN_0);</span><br><span class="line">key[<span class="number">1</span>].status=HAL_GPIO_ReadPin (GPIOB,GPIO_PIN_1);</span><br><span class="line">key[<span class="number">2</span>].status=HAL_GPIO_ReadPin (GPIOB,GPIO_PIN_2);</span><br><span class="line">key[<span class="number">3</span>].status=HAL_GPIO_ReadPin (GPIOA,GPIO_PIN_0);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(htim-&gt;Instance==TIM4) &#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">4</span>; i++) &#123;</span><br><span class="line"><span class="keyword">switch</span>(key[i].judge) &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">0</span>: &#123;</span><br><span class="line"><span class="keyword">if</span>(key[i].status==<span class="number">0</span>) &#123;</span><br><span class="line">key[i].judge=<span class="number">1</span>;</span><br><span class="line">key[i].time =<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span>: &#123;</span><br><span class="line"><span class="keyword">if</span>(key[i].status==<span class="number">0</span>) &#123;</span><br><span class="line">key[i].judge=<span class="number">2</span>;</span><br><span class="line"><span class="comment">//key[i].single_flag=1;</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">key[i].judge=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">2</span>: &#123;</span><br><span class="line"><span class="keyword">if</span>(key[i].status==<span class="number">1</span>) &#123;</span><br><span class="line">key[i].judge=<span class="number">0</span>;</span><br><span class="line">key[i].single_flag=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span>(key[i].time&lt;<span class="number">200</span>)</span><br><span class="line">&#123;</span><br><span class="line">key[i].long_flag=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">key[i].time++;</span><br><span class="line"><span class="keyword">if</span>(key[i].time&gt;<span class="number">200</span>)</span><br><span class="line">&#123;</span><br><span class="line">key[i].long_flag=<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>key[i].time&gt;200:</strong><br>ä¹‹å‰é…ç½®çš„å®šæ—¶å™¨ä¸€ä¸ªå‘¨æœŸ10ms,<strong>200ä¹Ÿå°±æ˜¯2s</strong></p><h2 id="å‡½æ•°å°è£…"><a href="#å‡½æ•°å°è£…" class="headerlink" title="å‡½æ•°å°è£…"></a>å‡½æ•°å°è£…</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">char</span>  view=<span class="number">0</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">key_proc</span><span class="params">()</span>;</span><br><span class="line"><span class="type">void</span> <span class="title function_">disp_proc</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">key_proc</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(key[<span class="number">0</span>].single_flag==<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">key[<span class="number">0</span>].single_flag =<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(key[<span class="number">1</span>].single_flag==<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line">view++;</span><br><span class="line"><span class="keyword">if</span>(view&gt;<span class="number">2</span>)</span><br><span class="line">&#123;</span><br><span class="line">view=<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">key[<span class="number">1</span>].single_flag =<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(key[<span class="number">2</span>].single_flag==<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">key[<span class="number">2</span>].single_flag =<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(key[<span class="number">3</span>].single_flag==<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">key[<span class="number">3</span>].single_flag =<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">disp_proc</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(view==<span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">char</span> text[<span class="number">30</span>];</span><br><span class="line"><span class="built_in">sprintf</span>(text,<span class="string">&quot;  view=0      &quot;</span>);</span><br><span class="line">LCD_DisplayStringLine(Line9, (<span class="type">uint8_t</span> *)text);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(view==<span class="number">1</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">char</span> text[<span class="number">30</span>];</span><br><span class="line"><span class="built_in">sprintf</span>(text,<span class="string">&quot;  view=1      &quot;</span>);</span><br><span class="line">LCD_DisplayStringLine(Line9, (<span class="type">uint8_t</span> *)text);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(view==<span class="number">2</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">char</span> text[<span class="number">30</span>];</span><br><span class="line"><span class="built_in">sprintf</span>(text,<span class="string">&quot;  view=2      &quot;</span>);</span><br><span class="line">LCD_DisplayStringLine(Line9, (<span class="type">uint8_t</span> *)text);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;çŸ­æŒ‰é”®&quot;&gt;&lt;a href=&quot;#çŸ­æŒ‰é”®&quot; class=&quot;headerlink&quot; title=&quot;çŸ­æŒ‰é”®&quot;&gt;&lt;/a&gt;çŸ­æŒ‰é”®&lt;/h2&gt;&lt;h3 id=&quot;ç”µè·¯å›¾&quot;&gt;&lt;a href=&quot;#ç”µè·¯å›¾&quot; class=&quot;headerlink&quot; title=&quot;ç”µè·¯å›¾&quot;&gt;&lt;/a&gt;ç”µè·¯å›¾&lt;/h</summary>
      
    
    
    
    <category term="åµŒå…¥å¼" scheme="http://tumytime.github.io/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/"/>
    
    
    <category term="åµŒå…¥å¼" scheme="http://tumytime.github.io/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/"/>
    
    <category term="stm32" scheme="http://tumytime.github.io/tags/stm32/"/>
    
    <category term="è“æ¡¥æ¯" scheme="http://tumytime.github.io/tags/%E8%93%9D%E6%A1%A5%E6%9D%AF/"/>
    
  </entry>
  
</feed>
